"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2894],{80854:function(e,t,r){function getDisplayName(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",{displayName:s,display_name:o,fullName:n,full_name:l,familyName:i,family_name:a,givenName:c,given_name:d,surname:h,lastName:u,last_name:x,firstName:p,first_name:m}=null!==(t=e.raw_user_meta_data)&&void 0!==t?t:{},g=i||a||h||u||x,v=c||d||p||m;return s||o||n||l||v&&g&&"".concat(v," ").concat(g)||r}function getAvatarUrl(e){var t;let{avatarUrl:r,avatarURL:s,avatar_url:o,profileUrl:n,profileURL:l,profile_url:i,profileImage:a,profile_image:c,profileImageUrl:d,profileImageURL:h,profile_image_url:u}=null!==(t=e.raw_user_meta_data)&&void 0!==t?t:{};return r||s||o||a||c||n||l||i||d||h||u}r.d(t,{E:function(){return getAvatarUrl},G:function(){return getDisplayName}})},2894:function(e,t,r){r.d(t,{Q:function(){return RoleImpersonationSelector_RoleImpersonationPopover},G:function(){return RoleImpersonationSelector_RoleImpersonationSelector}});var s=r(52322),o=r(2784),n=r(56469),l=r(94580),i=r(4220),a=r(81395),c=r(30474),d=r(11033),h=r(80854),u=r(97036),x=r(38617);let ServiceRoleIcon=e=>{let{isSelected:t=!1}=e,{resolvedTheme:r}=(0,x.F)();return(0,s.jsx)("svg",{width:"53",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsxs)("g",{opacity:t?"1":".5",children:[(0,s.jsx)("rect",{x:"37.161",y:".53",width:"15",height:"15",rx:"5.5",stroke:"light"===r?"#11181C":"#EDEDED"}),(0,s.jsx)("path",{d:"M1 10.53h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2"}),(0,s.jsx)("rect",{x:"15.964",y:".53",width:"9",height:"15",rx:"4.5",stroke:"light"===r?"#7E868C":"#7E7E7E"}),(0,s.jsx)("path",{d:"M1 5.53h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2"})]})})},AnonIcon=e=>{let{isSelected:t=!1}=e,{resolvedTheme:r}=(0,x.F)();return(0,s.jsx)("svg",{width:"53",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsxs)("g",{opacity:t?"1":".5",children:[(0,s.jsx)("path",{d:"M1 4.994a.5.5 0 0 0 0 1v-1Zm16.218 1h.5v-1h-.5v1ZM1 5.994h1.014v-1H1v1Zm3.04 0h2.028v-1H4.041v1Zm4.056 0h2.027v-1H8.096v1Zm4.054 0h2.027v-1H12.15v1Zm4.055 0h1.013v-1h-1.013v1Z",fill:"light"===r?"#7E868C":"#7E7E7E"}),(0,s.jsx)("path",{d:"m15.92 12.56 9.04-9.04",stroke:"light"===r?"#11181C":"#EDEDED"}),(0,s.jsx)("rect",{x:"15.964",y:".494",width:"9",height:"15",rx:"4.5",stroke:"light"===r?"#11181C":"#EDEDED"}),(0,s.jsx)("rect",{x:"37.161",y:".744",width:"15",height:"15",rx:"5.5",stroke:"light"===r?"#11181C":"#EDEDED"}),(0,s.jsx)("path",{d:"M1 10.494h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2"}),(0,s.jsx)("path",{d:"M15.96 7.562 22.568.956M19.049 14.885l5.957-5.958",stroke:"light"===r?"#11181C":"#EDEDED"})]})})},AuthenticatedIcon=e=>{let{isSelected:t=!1}=e,{resolvedTheme:r}=(0,x.F)();return(0,s.jsx)("svg",{width:"68",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsxs)("g",{opacity:t?"1":".5",children:[(0,s.jsx)("path",{d:"M15.63 5.156a.5.5 0 1 0 0 1v-1Zm16.218 1h.5v-1h-.5v1Zm-16.218 0h1.013v-1H15.63v1Zm3.04 0h2.028v-1h-2.027v1Zm4.055 0h2.028v-1h-2.028v1Zm4.055 0h2.027v-1H26.78v1Zm4.055 0h1.013v-1h-1.013v1Z",fill:"light"===r?"#7E868C":"#7E7E7E"}),(0,s.jsx)("path",{d:"m30.55 12.722 9.04-9.04",stroke:"light"===r?"#11181C":"#EDEDED"}),(0,s.jsx)("rect",{x:"30.594",y:".656",width:"9",height:"15",rx:"4.5",stroke:"light"===r?"#11181C":"#EDEDED"}),(0,s.jsx)("rect",{x:"51.791",y:".906",width:"15",height:"15",rx:"5.5",stroke:"light"===r?"#11181C":"#EDEDED"}),(0,s.jsx)("path",{d:"M15.63 10.656h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2"}),(0,s.jsx)("path",{d:"m30.59 7.724 6.607-6.606M33.679 15.047l5.957-5.958",stroke:"light"===r?"#11181C":"#EDEDED"}),(0,s.jsx)("path",{d:"M12.666 14.281v-1.333A2.667 2.667 0 0 0 10 10.28H6a2.667 2.667 0 0 0-2.667 2.667v1.333M8 7.615A2.667 2.667 0 1 0 8 2.28a2.667 2.667 0 0 0 0 5.334Z",stroke:"light"===r?"#11181C":"#EDEDED",strokeLinecap:"round",strokeLinejoin:"round"})]})})};var p=r(55216),m=r(60537),g=r(97265),IconMinus_IconMinus=function(e){return(0,s.jsx)(g.Z,{icon:m.Z,...e})},RoleImpersonationSelector_RoleImpersonationRadio=function(e){let{label:t,value:r,isSelected:o,onSelectedChange:n,icon:l}=e;return(0,s.jsxs)("label",{className:(0,i.cn)("border border-default rounded-md bg-surface-200 hover:bg-overlay-hover hover:border-control px-4 py-3 w-44 cursor-pointer transition-colors",o&&"border-stronger bg-surface-300"),tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&n(r)},htmlFor:"role-".concat(r),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[l&&(0,s.jsx)("div",{children:l}),o&&(0,s.jsxs)("div",{className:"flex items-center justify-center p-0.5 bg-foreground text-background rounded-full",children:["boolean"==typeof o&&(0,s.jsx)(p.Z,{size:12,strokeWidth:"4",className:"text-background"}),"partially"===o&&(0,s.jsx)(IconMinus_IconMinus,{size:12,strokeWidth:"4",className:"text-background"})]})]}),(0,s.jsx)("input",{id:"role-".concat(r),type:"radio",name:"role",value:r,checked:!!o,onChange:e=>{n(e.target.value)},className:"invisible h-0 w-0 border-0"}),(0,s.jsxs)("span",{className:(0,i.cn)("text-sm text-foreground-light whitespace-nowrap select-none transition-colors",o&&"text-foreground"),children:[null!=t?t:r," role"]})]})},v=r(53111),f=r(2755),j=r(7503),w=r(48193),y=r(47716),k=r(38880),E=r(88724),b=r(31915),RoleImpersonationSelector_UserImpersonationSelector=()=>{var e,t,r,n;let[i,a]=(0,o.useState)(""),c=(0,v.Nr)(i,300),{project:u}=(0,f.d2)(),{data:x,isSuccess:p,isLoading:m,isError:g,error:N,isFetching:S,isPreviousData:R}=(0,w.xY)({projectRef:null==u?void 0:u.ref,keywords:c||void 0},{keepPreviousData:!0}),I=(0,d.fN)(),D=(null===(e=I.role)||void 0===e?void 0:e.type)==="postgrest"&&"authenticated"===I.role.role&&I.role.user;function impersonateUser(e){I.setRole({type:"postgrest",role:"authenticated",user:e})}return(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("h2",{className:"text-foreground text-base",children:D?"Impersonating ".concat((0,h.G)(D,null!==(n=null!==(r=null!==(t=D.email)&&void 0!==t?t:D.phone)&&void 0!==r?r:D.id)&&void 0!==n?n:"Unknown")):"Impersonate a User"}),(0,s.jsx)("p",{className:"text-sm text-foreground-light max-w-md",children:D?"Results will respect your database's Row-Level Security policies for this user.":"Select a user to respect your database's Row-Level Security policies for that particular user."}),D?(0,s.jsx)(UserImpersonatingRow,{user:D,onClick:function(){I.setRole(void 0)},isImpersonating:!0}):(0,s.jsxs)("div",{className:"flex flex-col gap-2 mt-4",children:[(0,s.jsx)(b.Z,{className:"table-editor-search border-none",icon:R&&S?(0,s.jsx)(y.Z,{className:"animate-spin text-foreground-lighter",size:16,strokeWidth:1.5}):(0,s.jsx)(k.Z,{className:"text-foreground-lighter",size:16,strokeWidth:1.5}),placeholder:"Search for a user..",onChange:e=>a(e.target.value.trim()),value:i,size:"small",actions:i&&(0,s.jsx)(l.z,{size:"tiny",type:"text",className:"px-1",onClick:()=>a(""),children:(0,s.jsx)(E.Z,{size:12,strokeWidth:2})})}),m&&(0,s.jsxs)("div",{className:"flex flex-col gap-2 items-center justify-center h-24",children:[(0,s.jsx)(y.Z,{className:"animate-spin",size:24}),(0,s.jsx)("span",{children:"Loading users..."})]}),g&&(0,s.jsx)(j.Z,{error:N,subject:"Failed to retrieve users"}),p&&(x.users.length>0?(0,s.jsx)("ul",{className:"divide-y max-h-[192px] overflow-y-scroll",role:"list",children:x.users.map(e=>(0,s.jsx)("li",{role:"listitem",children:(0,s.jsx)(UserRow,{user:e,onClick:impersonateUser})},e.id))}):(0,s.jsx)("div",{className:"flex flex-col gap-2 items-center justify-center h-24",children:(0,s.jsx)("p",{className:"text-foreground-light text-xs",role:"status",children:"No users found"})}))]})]})};let UserImpersonatingRow=e=>{var t,r,o;let{user:n,onClick:i,isImpersonating:a=!1}=e,d=(0,h.E)(n),u=(0,h.G)(n,null!==(o=null!==(r=null!==(t=n.email)&&void 0!==t?t:n.phone)&&void 0!==r?r:n.id)&&void 0!==o?o:"Unknown");return(0,s.jsxs)("div",{className:"flex items-center gap-3 py-2 text-foreground",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 bg-surface-200 pr-5 pl-0.5 py-0.5 border rounded-full max-w-l",children:[d?(0,s.jsx)("img",{className:"rounded-full w-5 h-5",src:d,alt:u}):(0,s.jsx)("div",{className:"rounded-full w-[21px] h-[21px] bg-surface-300 border border-strong flex items-center justify-center",children:(0,s.jsx)(c.Z,{size:12,strokeWidth:2})}),(0,s.jsx)("span",{className:"text-sm truncate",children:u})]}),(0,s.jsx)(l.z,{type:"secondary",onClick:()=>{i(n)},children:a?"Stop Impersonating":"Impersonate"})]})},UserRow=e=>{var t,r,o;let{user:n,onClick:i,isImpersonating:a=!1}=e,d=(0,h.E)(n),u=(0,h.G)(n,null!==(o=null!==(r=null!==(t=n.email)&&void 0!==t?t:n.phone)&&void 0!==r?r:n.id)&&void 0!==o?o:"Unknown");return(0,s.jsxs)("div",{className:"flex items-center justify-between py-2 text-foreground",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[d?(0,s.jsx)("img",{className:"rounded-full w-5 h-5",src:d,alt:u}):(0,s.jsx)("div",{className:"rounded-full w-[21px] h-[21px] bg-surface-300 border text-muted flex items-center justify-center text-background",children:(0,s.jsx)(c.Z,{size:12,strokeWidth:2})}),(0,s.jsx)("span",{className:"text-sm",children:u})]}),(0,s.jsx)(l.z,{type:"secondary",onClick:()=>{i(n)},children:a?"Stop Impersonating":"Impersonate"})]})};var RoleImpersonationSelector_RoleImpersonationSelector=e=>{var t;let{serviceRoleLabel:r,padded:n=!0}=e,l=(0,d.fN)(),[a,c]=(0,o.useState)(()=>{var e;return(null===(e=l.role)||void 0===e?void 0:e.type)==="postgrest"&&("anon"===l.role.role||"authenticated"===l.role.role)?l.role.role:"service_role"}),h=!!("authenticated"===a&&(null===(t=l.role)||void 0===t?void 0:t.type)==="postgrest"&&"authenticated"===l.role.role&&l.role.user);function onSelectedChange(e){"service_role"===e&&l.setRole(void 0),"anon"===e&&l.setRole({type:"postgrest",role:e}),c(e)}return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:(0,i.cn)("flex flex-col gap-3",n?"p-5":"pb-5"),children:[(0,s.jsx)("h2",{className:"text-foreground text-base",children:"Database role settings"}),(0,s.jsx)("form",{onSubmit:e=>{e.preventDefault()},children:(0,s.jsxs)("fieldset",{className:"flex gap-3",children:[(0,s.jsx)(RoleImpersonationSelector_RoleImpersonationRadio,{value:"service_role",isSelected:"service_role"===a,onSelectedChange:onSelectedChange,label:r,icon:(0,s.jsx)(ServiceRoleIcon,{isSelected:"service_role"===a})}),(0,s.jsx)(RoleImpersonationSelector_RoleImpersonationRadio,{value:"anon",isSelected:"anon"===a,onSelectedChange:onSelectedChange,icon:(0,s.jsx)(AnonIcon,{isSelected:"anon"===a})}),(0,s.jsx)(RoleImpersonationSelector_RoleImpersonationRadio,{value:"authenticated",isSelected:"authenticated"===a&&(h||"partially"),onSelectedChange:onSelectedChange,icon:(0,s.jsx)(AuthenticatedIcon,{isSelected:"authenticated"===a})})]})}),"service_role"===a&&(0,s.jsxs)("p",{className:"text-foreground-light text-sm",children:["The default Postgres/superuser role. This has admin privileges.",(0,s.jsx)("br",{}),"It will bypass Row Level Security (RLS) policies."]}),"anon"===a&&(0,s.jsxs)("p",{className:"text-foreground-light text-sm",children:['For "anonymous access". This is the role which the API (PostgREST) will use when a user',(0,s.jsx)("br",{}),"is not logged in. It will respect Row Level Security (RLS) policies."]}),"authenticated"===a&&(0,s.jsxs)("p",{className:"text-foreground-light text-sm",children:['For "authenticated access". This is the role which the API (PostgREST) will use when',(0,s.jsx)("br",{})," a user is logged in. It will respect Row Level Security (RLS) policies."]})]}),"authenticated"===a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.VD,{}),(0,s.jsx)("div",{className:(0,i.cn)("py-5",n&&"px-5"),children:(0,s.jsx)(RoleImpersonationSelector_UserImpersonationSelector,{})})]})]})},RoleImpersonationSelector_RoleImpersonationPopover=e=>{var t,r,c,h;let{serviceRoleLabel:u,variant:x="regular",align:p="end"}=e,m=(0,d.fN)(),[g,v]=(0,o.useState)(!1),f=null!==(h=null!==(c=null===(t=m.role)||void 0===t?void 0:t.role)&&void 0!==c?c:u)&&void 0!==h?h:"service role";return(0,s.jsxs)(n.J2,{open:g,onOpenChange:v,modal:!1,children:[(0,s.jsx)(n.xo,{asChild:!0,children:(0,s.jsx)(l.z,{size:"tiny",type:"default",className:(0,i.cn)("h-[26px] pr-3 gap-0","connected-on-right"===x&&"rounded-r-none border-r-0","connected-on-left"===x&&"rounded-l-none border-l-0","connected-on-both"===x&&"rounded-none border-x-0"),children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{className:"text-foreground-muted",children:"role"}),(0,s.jsx)("span",{children:f}),(null===(r=m.role)||void 0===r?void 0:r.type)==="postgrest"&&"authenticated"===m.role.role&&(0,s.jsx)(UserRoleButtonSection,{user:m.role.user}),(0,s.jsx)(a.Z,{className:"text-muted",strokeWidth:1,size:12})]})})}),(0,s.jsx)(n.yk,{className:"p-0 w-full overflow-hidden bg-overlay",side:"bottom",align:p,children:(0,s.jsx)(RoleImpersonationSelector_RoleImpersonationSelector,{serviceRoleLabel:u})})]})};let UserRoleButtonSection=e=>{var t,r,o;let{user:n}=e,l=(0,h.E)(n),i=(0,h.G)(n,null!==(o=null!==(r=null!==(t=n.email)&&void 0!==t?t:n.phone)&&void 0!==r?r:n.id)&&void 0!==o?o:"Unknown");return(0,s.jsxs)("div",{className:"flex gap-1 items-center pl-0.5 pr-1.5 h-[21px] bg-surface-200 rounded-full overflow-hidden",children:[l?(0,s.jsx)("img",{className:"rounded-full w-[18px] h-[18px]",src:l,alt:i}):(0,s.jsx)("div",{className:"rounded-full w-[18px] h-[18px] bg-surface-100 border flex items-center justify-center text-light",children:(0,s.jsx)(c.Z,{size:12,strokeWidth:2})}),(0,s.jsx)("span",{className:"truncate max-w-[84px]",children:i})]})}},48193:function(e,t,r){r.d(t,{RT:function(){return l},xY:function(){return useUsersQuery}});var s=r(58943),o=r(9402),n=r(549);let l=10;async function getUsers(e,t){let{projectRef:r,page:s=1,keywords:n="",verified:i}=e;if(!r)throw Error("Project ref is required");let a={limit:l.toString(),offset:((s-1)*10).toString(),keywords:n};i&&(a.verified=i);let{data:c,error:d}=await (0,o.U2)("/platform/auth/{ref}/users",{params:{path:{ref:r},query:a},signal:t});if(d)throw d;return c}let useUsersQuery=function(e){let{projectRef:t,page:r,keywords:o,verified:l}=e,{enabled:i=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(n.o.users(t,{page:r,keywords:o,verified:l}),e=>{let{signal:s}=e;return getUsers({projectRef:t,page:r,keywords:o,verified:l},s)},{enabled:i&&void 0!==t,...a})}}}]);