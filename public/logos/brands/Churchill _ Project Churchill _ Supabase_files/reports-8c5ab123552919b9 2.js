(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8594],{68756:function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/reports",function(){return r(36704)}])},36704:function(t,e,r){"use strict";r.r(e),r.d(e,{UserReportPage:function(){return UserReportPage},default:function(){return m}});var a=r(52322),o=r(59491),s=r(5632),n=r(2784),i=r(73872),l=r(51373),c=r(82042),u=r(13427);let d={name:"new report",description:"",type:"report",visibility:"project",content:{schema_version:1,period_start:{time_period:"7d",date:""},period_end:{time_period:"today",date:""},interval:"1d",layout:[]}},createReport=async t=>{let{router:e}=t,{ref:r}=e.query,a=(0,u.I)(r),{data:o,error:s}=await a.create(d);if(s)throw s;await a.load(),e.push("/project/".concat(r,"/reports/").concat(o[0].id))};var p=r(86024),h=r(89465),f=r(84447);let UserReportPage=()=>{let[t,e]=(0,n.useState)(!0),r=(0,s.useRouter)(),{ref:l}=(0,i.UO)(),{profile:d}=(0,f.Un)(),{ui:m}=(0,h.oR)(),y=(0,u.I)(l),w=(0,h.Xo)(o.KA.CREATE,"user_content",{resource:{type:"report",owner_id:null==d?void 0:d.id},subject:{id:null==d?void 0:d.id}});async function loadReports(){await y.load();let t=y.reports();t.length>=1?r.push("/project/".concat(l,"/reports/").concat(t[0].id)):e(!1)}return(0,n.useEffect)(()=>{loadReports()},[l]),(0,a.jsx)("div",{className:"mx-auto my-32 w-full max-w-7xl flex-grow space-y-16",children:t?(0,a.jsx)(p.Z,{}):(0,a.jsxs)(c.Z,{title:"Reports",ctaButtonLabel:"Create report",onClickCta:()=>{try{createReport({router:r})}catch(t){m.setNotification({category:"error",message:"Failed to create report: ".concat(t.message)})}},disabled:!w,disabledMessage:"You need additional permissions to create a report",children:[(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:"Create custom reports for your projects."}),(0,a.jsx)("p",{className:"text-foreground-light text-sm",children:"Get a high level overview of your network traffic, user actions, and infrastructure health."})]})})};UserReportPage.getLayout=t=>(0,a.jsx)(l.li,{children:t});var m=UserReportPage},13427:function(t,e,r){"use strict";r.d(e,{I:function(){return useProjectContentStore}});var a=r(87612),o=r(80075),s=r(3218),n=r(87622),i=r.n(n),l=r(46732);let c=null,u=null;function useProjectContentStore(t){if(null===c||t!==u){u=t;let e="".concat(l.T5,"/projects/").concat(t,"/content");c=new ProjectContent(e)}return c}let ProjectContent=class ProjectContent{async fetchData(){let t=await (0,s.U2)(this.url,{headers:{"Content-Type":"application/json"}});if(t.error)throw t.error;return this.data=t.data.length>0?i()(t.data,"id"):t.data,t}async load(){let{LOADING:t,ERROR:e,LOADED:r}=this.STATES;try{return this.error=null,this.state=t,await this.fetchData(),this.state=r,this.data}catch(t){console.error("e.message",t.message),this.error=t,this.state=e}}get hasError(){return this.state===this.STATES.ERROR}get isLoading(){return this.state===this.STATES.INITIAL||this.state===this.STATES.LOADING}list(t){let e=Object.values(this.data);return t?e.filter(t).sort((t,e)=>t.name.localeCompare(e.name)):e.sort((t,e)=>t.name.localeCompare(e.name))}reports(t){let e=Object.values(this.data);return t?e.filter(t=>"report"==t.type).filter(t).sort((t,e)=>t.name.localeCompare(e.name)):e.filter(t=>"report"==t.type).sort((t,e)=>t.name.localeCompare(e.name))}sqlSnippets(t){let e=Object.values(this.data);if(t){let r=e.filter(t=>"sql"==t.type).filter(t).sort((t,e)=>t.name.localeCompare(e.name));return r}{let t=e.filter(t=>"sql"==t.type).sort((t,e)=>t.name.localeCompare(e.name));return t}}byId(t){return this.data[t]}async create(t){try{let e=await (0,s.v_)(this.url,t,{headers:{"Content-Type":"application/json"}});if(e.error)throw e.error;return this.data[e.id]=e,{data:e,error:null}}catch(t){return{data:null,error:t}}}async update(t,e,r){try{let a={...e,type:r,id:t},o="".concat(this.url,"?id=").concat(t),n=await (0,s.r$)(o,a,{headers:{"Content-Type":"application/json"}});if(n.error)throw n.error;return this.data[t]=n,{data:n,error:null}}catch(t){return{data:null,error:t}}}async updateSql(t,e){return this.update(t,e,"sql")}async updateReport(t,e){return this.update(t,e,"report")}async del(t){try{let e="".concat(this.url,"?id=").concat(t),r=await (0,s.$v)(e,{},{headers:{"Content-Type":"application/json"}});if(r.error)throw r.error;return delete this.data[t],{data:!0,error:null}}catch(t){return{data:!1,error:t}}}constructor(t){(0,a._)(this,"STATES",{INITIAL:"initial",LOADING:"loading",ERROR:"error",LOADED:"loaded"}),(0,a._)(this,"rootStore",null),(0,a._)(this,"url",""),(0,a._)(this,"state",this.STATES.INITIAL),(0,a._)(this,"data",{}),(0,a._)(this,"error",null),this.url=t,(0,o.rC)(this,{state:o.LO,data:o.LO,list:o.LO,hasError:o.Fl,isLoading:o.Fl})}}}},function(t){t.O(0,[1715,1187,6653,3844,8421,9362,4796,806,2591,1915,4079,4964,8211,452,8108,9774,2888,179],function(){return t(t.s=68756)}),_N_E=t.O()}]);