"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9954],{33929:function(e,t,a){var n=a(52322),r=a(3689);t.Z=()=>(0,n.jsx)("div",{className:"block w-full rounded border border-gray-400 border-opacity-50 bg-gray-300 p-3",children:(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsx)(r.Z,{size:20,strokeWidth:1.5}),(0,n.jsx)("p",{className:"text-sm",children:"No backups created yet - check again tomorrow."})]})})},66433:function(e,t,a){a.d(t,{QI:function(){return convertConfigParams},cK:function(){return convertArgumentTypes},zB:function(){return hasWhitespace}});var n=a(45455),r=a.n(n);function convertArgumentTypes(e){let t=null==e?void 0:e.split(",");if(r()(e)||!t||(null==t?void 0:t.length)==0)return{value:[]};let a=t.map(e=>{let t=e.trim(),a=t.indexOf(" "),n=t.slice(0,1!==a?a:0),r=t.slice(a+1);return{name:n,type:r}});return{value:a}}function convertConfigParams(e){let t=[];if(e)for(var a in e)t.push({name:a,value:e[a]});return{value:t}}function hasWhitespace(e){return/\s/.test(e)}},69954:function(e,t,a){a.d(t,{M4:function(){return tm},TH:function(){return k},B8:function(){return aa},RA:function(){return tM},ZY:function(){return eH},ZR:function(){return Functions_DeleteFunction},eX:function(){return Triggers_DeleteTrigger},_h:function(){return eJ},Ms:function(){return EnumeratedTypes_EnumeratedTypes},IP:function(){return eZ},Vj:function(){return te},_y:function(){return Publications_PublicationsTables},yT:function(){return Roles_RolesList},bw:function(){return q},Hm:function(){return e8}});var n=a(52322),r=a(24990),s=a(59491),i=a(34291),l=a.n(i),o=a(46776),c=a(2784),d=a(79569),u=a(94580),m=a(6225),p=a(31915),h=a(10381),x=a(88058),f=a(97036),g=a(53830),v=a(22354),j=a(5099),b=a(92042),y=a(44171),N=a(7503),w=a(20775),_=a(89465),S=a(96286),C=a(99033),Z=a(56173),k=(0,o.Pi)(e=>{var t,a,i,o;let{table:k,onSelectBack:T=l(),onAddColumn:D=l(),onEditColumn:E=l(),onDeleteColumn:F=l()}=e,[R,z]=(0,c.useState)(""),{data:P,error:I,isError:A,isLoading:W,isSuccess:V}=(0,S.Z)(k.id),q=null!==(i=0===R.length?null!==(a=null==P?void 0:P.columns)&&void 0!==a?a:[]:null==P?void 0:null===(t=P.columns)||void 0===t?void 0:t.filter(e=>e.name.includes(R)))&&void 0!==i?i:[],O=C.F.includes(null!==(o=k.schema)&&void 0!==o?o:""),L=(0,_.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"columns");return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("h3",{className:"mb-1 text-xl text-foreground",children:"Database Tables"}),(0,n.jsx)(d.Z,{strokeWidth:1.5,className:"text-foreground-light"}),(0,n.jsx)("h3",{className:"mb-1 text-xl text-foreground",children:k.name})]})}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)(u.z,{type:"outline",onClick:()=>T(),icon:(0,n.jsx)(m.Z,{size:"small"}),style:{padding:"5px"}}),(0,n.jsx)(p.Z,{size:"small",placeholder:"Filter columns",value:R,onChange:e=>z(e.target.value),icon:(0,n.jsx)(h.Z,{size:"tiny"})})]}),!O&&(0,n.jsx)("div",{children:(0,n.jsxs)(r.fC,{delayDuration:0,children:[(0,n.jsx)(r.xz,{asChild:!0,children:(0,n.jsx)(u.z,{disabled:!L,icon:(0,n.jsx)(x.Z,{}),onClick:()=>D(),children:"New column"})}),!L&&(0,n.jsx)(r.h_,{children:(0,n.jsxs)(r.VY,{side:"bottom",children:[(0,n.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to create columns"})})]})})]})})]}),O&&(0,n.jsx)(Z.Z,{schema:k.schema,entity:"columns"}),W&&(0,n.jsx)(w.A,{}),A&&(0,n.jsx)(N.Z,{error:I,subject:'Failed to retrieve columns for table "'.concat(k.schema,".").concat(k.name,'"')}),V&&(0,n.jsx)(n.Fragment,{children:0===q.length?(0,n.jsx)(b.Z,{}):(0,n.jsx)("div",{children:(0,n.jsx)(y.Z,{head:[(0,n.jsx)(y.Z.th,{children:"Name"},"name"),(0,n.jsx)(y.Z.th,{className:"hidden lg:table-cell",children:"Description"},"description"),(0,n.jsx)(y.Z.th,{className:"hidden xl:table-cell",children:"Data Type"},"type"),(0,n.jsx)(y.Z.th,{className:"hidden xl:table-cell",children:"Format"},"format"),(0,n.jsx)(y.Z.th,{},"buttons")],body:q.map((e,t)=>(0,n.jsxs)(y.Z.tr,{className:"border-t",children:[(0,n.jsx)(y.Z.td,{children:(0,n.jsx)("p",{children:e.name})}),(0,n.jsx)(y.Z.td,{className:"break-all whitespace-normal",children:null!==e.comment?(0,n.jsx)("p",{title:e.comment,children:e.comment}):(0,n.jsx)("p",{className:"text-border-stronger",children:"No description"})}),(0,n.jsx)(y.Z.td,{children:(0,n.jsx)("code",{className:"text-xs",children:e.data_type})}),(0,n.jsx)(y.Z.td,{className:"font-mono text-xs",children:(0,n.jsx)("code",{className:"text-xs",children:e.format})}),(0,n.jsx)(y.Z.td,{className:"text-right",children:!O&&(0,n.jsxs)(f.h_,{children:[(0,n.jsx)(f.$F,{asChild:!0,children:(0,n.jsx)(u.z,{type:"default",className:"px-1",children:(0,n.jsx)(g.Z,{})})}),(0,n.jsxs)(f.AW,{side:"bottom",align:"end",className:"w-32",children:[(0,n.jsx)(f.Xi,{disabled:!L,onClick:()=>E(e),children:(0,n.jsxs)(r.fC,{delayDuration:0,children:[(0,n.jsxs)(r.xz,{className:"flex items-center space-x-2",children:[(0,n.jsx)(v.Z,{size:"tiny"}),(0,n.jsx)("p",{children:"Edit column"})]}),!L&&(0,n.jsx)(r.h_,{children:(0,n.jsxs)(r.VY,{side:"bottom",children:[(0,n.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to edit column"})})]})})]})}),(0,n.jsx)(f.Xi,{disabled:!L||O,onClick:()=>F(e),children:(0,n.jsxs)(r.fC,{delayDuration:0,children:[(0,n.jsxs)(r.xz,{className:"flex items-center space-x-2",children:[(0,n.jsx)(j.Z,{stroke:"red",size:"tiny"}),(0,n.jsx)("p",{children:"Delete column"})]}),!L&&(0,n.jsx)(r.h_,{children:(0,n.jsxs)(r.VY,{side:"bottom",children:[(0,n.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to edit column"})})]})})]})})]})]})})]},e.name))})})})]})}),T=a(96795),D=a.n(T),E=a(2755),F=a(50932),R=a(86323),z=a(12752),P=a(93969),I=a(44389),A=a(55216),W=a(88979),V=a(26292),q=(0,o.Pi)(e=>{let{onAddTable:t=l(),onEditTable:a=l(),onDeleteTable:i=l(),onOpenTable:o=l()}=e,{project:d}=(0,E.d2)(),m=(0,I._2)(),[S,k]=(0,c.useState)(""),T=(0,_.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"tables"),{data:q}=(0,z.Q1)({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString}),[O]=D()(null!=q?q:[],e=>{var t;return C.F.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),{data:L,isLoading:M,isSuccess:B,isError:U,error:Q}=(0,P.Bj)({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString,schema:m.selectedSchemaName,sortByProperty:"name"},{select:e=>0===S.length?e:e.filter(e=>e.name.includes(S))}),{data:Y}=(0,R.z)({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString}),H=(null!=Y?Y:[]).find(e=>"supabase_realtime"===e.name),X=null==q?void 0:q.find(e=>e.name===m.selectedSchemaName),K=O.some(e=>e.id===(null==X?void 0:X.id));return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"mb-1 text-xl text-foreground",children:"Database Tables"}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)(F.Z,{className:"w-[260px]",size:"small",showError:!1,selectedSchemaName:m.selectedSchemaName,onSelectSchema:m.setSelectedSchemaName}),(0,n.jsx)(p.Z,{size:"small",className:"w-64",placeholder:"Search for a table",value:S,onChange:e=>k(e.target.value),icon:(0,n.jsx)(h.Z,{size:"tiny"})})]}),!K&&(0,n.jsx)("div",{children:(0,n.jsxs)(r.fC,{delayDuration:0,children:[(0,n.jsx)(r.xz,{asChild:!0,children:(0,n.jsx)(u.z,{disabled:!T,icon:(0,n.jsx)(x.Z,{}),onClick:()=>t(),children:"New table"})}),!T&&(0,n.jsx)(r.h_,{children:(0,n.jsxs)(r.VY,{side:"bottom",children:[(0,n.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to create tables"})})]})})]})})]}),K&&(0,n.jsx)(Z.Z,{schema:m.selectedSchemaName,entity:"tables"}),M&&(0,n.jsx)(w.A,{}),U&&(0,n.jsx)(N.Z,{error:Q,subject:"Failed to retrieve tables"}),B&&(0===L.length?(0,n.jsx)(b.Z,{}):(0,n.jsx)("div",{className:"my-4 w-full",children:(0,n.jsx)(y.Z,{head:[(0,n.jsx)(y.Z.th,{children:"Name"},"name"),(0,n.jsx)(y.Z.th,{className:"hidden lg:table-cell",children:"Description"},"description"),(0,n.jsx)(y.Z.th,{className:"hidden text-right xl:table-cell",children:"Rows (Estimated)"},"rows"),(0,n.jsx)(y.Z.th,{className:"hidden text-right xl:table-cell",children:"Size (Estimated)"},"size"),(0,n.jsx)(y.Z.th,{className:"hidden xl:table-cell text-center",children:"Realtime Enabled"},"realtime"),(0,n.jsx)(y.Z.th,{},"buttons")],body:(0,n.jsxs)(n.Fragment,{children:[0===L.length&&0===S.length&&(0,n.jsx)(y.Z.tr,{children:(0,n.jsxs)(y.Z.td,{colSpan:6,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No tables created yet"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no tables found in the schema "',m.selectedSchemaName,'"']})]})},m.selectedSchemaName),0===L.length&&S.length>0&&(0,n.jsx)(y.Z.tr,{children:(0,n.jsxs)(y.Z.td,{colSpan:6,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',S,'" did not return any results']})]})},m.selectedSchemaName),L.length>0&&L.map((e,t)=>{var s,l,c;return(0,n.jsxs)(y.Z.tr,{children:[(0,n.jsx)(y.Z.td,{children:e.name.length>20?(0,n.jsxs)(r.fC,{delayDuration:0,disableHoverableContent:!0,children:[(0,n.jsx)(r.xz,{asChild:!0,className:"max-w-[95%] overflow-hidden text-ellipsis whitespace-nowrap",children:(0,n.jsx)("p",{children:e.name})}),(0,n.jsx)(r.h_,{children:(0,n.jsxs)(r.VY,{side:"bottom",children:[(0,n.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-scale-100 py-1 px-2 leading-none shadow border border-scale-200",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:e.name})})]})})]}):(0,n.jsx)("p",{children:e.name})}),(0,n.jsx)(y.Z.td,{className:"hidden max-w-sm truncate lg:table-cell break-all whitespace-normal",children:null!==e.comment?(0,n.jsx)("p",{title:e.comment,children:e.comment}):(0,n.jsx)("p",{className:"text-border-stronger",children:"No description"})}),(0,n.jsx)(y.Z.td,{className:"hidden text-right xl:table-cell",children:(null!==(l=e.live_rows_estimate)&&void 0!==l?l:e.live_row_count).toLocaleString()}),(0,n.jsx)(y.Z.td,{className:"hidden text-right xl:table-cell",children:(0,n.jsx)("code",{className:"text-sm",children:e.size})}),(0,n.jsx)(y.Z.td,{className:"hidden xl:table-cell text-center",children:(null!==(c=null==H?void 0:H.tables)&&void 0!==c?c:[]).find(t=>t.id===e.id)?(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)(A.Z,{strokeWidth:2,className:"text-brand"})}):(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)(W.Z,{strokeWidth:2,className:"text-foreground-lighter"})})}),(0,n.jsx)(y.Z.td,{children:(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsxs)(u.z,{type:"default",iconRight:(0,n.jsx)(V.Z,{}),className:"whitespace-nowrap hover:border-gray-500",style:{paddingTop:3,paddingBottom:3},onClick:()=>o(e),children:[null===(s=e.columns)||void 0===s?void 0:s.length," columns"]}),!K&&(0,n.jsxs)(f.h_,{children:[(0,n.jsx)(f.$F,{asChild:!0,children:(0,n.jsx)(u.z,{type:"default",className:"px-1",children:(0,n.jsx)(g.Z,{})})}),(0,n.jsxs)(f.AW,{side:"bottom",align:"end",className:"w-32",children:[(0,n.jsx)(f.Xi,{disabled:!T,onClick:()=>a(e),children:(0,n.jsxs)(r.fC,{delayDuration:0,children:[(0,n.jsxs)(r.xz,{className:"flex items-center space-x-2",children:[(0,n.jsx)(v.Z,{size:"tiny"}),(0,n.jsx)("p",{children:"Edit table"})]}),!T&&(0,n.jsx)(r.h_,{children:(0,n.jsxs)(r.VY,{side:"bottom",children:[(0,n.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to edit table"})})]})})]})}),(0,n.jsx)(f.Xi,{disabled:!T||K,onClick:()=>i(e),children:(0,n.jsxs)(r.fC,{delayDuration:0,children:[(0,n.jsxs)(r.xz,{className:"flex items-center space-x-2",children:[(0,n.jsx)(j.Z,{stroke:"red",size:"tiny"}),(0,n.jsx)("p",{children:"Delete table"})]}),!T&&(0,n.jsx)(r.h_,{children:(0,n.jsxs)(r.VY,{side:"bottom",children:[(0,n.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to delete table"})})]})})]})})]})]})]})})]},e.id)})]})})}))]})}),O=a(829),L=a.n(O),M=a(84959),B=a(26861),U=a(93709),Q=a(29557),Y=a(67149),H=a(70481);let getMaxConnectionsQuery=()=>"show max_connections",useMaxConnectionsQuery=function(e){let{projectRef:t,connectionString:a}=e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,H.cp)({projectRef:t,connectionString:a,sql:getMaxConnectionsQuery(),queryKey:["max-connections"]},{select:e=>{let t=parseInt(e.result[0].max_connections);return{maxConnections:t}},...n})};var X=a(88883),K=a(63955),G=a(62202),J=a(66768),$=a(69218),ee=a(84283),et=a(364),ea=a(30195),en=a(55830),er=a(62350),es=a(9402),ei=a(95345);async function createDatabaseRole(e){let{projectRef:t,connectionString:a,payload:n}=e,r=new Headers;a&&r.set("x-connection-encrypted",a);let{data:s,error:i}=await (0,es.v_)("/platform/pg-meta/{ref}/roles",{params:{header:{"x-connection-encrypted":a},path:{ref:t}},body:n,headers:r});if(i)throw i;return s}let useDatabaseRoleCreateMutation=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,en.NL)();return(0,er.D)(e=>createDatabaseRole(e),{async onSuccess(t,a,r){let{projectRef:s}=a;await n.invalidateQueries(ei.i.list(s)),await (null==e?void 0:e(t,a,r))},async onError(e,a,n){void 0===t?G.Am.error("Failed to create database role: ".concat(e.message)):t(e,a,n)},...a})};var el=a(65770);let eo=ea.ZP.object({name:ea.ZP.string().trim().min(1,"You must provide a name").default(""),is_superuser:ea.ZP.boolean().default(!1),can_login:ea.ZP.boolean().default(!1),can_create_role:ea.ZP.boolean().default(!1),can_create_db:ea.ZP.boolean().default(!1),is_replication_role:ea.ZP.boolean().default(!1),can_bypass_rls:ea.ZP.boolean().default(!1)});var Roles_CreateRolePanel=e=>{let{visible:t,onClose:a}=e,r="create-new-role",{project:s}=(0,E.d2)(),i=(0,K.cI)({resolver:(0,X.F)(eo)}),{mutate:l,isLoading:o}=useDatabaseRoleCreateMutation({onSuccess:e=>{G.ZP.success("Successfully created new role: ".concat(e.name)),a()}}),onSubmit=async e=>{if(!s)return console.error("Project is required");l({projectRef:s.ref,connectionString:s.connectionString,payload:e})};return(0,n.jsx)(J.ZP,{size:"large",visible:t,header:"Create a new role",className:"mr-0 transform transition-all duration-300 ease-in-out",loading:!1,onCancel:()=>{a(),i.reset()},customFooter:(0,n.jsx)("div",{className:"flex w-full justify-end space-x-3 border-t border-default px-3 py-4",children:(0,n.jsx)(B.iN,{form:r,isSubmitting:o,hasChanges:i.formState.isDirty,handleReset:()=>i.reset()})}),children:(0,n.jsx)($.l0,{...i,children:(0,n.jsxs)("form",{id:r,className:"grid gap-6 w-full px-8 py-8",onSubmit:i.handleSubmit(onSubmit),children:[(0,n.jsx)($.Wi,{control:i.control,name:"name",render:e=>{let{field:t}=e;return(0,n.jsxs)($.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,n.jsx)($.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Name"}),(0,n.jsx)($.NI,{className:"col-span-8",children:(0,n.jsx)(ee.I,{...t,className:"w-full"})}),(0,n.jsx)($.zG,{className:"col-start-5 col-span-8"})]})}}),(0,n.jsxs)("div",{className:"grid gap-2 mt-4 md:grid md:grid-cols-12",children:[(0,n.jsx)("div",{className:"col-span-4",children:(0,n.jsx)($.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Role privileges"})}),(0,n.jsxs)("div",{className:"col-span-8 grid gap-4",children:[Object.keys(el.IC).filter(e=>el.IC[e].grant_by_dashboard).map(e=>{let t=el.IC[e];return(0,n.jsx)($.Wi,{control:i.control,name:e,render:e=>{let{field:a}=e;return(0,n.jsxs)($.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,n.jsx)($.NI,{className:"col-span-8 flex items-center gap-4",children:(0,n.jsxs)("div",{className:"w-full text-sm",children:[(0,n.jsx)(et.r,{checked:a.value,onCheckedChange:a.onChange}),(0,n.jsx)($.lX,{children:t.description})]})}),(0,n.jsx)($.zG,{className:"col-start-5 col-span-8"})]})}},e)}),(0,n.jsx)(J.ZP.Separator,{}),(0,n.jsxs)("div",{className:"grid gap-4",children:[(0,n.jsx)("p",{className:"text-sm",children:"These privileges cannot be granted via the Dashboard:"}),Object.keys(el.IC).filter(e=>!el.IC[e].grant_by_dashboard).map(e=>{let t=el.IC[e];return(0,n.jsx)($.Wi,{control:i.control,name:e,render:e=>{let{field:a}=e;return(0,n.jsxs)($.xJ,{className:"space-y-0 opacity-70",children:[(0,n.jsx)($.NI,{className:"flex items-center gap-4",children:(0,n.jsxs)("div",{className:"w-full text-sm",children:[(0,n.jsx)(et.r,{checked:a.value,onCheckedChange:a.onChange,disabled:!0,"aria-readonly":!0}),(0,n.jsx)($.lX,{children:t.description})]})}),(0,n.jsx)($.zG,{className:"col-start-5 col-span-8"})]})}},e)})]})]})]})]})})})},ec=a(1681);async function deleteDatabaseRole(e){let{projectRef:t,connectionString:a,id:n}=e,r=new Headers;a&&r.set("x-connection-encrypted",a);let{data:s,error:i}=await (0,es.IV)("/platform/pg-meta/{ref}/roles",{params:{header:{"x-connection-encrypted":a},path:{ref:t},query:{id:n}},headers:r});if(i)throw i;return s}let useDatabaseRoleDeleteMutation=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,en.NL)();return(0,er.D)(e=>deleteDatabaseRole(e),{async onSuccess(t,a,r){let{projectRef:s}=a;await n.invalidateQueries(ei.i.list(s)),await (null==e?void 0:e(t,a,r))},async onError(e,a,n){void 0===t?G.Am.error("Failed to delete database role: ".concat(e.message)):t(e,a,n)},...a})};var Roles_DeleteRoleModal=e=>{let{role:t,visible:a,onClose:r}=e,{project:s}=(0,E.d2)(),{mutate:i,isLoading:l}=useDatabaseRoleDeleteMutation({onSuccess:()=>{G.ZP.success("Successfully deleted role: ".concat(t.name)),r()}}),deleteRole=async()=>s?t?void i({projectRef:s.ref,connectionString:s.connectionString,id:t.id.toString()}):console.error("Failed to delete role: role is missing"):console.error("Project is required");return(0,n.jsx)(ec.C,{size:"small",alignFooter:"right",visible:a,onCancel:r,onConfirm:deleteRole,header:(0,n.jsxs)("h3",{children:['Confirm to delete role "',null==t?void 0:t.name,'"']}),loading:l,children:(0,n.jsx)("div",{className:"py-4",children:(0,n.jsx)(ec.C.Content,{children:(0,n.jsx)("p",{className:"text-sm",children:"This will automatically revoke any membership of this role in other roles, and this action cannot be undone."})})})})},ed=a(57463),eu=a(25618),em=a(68287),ep=a(49730),eh=a(99750);async function updateDatabaseRole(e){let{projectRef:t,connectionString:a,id:n,payload:r}=e,s=new Headers;a&&s.set("x-connection-encrypted",a);let{data:i,error:l}=await (0,es.r$)("/platform/pg-meta/{ref}/roles",{params:{header:{"x-connection-encrypted":a},path:{ref:t},query:{id:n}},body:r,headers:s});if(l)throw l;return i}let useDatabaseRoleUpdateMutation=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,en.NL)();return(0,er.D)(e=>updateDatabaseRole(e),{async onSuccess(t,a,r){let{projectRef:s}=a;await n.invalidateQueries(ei.i.list(s)),await (null==e?void 0:e(t,a,r))},async onError(e,a,n){void 0===t?G.Am.error("Failed to update database role: ".concat(e.message)):t(e,a,n)},...a})};var Roles_RoleRow=e=>{let{role:t,disabled:a=!1,onSelectDelete:s}=e,{project:i}=(0,E.d2)(),[l,o]=(0,c.useState)(!1),{mutate:d,isLoading:m}=useDatabaseRoleUpdateMutation(),{is_superuser:p,can_login:h,can_create_role:x,can_create_db:v,is_replication_role:b,can_bypass_rls:y}=t,onSaveChanges=async(e,a)=>{let{resetForm:n}=a;if(!i)return console.error("Project is required");let{is_superuser:r,is_replication_role:s,...l}=e;d({projectRef:i.ref,connectionString:i.connectionString,id:t.id,payload:l},{onSuccess:()=>{G.ZP.success('Successfully updated role "'.concat(t.name,'"')),n({values:{...e},initialValues:{...e}})}})};return(0,n.jsx)(ed.Z,{name:"role-update-form",initialValues:{is_superuser:p,can_login:h,can_create_role:x,can_create_db:v,is_replication_role:b,can_bypass_rls:y},onSubmit:onSaveChanges,className:"bg-surface-100 hover:bg-overlay-hover data-open:bg-selection border-default hover:border-strong data-open:border-strong data-open:pb-px col-span-12 mx-auto -space-y-px overflow-hidden border border-t-0 first:border-t first:!mt-0 hover:border-t hover:-mt-[1px] shadow transition hover:z-50 first:rounded-tl first:rounded-tr last:rounded-bl last:rounded-br",children:e=>{let{values:i,initialValues:c,handleReset:d}=e,p=JSON.stringify(i)!==JSON.stringify(c);return(0,n.jsxs)(eu.ZP,{open:l,children:[(0,n.jsx)(eu.ZP.Trigger,{asChild:!0,children:(0,n.jsxs)("button",{id:"collapsible-trigger",type:"button",className:"group flex w-full items-center justify-between rounded py-3 px-6 text-foreground",onClick:e=>{"collapsible-trigger"===e.target.id&&o(!l)},children:[(0,n.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,n.jsx)(em.Z,{id:"collapsible-trigger",className:"text-border-stronger transition data-open-parent:rotate-0 data-closed-parent:rotate-180",strokeWidth:2,width:14}),(0,n.jsxs)("div",{className:"space-x-2 flex items-center",children:[(0,n.jsx)("p",{className:"text-left text-sm",id:"collapsible-trigger",children:t.name}),(0,n.jsxs)("p",{className:"text-left text-sm text-foreground-light",id:"collapsible-trigger",children:["(ID: ",t.id,")"]})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[t.active_connections>0&&(0,n.jsx)("div",{className:"relative h-2 w-2",children:(0,n.jsxs)("span",{className:"flex h-2 w-2",children:[(0,n.jsx)("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-brand opacity-75"}),(0,n.jsx)("span",{className:"relative inline-flex h-2 w-2 rounded-full bg-brand opacity-75"})]})}),(0,n.jsxs)("p",{id:"collapsible-trigger",className:"text-sm ".concat(t.active_connections>0?"text-foreground":"text-foreground-light"),children:[t.active_connections," connections"]}),!a&&(0,n.jsxs)(f.h_,{children:[(0,n.jsx)(f.$F,{asChild:!0,children:(0,n.jsx)(u.z,{type:"default",className:"px-1",children:(0,n.jsx)(g.Z,{})})}),(0,n.jsx)(f.AW,{side:"bottom",className:"w-[120px]",children:(0,n.jsxs)(f.Xi,{className:"space-x-2",onClick:e=>{e.stopPropagation(),s(t)},children:[(0,n.jsx)(j.Z,{className:"text-red-800",size:"tiny",strokeWidth:2}),(0,n.jsx)("p",{children:"Delete"})]})})]})]})]})}),(0,n.jsx)(eu.ZP.Content,{children:(0,n.jsxs)("div",{className:"group border-t border-default bg-surface-100 py-6 px-20 text-foreground",children:[(0,n.jsx)("div",{className:"py-4 space-y-[9px]",children:Object.keys(el.IC).map(e=>(0,n.jsx)(ep.Z,{size:"small",id:e,name:e,label:el.IC[e].description,disabled:a||el.IC[e].disabled,className:["roles-toggle",a||el.IC[e].disabled?"opacity-50":""].join(" "),afterLabel:!a&&el.IC[e].disabled?(0,n.jsxs)(r.fC,{delayDuration:0,children:[(0,n.jsx)(r.xz,{type:"button",children:(0,n.jsx)(eh.Z,{size:"tiny",strokeWidth:2,className:"ml-2 relative top-[3px]"})}),(0,n.jsx)(r.h_,{children:(0,n.jsxs)(r.VY,{align:"center",side:"bottom",children:[(0,n.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background space-y-1",children:(0,n.jsx)("span",{className:"text-xs",children:"This privilege cannot be updated via the dashboard"})})]})})]}):(0,n.jsx)(n.Fragment,{})},e))}),!a&&(0,n.jsxs)("div",{className:"py-4 flex items-center space-x-2 justify-end",children:[(0,n.jsx)(u.z,{type:"default",disabled:!p||m,onClick:()=>d(),children:"Cancel"}),(0,n.jsx)(u.z,{type:"primary",htmlType:"submit",disabled:!p||m,loading:m,children:"Save"})]})]})})]})}})},ex=a(4220),Roles_RoleRowSkeleton=e=>{let{index:t}=e;return(0,n.jsx)("div",{className:(0,ex.cn)(["bg-surface-100","data-open:bg-selection","border-default","data-open:border-strong","data-open:pb-px col-span-12 mx-auto","-space-y-px overflow-hidden","border border-t-0 first:border-t first:!mt-0 shadow transition","first:rounded-tl first:rounded-tr","last:rounded-bl last:rounded-br"]),children:(0,n.jsxs)("div",{className:"flex w-full items-center justify-between rounded py-3 px-6 text-foreground",children:[(0,n.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,n.jsx)(em.Z,{id:"collapsible-trigger",className:"text-border-stronger rotate-180",strokeWidth:2,width:14}),(0,n.jsxs)("div",{className:"space-x-2 flex items-center",children:[(0,n.jsx)(w.Z,{className:"h-4 w-20 py-0 my-0.5",delayIndex:t}),(0,n.jsx)(w.Z,{className:"h-4 w-16 py-0 my-0.5",delayIndex:t})]})]}),(0,n.jsx)(w.Z,{className:"h-4 w-[90px] py-0 my-0.5",delayIndex:t})]})})},Roles_RolesList=()=>{let{project:e}=(0,E.d2)(),[t,a]=(0,c.useState)(""),[i,l]=(0,c.useState)("all"),[o,d]=(0,c.useState)(!1),[m,f]=(0,c.useState)(),g=(0,_.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"roles"),{data:v}=useMaxConnectionsQuery({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),j=null==v?void 0:v.maxConnections,{data:b,isLoading:y}=(0,Y.x)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),N=L()(null!=b?b:[],e=>e.name.toLocaleLowerCase()),w=("active"===i?N.filter(e=>e.active_connections>0):N).filter(e=>e.name.includes(t)),[S,C]=D()(w,e=>el.NM.includes(e.name)),Z=N.map(e=>e.active_connections).reduce((e,t)=>e+t,0),k=L()(N.filter(e=>e.active_connections>0),e=>-e.active_connections);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsx)(B.ph,{title:"Database Roles",description:"Manage access control to your database through users, groups, and permissions"})}),(0,n.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)(p.Z,{size:"small",placeholder:"Search for a role",icon:(0,n.jsx)(h.Z,{size:"tiny"}),value:t,onChange:e=>a(e.target.value),actions:t&&(0,n.jsx)(u.z,{size:"tiny",type:"text",onClick:()=>a(""),className:"px-1 mr-1",children:(0,n.jsx)(W.Z,{size:12,strokeWidth:2})})}),(0,n.jsxs)("div",{className:"flex items-center border border-strong rounded-full w-min h-[34px]",children:[(0,n.jsx)("button",{className:["text-xs w-[90px] h-full text-center rounded-l-full flex items-center justify-center transition","all"===i?"bg-overlay-hover text-foreground":"hover:bg-surface-200 text-foreground-light"].join(" "),onClick:()=>l("all"),children:"All roles"}),(0,n.jsx)("div",{className:"h-full w-[1px] border-r border-strong"}),(0,n.jsx)("button",{className:["text-xs w-[90px] h-full text-center rounded-r-full flex items-center justify-center transition","active"===i?"bg-overlay-hover text-foreground":"hover:bg-surface-200 text-foreground-light"].join(" "),onClick:()=>l("active"),children:"Active roles"})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,n.jsxs)(r.fC,{delayDuration:0,children:[(0,n.jsx)(r.xz,{children:(0,n.jsx)("div",{className:"w-42",children:(0,n.jsx)(Q.Z,{type:"horizontal",max:j||Z,value:Z,barClass:0===j||void 0===j?"bg-control":Z>.9*j?"bg-red-800":Z>.75*j?"bg-amber-900":"bg-green-800",labelTop:Number.isInteger(j)?"".concat(Z,"/").concat(j):"".concat(Z),labelBottom:"Active connections"})})}),(0,n.jsxs)(r.VY,{align:"start",side:"bottom",children:[(0,n.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsxs)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background space-y-1",children:[(0,n.jsx)("p",{className:"text-xs text-foreground-light pr-2",children:"Connections by roles:"}),k.map(e=>(0,n.jsxs)("div",{className:"text-xs text-foreground",children:[e.name,": ",e.active_connections]},e.id))]})]})]}),(0,n.jsxs)(r.fC,{delayDuration:0,children:[(0,n.jsx)(r.xz,{asChild:!0,children:(0,n.jsx)(u.z,{type:"primary",disabled:!g,icon:(0,n.jsx)(x.Z,{size:"tiny"}),onClick:()=>d(!0),children:"Add role"})}),!g&&(0,n.jsxs)(r.VY,{align:"start",side:"bottom",children:[(0,n.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background text-xs",children:"You need additional permissions to add a new role"})]})]})]})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"bg-surface-100 border border-default px-6 py-3 rounded-t flex items-center space-x-4",children:[(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Roles managed by Supabase"}),(0,n.jsx)(M.Z,{color:"green",children:"Protected"})]}),y?Array.from({length:5}).map((e,t)=>(0,n.jsx)(Roles_RoleRowSkeleton,{index:t},t)):S.map((e,t)=>(0,n.jsx)(Roles_RoleRow,{disabled:!0,role:e,onSelectDelete:f},e.id))]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"bg-surface-100 border border-default px-6 py-3 rounded-t",children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Other database roles"})}),y?Array.from({length:3}).map((e,t)=>(0,n.jsx)(Roles_RoleRowSkeleton,{index:t},t)):C.map((e,t)=>(0,n.jsx)(Roles_RoleRow,{disabled:!g,role:e,onSelectDelete:f},e.id))]})]}),t.length>0&&0===w.length&&(0,n.jsx)(U.Z,{searchString:t,onResetFilter:()=>a("")})]}),(0,n.jsx)(Roles_CreateRolePanel,{visible:o,onClose:()=>d(!1)}),(0,n.jsx)(Roles_DeleteRoleModal,{role:m,visible:void 0!==m,onClose:()=>f(void 0)})]})},ef=a(60674),eg=a(25877),ev=a.n(eg),ej=a(39097),eb=a.n(ej),ey=a(39195),eN=a(63157),ew=a(61356),e_=a(72397),eS=a(24978),Extensions_ExtensionCardSkeleton=e=>{let{index:t=0}=e;return(0,n.jsxs)("div",{className:"flex border-overlay flex-col overflow-hidden rounded border shadow-sm",children:[(0,n.jsxs)("div",{className:"border-overlay bg-surface-100 flex justify-between w-full border-b py-3 px-4",children:[(0,n.jsx)("div",{className:"flex items-center gap-1 max-w-[85%]",children:(0,n.jsx)("div",{className:"flex items-center space-x-2 truncate",children:(0,n.jsx)(w.Z,{className:"h-5 w-32 m-0 text-foreground",delayIndex:t})})}),(0,n.jsx)(ep.Z,{size:"tiny",checked:!1,disabled:!0})]}),(0,n.jsx)("div",{className:"bg-panel-header-light bg-panel-secondary-light flex h-full flex-col justify-between",children:(0,n.jsx)("div",{className:"py-3 px-4",children:(0,n.jsx)(w.Z,{className:"h-4 w-48",delayIndex:t})})})]})};let eC=["adminpack","amcheck","file_fdw","lo","old_snapshot","pageinspect","pg_buffercache","pg_freespacemap","pg_prewarm","pg_surgery","pg_visibility","pgstattuple","supabase_vault","intagg","xml2","pg_tle"];var eZ=(0,o.Pi)(()=>{let{filter:e}=(0,ef.UO)(),{project:t}=(0,E.d2)(),[a,r]=(0,c.useState)(""),{data:i,isLoading:l}=(0,e_.H)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString}),o=0===a.length?null!=i?i:[]:(null!=i?i:[]).filter(e=>e.name.includes(a)),d=o.filter(e=>!eC.includes(e.name)),[m,x]=D()(d,e=>!ev()(e.installed_version)),f=(0,_.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"extensions"),g=(0,_.N4)();return(0,c.useEffect)(()=>{void 0!==e&&r(e)},[e]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(p.Z,{size:"small",placeholder:"Search for an extension",value:a,onChange:e=>r(e.target.value),className:"w-64",icon:(0,n.jsx)(h.Z,{size:"tiny"})}),g&&!f?(0,n.jsx)("div",{className:"w-[500px]",children:(0,n.jsx)(ew.Z,{icon:(0,n.jsx)(ey.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to update database extensions"})}):(0,n.jsx)(u.z,{asChild:!0,type:"default",icon:(0,n.jsx)(eN.Z,{}),children:(0,n.jsx)(eb(),{href:"https://supabase.com/docs/guides/database/extensions",target:"_blank",rel:"noreferrer",children:"Documentation"})})]})}),l?(0,n.jsx)("div",{className:"my-8 w-full space-y-12",children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(w.Z,{className:"h-[28px] w-40"}),(0,n.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:Array.from({length:6}).map((e,t)=>(0,n.jsx)(Extensions_ExtensionCardSkeleton,{index:t},t))})]})}):(0,n.jsxs)(n.Fragment,{children:[0===o.length&&(0,n.jsx)(U.Z,{searchString:a,onResetFilter:()=>r("")}),(0,n.jsxs)("div",{className:"my-8 w-full space-y-12",children:[m.length>0&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h4",{className:"text-lg",children:"Enabled extensions"}),(0,n.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:m.map(e=>(0,n.jsx)(eS.Z,{extension:e},e.name))})]}),x.length>0&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h4",{className:"text-lg",children:"Available extensions"}),(0,n.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:x.map(e=>(0,n.jsx)(eS.Z,{extension:e},e.name))})]})]})]})]})}),ek=a(45455),eT=a.n(ek),eD=a(5632),eE=a(73872),eF=a(13627),eR=a(74596);function wrapWithTransaction(e){return"\n    begin;\n\n    ".concat(e,"\n    \n    commit;\n  ")}var ez=a(8103);function getCreateFDWSql(e){let{wrapperMeta:t,formState:a,tables:n}=e,r=n.filter(e=>e.is_new_schema).map(e=>"create schema if not exists ".concat(e.schema_name,";")).join("\n"),s="\n    create foreign data wrapper ".concat(a.wrapper_name,"\n    handler ").concat(t.handlerName,"\n    validator ").concat(t.validatorName,";\n  "),i=t.server.options.filter(e=>e.encrypted),l=t.server.options.filter(e=>!e.encrypted),o=i.map(e=>{let t="".concat(a.wrapper_name,"_").concat(e.name),n=(a[e.name]||"").replace(/'/g,"''");return"\n      select pgsodium.create_key(\n        name := '".concat(t,"'\n      );\n\n      select vault.create_secret (\n        new_secret := '").concat(n,"',\n        new_name   := '").concat(t,"',\n        new_key_id := (select id from pgsodium.valid_key where name = '").concat(t,"')\n      );\n    ")}),c=o.join("\n"),d=i.map(e=>"".concat(e.name," ''%s''")),u=l.map(e=>"".concat(e.name," ''").concat(a[e.name],"''")),m=[...d,...u].join(","),p="\n    do $$\n    declare\n      ".concat(i.map(e=>"v_".concat(e.name," text;")).join("\n"),"\n    begin\n      ").concat(i.map(e=>"select id into v_".concat(e.name," from pgsodium.valid_key where name = '").concat(a.wrapper_name,"_").concat(e.name,"' limit 1;")).join("\n"),"\n    \n      execute format(\n        E'create server ").concat(a.server_name,"\\n'\n        '   foreign data wrapper ").concat(a.wrapper_name,"\\n'\n        '   options (\\n'\n        '     ").concat(m,"\\n'\n        '   );',\n        ").concat(i.map(e=>"v_".concat(e.name)).join(",\n"),"\n      );\n    end $$;\n  "),h=n.map(e=>{let t=e.columns;return'\n        create foreign table "'.concat(e.schema_name,'"."').concat(e.table_name,'" (\n          ').concat(t.map(e=>'"'.concat(e.name,'" ').concat(e.type)).join(",\n          "),"\n        )\n        server ").concat(a.server_name,"\n        options (\n          ").concat(Object.entries(e).filter(e=>{let[t,a]=e;return"table_name"!==t&&"schema_name"!==t&&"columns"!==t&&"index"!==t&&"is_new_schema"!==t&&!!a}).map(e=>{let[t,a]=e;return"".concat(t," '").concat(a,"'")}).join(",\n          "),"\n        );\n      ")}).join("\n\n"),x="\n    ".concat(r,"\n\n    ").concat(s,"\n\n    ").concat(c,"\n\n    ").concat(p,"\n\n    ").concat(h,"\n  ");return x}async function createFDW(e){let{projectRef:t,connectionString:a,wrapperMeta:n,formState:r,tables:s}=e,i=wrapWithTransaction(getCreateFDWSql({wrapperMeta:n,formState:r,tables:s})),{result:l}=await (0,H.Rj)({projectRef:t,connectionString:a,sql:i});return l}let useFDWCreateMutation=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,en.NL)();return(0,er.D)(e=>createFDW(e),{async onSuccess(t,a,r){let{projectRef:s}=a;await Promise.all([n.invalidateQueries(eR.M.query(s,["fdws"]),{refetchType:"all"}),n.invalidateQueries(eF.H.list(s)),n.invalidateQueries(eR.M.query(s,ez.W.list(s)))]),await (null==e?void 0:e(t,a,r))},async onError(e,a,n){void 0===t?G.Am.error("Failed to create ".concat(a.wrapperMeta.label," foreign data wrapper: ").concat(e.message)):t(e,a,n)},...a})};var eP=a(35500),eI=a(13781),eA=a(77784),eW=a(92553),Wrappers_InputField=e=>{var t,a,r;let{option:s,loading:i,error:l}=e,[o,d]=(0,c.useState)(!s.hidden);return s.isTextArea?(0,n.jsx)("div",{className:"text-area-text-sm text-area-resize-none",children:(0,n.jsx)(p.Z.TextArea,{rows:6,error:l,className:"input-mono",disabled:i,id:s.name,name:s.name,label:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("p",{children:s.label}),void 0!==s.urlHelper&&(0,n.jsx)(eb(),{href:s.urlHelper,target:"_blank",rel:"noreferrer",children:(0,n.jsx)(eh.Z,{strokeWidth:2,size:14,className:"text-foreground-light hover:text-foreground cursor-pointer transition"})})]}),value:i?"Fetching value from Vault...":void 0,defaultValue:null!==(t=s.defaultValue)&&void 0!==t?t:"",required:null!==(a=s.required)&&void 0!==a&&a},s.name)}):(0,n.jsx)(p.Z,{id:s.name,name:s.name,label:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("p",{children:s.label}),void 0!==s.urlHelper&&(0,n.jsx)(eb(),{href:s.urlHelper,target:"_blank",rel:"noreferrer",children:(0,n.jsx)(eh.Z,{strokeWidth:2,size:14,className:"text-foreground-light hover:text-foreground cursor-pointer transition"})})]}),defaultValue:null!==(r=s.defaultValue)&&void 0!==r?r:"",error:l,value:i?"Fetching value from Vault...":void 0,type:!s.hidden||i?"text":o?"text":"password",disabled:i,actions:i?(0,n.jsx)("div",{className:"flex items-center justify-center mr-1",children:(0,n.jsx)(u.z,{disabled:!0,type:"default",icon:(0,n.jsx)(eI.Z,{className:"animate-spin"})})}):s.hidden?(0,n.jsx)("div",{className:"flex items-center justify-center mr-1",children:(0,n.jsx)(u.z,{type:"default",icon:o?(0,n.jsx)(eA.Z,{}):(0,n.jsx)(eW.Z,{}),onClick:()=>d(!o)})}):null},s.name)},eV=a(46732);let eq={STRIPE:"stripe_fdw_handler",FIREBASE:"firebase_fdw_handler",S3:"s3_fdw_handler",CLICK_HOUSE:"click_house_fdw_handler",BIG_QUERY:"big_query_fdw_handler",AIRTABLE:"airtable_fdw_handler",LOGFLARE:"logflare_fdw_handler"},eO=[{name:"stripe_wrapper",handlerName:eq.STRIPE,validatorName:"stripe_fdw_validator",icon:"".concat(eV.GW,"/img/icons/stripe-icon.svg"),extensionName:"StripeFdw",label:"Stripe",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/stripe",server:{options:[{name:"api_key_id",label:"Stripe Secret Key",required:!0,encrypted:!0,hidden:!0,urlHelper:"https://stripe.com/docs/keys"},{name:"api_url",label:"Stripe API URL",defaultValue:"https://api.stripe.com/v1",required:!1,encrypted:!1,hidden:!1}]},tables:[{label:"Balance",description:"The balance currently on your Stripe account",availableColumns:[{name:"balance_type",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"balance",editable:!1,required:!0,type:"text"}]},{label:"Balance Transactions",description:"Transactions that have contributed to the balance on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"description",type:"text"},{name:"fee",type:"bigint"},{name:"net",type:"bigint"},{name:"status",type:"text"},{name:"type",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"balance_transactions",editable:!1,required:!0,type:"text"}]},{label:"Charges",description:"Charges made on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"customer",type:"text"},{name:"description",type:"text"},{name:"invoice",type:"text"},{name:"payment_intent",type:"text"},{name:"status",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"charges",editable:!1,required:!0,type:"text"}]},{label:"Customers",description:"Customers on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"email",type:"text"},{name:"name",type:"text"},{name:"description",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"customers",editable:!1,required:!0,type:"text"}]},{label:"Invoices",description:"Invoices on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"subscription",type:"text"},{name:"status",type:"text"},{name:"total",type:"bigint"},{name:"currency",type:"text"},{name:"period_start",type:"timestamp"},{name:"period_end",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"invoices",editable:!1,required:!0,type:"text"}]},{label:"Payment Intents",description:"Payment Intents on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"payment_method",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"payment_intents",editable:!1,required:!0,type:"text"}]},{label:"Products",description:"Products on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"name",type:"text"},{name:"active",type:"bool"},{name:"default_price",type:"text"},{name:"description",type:"text"},{name:"created",type:"timestamp"},{name:"updated",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"products",editable:!1,required:!0,type:"text"}]},{label:"Subscriptions",description:"Subscriptions on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"currency",type:"text"},{name:"current_period_start",type:"timestamp"},{name:"current_period_end",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"subscriptions",editable:!1,required:!0,type:"text"}]}]},{name:"firebase_wrapper",handlerName:eq.FIREBASE,validatorName:"firebase_fdw_validator",icon:"".concat(eV.GW,"/img/icons/firebase-icon.svg"),extensionName:"FirebaseFdw",label:"Firebase",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/firebase",server:{options:[{name:"project_id",label:"Project ID",required:!0,encrypted:!1,hidden:!1},{name:"sa_key_id",label:"Service Account Key",required:!0,encrypted:!0,hidden:!0,isTextArea:!0,urlHelper:"https://firebase.google.com/docs/admin/setup#initialize-sdk"}]},tables:[{label:"Users",description:"Shows your Firebase users",availableColumns:[{name:"uid",type:"text"},{name:"email",type:"text"},{name:"created_at",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"auth/users",editable:!1,required:!0,type:"text"},{name:"base_url",label:"Base URL",defaultValue:"https://identitytoolkit.googleapis.com/v1/projects",editable:!0,required:!0,type:"text"},{name:"limit",label:"Limit",defaultValue:"10000",editable:!0,required:!0,type:"text"}]},{label:"Firestore Collection",description:"Map to a Firestore collection",availableColumns:[{name:"name",type:"text"},{name:"created_at",type:"timestamp"},{name:"updated_at",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",label:"Object",placeholder:"firestore/[collection_id]",editable:!0,required:!0,type:"text"},{name:"base_url",label:"Base URL",defaultValue:"https://firestore.googleapis.com/v1beta1/projects",editable:!0,required:!0,type:"text"},{name:"limit",label:"Limit",defaultValue:"10000",editable:!0,required:!0,type:"text"}]}]},{name:"s3_wrapper",handlerName:eq.S3,validatorName:"s3_fdw_validator",icon:"".concat(eV.GW,"/img/icons/s3-icon.svg"),extensionName:"S3Fdw",label:"S3",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/s3",server:{options:[{name:"vault_access_key_id",label:"Access Key ID",required:!0,encrypted:!0,hidden:!0},{name:"vault_secret_access_key",label:"Access Key Secret",required:!0,encrypted:!0,hidden:!0},{name:"aws_region",label:"AWS Region",required:!0,encrypted:!1,hidden:!1,defaultValue:"us-east-1"}]},tables:[{label:"S3 File",description:"Map to a file in S3 (CSV or JSON only)",options:[{name:"uri",label:"URI",editable:!0,required:!0,placeholder:"s3://bucket/s3_table.csv",type:"text"},{name:"format",label:"Format",editable:!0,required:!0,type:"select",defaultValue:"csv",options:[{label:"CSV",value:"csv"},{label:"JSONL (JSON Lines)",value:"jsonl"}]},{name:"has_header",label:"Has Header",editable:!0,required:!0,type:"select",defaultValue:"true",options:[{label:"True",value:"true"},{label:"False",value:"false"}]},{name:"compress",label:"Compression",editable:!0,required:!1,type:"select",options:[{label:"GZIP",value:"gzip"}]}]}]},{name:"clickhouse_wrapper",handlerName:eq.CLICK_HOUSE,validatorName:"click_house_fdw_validator",icon:"".concat(eV.GW,"/img/icons/clickhouse-icon.svg"),extensionName:"ClickHouseFdw",label:"ClickHouse",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/clickhouse",server:{options:[{name:"conn_string_id",label:"ClickHouse Connection String",required:!0,encrypted:!0,hidden:!0}]},tables:[{label:"ClickHouse Table",description:"Map to a ClickHouse Table",options:[{name:"table",label:"ClickHouse Table Name",editable:!0,required:!0,placeholder:"my_clickhouse_table",type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]}]},{name:"bigquery_wrapper",handlerName:eq.BIG_QUERY,validatorName:"big_query_fdw_validator",icon:"".concat(eV.GW,"/img/icons/bigquery-icon.svg"),extensionName:"BigQueryFdw",label:"BigQuery",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/bigquery",server:{options:[{name:"sa_key_id",label:"Service Account Key",required:!0,encrypted:!0,hidden:!0},{name:"project_id",label:"Project ID",required:!0,encrypted:!1,hidden:!1},{name:"dataset_id",label:"Dataset ID",required:!0,encrypted:!1,hidden:!1}]},tables:[{label:"BigQuery Table",description:"Map to a BigQuery Table",options:[{name:"table",label:"BigQuery Table Name",editable:!0,required:!0,placeholder:"my_bigquery_table",type:"text"},{name:"location",label:"Location",defaultValue:"US",editable:!0,required:!1,type:"text"},{name:"timeout",label:"Timeout (ms)",defaultValue:"30000",editable:!0,required:!1,type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!1,type:"text"}]}]},{name:"airtable_wrapper",handlerName:eq.AIRTABLE,validatorName:"airtable_fdw_validator",icon:"".concat(eV.GW,"/img/icons/airtable-icon.svg"),extensionName:"airtableFdw",label:"Airtable",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/airtable",server:{options:[{name:"api_key_id",label:"API Key ID",required:!0,encrypted:!0,hidden:!0}]},tables:[{label:"Airtable Table",description:"Map to an Airtable Table",options:[{name:"base_id",label:"Base ID",editable:!0,required:!0,type:"text"},{name:"table_id",label:"Table ID",editable:!0,required:!0,type:"text"}]}]},{name:"logflare_wrapper",handlerName:eq.LOGFLARE,validatorName:"logflare_fdw_validator",icon:"".concat(eV.GW,"/img/icons/logflare-icon.svg"),extensionName:"logflareFdw",label:"Logflare",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/logflare",server:{options:[{name:"api_key_id",label:"API Key ID",required:!0,encrypted:!0,hidden:!0}]},tables:[{label:"Logflare Table",description:"Map to a Logflare Table",options:[{name:"endpoint",label:"Endpoint",editable:!0,required:!0,type:"text"}]}]}],makeValidateRequired=e=>{let t=new Set(e.filter(e=>e.required).map(e=>e.name)),a=new Set(Array.from(t).filter(e=>e.includes("."))),n=Array.from(a);return e=>{let r=Object.fromEntries(Object.entries(e).flatMap(e=>{let[t,a]=e;return Array.isArray(a)?[[t,a],...a.map((e,a)=>["".concat(t,".").concat(a),e])]:[[t,a]]}).filter(e=>{let[r,s]=e,[i,l]=r.split(".");if(void 0!==l&&t.has(i)&&Object.keys(s).some(e=>a.has("".concat(i,".").concat(e)))){let e=n.find(e=>e.startsWith("".concat(i,".")));if(e){let t=e.split(".")[1];return!s[t]}return!1}return t.has(i)&&(Array.isArray(s)?s.length<1:!s)}).map(e=>{let[t]=e;return"table_name"===t?[t,"Please provide a name for your table"]:"columns"===t?[t,"Please select at least one column"]:[t,"This field is required"]}));return r}},formatWrapperTables=(e,t)=>{var a;let n=null!==(a=null==e?void 0:e.tables)&&void 0!==a?a:[];return n.map(a=>{var n,r,s;let i=0,l=Object.fromEntries(a.options.map(e=>e.split("=")));switch(e.handler){case eq.STRIPE:i=null!==(n=null==t?void 0:t.tables.findIndex(e=>{var t;return(null===(t=e.options.find(e=>"object"===e.name))||void 0===t?void 0:t.defaultValue)===l.object}))&&void 0!==n?n:0;break;case eq.FIREBASE:i="auth/users"===l.object?null!==(r=null==t?void 0:t.tables.findIndex(e=>e.options.find(e=>"auth/users"===e.defaultValue)))&&void 0!==r?r:0:null!==(s=null==t?void 0:t.tables.findIndex(e=>"Firestore Collection"===e.label))&&void 0!==s?s:0;case eq.S3:case eq.AIRTABLE:case eq.LOGFLARE:case eq.BIG_QUERY:case eq.CLICK_HOUSE:}return{...l,index:i,columns:a.columns,is_new_schema:!1,schema:a.schema,schema_name:a.schema,table_name:a.name}})},convertKVStringArrayToJson=e=>Object.fromEntries(e.map(e=>e.split("=")));var eL=a(11539),eM=a(60240),eB=a(59343),eU=a(40127),eQ=a(96415);let eY=[{name:"",type:"text"}];var Wrappers_WrapperDynamicColumns=e=>{let{initialColumns:t=eY,onChange:a,errors:r={}}=e,[s,i]=(0,c.useReducer)((e,t)=>{switch(t.type){case"ADD_COLUMN":return{...e,columns:{...e.columns,[e.nextId]:{id:e.nextId,name:"",type:"text"}},nextId:e.nextId+1};case"REMOVE_COLUMN":return{...e,columns:Object.fromEntries(Object.entries(e.columns).filter(e=>{let[a]=e;return Number(a)!==t.payload.id}))};case"UPDATE_COLUMN":return{...e,columns:{...e.columns,[t.payload.id]:{...e.columns[t.payload.id],[t.payload.key]:t.payload.value}}};default:return e}},{columns:Object.fromEntries(t.map((e,t)=>[t,{...e,id:t}])),nextId:t.length}),l=(0,eQ.Z)(a);(0,c.useEffect)(()=>{var e;null===(e=l.current)||void 0===e||e.call(l,getColumns(s.columns))},[s.columns]);let onAddColumn=()=>{i({type:"ADD_COLUMN"})},onRemoveColumn=e=>{i({type:"REMOVE_COLUMN",payload:{id:e}})},onUpdateValue=(e,t,a)=>{i({type:"UPDATE_COLUMN",payload:{id:e,key:t,value:a}})},o=getColumns(s.columns);return(0,n.jsxs)("div",{className:"w-full flex flex-col gap-4",children:[(0,n.jsx)("div",{className:"flex flex-col gap-4",children:o.map((e,t)=>(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(p.Z,{className:"flex-1 [&_label]:!p-0",layout:"vertical",label:"Name",value:e.name,onChange:t=>onUpdateValue(e.id,"name",t.target.value)}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(eU.Z,{value:e.type,enumTypes:[],onOptionSelect:t=>onUpdateValue(e.id,"type",t),layout:"vertical",className:"[&_label]:!p-0"})}),(0,n.jsx)(u.z,{onClick:()=>onRemoveColumn(e.id),icon:(0,n.jsx)(W.Z,{size:14,strokeWidth:1.5}),type:"outline",className:"self-end -translate-y-1 !px-2 !py-2"})]}),r["columns.".concat(t)]&&(0,n.jsx)("span",{className:"text-red-900 text-sm mt-2",children:r["columns.".concat(t)]})]},e.id))}),(0,n.jsx)(u.z,{type:"default",onClick:()=>onAddColumn(),className:"self-start",children:"Add column"})]})};function getColumns(e){return Object.values(e).sort((e,t)=>e.id-t.id)}var Wrappers_WrapperTableEditor=e=>{let{visible:t,onCancel:a,onSave:r,tables:s,initialData:i}=e,[l,o]=(0,c.useState)("");(0,c.useEffect)(()=>{i&&o(String(i.index))},[i]);let d=""===l?void 0:s[parseInt(l)],handleCancel=()=>{o(""),a()};return(0,n.jsx)(J.ZP,{size:"medium",visible:t,onCancel:handleCancel,header:(0,n.jsx)("span",{children:"Edit foreign table"}),customFooter:(0,n.jsx)(eL.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",formId:"wrapper-table-editor-form",closePanel:handleCancel}),children:(0,n.jsx)(J.ZP.Content,{children:(0,n.jsxs)("div",{className:"my-4 space-y-6",children:[(0,n.jsxs)(eM.Z,{size:"small",label:"Select a target the table will point to",value:l,onChange:e=>o(e),children:[(0,n.jsx)(eM.Z.Option,{value:"",label:"---",children:"---"},"empty"),s.map((e,t)=>(0,n.jsx)(eM.Z.Option,{className:"group",value:String(t),label:e.label,children:(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("p",{children:e.label}),(0,n.jsx)("p",{className:"opacity-50",children:e.description})]})},String(t)))]}),d&&(0,n.jsx)(TableForm,{table:d,onSubmit:(e,t)=>{let{resetForm:a}=t;r({...e,index:parseInt(l),schema_name:"custom"===e.schema?e.schema_name:e.schema,is_new_schema:"custom"===e.schema}),a(),o("")},initialData:i})]})})},"WrapperTableEditor")};let Option=e=>{var t,a,r;let{option:s}=e;return"select"===s.type?(0,n.jsx)(eM.Z,{id:s.name,name:s.name,label:s.label,defaultValue:null!==(t=s.defaultValue)&&void 0!==t?t:"",children:[...s.required?[]:[(0,n.jsx)(eM.Z.Option,{value:"",label:"---",children:"---"},"empty")],...s.options.map(e=>(0,n.jsx)(eM.Z.Option,{id:s.name+e.value,value:e.value,label:e.label,children:e.label},e.value))]},s.name):(0,n.jsx)(p.Z,{id:s.name,name:s.name,label:s.label,placeholder:null!==(a=s.placeholder)&&void 0!==a?a:"",defaultValue:null!==(r=s.defaultValue)&&void 0!==r?r:""},s.name)},TableForm=e=>{var t,a,r;let{table:s,onSubmit:i,initialData:l}=e,{project:o}=(0,E.d2)(),{data:c,isLoading:d,isSuccess:u}=(0,z.Q1)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString}),m=null!==(t=s.options.filter(e=>e.editable&&e.required&&!e.defaultValue))&&void 0!==t?t:[],h=null!==(a=s.options.filter(e=>e.editable&&(!e.required||e.defaultValue)))&&void 0!==a?a:[],f=null!=l?l:{table_name:"",columns:null!==(r=s.availableColumns)&&void 0!==r?r:[],...Object.fromEntries(s.options.map(e=>{var t;return[e.name,null!==(t=e.defaultValue)&&void 0!==t?t:""]})),schema:"public",schema_name:""},g=makeValidateRequired([...s.options,{name:"table_name",required:!0},{name:"columns",required:!0},...s.availableColumns?[]:[{name:"columns.name",required:!0}]]);return(0,n.jsx)(ed.Z,{id:"wrapper-table-editor-form",initialValues:f,validate:g,onSubmit:i,enableReinitialize:!0,children:e=>{var t;let{errors:a,values:r,setFieldValue:i}=e;return(0,n.jsxs)("div",{className:"space-y-4",children:[d&&(0,n.jsx)(w.Z,{className:"py-4"}),u&&(0,n.jsxs)(eM.Z,{size:"small",name:"schema",label:"Select a schema for the foreign table",children:[(0,n.jsx)(eM.Z.Option,{id:"custom",label:"Create a new schema",value:"custom",addOnBefore:()=>(0,n.jsx)(x.Z,{size:16,strokeWidth:1.5}),children:"Create a new schema"},"custom"),(0,n.jsx)(ec.C.Separator,{}),null===(t=null!=c?c:[])||void 0===t?void 0:t.map(e=>(0,n.jsx)(eM.Z.Option,{id:e.name,label:e.name,value:e.name,addOnBefore:()=>(0,n.jsx)(eB.Z,{size:16,strokeWidth:1.5}),children:e.name},e.id))]}),"custom"===r.schema&&(0,n.jsx)(p.Z,{id:"schema_name",name:"schema_name",label:"Schema name"}),(0,n.jsx)(p.Z,{id:"table_name",name:"table_name",label:"Table name",descriptionText:"You can query from this table after the wrapper is enabled."}),m.map(e=>(0,n.jsx)(Option,{option:e},e.name)),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"!w-full",children:s.availableColumns?"Select the columns to be added to your table":"Add columns to your table"}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2 w-full",children:s.availableColumns?s.availableColumns.map(e=>{let t=!!r.columns.find(t=>t.name===e.name);return(0,n.jsx)("div",{className:["px-2 py-1 rounded cursor-pointer transition","".concat(t?"bg-brand-300":"bg-surface-300 hover:bg-selection")].join(" "),onClick:()=>{t?i("columns",r.columns.filter(t=>t.name!==e.name)):i("columns",r.columns.concat([e]))},children:(0,n.jsx)("p",{className:"text-sm",children:e.name})},e.name)}):(0,n.jsx)(Wrappers_WrapperDynamicColumns,{initialColumns:r.columns,onChange:e=>{i("columns",e)},errors:a})}),a.columns&&(0,n.jsx)("span",{className:"text-red-900 text-sm mt-2",children:a.columns})]}),h.map(e=>(0,n.jsx)(Option,{option:e},e.name))]})}})};var eH=(0,o.Pi)(()=>{let e="create-wrapper-form",t=(0,eD.useRouter)(),a=(0,en.NL)(),{ui:r}=(0,_.oR)(),{ref:i,type:l}=(0,eE.UO)(),{project:o}=(0,E.d2)(),d=(0,_.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"wrappers"),[m,h]=(0,c.useState)([]),[x,f]=(0,c.useState)(!1),[g,b]=(0,c.useState)(),[y,N]=(0,c.useState)({}),{mutate:w,isLoading:S}=useFDWCreateMutation({onSuccess:()=>{r.setNotification({category:"success",message:"Successfully created ".concat(null==C?void 0:C.label," foreign data wrapper")}),h([]);let e=m.some(e=>e.is_new_schema);e&&(0,z.XL)(a,i),t.push("/project/".concat(i,"/database/wrappers"))}}),C=eO.find(e=>e.name===l),Z=void 0!==C?{wrapper_name:"",server_name:"",...Object.fromEntries(C.server.options.map(e=>{var t;return[e.name,null!==(t=e.defaultValue)&&void 0!==t?t:""]}))}:{};if(void 0===C)return(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-2 flex flex-col items-center w-[400px]",children:[(0,n.jsx)("p",{children:"Unsupported wrapper type"}),(0,n.jsxs)("p",{className:"text-sm text-center text-foreground-light",children:["The wrapper type ",l," not supported by the dashboard. Head back to create a different wrapper."]})]}),(0,n.jsx)(u.z,{asChild:!0,type:"default",children:(0,n.jsx)(eb(),{href:"/project/".concat(i,"/database/wrappers"),children:"Head back"})})]});let onSubmit=async e=>{let t=makeValidateRequired(C.server.options),a=t(e),{wrapper_name:n}=e;if(0===n.length&&(a.name="Please provide a name for your wrapper"),0===m.length&&(a.tables="Please add at least one table"),!eT()(a))return N(a);w({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString,wrapperMeta:C,formState:{...e,server_name:"".concat(n,"_server")},tables:m})};return(0,n.jsxs)(B.ld,{children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"relative flex items-center justify-between mb-6",children:[(0,n.jsx)("div",{className:"transition cursor-pointer absolute -left-20 top-1 opacity-75 hover:opacity-100",children:(0,n.jsx)(eb(),{href:"/project/".concat(i,"/database/wrappers"),children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(eP.Z,{strokeWidth:1.5,size:14}),(0,n.jsx)("p",{className:"text-sm",children:"Back"})]})})}),(0,n.jsxs)("h3",{className:"mb-2 text-xl text-foreground",children:["Create a ",C.label," Wrapper"]}),(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsx)(u.z,{asChild:!0,type:"default",icon:(0,n.jsx)(eN.Z,{strokeWidth:1.5}),children:(0,n.jsx)(eb(),{href:C.docsUrl,target:"_blank",rel:"noreferrer",children:"Documentation"})})})]}),(0,n.jsx)(ed.Z,{id:e,initialValues:Z,onSubmit:onSubmit,children:t=>{var a;let{handleReset:r,values:s,initialValues:i}=t,l=JSON.stringify(s)!==JSON.stringify(i);return(0,n.jsxs)(B.by,{disabled:!d,footer:(0,n.jsx)("div",{className:"flex px-8 py-4",children:(0,n.jsx)(B.iN,{form:e,isSubmitting:S,hasChanges:l,handleReset:r,disabled:!d,helper:d?void 0:"You need additional permissions to create a foreign data wrapper"})}),children:[(0,n.jsx)(B.hj,{header:(0,n.jsx)(B.S0,{children:"Wrapper Configuration"}),children:(0,n.jsx)(B.B4,{loading:!1,children:(0,n.jsx)(p.Z,{id:"wrapper_name",label:"Wrapper Name",error:y.wrapper_name,descriptionText:(null!==(a=null==s?void 0:s.wrapper_name)&&void 0!==a?a:"").length>0?(0,n.jsxs)(n.Fragment,{children:["Your wrapper's server name will be"," ",(0,n.jsxs)("code",{className:"text-xs",children:[s.wrapper_name,"_server"]})]}):""})})}),(0,n.jsx)(B.hj,{header:(0,n.jsxs)(B.S0,{children:[C.label," Configuration"]}),children:(0,n.jsx)(B.B4,{loading:!1,children:C.server.options.map(e=>(0,n.jsx)(Wrappers_InputField,{option:e,loading:!1,error:y[e.name]},e.name))})}),(0,n.jsx)(B.hj,{header:(0,n.jsxs)(B.S0,{children:[(0,n.jsx)("p",{children:"Foreign Tables"}),(0,n.jsx)("p",{className:"text-foreground-light mt-2 w-[90%]",children:"You can query your data from these foreign tables after the wrapper is created"})]}),children:(0,n.jsxs)(B.B4,{loading:!1,children:[0===m.length?(0,n.jsx)("div",{className:"flex justify-end translate-y-4",children:(0,n.jsx)(u.z,{type:"default",onClick:()=>f(!0),children:"Add foreign table"})}):(0,n.jsx)("div",{className:"space-y-2",children:m.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border rounded-md border-control",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"text-sm",children:[e.schema_name,".",e.table_name]}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:[C.tables[e.index].label,":"," ",e.columns.map(e=>e.name).join(", ")]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(u.z,{type:"default",className:"px-1",icon:(0,n.jsx)(v.Z,{}),onClick:()=>{f(!0),b({...e,tableIndex:t})}}),(0,n.jsx)(u.z,{type:"default",className:"px-1",icon:(0,n.jsx)(j.Z,{}),onClick:()=>{h(e=>e.filter((e,a)=>a!==t))}})]})]},"".concat(e.schema_name,".").concat(e.table_name)))}),m.length>0&&(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(u.z,{type:"default",onClick:()=>f(!0),children:"Add foreign table"})}),0===m.length&&y.tables&&(0,n.jsx)("p",{className:"text-sm text-right text-red-900",children:y.tables})]})})]})}})]}),(0,n.jsx)(Wrappers_WrapperTableEditor,{visible:x,tables:C.tables,onCancel:()=>{b(void 0),f(!1)},onSave:e=>{h(t=>{if(void 0!==e.tableIndex){let a=e.tableIndex,n=[...t];return delete e.tableIndex,n[a]=e,n}return[...t,e]}),f(!1),b(void 0)},initialData:g})]})}),eX=a(86024);let getDeleteFDWSql=e=>{let{wrapper:t,wrapperMeta:a}=e,n=a.server.options.filter(e=>e.encrypted),r=n.map(e=>{let a="".concat(t.name,"_").concat(e.name);return"\n      delete from vault.secrets where key_id = (select id from pgsodium.valid_key where name = '".concat(a,"');\n\n      delete from pgsodium.key where name = '").concat(a,"';\n    ")}),s=r.join("\n"),i="\n    drop foreign data wrapper if exists ".concat(t.name," cascade;\n\n    ").concat(s,"\n  ");return i};async function deleteFDW(e){let{projectRef:t,connectionString:a,wrapper:n,wrapperMeta:r}=e,s=wrapWithTransaction(getDeleteFDWSql({wrapper:n,wrapperMeta:r})),{result:i}=await (0,H.Rj)({projectRef:t,connectionString:a,sql:s});return i}let useFDWDeleteMutation=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,en.NL)();return(0,er.D)(e=>deleteFDW(e),{async onSuccess(t,a,r){let{projectRef:s}=a;await Promise.all([n.invalidateQueries(eR.M.query(s,["fdws"])),n.invalidateQueries(eF.H.list(s)),n.invalidateQueries(eR.M.query(s,ez.W.list(s)))]),await (null==e?void 0:e(t,a,r))},async onError(e,a,n){void 0===t?G.Am.error("Failed to disable ".concat(a.wrapper.name," foreign data wrapper: ").concat(e.message)):t(e,a,n)},...a})},getUpdateFDWSql=e=>{let{wrapper:t,wrapperMeta:a,formState:n,tables:r}=e,s=getDeleteFDWSql({wrapper:t,wrapperMeta:a}),i=getCreateFDWSql({wrapperMeta:a,formState:n,tables:r}),l="\n    ".concat(s,"\n\n    ").concat(i,"\n  ");return l};async function updateFDW(e){let{projectRef:t,connectionString:a,wrapper:n,wrapperMeta:r,formState:s,tables:i}=e,l=wrapWithTransaction(getUpdateFDWSql({wrapper:n,wrapperMeta:r,formState:s,tables:i})),{result:o}=await (0,H.Rj)({projectRef:t,connectionString:a,sql:l});return o}let useFDWUpdateMutation=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,en.NL)();return(0,er.D)(e=>updateFDW(e),{async onSuccess(t,a,r){let{projectRef:s}=a;await Promise.all([n.invalidateQueries(eR.M.query(s,["fdws"])),n.invalidateQueries(eF.H.list(s)),n.invalidateQueries(eR.M.query(s,ez.W.list(s)))]),await (null==e?void 0:e(t,a,r))},async onError(e,a,n){void 0===t?G.Am.error("Failed to update ".concat(a.wrapper.name," foreign data wrapper: ").concat(e.message)):t(e,a,n)},...a})},getFDWsSql=()=>"\n    select\n      s.oid as \"id\",\n      w.fdwname as \"name\",\n      s.srvname as \"server_name\",\n      s.srvoptions as \"server_options\",\n      c.proname as \"handler\",\n      (\n        select jsonb_agg(\n          jsonb_build_object(\n            'id', c.oid::bigint,\n            'schema', relnamespace::regnamespace::text,\n            'name', c.relname,\n            'columns', (\n              select jsonb_agg(\n                jsonb_build_object(\n                  'name', a.attname,\n                  'type', pg_catalog.format_type(a.atttypid, a.atttypmod)\n                )\n              )\n              from pg_catalog.pg_attribute a\n              where a.attrelid = c.oid and a.attnum > 0 and not a.attisdropped\n            ),\n            'options', t.ftoptions\n          )\n        )\n        from pg_catalog.pg_class c\n        join pg_catalog.pg_foreign_table t on c.oid = t.ftrelid\n        where c.oid = any (select t.ftrelid from pg_catalog.pg_foreign_table t where t.ftserver = s.oid)\n      ) as \"tables\"\n    from pg_catalog.pg_foreign_server s\n    join pg_catalog.pg_foreign_data_wrapper w on s.srvfdw = w.oid\n    join pg_catalog.pg_proc c on w.fdwhandler = c.oid;\n  ",useFDWsQuery=function(e){let{projectRef:t,connectionString:a}=e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,H.cp)({projectRef:t,connectionString:a,sql:getFDWsSql(),queryKey:["fdws"]},n)};var eK=a(73544),eG=a(14486),eJ=(0,o.Pi)(()=>{var e,t;let a="edit-wrapper-form",r=(0,eD.useRouter)(),i=(0,en.NL)(),{ui:l}=(0,_.oR)(),{ref:o,id:d}=(0,eE.UO)(),{project:m}=(0,E.d2)(),{data:h,isLoading:x}=useFDWsQuery({projectRef:null==m?void 0:m.ref,connectionString:null==m?void 0:m.connectionString}),{data:f,isLoading:g}=(0,eG.f)({projectRef:null==m?void 0:m.ref,connectionString:null==m?void 0:m.connectionString}),b=null!==(e=null==h?void 0:h.result)&&void 0!==e?e:[],y=b.find(e=>Number(e.id)===Number(d)),N=(0,_.Je)(y),w=eO.find(e=>e.handlerName===(null==N?void 0:N.handler)),{mutate:S,isLoading:C}=useFDWUpdateMutation({onSuccess:()=>{l.setNotification({category:"success",message:"Successfully updated ".concat(null==w?void 0:w.label," foreign data wrapper")}),k([]);let e=Z.some(e=>e.is_new_schema);e&&(0,z.XL)(i,o),r.push("/project/".concat(o,"/database/wrappers"))}}),[Z,k]=(0,c.useState)([]),[T,D]=(0,c.useState)(!1),[F,R]=(0,c.useState)(),[P,I]=(0,c.useState)({}),A=(0,_.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"wrappers"),W=void 0!==w?{wrapper_name:null==N?void 0:N.name,server_name:null==N?void 0:N.server_name,...convertKVStringArrayToJson(null!==(t=null==N?void 0:N.server_options)&&void 0!==t?t:[])}:{};if((0,c.useEffect)(()=>{(null==N?void 0:N.id)&&k(formatWrapperTables(N,w))},[null==N?void 0:N.id]),x)return(0,n.jsx)("div",{className:"flex items-center justify-center w-full h-full",children:(0,n.jsx)(eX.Z,{})});if(void 0===N||void 0===w)return C?(0,n.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)(eI.Z,{className:"animate-spin",size:16}),(0,n.jsx)("p",{className:"text-sm",children:"Updating wrapper"})]})}):(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-2 flex flex-col items-center w-[400px]",children:[(0,n.jsx)("p",{children:"Unknown wrapper"}),(0,n.jsxs)("p",{className:"text-sm text-center text-foreground-light",children:["The wrapper ID ",d," cannot be found in your project. Head back to select another wrapper."]})]}),(0,n.jsx)(u.z,{asChild:!0,type:"default",children:(0,n.jsx)(eb(),{href:"/project/".concat(o,"/database/wrappers"),children:"Head back"})})]});let onSubmit=async e=>{let t=makeValidateRequired(w.server.options),a=t(e),{wrapper_name:n}=e;if(0===n.length&&(a.name="Please provide a name for your wrapper"),0===Z.length&&(a.tables="Please add at least one table"),!eT()(a))return I(a);S({projectRef:null==m?void 0:m.ref,connectionString:null==m?void 0:m.connectionString,wrapper:N,wrapperMeta:w,formState:{...e,server_name:"".concat(n,"_server")},tables:Z})};return(0,n.jsxs)(B.ld,{children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"relative flex items-center justify-between mb-6",children:[(0,n.jsx)("div",{className:"transition cursor-pointer absolute -left-20 top-1 opacity-75 hover:opacity-100",children:(0,n.jsx)(eb(),{href:"/project/".concat(o,"/database/wrappers"),children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(eP.Z,{strokeWidth:1.5,size:14}),(0,n.jsx)("p",{className:"text-sm",children:"Back"})]})})}),(0,n.jsxs)("h3",{className:"mb-2 text-xl text-foreground",children:["Edit wrapper: ",N.name]}),(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsx)(u.z,{asChild:!0,type:"default",icon:(0,n.jsx)(eN.Z,{strokeWidth:1.5}),children:(0,n.jsx)(eb(),{href:"https://supabase.github.io/wrappers/stripe/",target:"_blank",rel:"noreferrer",children:"Documentation"})})})]}),(0,n.jsx)(ed.Z,{id:a,initialValues:W,onSubmit:onSubmit,children:e=>{var t;let{handleReset:r,values:s,initialValues:i,resetForm:l}=e,[o,d]=(0,c.useState)(!1),h=formatWrapperTables(null!==(t=null==N?void 0:N.tables)&&void 0!==t?t:[]),x=JSON.stringify(s)!==JSON.stringify(i),b=JSON.stringify(h)!==JSON.stringify(Z),y=w.server.options.filter(e=>e.encrypted);return(0,c.useEffect)(()=>{let fetchEncryptedValues=async()=>{if(d(!0),g)return;let e=await Promise.all(y.map(async e=>{let t=null==f?void 0:f.find(t=>t.name==="".concat(N.name,"_").concat(e.name));if(void 0===t)return{[e.name]:""};{let a=await (0,eK.mp)({projectRef:null==m?void 0:m.ref,connectionString:null==m?void 0:m.connectionString,id:t.id});return{[e.name]:a[0].decrypted_secret}}})),t=e.reduce((e,t)=>{let[a]=Object.keys(t);return{...e,[a]:t[a]}},{});l({values:{...s,...t},initialValues:{...i,...t}}),d(!1)};y.length>0&&fetchEncryptedValues()},[g]),(0,n.jsxs)(B.by,{disabled:!A,footer:(0,n.jsx)("div",{className:"flex px-8 py-4",children:(0,n.jsx)(B.iN,{form:a,isSubmitting:C,hasChanges:x||b,handleReset:()=>{r(),k(h)},disabled:!A,helper:A?void 0:"You need additional permissions to edit a foreign data wrapper"})}),children:[(0,n.jsx)(B.hj,{header:(0,n.jsx)(B.S0,{children:"Wrapper Configuration"}),children:(0,n.jsx)(B.B4,{loading:!1,children:(0,n.jsx)(p.Z,{id:"wrapper_name",label:"Wrapper Name",error:P.wrapper_name,descriptionText:s.wrapper_name!==i.wrapper_name?(0,n.jsxs)(n.Fragment,{children:["Your wrapper's server name will be updated to"," ",(0,n.jsxs)("code",{className:"text-xs",children:[s.wrapper_name,"_server"]})]}):(0,n.jsxs)(n.Fragment,{children:["Your wrapper's server name is"," ",(0,n.jsxs)("code",{className:"text-xs",children:[s.wrapper_name,"_server"]})]})})})}),(0,n.jsx)(B.hj,{header:(0,n.jsxs)(B.S0,{children:[w.label," Configuration"]}),children:(0,n.jsx)(B.B4,{loading:!1,children:w.server.options.map(e=>(0,n.jsx)(Wrappers_InputField,{option:e,loading:!!e.encrypted&&o,error:P[e.name]},e.name))})}),(0,n.jsx)(B.hj,{header:(0,n.jsxs)(B.S0,{children:[(0,n.jsx)("p",{children:"Foreign Tables"}),(0,n.jsx)("p",{className:"text-foreground-light mt-2 w-[90%]",children:"You can query your data from these foreign tables after the wrapper is created"})]}),children:(0,n.jsxs)(B.B4,{loading:!1,children:[0===Z.length?(0,n.jsx)("div",{className:"flex justify-end translate-y-4",children:(0,n.jsx)(u.z,{type:"default",onClick:()=>D(!0),children:"Add foreign table"})}):(0,n.jsx)("div",{className:"space-y-2",children:Z.map((e,t)=>{let a=w.tables[e.index].label;return(0,n.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border rounded-md border-control",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"text-sm",children:[e.schema_name,".",e.table_name]}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:[a,":"," ",e.columns.map(e=>e.name).join(", ")]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(u.z,{type:"default",className:"px-1",icon:(0,n.jsx)(v.Z,{}),onClick:()=>{D(!0),R({...e,tableIndex:t})}}),(0,n.jsx)(u.z,{type:"default",className:"px-1",icon:(0,n.jsx)(j.Z,{}),onClick:()=>{k(e=>e.filter((e,a)=>a!==t))}})]})]},"".concat(e.schema_name,".").concat(e.table_name))})}),Z.length>0&&(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(u.z,{type:"default",onClick:()=>D(!0),children:"Add foreign table"})}),0===Z.length&&P.tables&&(0,n.jsx)("p",{className:"text-sm text-right text-red-900",children:P.tables})]})})]})}})]}),(0,n.jsx)(Wrappers_WrapperTableEditor,{visible:T,tables:w.tables,onCancel:()=>{R(void 0),D(!1)},onSave:e=>{k(t=>{if(void 0!==e.tableIndex){let a=e.tableIndex,n=[...t];return delete e.tableIndex,n[a]=e,n}return[...t,e]}),D(!1),R(void 0)},initialData:F})]})}),e$=a(3440),e0=a.n(e$),Wrappers_DeleteWrapperModal=e=>{let{selectedWrapper:t,onClose:a}=e,{ui:r}=(0,_.oR)(),{project:s}=(0,E.d2)(),{mutate:i,isLoading:l}=useFDWDeleteMutation({onSuccess:()=>{r.setNotification({category:"success",message:"Successfully disabled ".concat(null==t?void 0:t.name," foreign data wrapper")}),a()}}),o=eO.find(e=>e.handlerName===(null==t?void 0:t.handler)),onConfirmDelete=async()=>(null==s?void 0:s.ref)?t?o?void i({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString,wrapper:t,wrapperMeta:o}):console.error("Wrapper meta is required"):console.error("Wrapper is required"):console.error("Project ref is required");return(0,n.jsx)(ec.C,{size:"medium",alignFooter:"right",loading:l,visible:void 0!==t,onCancel:()=>a(),onConfirm:()=>onConfirmDelete(),header:"Confirm to disable ".concat(null==t?void 0:t.name),children:(0,n.jsx)("div",{className:"py-4",children:(0,n.jsx)(ec.C.Content,{children:(0,n.jsxs)("p",{className:"text-sm",children:["Are you sure you want to disable ",null==t?void 0:t.name,"? This will also remove all tables created with this wrapper."]})})})})},e1=a(38421),e2=a.n(e1),Wrappers_WrapperRow=e=>{let{wrappers:t=[],wrapperMeta:a,isOpen:i,onOpen:l,onSelectDelete:o}=e,{ref:c}=(0,eE.UO)(),d=(0,_.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"wrappers");return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(eu.ZP,{open:i,onOpenChange:()=>l(a.name),className:"bg-surface-100 hover:bg-overlay-hover data-open:bg-selection border-default hover:border-strong data-open:border-strong col-span-12 mx-auto -space-y-px overflow-hidden transition border shadow hover:z-50 first:rounded-tl first:rounded-tr first:!border-t last:rounded-bl last:rounded-br last:border-t-0",children:[(0,n.jsx)(eu.ZP.Trigger,{asChild:!0,children:(0,n.jsxs)("button",{type:"button",className:"flex items-center justify-between w-full px-6 py-3 rounded group text-foreground",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(em.Z,{className:"transition text-border-stronger data-open-parent:rotate-0 data-closed-parent:rotate-180",strokeWidth:2,width:14}),(0,n.jsx)(e2(),{src:a.icon,width:20,height:20,alt:"".concat(a.name," wrapper icon")}),(0,n.jsx)("span",{className:"text-sm capitalize",children:a.label})]}),(0,n.jsx)("div",{className:"flex items-center gap-3",children:(0,n.jsxs)("div",{className:"px-3 py-1 text-xs border rounded-md border-strong bg-surface-100 text-foreground",children:[t.length," wrapper",t.length>1?"s":""]})})]})}),(0,n.jsx)(eu.ZP.Content,{children:(0,n.jsx)("div",{className:"border-t group border-strong bg-surface-100 text-foreground divide-y",children:t.map(e=>{let t=Object.fromEntries(e.server_options.map(e=>e.split("="))),[s,i]=D()(a.server.options,"hidden");return(0,n.jsxs)("div",{className:"px-6 py-4 flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"space-y-1 w-3/4",children:[(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsx)("p",{className:"text-base",children:e.name})}),i.map(e=>(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-foreground-light",children:[(0,n.jsxs)("p",{children:[e.label,":"]}),(0,n.jsx)("p",{children:t[e.name]})]},e.name)),s.map(t=>(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,n.jsxs)("p",{className:"text-foreground-light",children:[t.label,":"]}),(0,n.jsxs)(eb(),{href:"/project/".concat(c,"/settings/vault/secrets?search=").concat(e.name,"_").concat(t.name),className:"transition text-foreground-light hover:text-foreground flex items-center space-x-2",children:[(0,n.jsx)("span",{children:"Encrypted in Vault"}),(0,n.jsx)(eN.Z,{size:14,strokeWidth:1.5})]})]},t.name)),(0,n.jsxs)("div",{className:"!mt-3 space-y-1",children:[(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["Foreign tables",e.tables&&": (".concat(e.tables.length,")")]}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:e.tables?e.tables.map(e=>(0,n.jsx)(eb(),{href:"/project/".concat(c,"/editor/").concat(e.id),children:(0,n.jsx)("div",{className:"text-sm border rounded px-2 py-1 transition bg-surface-200 hover:bg-overlay-hover",children:e.name})},e.id)):(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"No tables available"})})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[d?(0,n.jsx)(eb(),{href:"/project/".concat(c,"/database/wrappers/").concat(e.id),children:(0,n.jsx)(u.z,{type:"default",icon:(0,n.jsx)(v.Z,{strokeWidth:1.5}),className:"py-2"})}):(0,n.jsxs)(r.fC,{delayDuration:0,children:[(0,n.jsx)(r.xz,{asChild:!0,children:(0,n.jsx)(u.z,{type:"default",disabled:!0,icon:(0,n.jsx)(v.Z,{strokeWidth:1.5}),className:"py-2"})}),!d&&(0,n.jsx)(r.h_,{children:(0,n.jsxs)(r.VY,{side:"bottom",children:[(0,n.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to edit wrappers"})})]})})]}),(0,n.jsxs)(r.fC,{delayDuration:0,children:[(0,n.jsx)(r.xz,{asChild:!0,children:(0,n.jsx)(u.z,{type:"default",disabled:!d,icon:(0,n.jsx)(j.Z,{strokeWidth:1.5}),className:"py-2",onClick:()=>o(e)})}),!d&&(0,n.jsx)(r.h_,{children:(0,n.jsxs)(r.VY,{side:"bottom",children:[(0,n.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to add wrappers"})})]})})]})]})]},e.id)})})})]})})},e4=a(38617),e3=a(43753),e5=(0,o.Pi)(()=>{let{ref:e}=(0,ef.UO)(),{resolvedTheme:t}=(0,e4.F)(),{project:a}=(0,E.d2)(),{data:i}=(0,e_.H)({projectRef:null==a?void 0:a.ref,connectionString:null==a?void 0:a.connectionString}),l=(null!=i?i:[]).find(e=>"wrappers"===e.name),o=(null!=i?i:[]).find(e=>"supabase_vault"===e.name),d=void 0===l||void 0===o,[m,p]=(0,c.useState)(!1),h=(0,_.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"extensions"),{mutateAsync:x}=(0,e3.k)({onError:()=>{}}),onEnableWrappers=async()=>{if(void 0===l||void 0===o)return;if(void 0===a)return console.error("Project is required");let e=!1;try{var t,n;p(!0),await Promise.all([x({projectRef:a.ref,connectionString:a.connectionString,schema:null!==(t=l.schema)&&void 0!==t?t:"extensions",name:l.name,version:l.default_version,cascade:!0}),x({projectRef:a.ref,connectionString:a.connectionString,schema:null!==(n=o.schema)&&void 0!==n?n:"vault",name:o.name,version:o.default_version,cascade:!0})])}catch(t){t.message.includes("already exists")||(e=!0,G.ZP.error("Failed to enable Wrappers: ".concat(t.message)))}finally{p(!1),e||G.ZP.success("Wrappers is now enabled!")}};return(0,n.jsx)("div",{children:(0,n.jsx)("div",{className:"w-full px-12 py-12 bg-no-repeat border rounded bg-background border-default",style:{backgroundSize:"45%",backgroundPosition:"105% 40%",backgroundImage:(null==t?void 0:t.includes("dark"))?'url("'.concat(eV.GW,'/img/wrappers-dark.png")'):'url("'.concat(eV.GW,'/img/wrappers-light.png")')},children:(0,n.jsxs)("div",{className:"w-3/5 space-y-8",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("h4",{className:"text-lg",children:"Supabase Wrappers"}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Supabase Wrappers is a framework for building Postgres Foreign Data Wrappers (FDW) which connect Postgres to external systems. Query your data warehouse or third-party APIs directly from your database."})]}),d?(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"rounded border border-default px-4 py-2 flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-foreground-light text-sm",children:"Wrappers is not available for this project yet."}),(0,n.jsx)("p",{className:"text-foreground-light text-sm",children:"Do reach out to us if you're interested!"})]}),(0,n.jsx)("div",{children:(0,n.jsx)(u.z,{asChild:!0,type:"primary",children:(0,n.jsx)(eb(),{href:"/support/new?ref=".concat(e,"&category=sales&subject=Request%20for%20access%20to%20wrappers"),target:"_blank",rel:"noreferrer",children:"Contact us"})})})]}),(0,n.jsx)("div",{className:"flex items-center space-x-2 my-1 ml-[1px]",children:(0,n.jsx)(u.z,{asChild:!0,type:"default",icon:(0,n.jsx)(eN.Z,{}),children:(0,n.jsx)(eb(),{href:"https://supabase.com/docs/guides/database/extensions/wrappers/overview",target:"_blank",rel:"noreferrer",children:"About Wrappers"})})})]}):(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(u.z,{asChild:!0,type:"default",icon:(0,n.jsx)(eN.Z,{}),children:(0,n.jsx)(eb(),{href:"https://supabase.com/docs/guides/database/extensions/wrappers/overview",target:"_blank",rel:"noreferrer",children:"About Wrappers"})}),(0,n.jsxs)(r.fC,{delayDuration:0,children:[(0,n.jsx)(r.xz,{asChild:!0,children:(0,n.jsx)(u.z,{type:"primary",loading:m,disabled:d||m||!h,onClick:()=>onEnableWrappers(),children:"Enable Wrappers"})}),!h&&(0,n.jsx)(r.h_,{children:(0,n.jsxs)(r.VY,{side:"bottom",children:[(0,n.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to enable Wrappers for this project"})})]})})]})]})]})})})}),e6=(0,o.Pi)(e=>{let{buttonText:t="Add wrapper",align:a="end"}=e,{ref:i}=(0,eE.UO)(),l=(0,_.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"wrappers");return l?(0,n.jsxs)(f.h_,{children:[(0,n.jsx)(f.$F,{asChild:!0,children:(0,n.jsx)(u.z,{type:"primary",icon:(0,n.jsx)(x.Z,{strokeWidth:1.5}),children:t})}),(0,n.jsx)(f.AW,{side:"bottom",align:a,children:eO.map((e,t)=>(0,n.jsxs)(c.Fragment,{children:[(0,n.jsx)(f.Xi,{className:"space-x-2",asChild:!0,children:(0,n.jsxs)(eb(),{href:"/project/".concat(i,"/database/wrappers/new?type=").concat(e.name.toLowerCase()),children:[(0,n.jsx)(e2(),{src:e.icon,width:20,height:20,alt:"".concat(e.name," wrapper icon")}),(0,n.jsx)("p",{children:e.label})]})},e.name),t!==eO.length-1&&(0,n.jsx)(f.VD,{})]},t))})]}):(0,n.jsxs)(r.fC,{delayDuration:0,children:[(0,n.jsx)(r.xz,{asChild:!0,children:(0,n.jsx)(u.z,{disabled:!0,type:"primary",icon:(0,n.jsx)(x.Z,{strokeWidth:1.5}),children:t})}),(0,n.jsx)(r.h_,{children:(0,n.jsxs)(r.VY,{side:"bottom",children:[(0,n.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to add wrappers"})})]})})]})}),e8=(0,o.Pi)(()=>{var e;let{project:t}=(0,E.d2)(),{data:a,isLoading:r}=useFDWsQuery({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString}),{data:s,isLoading:i}=(0,e_.H)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString}),l=(null!=s?s:[]).find(e=>"wrappers"===e.name),o=(null!=s?s:[]).find(e=>"supabase_vault"===e.name),[d,m]=(0,c.useState)(""),[p,h]=(0,c.useState)(),x=null!==(e=null==a?void 0:a.result)&&void 0!==e?e:[],f=e0()(x,"handler"),g=void 0!==l&&null!==l.installed_version&&void 0!==o&&null!==o.installed_version;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"mb-1 text-xl text-foreground",children:"Foreign Data Wrappers"}),(0,n.jsx)("div",{className:"text-sm text-foreground-lighter",children:"Query your data warehouse directly from your database, or third-party APIs using SQL."})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(u.z,{asChild:!0,type:"default",icon:(0,n.jsx)(eN.Z,{strokeWidth:1.5}),children:(0,n.jsx)(eb(),{href:"https://supabase.com/docs/guides/database/extensions/wrappers/overview",target:"_blank",rel:"noreferrer",children:"Documentation"})}),g&&(0,n.jsx)(e6,{})]})]}),i||r?(0,n.jsx)("div",{className:"p-12 space-y-2 border rounded border-default",children:(0,n.jsx)(w.A,{})}):g?(0,n.jsx)("div",{children:0===x.length?(0,n.jsxs)("div",{className:"border rounded border-default px-20 py-16 flex flex-col items-center justify-center space-y-4",children:[(0,n.jsx)("p",{className:"text-sm",children:"No wrappers created yet"}),(0,n.jsx)(e6,{align:"center",buttonText:"Create a new wrapper"})]}):(0,n.jsx)(n.Fragment,{children:eO.map((e,t)=>{var a;let r=null!==(a=f[e.handlerName])&&void 0!==a?a:[];return r.length>0?(0,n.jsx)(Wrappers_WrapperRow,{wrapperMeta:e,wrappers:r,isOpen:d===e.name,onOpen:e=>{d!==e?m(e):m("")},onSelectDelete:h},t):null})})}):(0,n.jsx)(e5,{})]}),(0,n.jsx)(Wrappers_DeleteWrapperModal,{selectedWrapper:p,onClose:()=>h(void 0)})]})}),e9=a(98050),e7=a(59600),Publications_PublicationSkeleton=e=>{let{index:t}=e;return(0,n.jsxs)(y.Z.tr,{className:"border-t",children:[(0,n.jsx)(y.Z.td,{className:"px-4 py-3",style:{width:"25%"},children:(0,n.jsx)(w.Z,{className:"h-4 w-24 my-0.5 p-0",delayIndex:t})}),(0,n.jsx)(y.Z.td,{className:"hidden lg:table-cell",style:{width:"25%"},children:(0,n.jsx)(w.Z,{className:"h-4 w-14 my-0.5 p-0",delayIndex:t})}),Array.from({length:4}).map((e,t)=>(0,n.jsx)(y.Z.td,{children:(0,n.jsx)(ep.Z,{size:"tiny",checked:!1,disabled:!0})},t)),(0,n.jsx)(y.Z.td,{className:"px-4 py-3 pr-2",children:(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(w.Z,{className:"h-6 w-12 p-0",delayIndex:t})})})]})},te=(0,o.Pi)(e=>{let{onSelectPublication:t=l()}=e,{project:a}=(0,E.d2)(),[r,i]=(0,c.useState)(""),{data:o,isLoading:d}=(0,R.z)({projectRef:null==a?void 0:a.ref,connectionString:null==a?void 0:a.connectionString}),{mutate:m}=(0,e7.u)({onSuccess:()=>{G.ZP.success("Successfully updated event"),b(null)}});console.log(o);let x=(0,_.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"publications"),f=(0,_.N4)(),g=[{event:"Insert",key:"publish_insert"},{event:"Update",key:"publish_update"},{event:"Delete",key:"publish_delete"},{event:"Truncate",key:"publish_truncate"}],v=0===r.length?null!=o?o:[]:(null!=o?o:[]).filter(e=>e.name.includes(r)),[j,b]=(0,c.useState)(null),toggleListenEvent=async()=>{if(!j||!a)return;let{publication:e,event:t,currentStatus:n}=j,r={projectRef:a.ref,connectionString:a.connectionString,id:e.id};r["publish_".concat(t.event.toLowerCase())]=!n,m(r)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsx)(p.Z,{size:"small",icon:(0,n.jsx)(h.Z,{size:"tiny"}),placeholder:"Filter",value:r,onChange:e=>i(e.target.value)})}),f&&!x&&(0,n.jsx)("div",{className:"w-[500px]",children:(0,n.jsx)(ew.Z,{icon:(0,n.jsx)(ey.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to update database replications"})})]})}),(0,n.jsxs)("div",{className:"overflow-hidden rounded",children:[(0,n.jsx)(y.Z,{head:[(0,n.jsx)(y.Z.th,{style:{width:"25%"},children:"Name"},"header.name"),(0,n.jsx)(y.Z.th,{className:"hidden lg:table-cell",style:{width:"25%"},children:"System ID"},"header.id"),(0,n.jsx)(y.Z.th,{children:"Insert"},"header.insert"),(0,n.jsx)(y.Z.th,{children:"Update"},"header.update"),(0,n.jsx)(y.Z.th,{children:"Delete"},"header.delete"),(0,n.jsx)(y.Z.th,{children:"Truncate"},"header.truncate"),(0,n.jsx)(y.Z.th,{className:"text-right",children:"Source"},"header.source")],body:d?Array.from({length:5}).map((e,t)=>(0,n.jsx)(Publications_PublicationSkeleton,{index:t},t)):v.map(e=>(0,n.jsxs)(y.Z.tr,{className:"border-t",children:[(0,n.jsx)(y.Z.td,{className:"px-4 py-3",style:{width:"25%"},children:e.name}),(0,n.jsx)(y.Z.td,{className:"hidden lg:table-cell",style:{width:"25%"},children:e.id}),g.map(t=>(0,n.jsx)(y.Z.td,{children:(0,n.jsx)(ep.Z,{size:"tiny",checked:e[t.key],disabled:!x,onChange:()=>{b({publication:e,event:t,currentStatus:e[t.key]})}})},t.key)),(0,n.jsx)(y.Z.td,{className:"px-4 py-3 pr-2",children:(0,n.jsx)("div",{className:"flex justify-end gap-2",children:(0,n.jsx)(u.z,{type:"default",style:{paddingTop:3,paddingBottom:3},onClick:()=>t(e.id),children:null==e.tables?"All tables":"".concat(e.tables.length," ").concat(e.tables.length>1||0==e.tables.length?"tables":"table")})})})]},e.name))}),!d&&0===v.length&&(0,n.jsx)(U.Z,{searchString:r,onResetFilter:()=>i(""),className:"rounded-t-none border-t-0"})]}),(0,n.jsx)(e9.Z,{visible:null!==j,header:"Confirm to toggle sending ".concat(null==j?void 0:j.event.event.toLowerCase()," events"),buttonLabel:"Confirm",buttonLoadingLabel:"Updating",onSelectCancel:()=>b(null),onSelectConfirm:()=>{toggleListenEvent()},children:(0,n.jsx)(ec.C.Content,{children:(0,n.jsxs)("p",{className:"py-4 text-sm text-foreground-light",children:["Are you sure you want to ",(null==j?void 0:j.currentStatus)?"stop":"start"," ","sending ",null==j?void 0:j.event.event.toLowerCase()," events for"," ",null==j?void 0:j.publication.name,"?"]})})})]})}),tt=a(67950),ta=(0,o.Pi)(e=>{var t;let{table:a,selectedPublication:r}=e,{project:i}=(0,E.d2)(),l=null==r.tables,[o,d]=(0,c.useState)((null===(t=r.tables)||void 0===t?void 0:t.find(e=>e.id==a.id))!=void 0),u=(0,_.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"publications"),{mutate:m,isLoading:p}=(0,e7.u)(),toggleReplicationForTable=async(e,t)=>{var a;if(void 0===i)return console.error("Project is required");d(!o);let n=null!==(a=null==t?void 0:t.tables)&&void 0!==a?a:[],r=n.some(t=>t.id==e.id),s=r?n.filter(t=>t.id!=e.id).map(e=>"".concat(e.schema,".").concat(e.name)):["".concat(e.schema,".").concat(e.name)].concat(n.map(e=>"".concat(e.schema,".").concat(e.name)));m({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString,id:t.id,tables:s},{onSuccess:()=>{G.ZP.success("Successfully ".concat(o?"disabled":"enabled"," replication for ").concat(e.name))},onError:t=>{G.ZP.error("Failed to toggle replication for ".concat(e.name,": ").concat(t.message)),d(o)}})};return(0,n.jsxs)(y.Z.tr,{children:[(0,n.jsx)(y.Z.td,{className:"whitespace-nowrap",children:a.name}),(0,n.jsx)(y.Z.td,{className:"whitespace-nowrap",children:a.schema}),(0,n.jsx)(y.Z.td,{className:"hidden max-w-sm truncate whitespace-nowrap lg:table-cell",children:a.comment}),(0,n.jsx)(y.Z.td,{className:"px-4 py-3 pr-2",children:(0,n.jsx)("div",{className:"flex justify-end gap-2",children:l?(0,n.jsxs)(M.Z,{color:"scale",children:[(0,n.jsx)("span",{children:"Enabled"}),(0,n.jsx)("span",{className:"hidden lg:inline-block",children:"\xa0for all tables"})]}):(0,n.jsx)(ep.Z,{size:"tiny",align:"right",disabled:!u||p,className:"m-0 ml-2 mt-1 -mb-1 p-0",checked:o,onChange:()=>toggleReplicationForTable(a,r)})})})]},a.id)}),Publications_PublicationsTables=e=>{let{selectedPublication:t,onSelectBack:a}=e,{project:r}=(0,E.d2)(),[i,l]=(0,c.useState)(""),o=(0,_.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"publications"),{data:d,isLoading:x,isSuccess:f,isError:g,error:v}=(0,P.Bj)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString},{select:e=>e.filter(e=>0===i.length?!C.F.includes(e.schema):!C.F.includes(e.schema)&&e.name.includes(i))});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)(u.z,{type:"outline",onClick:()=>a(),icon:(0,n.jsx)(m.Z,{}),style:{padding:"5px"}}),(0,n.jsx)("div",{children:(0,n.jsx)(p.Z,{size:"small",placeholder:"Filter",value:i,onChange:e=>l(e.target.value),icon:(0,n.jsx)(h.Z,{size:"tiny"})})})]}),!o&&(0,n.jsx)("div",{className:"w-[500px]",children:(0,n.jsx)(ew.Z,{icon:(0,n.jsx)(ey.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to update database replications"})})]})}),x&&(0,n.jsx)("div",{className:"mt-8",children:(0,n.jsx)(tt.Z,{})}),g&&(0,n.jsx)(N.Z,{error:v,subject:"Failed to retrieve tables"}),f&&(0===d.length?(0,n.jsx)(b.Z,{}):(0,n.jsx)("div",{children:(0,n.jsx)(y.Z,{head:[(0,n.jsx)(y.Z.th,{children:"Name"},"header-name"),(0,n.jsx)(y.Z.th,{children:"Schema"},"header-schema"),(0,n.jsx)(y.Z.th,{className:"hidden text-left lg:table-cell",children:"Description"},"header-desc"),(0,n.jsx)(y.Z.th,{},"header-all")],body:d.map((e,a)=>(0,n.jsx)(ta,{table:e,selectedPublication:t},e.id))})}))]})},tn=a(28879),tr=a.n(tn),ts=a(44607),ti=a(12744),tl=a(93444);async function restoreFromBackup(e){let{ref:t,backup:a}=e;if(a.isPhysicalBackup){let{data:e,error:n}=await (0,es.v_)("/platform/database/{ref}/backups/restore-physical",{params:{path:{ref:t}},body:{id:a.id,recovery_time_target:a.inserted_at}});if(n)throw n;return e}let{data:n,error:r}=await (0,es.v_)("/platform/database/{ref}/backups/restore",{params:{path:{ref:t}},body:{id:a.id}});if(r)throw r;return n}let useBackupRestoreMutation=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,er.D)(e=>restoreFromBackup(e),{async onSuccess(t,a,n){await (null==e?void 0:e(t,a,n))},async onError(e,a,n){void 0===t?G.Am.error("Failed to restore from backup: ".concat(e.message)):t(e,a,n)},...a})};var to=a(71458),tc=a(29659),td=a(46469);async function downloadBackup(e){let{ref:t,backup:a}=e,{data:n,error:r}=await (0,es.v_)("/platform/database/{ref}/backups/download",{params:{path:{ref:t}},body:{id:a.id,inserted_at:a.inserted_at,project_id:a.project_id,data:{},s3_bucket:"deprecated",s3_path:"deprecated",status:"deprecated"}});if(r)throw r;return n}let useBackupDownloadMutation=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,er.D)(e=>downloadBackup(e),{async onSuccess(t,a,n){await (null==e?void 0:e(t,a,n))},async onError(e,a,n){void 0===t?G.Am.error("Failed to download backup: ".concat(e.message)):t(e,a,n)},...a})};var Backups_BackupItem=e=>{let{index:t,isHealthy:a,backup:r,projectRef:i,onSelectBackup:l}=e,o=(0,_.Xo)(s.KA.INFRA_EXECUTE,"queue_job.restore.prepare"),{mutate:c,isLoading:d}=useBackupDownloadMutation({onSuccess:e=>{let{fileUrl:t}=e,a=document.createElement("a");a.href=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)}});return(0,n.jsxs)("div",{className:"flex h-12 items-center justify-between px-6 ".concat(t?"border-t border-default":""),children:[(0,n.jsx)("p",{className:"text-sm text-foreground ",children:"COMPLETED"==r.status?"".concat(tr()(r.inserted_at).format("DD MMM YYYY HH:mm:ss")," UTC"):tr()(r.inserted_at).format("DD MMM YYYY")}),(0,n.jsx)("div",{className:"",children:"COMPLETED"===r.status?(0,n.jsxs)("div",{className:"flex space-x-4",children:[(0,n.jsx)(u.z,{type:"default",disabled:!a||!o,onClick:l,children:"Restore"}),!r.isPhysicalBackup&&(0,n.jsx)(u.z,{type:"default",disabled:!o||d,onClick:()=>c({ref:i,backup:r}),loading:d,icon:(0,n.jsx)(td.Z,{}),children:"Download"})]}):(0,n.jsx)(M.Z,{color:"yellow",children:"Backup In Progress..."})})]})},tu=a(33929),tm=(0,o.Pi)(()=>{var e,t;let{ui:a}=(0,_.oR)(),r=(0,eD.useRouter)(),i=(0,en.NL)(),l=(0,_.lL)(),{project:o}=(0,E.d2)(),d=(null==o?void 0:o.ref)||"default",u=(null==o?void 0:o.status)===eV.S.ACTIVE_HEALTHY,[m,p]=(0,c.useState)(),h=(0,_.Xo)(s.KA.INFRA_EXECUTE,"queue_job.restore.prepare"),{data:x}=(0,to.T)({projectRef:d}),{mutate:f,isLoading:g,isSuccess:v}=useBackupRestoreMutation({onSuccess:()=>{setTimeout(()=>{(0,tc.k7)(i,d,eV.S.RESTORING),a.setNotification({category:"success",message:"Restoring database back to ".concat(tr()(null==m?void 0:m.inserted_at).format("DD MMM YYYY HH:mm:ss"))}),r.push("/project/".concat(d))},3e3)}}),j=null!==(e=null==x?void 0:x.tierKey)&&void 0!==e?e:"",b=(null!==(t=null==x?void 0:x.backups)&&void 0!==t?t:[]).sort((e,t)=>new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()),y=null==x?void 0:x.pitr_enabled;return"FREE"===j?(0,n.jsx)(tl.Z,{icon:(0,n.jsx)(ts.Z,{size:"large"}),primaryText:"Free Plan does not include project backups.",projectRef:d,organizationSlug:l.slug,secondaryText:"Upgrade to the Pro plan for up to 7 days of scheduled backups.",addon:"pitr"}):y?null:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"space-y-6",children:0===b.length&&"FREE"!==j?(0,n.jsx)(tu.Z,{}):(0,n.jsxs)(n.Fragment,{children:[!h&&(0,n.jsx)(ew.Z,{icon:(0,n.jsx)(ey.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to trigger a scheduled backup"}),(0,n.jsx)(ti.Z,{children:null==b?void 0:b.map((e,t)=>(0,n.jsx)(Backups_BackupItem,{backup:e,projectRef:d,index:t,isHealthy:u,onSelectBackup:()=>p(e)},e.id))})]})}),(0,n.jsx)(e9.Z,{size:"medium",buttonLabel:"Confirm restore",buttonLoadingLabel:"Restoring",visible:void 0!==m,header:"Confirm to restore from backup",loading:g||v,onSelectCancel:()=>p(void 0),onSelectConfirm:()=>{if(void 0===m)return console.error("Backup required");f({ref:d,backup:m})},children:(0,n.jsx)(ec.C.Content,{children:(0,n.jsx)("div",{className:"pt-6 pb-5",children:(0,n.jsxs)("p",{children:["Are you sure you want to restore from",tr()(null==m?void 0:m.inserted_at).format("DD MMM YYYY"),"? This will destroy any new data written since this backup was made."]})})})})]})});a(72223);var tp=a(87612),th=a(93352),tx=a.n(th),tf=a(34519),tg=a.n(tf),tv=a(26139),tj=a.n(tv),tb=a(67304),ty=a.n(tb),tN=a(80075),tw=a(38183),ui_FormBoxEmpty=e=>{let{icon:t,text:a}=e;return(0,n.jsxs)("div",{className:"flex items-center justify-center flex-row py-4 space-x-2",children:[(0,n.jsx)("div",{className:"relative bg-surface-100 text-foreground-lighter w-6 h-6 rounded-full flex items-center justify-center",children:t}),(0,n.jsx)("p",{className:"text-foreground-light",children:a})]})},t_=a(63550),tS=a(86178),tC=a(49530),tZ=a(3218),tk=a(21562);async function updateDatabaseTrigger(e){let{id:t,projectRef:a,connectionString:n,payload:r}=e,s=new Headers;n&&s.set("x-connection-encrypted",n);let i=await (0,tZ.r$)("".concat(eV.T5,"/pg-meta/").concat(a,"/triggers?id=").concat(t),r,{headers:Object.fromEntries(s)});if(i.error)throw i.error;return i}let useDatabaseTriggerUpdateMutation=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,en.NL)();return(0,er.D)(e=>updateDatabaseTrigger(e),{async onSuccess(t,a,r){let{projectRef:s}=a;await n.invalidateQueries(tk.D.list(s)),await (null==e?void 0:e(t,a,r))},async onError(e,a,n){void 0===t?G.Am.error("Failed to update database trigger: ".concat(e.message)):t(e,a,n)},...a})};var tT=a(44593),tD=a(20644),tE=a(46916),tF=a(97265),IconPlayCircle_IconPlayCircle=function(e){return(0,n.jsx)(tF.Z,{icon:tE.Z,...e})},tR=a(77105),tz=a(86263),tP=a(16760),tI=a.n(tP),tA=a(84636),tW=a.n(tA),tV=a(43502),tq=a(82042),tO=a(90411),Triggers_ChooseFunctionForm=e=>{let{triggerFunctions:t,visible:a,onChange:r,setVisible:s}=e,i=t.length>=1,l=tI()(tW()(t,"schema"),"schema");function selectFunction(e){r(e),s(!a)}return(0,n.jsx)(J.ZP,{size:"large",header:"Pick a function",visible:a,onCancel:()=>s(!a),className:"hooks-sidepanel",children:(0,n.jsx)("div",{className:"py-6",children:i?(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)(NoticeBox,{}),l.map(e=>(0,n.jsx)(SchemaFunctionGroup,{schema:e,functions:t.filter(t=>t.schema==e),selectFunction:selectFunction},e))]}):(0,n.jsx)(NoFunctionsState,{})})})};let NoticeBox=()=>{let{ref:e}=(0,ef.UO)();return(0,n.jsx)("div",{className:"px-6",children:(0,n.jsx)(ew.Z,{icon:(0,n.jsx)(eh.Z,{size:"large",strokeWidth:1.5}),title:"Only functions that return a trigger will be displayed below",description:"You can make functions by using the Database Functions",button:(0,n.jsx)(u.z,{asChild:!0,type:"default",children:(0,n.jsx)(eb(),{href:"/project/".concat(e,"/database/functions"),children:"Go to Functions"})})})})},NoFunctionsState=()=>{let e=(0,eD.useRouter)(),{ref:t}=e.query;return(0,n.jsx)(tq.Z,{title:"No Trigger Functions found in database",ctaButtonLabel:"Create a trigger function",onClickCta:()=>{e.push("/project/".concat(t,"/database/functions"))},children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"You will need to create a trigger based function before you can add it to your trigger."})})},SchemaFunctionGroup=e=>{let{schema:t,functions:a,selectFunction:r}=e;return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"sticky top-0 flex items-center space-x-1 px-6 backdrop-blur backdrop-filter",children:[(0,n.jsx)("h5",{className:"text-foreground-light",children:"schema"}),(0,n.jsx)("h5",{children:t})]}),(0,n.jsx)("div",{className:"space-y-0 divide-y border-t border-b border-default",children:a.map(e=>(0,n.jsx)(Function,{id:e.id,completeStatement:e.complete_statement,name:e.name,onClick:r},e.id))})]})},Function=e=>{let{id:t,completeStatement:a,name:r,onClick:s}=e,[i,l]=(0,c.useState)(!1);return(0,n.jsxs)("div",{className:"cursor-pointer rounded p-3 px-6 hover:bg-background",onClick:()=>s(t),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between space-x-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,n.jsx)(tR.Z,{strokeWidth:2,size:14})}),(0,n.jsx)("p",{className:"mb-0 text-sm",children:r})]}),(0,n.jsx)(u.z,{type:"text",onClick:e=>{e.stopPropagation(),l(!i)},icon:(0,n.jsx)(tV.Z,{className:i?"rotate-180 transform":"rotate-0 transform"}),children:i?"Hide definition":"View definition"})]}),(0,n.jsx)(tz.u,{show:i,enter:"transition ease-out duration-300",enterFrom:"transform opacity-0",enterTo:"transform opacity-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100",leaveTo:"transform opacity-0",children:(0,n.jsx)("div",{className:"mt-4 h-64 border border-default",children:(0,n.jsx)(tO.Z,{defaultValue:a,readOnly:!0,contextmenu:!1})})})]})};let CreateTriggerFormState=class CreateTriggerFormState{get requestBody(){return{id:this.id,activation:this.activation.value,enabled_mode:this.enabledMode.value,events:this.events.value,function_name:this.functionName.value,function_schema:this.functionSchema.value,orientation:this.orientation.value,name:this.name.value,schema:this.schema.value,table:this.table.value}}reset(e){var t,a,n,r,s,i,l,o,c,d;this.id=null==e?void 0:e.id,this.originalName=null==e?void 0:e.name,this.activation={value:null!==(t=null==e?void 0:e.activation)&&void 0!==t?t:"BEFORE"},this.enabledMode={value:null!==(a=null==e?void 0:e.enabled_mode)&&void 0!==a?a:"ORIGIN"},this.events={value:null!==(n=null==e?void 0:e.events)&&void 0!==n?n:[]},this.functionName={value:null!==(r=null==e?void 0:e.function_name)&&void 0!==r?r:""},this.functionSchema={value:null!==(s=null==e?void 0:e.function_schema)&&void 0!==s?s:""},this.orientation={value:null!==(i=null==e?void 0:e.orientation)&&void 0!==i?i:"STATEMENT"},this.name={value:null!==(l=null==e?void 0:e.name)&&void 0!==l?l:""},this.schema={value:null!==(o=null==e?void 0:e.schema)&&void 0!==o?o:""},this.table={value:null!==(c=null==e?void 0:e.table)&&void 0!==c?c:""},this.tableId={value:null!==(d=null==e?void 0:e.table_id)&&void 0!==d?d:""}}update(e){this.activation=e.activation,this.enabledMode=e.enabledMode,this.events=e.events,this.functionName=e.functionName,this.functionSchema=e.functionSchema,this.orientation=e.orientation,this.name=e.name,this.schema=e.schema,this.table=e.table,this.tableId=e.tableId}constructor(){(0,tp._)(this,"id",void 0),(0,tp._)(this,"originalName",void 0),(0,tp._)(this,"activation",void 0),(0,tp._)(this,"enabledMode",void 0),(0,tp._)(this,"events",void 0),(0,tp._)(this,"functionName",void 0),(0,tp._)(this,"functionSchema",void 0),(0,tp._)(this,"orientation",void 0),(0,tp._)(this,"name",void 0),(0,tp._)(this,"schema",void 0),(0,tp._)(this,"table",void 0),(0,tp._)(this,"tableId",void 0),(0,tN.ky)(this),this.reset()}};let CreateTriggerStore=class CreateTriggerStore{get isEditing(){return void 0!=this.formState.id}constructor(){(0,tp._)(this,"chooseFunctionFormVisible",!1),(0,tp._)(this,"formState",new CreateTriggerFormState),(0,tp._)(this,"meta",null),(0,tp._)(this,"tables",[]),(0,tp._)(this,"isDirty",!1),(0,tp._)(this,"setChooseFunctionFormVisible",e=>{this.chooseFunctionFormVisible=e}),(0,tp._)(this,"setDefaultSelectedTable",()=>{var e;(null===(e=this.tables)||void 0===e?void 0:e.length)!=0&&(this.formState.table.value=this.tables[0].name,this.formState.schema.value=this.tables[0].schema,this.formState.tableId.value=this.tables[0].id)}),(0,tp._)(this,"setisDirty",e=>{this.isDirty=e}),(0,tp._)(this,"setTables",e=>{this.tables=e.sort((e,t)=>e.schema.localeCompare(t.schema)).filter(e=>!C.F.includes(e.schema)),this.setDefaultSelectedTable()}),(0,tp._)(this,"onFormChange",e=>{let{key:t,value:a}=e;if(this.isDirty=!0,tx()(this.formState,t)){let e=this.formState[t];this.formState[t]={...e,value:a,error:void 0}}else this.formState[t]={value:a}}),(0,tp._)(this,"onSelectFunction",e=>{this.formState.functionName.value=e.name,this.formState.functionSchema.value=e.schema}),(0,tp._)(this,"validateForm",()=>{let e=!0,t=tg()(this.formState,(t,a)=>{switch(a){case"name":var n;if(eT()(t.value)||(n=t.value,/\s/.test(n)))return e=!1,{...t,error:"Invalid trigger name"};return t;case"activation":if(eT()(t.value))return e=!1,{...t,error:"you have an error"};return t;case"events":if(eT()(t.value))return e=!1,{...t,error:"Select at least 1 event"};return t;case"tableId":if(eT()("".concat(t.value)))return e=!1,{...t,error:"You must choose a table"};return t;default:return t}});return e||this.formState.update(t),e}),(0,tN.ky)(this)}};let tL=(0,c.createContext)(null);var tM=(0,o.Pi)(e=>{let{trigger:t,visible:a,setVisible:r}=e,{project:s}=(0,E.d2)(),{ui:i,meta:l}=(0,_.oR)(),[d,u]=(0,c.useState)(!1),m=(0,o.fv)(()=>new CreateTriggerStore);(0,P.Bj)({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString},{onSuccess(e){m.tables.length<=0&&m.setTables(e)}});let{data:p}=(0,tS.R)({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString}),h=(null!=p?p:[]).filter(e=>"trigger"===e.return_type),{mutate:x,isLoading:f}=(0,tC.x)(),{mutate:g,isLoading:v}=useDatabaseTriggerUpdateMutation();async function handleSubmit(){if(!s)return console.error("Project is required");if(m.validateForm()){let e=m.formState.requestBody;m.isEditing&&e.id?g({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString,id:e.id,payload:e},{onSuccess:()=>{G.ZP.success("Successfully updated trigger ".concat(e.name)),r(!a)},onError:e=>{G.ZP.error("Failed to update trigger: ".concat(e.message))}}):x({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString,payload:e},{onSuccess:()=>{G.ZP.success("Successfully created trigger ".concat(e.name)),r(!a)},onError:e=>{G.ZP.error("Failed to create trigger: ".concat(e.message))}})}}(0,c.useEffect)(()=>{m.setisDirty(!1),t?m.formState.reset(t):(m.formState.reset(),m.setDefaultSelectedTable())},[a,t]);let j=m.tables.length>=1;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(J.ZP,{size:"large",visible:a,onCancel:()=>{m.isDirty?u(!0):r(!a)},header:m.formState.id?"Edit '".concat(m.formState.originalName,"' trigger"):"Add a new Trigger",hideFooter:!j,className:m.chooseFunctionFormVisible?"hooks-sidepanel mr-16 transform transition-all duration-300 ease-in-out":"hooks-sidepanel mr-0 transform transition-all duration-300 ease-in-out",loading:f||v,onConfirm:handleSubmit,children:j?(0,n.jsxs)("div",{className:"",children:[(0,n.jsxs)(tL.Provider,{value:m,children:[(0,n.jsx)("div",{className:"my-6 space-y-10",children:m.isEditing?(0,n.jsxs)("div",{className:"space-y-6 px-6",children:[(0,n.jsx)(tB,{}),(0,n.jsx)(tU,{})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"px-6",children:(0,n.jsx)(tB,{})}),(0,n.jsx)(J.ZP.Separator,{}),(0,n.jsxs)("div",{className:"space-y-12 px-6",children:[(0,n.jsx)("h5",{children:"Conditions to fire trigger"}),(0,n.jsx)(tY,{}),(0,n.jsx)(tH,{}),(0,n.jsx)(tX,{}),(0,n.jsx)(tQ,{})]}),(0,n.jsx)(J.ZP.Separator,{}),(0,n.jsx)(tK,{})]})}),(0,n.jsx)(Triggers_ChooseFunctionForm,{triggerFunctions:h,visible:m.chooseFunctionFormVisible,setVisible:m.setChooseFunctionFormVisible,onChange:e=>{let t=(null!=p?p:[]).find(t=>t.id===e);t&&m.onSelectFunction(t)}})]}),(0,n.jsx)(e9.Z,{visible:d,header:"Discard changes",buttonLabel:"Discard",onSelectCancel:()=>u(!1),onSelectConfirm:()=>{u(!1),r(!a)},children:(0,n.jsx)(ec.C.Content,{children:(0,n.jsx)("p",{className:"py-4 text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})})]}):(0,n.jsx)(t_.Z,{message:"You will need to create a table first before you can make a trigger"})})})});let tB=(0,o.Pi)(e=>{let{}=e,t=(0,c.useContext)(tL);return(0,n.jsx)(p.Z,{id:"name",label:"Name of trigger",layout:"horizontal",placeholder:"Name of trigger",value:t.formState.name.value,onChange:e=>t.onFormChange({key:"name",value:e.target.value}),size:"small",error:t.formState.name.error,descriptionText:"The name is also stored as the actual postgres name of the trigger. Do not use spaces/whitespace."})}),tU=(0,o.Pi)(e=>{let{}=e,t=(0,c.useContext)(tL);return(0,n.jsxs)(eM.Z,{id:"enabled-mode",label:"Enabled mode",layout:"horizontal",value:t.formState.enabledMode.value,onChange:e=>t.onFormChange({key:"enabledMode",value:e}),size:"small",descriptionText:"Determines if a trigger should or should not fire. Can also be used to disable a trigger, but not delete it.",children:[(0,n.jsxs)(eM.Z.Option,{addOnBefore:e=>{let{active:t,selected:a}=e;return(0,n.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"ORIGIN",label:"Origin",children:["Origin",(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"This is a default behaviour"})]}),(0,n.jsxs)(eM.Z.Option,{addOnBefore:e=>{let{active:t,selected:a}=e;return(0,n.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"REPLICA",label:"Replica",children:["Replica",(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"Will only fire if the session is in “replica” mode"})]}),(0,n.jsxs)(eM.Z.Option,{addOnBefore:e=>{let{active:t,selected:a}=e;return(0,n.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"ALWAYS",label:"Always",children:["Always",(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"Will fire regardless of the current replication role"})]}),(0,n.jsxs)(eM.Z.Option,{addOnBefore:e=>{let{active:t,selected:a}=e;return(0,n.jsx)("div",{className:"h-3 w-3 rounded-full border border-red-700 bg-red-900 shadow-sm"})},value:"DISABLED",label:"Disabled",children:["Disabled",(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"Will not fire"})]})]})}),tQ=(0,o.Pi)(e=>{let{}=e,t=(0,c.useContext)(tL);return(0,n.jsxs)(eM.Z,{id:"orientation",label:"Orientation",layout:"horizontal",value:t.formState.orientation.value,onChange:e=>t.onFormChange({key:"orientation",value:e}),size:"small",descriptionText:"Identifies whether the trigger fires once for each processed row or once for each statement",children:[(0,n.jsxs)(eM.Z.Option,{value:"ROW",label:"Row",children:["Row",(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"fires once for each processed row"})]}),(0,n.jsxs)(eM.Z.Option,{value:"STATEMENT",label:"Statement",children:["Statement",(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"fires once for each statement"})]})]})}),tY=(0,o.Pi)(e=>{let{}=e,t=(0,c.useContext)(tL);return(0,n.jsx)(eM.Z,{id:"table",label:"Table",layout:"horizontal",value:t.formState.tableId.value,onChange:e=>{let a=t.tables.find(t=>t.id===e);a&&(t.onFormChange({key:"table",value:a.name}),t.onFormChange({key:"schema",value:a.schema}),t.onFormChange({key:"tableId",value:e}))},size:"small",error:t.formState.tableId.error,descriptionText:"This is the table the trigger will watch for changes. You can only select 1 table for a trigger.",children:t.tables.map(e=>(0,n.jsx)(eM.Z.Option,{id:e.id,value:e.id,label:e.name,addOnBefore:()=>(0,n.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,n.jsx)(tw.Z,{src:"".concat(eV.GW,"/img/table-editor.svg"),style:{width:"16px",height:"16px",strokeWidth:"1px"},preProcessor:e=>e.replace(/svg/,'svg class="m-auto text-color-inherit"')})}),children:(0,n.jsxs)("div",{className:"flex flex-row items-center space-x-1",children:[(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:e.schema}),(0,n.jsx)("p",{className:"text-foreground",children:e.name})]})},e.id))})}),tH=(0,o.Pi)(e=>{let{}=e,t=(0,c.useContext)(tL);return(0,n.jsxs)(tT.Z.Group,{name:"events",label:"Events",id:"events",labelOptional:"The type of events that will trigger your trigger",layout:"horizontal",descriptionText:"These are the events that are watched by the trigger, only the events selected above will fire the trigger on the table you've selected.",size:"small",onChange:e=>{let a=t.formState.events.value,n=e.target.checked?tj()(a,[e.target.value]):ty()(a,e.target.value);t.onFormChange({key:"events",value:n})},error:t.formState.events.error,children:[(0,n.jsx)(tT.Z,{value:"INSERT",label:"Insert",description:"Any insert operation on the table",checked:t.formState.events.value.includes("INSERT")}),(0,n.jsx)(tT.Z,{value:"UPDATE",label:"Update",description:"Any update operation, of any column in the table",checked:t.formState.events.value.includes("UPDATE")}),(0,n.jsx)(tT.Z,{value:"DELETE",label:"Delete",description:"Any deletion of a record",checked:t.formState.events.value.includes("DELETE")})]})}),tX=(0,o.Pi)(e=>{let{}=e,t=(0,c.useContext)(tL);return(0,n.jsxs)(eM.Z,{id:"activation",label:"Trigger type",descriptionText:"This determines when your Hook fires",onChange:e=>{t.onFormChange({key:"activation",value:e})},value:t.formState.activation.value,layout:"horizontal",size:"small",error:t.formState.activation.error,children:[(0,n.jsx)(eM.Z.Option,{id:"before",value:"BEFORE",label:"Before the event",addOnBefore:()=>(0,n.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,n.jsx)(tD.Z,{strokeWidth:2,size:"small"})}),children:(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("span",{children:"before"}),(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"Trigger fires before the operation is attempted"})]})}),(0,n.jsx)(eM.Z.Option,{id:"after",value:"AFTER",label:"After the event",addOnBefore:()=>(0,n.jsx)("div",{className:"flex items-center justify-center rounded bg-green-1200 p-1 text-background",children:(0,n.jsx)(IconPlayCircle_IconPlayCircle,{strokeWidth:2,size:"small"})}),children:(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("span",{children:"after"}),(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"Trigger fires after the operation has completed"})]})})]})}),tK=(0,o.Pi)(e=>{let{}=e,t=(0,c.useContext)(tL);return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"space-y-6 px-6",children:(0,n.jsx)("h5",{children:"Function to trigger"})}),(0,n.jsx)("div",{className:"px-6",children:eT()(t.formState.functionName.value)?(0,n.jsx)(tG,{}):(0,n.jsx)(tJ,{})})]})}),tG=(0,o.Pi)(e=>{let{}=e,t=(0,c.useContext)(tL);return(0,n.jsx)("button",{type:"button",onClick:()=>t.setChooseFunctionFormVisible(!0),className:"relative w-full rounded border border-default bg-surface-200 px-5 py-1 shadow-sm transition-all hover:border-strong hover:bg-overlay-hover",children:(0,n.jsx)(ui_FormBoxEmpty,{icon:(0,n.jsx)(tR.Z,{size:14,strokeWidth:2}),text:"Choose a function to trigger"})})}),tJ=(0,o.Pi)(e=>{let{}=e,t=(0,c.useContext)(tL);return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"relative w-full flex items-center justify-between space-x-3 px-5 py-4 border border-default rounded shadow-sm transition-shadow",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded bg-foreground text-background focus-within:bg-opacity-10",children:(0,n.jsx)(tR.Z,{size:"small",strokeWidth:2,width:14})}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("p",{className:"text-foreground-light",children:t.formState.functionName.value}),(0,n.jsx)("div",{children:(0,n.jsx)(M.Z,{children:t.formState.functionSchema.value})})]})]}),(0,n.jsx)(u.z,{type:"default",onClick:()=>t.setChooseFunctionFormVisible(!0),children:"Change function"})]})})});var t$=a(7765),t0=a(5776),Triggers_DeleteTrigger=e=>{let{trigger:t,visible:a,setVisible:r}=e,{project:s}=(0,E.d2)(),{id:i,name:l,schema:o}=null!=t?t:{},{mutate:c,isLoading:d}=(0,t0.m)();async function handleDelete(){return s?i?void c({projectRef:s.ref,connectionString:s.connectionString,id:i},{onSuccess:()=>{G.ZP.success("Successfully removed ".concat(l)),r(!1)}}):console.error("Trigger ID is required"):console.error("Project is required")}return(0,n.jsx)(t$.Z,{visible:a,onCancel:()=>r(!a),onConfirm:handleDelete,title:"Delete this trigger",loading:d,confirmLabel:"Delete trigger ".concat(l),confirmPlaceholder:"Type in name of trigger",confirmString:l,text:"This will delete your trigger called ".concat(l," of schema ").concat(o,"."),alert:"You cannot recover this trigger once it is deleted!"})},t1=a(90882),t2=a.n(t1),t4=a(84336),t3=a.n(t4),t5=a(87622),t6=a.n(t5),t8=a(39599),t9=a(75685),t7=a(37982);async function createDatabaseFunction(e){let{projectRef:t,connectionString:a,payload:n}=e,r=new Headers;a&&r.set("x-connection-encrypted",a);let{data:s,error:i}=await (0,es.v_)("/platform/pg-meta/{ref}/functions",{params:{path:{ref:t}},body:n,headers:r});if(i)throw i;return s}let useDatabaseFunctionCreateMutation=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,en.NL)();return(0,er.D)(e=>createDatabaseFunction(e),{async onSuccess(t,a,r){let{projectRef:s}=a;await n.invalidateQueries(t7.l.list(s)),await (null==e?void 0:e(t,a,r))},async onError(e,a,n){void 0===t?G.Am.error("Failed to create database function: ".concat(e.message)):t(e,a,n)},...a})};async function updateDatabaseFunction(e){let{projectRef:t,connectionString:a,id:n,payload:r}=e,s=new Headers;a&&s.set("x-connection-encrypted",a);let{data:i,error:l}=await (0,es.r$)("/platform/pg-meta/{ref}/functions",{params:{header:{"x-connection-encrypted":a},path:{ref:t},query:{id:n}},body:r,headers:s});if(l)throw l;return i}let useDatabaseFunctionUpdateMutation=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,en.NL)();return(0,er.D)(e=>updateDatabaseFunction(e),{async onSuccess(t,a,r){let{projectRef:s}=a;await n.invalidateQueries(t7.l.list(s)),await (null==e?void 0:e(t,a,r))},async onError(e,a,n){void 0===t?G.Am.error("Failed to update database function: ".concat(e.message)):t(e,a,n)},...a})};var ae=a(66433);let CreateFunctionFormState=class CreateFunctionFormState{get requestBody(){return{id:this.id,name:this.name.value,schema:this.schema.value,definition:this.definition.value,return_type:this.returnType.value,language:this.language.value,behavior:this.behavior.value,security_definer:this.securityDefiner.value,args:this.args.value.map(e=>"".concat(e.name," ").concat(e.type)),config_params:tg()(t6()(this.configParams.value,"name"),"value")}}reset(e){var t,a,n,r,s,i,l;this.id=null==e?void 0:e.id,this.originalName=null==e?void 0:e.name,this.args=(0,ae.cK)(null==e?void 0:e.argument_types),this.behavior={value:null!==(t=null==e?void 0:e.behavior)&&void 0!==t?t:"VOLATILE"},this.configParams=(0,ae.QI)(null==e?void 0:e.config_params),this.definition={value:null!==(a=null==e?void 0:e.definition)&&void 0!==a?a:""},this.language={value:null!==(n=null==e?void 0:e.language)&&void 0!==n?n:"plpgsql"},this.name={value:null!==(r=null==e?void 0:e.name)&&void 0!==r?r:""},this.returnType={value:null!==(s=null==e?void 0:e.return_type)&&void 0!==s?s:"void"},this.schema={value:null!==(i=null==e?void 0:e.schema)&&void 0!==i?i:"public"},this.securityDefiner={value:null!==(l=null==e?void 0:e.security_definer)&&void 0!==l&&l}}update(e){this.args=e.args,this.behavior=e.behavior,this.configParams=e.configParams,this.definition=e.definition,this.language=e.language,this.name=e.name,this.returnType=e.returnType,this.schema=e.schema,this.securityDefiner=e.securityDefiner}constructor(){(0,tp._)(this,"id",void 0),(0,tp._)(this,"originalName",void 0),(0,tp._)(this,"args",void 0),(0,tp._)(this,"behavior",void 0),(0,tp._)(this,"configParams",void 0),(0,tp._)(this,"definition",void 0),(0,tp._)(this,"language",void 0),(0,tp._)(this,"name",void 0),(0,tp._)(this,"returnType",void 0),(0,tp._)(this,"schema",void 0),(0,tp._)(this,"securityDefiner",void 0),(0,tN.ky)(this),this.reset()}};let CreateFunctionStore=class CreateFunctionStore{get title(){return this.formState.id?"Edit '".concat(this.formState.originalName,"' function"):"Add a new function"}get isEditing(){return void 0!=this.formState.id}constructor(){(0,tp._)(this,"formState",new CreateFunctionFormState),(0,tp._)(this,"meta",null),(0,tp._)(this,"schemas",[]),(0,tp._)(this,"advancedVisible",!1),(0,tp._)(this,"isDirty",!1),(0,tp._)(this,"toggleAdvancedVisible",()=>{this.advancedVisible=!this.advancedVisible}),(0,tp._)(this,"setSchemas",e=>{this.schemas=e}),(0,tp._)(this,"setIsDirty",e=>{this.isDirty=e}),(0,tp._)(this,"onFormChange",e=>{let{key:t,value:a}=e;if(this.isDirty=!0,tx()(this.formState,t)){let e=this.formState[t];this.formState[t]={...e,value:a,error:void 0}}else this.formState[t]={value:a}}),(0,tp._)(this,"onFormArrayChange",e=>{let{operation:t,key:a,idx:n,value:r}=e;switch(t){case"add":tx()(this.formState,a)?this.formState[a].value.push(r):this.formState[a]={value:[r]};break;case"delete":if(tx()(this.formState,a)){let e=t2()(this.formState[a].value,(e,t)=>t!=n);this.formState[a].value=e}break;default:tx()(this.formState,a)&&!t3()(n)?this.formState[a].value[n]=r:this.formState[a]={value:[r]}}}),(0,tp._)(this,"validateForm",()=>{let e=!0,t=tg()(this.formState,(t,a)=>{var n,r;switch(a){case"name":if(eT()(t.value)||(0,ae.zB)(t.value))return e=!1,{...t,error:"Invalid function name"};return t;case"args":{let a=null===(n=t.value)||void 0===n?void 0:n.map(t=>eT()(t.name)||(0,ae.zB)(t.name)?(e=!1,{...t,error:"Invalid argument name"}):t);return t.value=a,t}case"configParams":{let a=null===(r=t.value)||void 0===r?void 0:r.map(t=>{let a={name:void 0,value:void 0};return(eT()(t.name)||(0,ae.zB)(t.name))&&(e=!1,a.name="Invalid config name"),eT()(t.value)&&(e=!1,a.value="Missing config value"),{...t,error:a}});return t.value=a,t}default:return t}});return e||this.formState.update(t),e}),(0,tN.ky)(this)}};let at=(0,c.createContext)(null);var aa=(0,o.Pi)(e=>{let{func:t,visible:a,setVisible:r}=e,{project:s}=(0,E.d2)(),i=(0,o.fv)(()=>new CreateFunctionStore),[l,d]=(0,c.useState)(!1);(0,z.Q1)({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString},{onSuccess(e){i.setSchemas(e)}});let{mutate:u,isLoading:m}=useDatabaseFunctionCreateMutation(),{mutate:p,isLoading:h}=useDatabaseFunctionUpdateMutation();async function handleSubmit(){if(!s)return console.error("Project is required");if(i.validateForm()){let e=i.formState.requestBody;e.id?p({id:e.id,projectRef:s.ref,connectionString:s.connectionString,payload:e},{onSuccess:()=>{G.ZP.success("Successfully updated function ".concat(e.name)),r(!a)}}):u({projectRef:s.ref,connectionString:s.connectionString,payload:e},{onSuccess:()=>{G.ZP.success("Successfully created function ".concat(e.name)),r(!a)}})}}return(0,c.useEffect)(()=>{i.formState.reset(t),i.setIsDirty(!1)},[a,t]),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(J.ZP,{size:"large",visible:a,onCancel:function(){i.isDirty?d(!0):r(!a)},header:i.title,className:"hooks-sidepanel mr-0 transform transition-all duration-300 ease-in-out",loading:m||h,onConfirm:handleSubmit,children:[(0,n.jsx)(at.Provider,{value:i,children:(0,n.jsx)("div",{className:"mt-4 space-y-10",children:i.isEditing?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(J.ZP.Content,{children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(an,{}),(0,n.jsx)(ac,{})]})}),(0,n.jsx)(J.ZP.Separator,{}),(0,n.jsx)(J.ZP.Content,{children:(0,n.jsx)(ar,{readonly:!0})}),(0,n.jsx)(J.ZP.Separator,{}),(0,n.jsx)(J.ZP.Content,{children:(0,n.jsx)(ao,{})})]}):(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)(J.ZP.Content,{children:(0,n.jsx)(an,{})}),(0,n.jsx)(J.ZP.Separator,{}),(0,n.jsx)(J.ZP.Content,{children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(ac,{}),(0,n.jsx)(au,{})]})}),(0,n.jsx)(J.ZP.Separator,{}),(0,n.jsx)(J.ZP.Content,{children:(0,n.jsx)(ar,{})}),(0,n.jsx)(J.ZP.Separator,{}),(0,n.jsx)(J.ZP.Content,{children:(0,n.jsx)(ao,{})}),(0,n.jsx)(J.ZP.Separator,{}),(0,n.jsx)(J.ZP.Content,{children:(0,n.jsx)(ti.Z,{children:(0,n.jsx)("div",{className:"space-y-8 rounded bg-background py-4",children:(0,n.jsx)("div",{className:"px-6",children:(0,n.jsx)(ep.Z,{onChange:()=>i.toggleAdvancedVisible(),label:"Show advanced settings",checked:i.advancedVisible,labelOptional:"These are settings that might be familiar for postgres heavy users "})})})})}),i.advancedVisible&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(J.ZP.Content,{children:(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(ad,{}),(0,n.jsx)(am,{})]})}),(0,n.jsx)(J.ZP.Separator,{}),(0,n.jsx)(J.ZP.Content,{children:(0,n.jsx)(ai,{})}),(0,n.jsx)(J.ZP.Separator,{}),(0,n.jsx)(J.ZP.Content,{children:(0,n.jsx)(ap,{})})]})]})})}),(0,n.jsx)(e9.Z,{visible:l,header:"Discard changes",buttonLabel:"Discard",onSelectCancel:()=>d(!1),onSelectConfirm:()=>{d(!1),r(!a)},children:(0,n.jsx)(ec.C.Content,{children:(0,n.jsx)("p",{className:"py-4 text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})})]})})});let an=(0,o.Pi)(e=>{let{}=e,t=(0,c.useContext)(at);return(0,n.jsx)(p.Z,{id:"name",label:"Name of function",layout:"horizontal",placeholder:"Name of function",value:t.formState.name.value,onChange:e=>t.onFormChange({key:"name",value:e.target.value}),size:"small",error:t.formState.name.error,descriptionText:"Name will also be used for the function name in postgres"})}),ar=(0,o.Pi)(e=>{let{readonly:t}=e,a=(0,c.useContext)(at);return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("h5",{className:"text-base text-foreground",children:"Arguments"}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Arguments can be referenced in the function body using either names or numbers."})]}),(0,n.jsxs)("div",{className:"space-y-2 pt-4",children:[t&&eT()(a.formState.args.value)&&(0,n.jsx)("span",{className:"text-foreground-lighter",children:"No argument for this function"}),a.formState.args.value.map((e,a)=>(0,n.jsx)(as,{idx:a,name:e.name,type:e.type,error:e.error,readonly:t},"arg-".concat(a))),!t&&(0,n.jsx)("div",{className:"",children:(0,n.jsx)(u.z,{type:"default",icon:(0,n.jsx)(x.Z,{}),onClick:function(){a.onFormArrayChange({key:"args",value:{name:"",type:"bool"},operation:"add"})},disabled:t,children:"Add a new argument"})})]})]})}),as=(0,o.Pi)(e=>{let{idx:t,name:a,type:r,error:s,readonly:i}=e,l=(0,c.useContext)(at);return(0,n.jsxs)("div",{className:"flex flex-row space-x-1 items-center",children:[(0,n.jsx)(p.Z,{id:"name-".concat(t),className:"flex-1 flex-grow",value:a,placeholder:"Name of argument",onChange:function(e){let a=e.currentTarget.value;l.onFormArrayChange({key:"args",value:{name:a,type:r},idx:t,operation:"update"})},size:"small",error:s,disabled:i}),i?(0,n.jsx)(p.Z,{disabled:!0,readOnly:!0,id:"type-".concat(t),size:"small",value:r,className:"flex-1"}):(0,n.jsxs)(eM.Z,{id:"type-".concat(t),className:"flex-1",value:r,size:"small",onChange:function(e){l.onFormArrayChange({key:"args",value:{name:a,type:e},idx:t,operation:"update"})},disabled:i,children:[(0,n.jsx)(eM.Z.Option,{value:"integer",label:"integer",children:"integer"}),t9.DL.map(e=>(0,n.jsx)(eM.Z.Option,{value:e,label:e,children:e},e))]}),!i&&(0,n.jsx)(u.z,{type:"danger",icon:(0,n.jsx)(j.Z,{size:"tiny"}),onClick:function(){l.onFormArrayChange({key:"args",idx:t,operation:"delete"})},size:"small"})]})}),ai=(0,o.Pi)(e=>{let{}=e,t=(0,c.useContext)(at);return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsx)("h5",{className:"text-base text-foreground",children:"Config Params"})}),(0,n.jsx)("div",{className:"space-y-2 pt-4",children:t.formState.configParams.value.map((e,t)=>(0,n.jsx)(al,{idx:t,name:e.name,value:e.value,error:e.error},"configParam-".concat(t)))}),(0,n.jsx)("div",{className:"pt-2",children:(0,n.jsx)(u.z,{type:"default",icon:(0,n.jsx)(x.Z,{}),onClick:function(){t.onFormArrayChange({key:"configParams",value:{name:"",value:""},operation:"add"})},children:"Add a new config"})})]})}),al=(0,o.Pi)(e=>{let{idx:t,name:a,value:r,error:s}=e,i=(0,c.useContext)(at);return(0,n.jsxs)("div",{className:"flex space-x-1 items-center",children:[(0,n.jsx)(p.Z,{id:"name-".concat(t),className:"flex-1",placeholder:"Name of config",value:a,onChange:function(e){let a=e.currentTarget.value;i.onFormArrayChange({key:"configParams",value:{name:a,value:r},idx:t,operation:"update"})},size:"small",error:null==s?void 0:s.name}),(0,n.jsx)(p.Z,{id:"value-".concat(t),className:"flex-1",placeholder:"Value of config",value:r,onChange:function(e){let n=e.currentTarget.value;i.onFormArrayChange({key:"configParams",value:{name:a,value:n},idx:t,operation:"update"})},size:"small",error:null==s?void 0:s.value}),(0,n.jsx)(u.z,{type:"danger",icon:(0,n.jsx)(j.Z,{size:"tiny"}),onClick:function(){i.onFormArrayChange({key:"configParams",idx:t,operation:"delete"})},size:"small"})]})}),ao=(0,o.Pi)(e=>{let{}=e,t=(0,c.useContext)(at);return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("h5",{className:"text-base text-foreground",children:"Definition"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["The language below should be written in `",t.formState.language.value,"`."]}),!(null==t?void 0:t.isEditing)&&(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Change the language in the Advanced Settings below."})]}),(0,n.jsx)("div",{className:"h-60 resize-y border border-default",children:(0,n.jsx)(tO.Z,{defaultValue:t.formState.definition.value,onInputChange:e=>{t.onFormChange({key:"definition",value:e})},contextmenu:!1})})]})}),ac=(0,o.Pi)(e=>{var t;let{}=e,a=(0,c.useContext)(at),{project:r}=(0,E.d2)(),{data:s}=(0,z.Q1)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString}),i=null!==(t=null==s?void 0:s.filter(e=>!C.F.includes(e.name)))&&void 0!==t?t:[];return(0,n.jsx)(eM.Z,{id:"schema",label:"Schema",size:"small",layout:"horizontal",placeholder:"Pick a schema",value:a.formState.schema.value,descriptionText:"Tables made in the table editor will be in 'public'",onChange:e=>a.onFormChange({key:"schema",value:e}),children:i.map(e=>(0,n.jsx)(eM.Z.Option,{label:e.name,value:e.name,children:e.name},e.name))})}),ad=(0,o.Pi)(e=>{let{}=e,t=(0,c.useContext)(at),{project:a}=(0,E.d2)(),{data:r}=(0,e_.H)({projectRef:null==a?void 0:a.ref,connectionString:null==a?void 0:a.connectionString}),[s]=D()(null!=r?r:[],e=>!ev()(e.installed_version));return(0,n.jsxs)(eM.Z,{id:"language",size:"small",label:"Language",layout:"horizontal",value:t.formState.language.value,placeholder:"Pick a language",onChange:e=>t.onFormChange({key:"language",value:e}),children:[(0,n.jsx)(eM.Z.Option,{value:"sql",label:"sql",children:"sql"}),s.filter(e=>e.name.startsWith("pl")).map(e=>(0,n.jsx)(eM.Z.Option,{value:e.name,label:e.name,children:e.name},e.name))]})}),au=(0,o.Pi)(e=>{let{}=e,t=(0,c.useContext)(at);return(0,n.jsxs)(eM.Z,{id:"returnType",size:"small",label:"Return type",layout:"horizontal",value:t.formState.returnType.value,onChange:e=>t.onFormChange({key:"returnType",value:e}),children:[(0,n.jsx)(eM.Z.Option,{value:"void",label:"void",children:"void"}),(0,n.jsx)(eM.Z.Option,{value:"record",label:"record",children:"record"}),(0,n.jsx)(eM.Z.Option,{value:"trigger",label:"trigger",children:"trigger"}),(0,n.jsx)(eM.Z.Option,{value:"integer",label:"integer",children:"integer"}),t9.DL.map(e=>(0,n.jsx)(eM.Z.Option,{value:e,label:e,children:e},e))]})}),am=(0,o.Pi)(e=>{let{}=e,t=(0,c.useContext)(at);return(0,n.jsxs)(eM.Z,{id:"behavior",size:"small",label:"Behavior",layout:"horizontal",value:t.formState.behavior.value,onChange:e=>t.onFormChange({key:"behavior",value:e}),children:[(0,n.jsx)(eM.Z.Option,{value:"IMMUTABLE",label:"immutable",children:"immutable"}),(0,n.jsx)(eM.Z.Option,{value:"STABLE",label:"stable",children:"stable"}),(0,n.jsx)(eM.Z.Option,{value:"VOLATILE",label:"volatile",children:"volatile"})]})}),ap=(0,o.Pi)(e=>{let{}=e,t=(0,c.useContext)(at);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"space-y-4",children:(0,n.jsxs)(t8.Z.Group,{type:"cards",label:"Type of security",layout:"vertical",onChange:e=>{t.onFormChange({key:"securityDefiner",value:"SECURITY_DEFINER"==e.target.value})},value:t.formState.securityDefiner.value?"SECURITY_DEFINER":"SECURITY_INVOKER",error:t.formState.securityDefiner.error,children:[(0,n.jsx)(t8.Z,{id:"SECURITY_INVOKER",label:"SECURITY INVOKER",value:"SECURITY_INVOKER",checked:!t.formState.securityDefiner.value,description:"Function is to be executed with the privileges of the user that calls it."}),(0,n.jsx)(t8.Z,{id:"SECURITY_DEFINER",label:"SECURITY DEFINER",value:"SECURITY_DEFINER",checked:t.formState.securityDefiner.value,description:"Function is to be executed with the privileges of the user that created it."})]})})})});async function deleteDatabaseFunction(e){let{projectRef:t,connectionString:a,id:n}=e,r=new Headers;a&&r.set("x-connection-encrypted",a);let{data:s,error:i}=await (0,es.IV)("/platform/pg-meta/{ref}/functions",{params:{header:{"x-connection-encrypted":a},path:{ref:t},query:{id:n}},headers:r});if(i)throw i;return s}let useDatabaseFunctionDeleteMutation=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,en.NL)();return(0,er.D)(e=>deleteDatabaseFunction(e),{async onSuccess(t,a,r){let{projectRef:s}=a;await n.invalidateQueries(t7.l.list(s)),await (null==e?void 0:e(t,a,r))},async onError(e,a,n){void 0===t?G.Am.error("Failed to delete database function: ".concat(e.message)):t(e,a,n)},...a})};var Functions_DeleteFunction=e=>{let{func:t,visible:a,setVisible:r}=e,{project:s}=(0,E.d2)(),{id:i,name:l,schema:o}=null!=t?t:{},{mutate:c,isLoading:d}=useDatabaseFunctionDeleteMutation({onSuccess:()=>{G.ZP.success("Successfully removed function ".concat(l)),r(!1)}});async function handleDelete(){return i?s?void c({id:i,projectRef:s.ref,connectionString:s.connectionString}):console.error("Project is required"):console.error("Function ID is require")}return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(t$.Z,{visible:a,onCancel:()=>r(!a),onConfirm:handleDelete,title:"Delete this function",loading:d,confirmLabel:"Delete function ".concat(l),confirmPlaceholder:"Type in name of function",confirmString:l,text:"This will delete your function called ".concat(l," of schema ").concat(o,"."),alert:"You cannot recover this function once it is deleted!"})})},ah=a(58943);let ax={list:e=>["projects",e,"enumerated-types"]};async function getEnumeratedTypes(e,t){let{projectRef:a,connectionString:n}=e;if(!a)throw Error("projectRef is required");let r=new Headers;n&&r.set("x-connection-encrypted",n);let{data:s,error:i}=await (0,es.U2)("/platform/pg-meta/{ref}/types",{params:{header:{"x-connection-encrypted":n},path:{ref:a}},headers:Object.fromEntries(r),signal:t});if(i)throw i;return s}let useEnumeratedTypesQuery=function(e){let{projectRef:t,connectionString:a}=e,{enabled:n=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,ah.a)(ax.list(t),e=>{let{signal:n}=e;return getEnumeratedTypes({projectRef:t,connectionString:a},n)},{enabled:n&&void 0!==t,...r})};var af=a(40023),ag=a(50074);async function createEnumeratedType(e){let{projectRef:t,connectionString:a,schema:n,name:r,description:s,values:i}=e,l='create type "'.concat(n,'"."').concat(r,'" as enum (').concat(i.map(e=>"'".concat(e,"'")).join(", "),");"),o=void 0!==s?'comment on type "'.concat(n,'"."').concat(r,"\" is '").concat(s,"';"):"",c=wrapWithTransaction("".concat(l," ").concat(o)),{result:d}=await (0,H.Rj)({projectRef:t,connectionString:a,sql:c});return d}let useEnumeratedTypeCreateMutation=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,en.NL)();return(0,er.D)(e=>createEnumeratedType(e),{async onSuccess(t,a,r){let{projectRef:s}=a;await n.invalidateQueries(ax.list(s)),await (null==e?void 0:e(t,a,r))},async onError(e,a,n){void 0===t?G.ZP.error("Failed to create enumerated type: ".concat(e.message)):t(e,a,n)},...a})};var av=a(76670),EnumeratedTypes_EnumeratedTypeValueRow=e=>{let{index:t,id:a,field:r,isDisabled:s=!1,onRemoveValue:i}=e;return(0,n.jsx)(af._l,{draggableId:a,index:t,isDragDisabled:s,children:e=>(0,n.jsxs)("div",{ref:e.innerRef,...e.draggableProps,className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{...e.dragHandleProps,className:"opacity-50 hover:opacity-100 transition ".concat(s?"text-foreground-lighter !cursor-default":"text-foreground"),children:(0,n.jsx)(av.Z,{size:16,strokeWidth:1.5})}),(0,n.jsx)(ee.I,{...r,className:"w-full"}),(0,n.jsx)(u.z,{type:"default",size:"small",disabled:s,icon:(0,n.jsx)(j.Z,{strokeWidth:1.5,size:16}),className:"px-2",onClick:()=>i()})]})})},EnumeratedTypes_CreateEnumeratedTypeSidePanel=e=>{let{visible:t,onClose:a,schema:r}=e,s=(0,c.useRef)(null),{project:i}=(0,E.d2)(),{mutate:l,isLoading:o}=useEnumeratedTypeCreateMutation({onSuccess:(e,t)=>{G.ZP.success('Successfully created type "'.concat(t.name,'"')),a()}}),d=ea.Ry({name:ea.Z_().min(1,"Please provide a name for your enumerated type").default(""),description:ea.Z_().default("").optional(),values:ea.Ry({value:ea.Z_().min(1,"Please provide a value")}).array().default([])}),m=(0,K.cI)({resolver:(0,X.F)(d),defaultValues:{name:"",description:"",values:[{value:""}]}}),{fields:p,append:h,remove:f,move:g}=(0,K.Dq)({name:"values",control:m.control}),updateOrder=e=>{e.destination&&g(e.source.index,e.destination.index)};return(0,c.useEffect)(()=>{t&&m.reset()},[t]),(0,n.jsx)(J.ZP,{loading:o,visible:t,onCancel:a,header:"Create a new enumerated type",confirmText:"Create type",onConfirm:()=>{s.current&&s.current.click()},children:(0,n.jsx)(J.ZP.Content,{className:"py-4",children:(0,n.jsx)($.l0,{...m,children:(0,n.jsxs)("form",{className:"space-y-4",onSubmit:m.handleSubmit(e=>{var t;return(null==i?void 0:i.ref)===void 0?console.error("Project ref required"):(null==i?void 0:i.connectionString)===void 0?console.error("Project connectionString required"):void l({projectRef:i.ref,connectionString:i.connectionString,schema:r,name:e.name,description:null===(t=e.description)||void 0===t?void 0:t.replaceAll("'","''"),values:e.values.filter(e=>e.value.length>0).map(e=>e.value)})}),children:[(0,n.jsx)($.Wi,{control:m.control,name:"name",render:e=>{let{field:t}=e;return(0,n.jsxs)($.xJ,{children:[(0,n.jsx)($.lX,{children:"Name"}),(0,n.jsx)($.NI,{children:(0,n.jsx)(ee.I,{...t})}),(0,n.jsx)($.zG,{})]})}}),(0,n.jsx)($.Wi,{control:m.control,name:"description",render:e=>{let{field:t}=e;return(0,n.jsxs)($.xJ,{children:[(0,n.jsx)($.lX,{children:"Description"}),(0,n.jsx)($.NI,{children:(0,n.jsx)(ee.I,{...t})}),(0,n.jsx)($.pf,{children:"Optional"})]})}}),(0,n.jsx)(af.Z5,{onDragEnd:e=>updateOrder(e),children:(0,n.jsx)(af.bK,{droppableId:"enum_type_values_droppable",children:e=>(0,n.jsxs)("div",{ref:e.innerRef,children:[p.map((e,t)=>(0,n.jsx)($.Wi,{control:m.control,name:"values.".concat(t,".value"),render:a=>{let{field:r}=a;return(0,n.jsxs)($.xJ,{children:[(0,n.jsx)($.lX,{className:(0,ex.cn)(0!==t&&"sr-only"),children:"Values"}),0===t&&(0,n.jsxs)(ag.bZ,{children:[(0,n.jsx)(ey.Z,{strokeWidth:1.5}),(0,n.jsx)(ag.Cd,{children:"After creation, values cannot be deleted or sorted"}),(0,n.jsxs)(ag.X,{children:[(0,n.jsx)("p",{className:"!leading-normal track",children:"You will need to delete and recreate the enumerated type with the updated values instead."}),(0,n.jsx)(u.z,{asChild:!0,type:"default",icon:(0,n.jsx)(eN.Z,{strokeWidth:1.5}),className:"mt-2",children:(0,n.jsx)(eb(),{href:"https://www.postgresql.org/message-id/21012.1459434338%40sss.pgh.pa.us",target:"_blank",rel:"noreferrer",children:"Learn more"})})]})]}),(0,n.jsx)($.NI,{children:(0,n.jsx)(EnumeratedTypes_EnumeratedTypeValueRow,{index:t,id:e.id,field:r,isDisabled:p.length<2,onRemoveValue:()=>f(t)})}),(0,n.jsx)($.zG,{className:"ml-6"})]})}},e.id)),e.placeholder]})})}),(0,n.jsx)(u.z,{type:"default",icon:(0,n.jsx)(x.Z,{strokeWidth:1.5}),onClick:()=>h({value:""}),children:"Add value"}),(0,n.jsx)(u.z,{ref:s,htmlType:"submit",type:"default",className:"hidden",children:"Update"})]})})})})},aj=a(16236);async function deleteEnumeratedType(e){let{projectRef:t,connectionString:a,name:n,schema:r}=e,s="drop type if exists ".concat(r,'."').concat(n,'"'),{result:i}=await (0,H.Rj)({projectRef:t,connectionString:a,sql:s});return i}let useEnumeratedTypeDeleteMutation=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,en.NL)();return(0,er.D)(e=>deleteEnumeratedType(e),{async onSuccess(t,a,r){let{projectRef:s}=a;await n.invalidateQueries(ax.list(s)),await (null==e?void 0:e(t,a,r))},async onError(e,a,n){void 0===t?G.ZP.error("Failed to create enumerated type: ".concat(e.message)):t(e,a,n)},...a})};var EnumeratedTypes_DeleteEnumeratedTypeModal=e=>{let{visible:t,selectedEnumeratedType:a,onClose:r}=e,{project:s}=(0,E.d2)(),{mutate:i,isLoading:l}=useEnumeratedTypeDeleteMutation({onSuccess:()=>{G.ZP.success('Successfully deleted "'.concat(a.name,'"')),r()}}),onConfirmDeleteType=()=>void 0===a?console.error("No enumerated type selected"):(null==s?void 0:s.ref)===void 0?console.error("Project ref required"):(null==s?void 0:s.connectionString)===void 0?console.error("Project connectionString required"):void i({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString,name:a.name,schema:a.schema});return(0,n.jsx)(e9.Z,{danger:!0,size:"medium",loading:l,visible:t,header:(0,n.jsxs)(n.Fragment,{children:["Confirm to delete enumerated type"," ",(0,n.jsx)("code",{className:"text-sm",children:null==a?void 0:a.name})]}),buttonLabel:"Confirm delete",buttonLoadingLabel:"Deleting...",onSelectConfirm:()=>onConfirmDeleteType(),onSelectCancel:r,children:(0,n.jsx)(ec.C.Content,{children:(0,n.jsxs)("div",{className:"py-6",children:[(0,n.jsxs)(ag.bZ,{variant:"warning",children:[(0,n.jsx)(aj.Z,{strokeWidth:2}),(0,n.jsx)(ag.Cd,{children:"This action cannot be undone"}),(0,n.jsx)(ag.X,{children:"You will need to re-create the enumerated type if you want to revert the deletion."})]}),(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("strong",{className:"text-sm",children:"Before deleting this enumerated type, consider:"}),(0,n.jsx)("ul",{className:"space-y-2 mt-2 text-sm text-foreground-light",children:(0,n.jsx)("li",{className:"list-disc ml-6",children:"This enumerated type is no longer in use in any tables or functions"})})]})]})})})};async function updateEnumeratedType(e){let{projectRef:t,connectionString:a,schema:n,name:r,description:s,values:i=[]}=e,l=[];r.original!==r.updated&&l.push('alter type "'.concat(n,'"."').concat(r.original,'" rename to "').concat(r.updated,'";')),i.length>0&&i.forEach((e,t)=>{if(e.isNew){if(0===t){let t=i.find(e=>!e.isNew);l.push('alter type "'.concat(n,'"."').concat(r.updated,"\" add value '").concat(e.updated,"' before '").concat(null==t?void 0:t.original,"';"))}else l.push('alter type "'.concat(n,'"."').concat(r.updated,"\" add value '").concat(e.updated,"' after '").concat(i[t-1].updated,"';"))}else e.original!==e.updated&&l.push('alter type "'.concat(n,'"."').concat(r.updated,"\" rename value '").concat(e.original,"' to '").concat(e.updated,"';"))}),void 0!==s&&l.push('comment on type "'.concat(n,'"."').concat(r.updated,"\" is '").concat(s,"';"));let o=wrapWithTransaction(l.join(" ")),{result:c}=await (0,H.Rj)({projectRef:t,connectionString:a,sql:o});return c}let useEnumeratedTypeUpdateMutation=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,en.NL)();return(0,er.D)(e=>updateEnumeratedType(e),{async onSuccess(t,a,r){let{projectRef:s}=a;await n.invalidateQueries(ax.list(s)),await (null==e?void 0:e(t,a,r))},async onError(e,a,n){void 0===t?G.ZP.error("Failed to add value to enumerated type: ".concat(e.message)):t(e,a,n)},...a})};var EnumeratedTypes_EditEnumeratedTypeSidePanel=e=>{var t;let{visible:a,selectedEnumeratedType:r,onClose:s}=e,i=(0,c.useRef)(null),{project:l}=(0,E.d2)(),{mutate:o,isLoading:d}=useEnumeratedTypeUpdateMutation({onSuccess:(e,t)=>{G.ZP.success('Successfully updated type "'.concat(t.name.updated,'"')),s()}}),m=ea.Ry({name:ea.Z_().min(1,"Please provide a name for your enumerated type").default(""),description:ea.Z_().default("").optional(),values:ea.Ry({isNew:ea.O7(),originalValue:ea.Z_(),updatedValue:ea.Z_().min(1,"Please provide a value")}).array().default([])}),p=(0,K.cI)({resolver:(0,X.F)(m),defaultValues:{name:"",description:"",values:[{isNew:!0,originalValue:"",updatedValue:""}]}}),{fields:h,append:f,remove:g,move:v}=(0,K.Dq)({name:"values",control:p.control}),updateOrder=e=>{e.destination&&v(e.source.index,e.destination.index)},j=(null!==(t=null==r?void 0:r.enums)&&void 0!==t?t:[]).map(e=>({isNew:!1,originalValue:e,updatedValue:e}));return(0,c.useEffect)(()=>{if(void 0!==r){var e;p.reset({name:r.name,description:null!==(e=r.comment)&&void 0!==e?e:"",values:j})}},[r]),(0,n.jsx)(J.ZP,{loading:d,visible:a,onCancel:s,header:'Update type "'.concat(null==r?void 0:r.name,'"'),confirmText:"Update type",onConfirm:()=>{i.current&&i.current.click()},children:(0,n.jsx)(J.ZP.Content,{className:"py-4",children:(0,n.jsx)($.l0,{...p,children:(0,n.jsxs)("form",{className:"space-y-4",onSubmit:p.handleSubmit(e=>{var t;if((null==l?void 0:l.ref)===void 0)return console.error("Project ref required");if((null==l?void 0:l.connectionString)===void 0)return console.error("Project connectionString required");if(void 0===r)return console.error("selectedEnumeratedType required");let a={schema:r.schema,name:{original:r.name,updated:e.name},values:e.values.filter(e=>0!==e.updatedValue.length).map(e=>({original:e.originalValue,updated:e.updatedValue,isNew:e.isNew})),...e.description!==r.comment?{description:null===(t=e.description)||void 0===t?void 0:t.replaceAll("'","''")}:{}};o({projectRef:l.ref,connectionString:l.connectionString,...a})}),children:[(0,n.jsx)($.Wi,{control:p.control,name:"name",render:e=>{let{field:t}=e;return(0,n.jsxs)($.xJ,{children:[(0,n.jsx)($.lX,{children:"Name"}),(0,n.jsx)($.NI,{children:(0,n.jsx)(ee.I,{...t})}),(0,n.jsx)($.zG,{})]})}}),(0,n.jsx)($.Wi,{control:p.control,name:"description",render:e=>{let{field:t}=e;return(0,n.jsxs)($.xJ,{children:[(0,n.jsx)($.lX,{children:"Description"}),(0,n.jsx)($.NI,{children:(0,n.jsx)(ee.I,{...t})}),(0,n.jsx)($.pf,{children:"Optional"})]})}}),(0,n.jsx)(af.Z5,{onDragEnd:e=>updateOrder(e),children:(0,n.jsx)(af.bK,{droppableId:"enum_type_values_droppable",children:e=>(0,n.jsxs)("div",{ref:e.innerRef,children:[h.map((e,t)=>(0,n.jsx)($.Wi,{control:p.control,name:"values.".concat(t,".updatedValue"),render:a=>{let{field:r}=a;return(0,n.jsxs)($.xJ,{children:[(0,n.jsx)($.lX,{className:(0,ex.cn)(0!==t&&"sr-only"),children:"Values"}),0===t&&(0,n.jsxs)(ag.bZ,{children:[(0,n.jsx)(ey.Z,{strokeWidth:1.5}),(0,n.jsx)(ag.Cd,{children:"Existing values cannot be deleted or sorted"}),(0,n.jsxs)(ag.X,{children:[(0,n.jsx)("p",{className:"!leading-normal track",children:"You will need to delete and recreate the enumerated type with the updated values instead."}),(0,n.jsx)(u.z,{asChild:!0,type:"default",icon:(0,n.jsx)(eN.Z,{strokeWidth:1.5}),className:"mt-2",children:(0,n.jsx)(eb(),{href:"https://www.postgresql.org/message-id/21012.1459434338%40sss.pgh.pa.us",target:"_blank",rel:"noreferrer",children:"Learn more"})})]})]}),(0,n.jsx)($.NI,{children:(0,n.jsx)(EnumeratedTypes_EnumeratedTypeValueRow,{index:t,id:e.id,field:r,isDisabled:!e.isNew,onRemoveValue:()=>g(t)})}),(0,n.jsx)($.zG,{className:"ml-6"})]})}},e.id)),e.placeholder]})})}),(0,n.jsx)(u.z,{type:"default",icon:(0,n.jsx)(x.Z,{strokeWidth:1.5}),onClick:()=>f({isNew:!0,originalValue:"",updatedValue:""}),children:"Add value"}),(0,n.jsx)(u.z,{ref:i,htmlType:"submit",type:"default",className:"hidden",children:"Update"})]})})})})},EnumeratedTypes_EnumeratedTypes=()=>{let{project:e}=(0,E.d2)(),[t,a]=(0,c.useState)(""),[r,s]=(0,c.useState)("public"),[i,l]=(0,c.useState)(!1),[o,d]=(0,c.useState)(),[m,x]=(0,c.useState)(),{data:b}=(0,z.Q1)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),{data:_,error:S,isLoading:k,isError:T,isSuccess:D}=useEnumeratedTypesQuery({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),R=t.length>0?(null!=_?_:[]).filter(e=>e.schema===r&&e.name.toLowerCase().includes(t.toLowerCase())):(null!=_?_:[]).filter(e=>e.schema===r),P=(null!=b?b:[]).filter(e=>{var t;return C.F.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),I=null==b?void 0:b.find(e=>e.name===r),A=P.some(e=>e.id===(null==I?void 0:I.id));return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(F.Z,{className:"w-[260px]",size:"small",showError:!1,selectedSchemaName:r,onSelectSchema:s}),(0,n.jsx)(p.Z,{size:"small",value:t,className:"w-64",onChange:e=>a(e.target.value),placeholder:"Search for a type",icon:(0,n.jsx)(h.Z,{size:14})})]}),!A&&(0,n.jsx)(u.z,{type:"primary",onClick:()=>l(!0),children:"Create type"})]}),A&&(0,n.jsx)(Z.Z,{schema:r,entity:"enumerated types"}),k&&(0,n.jsx)(w.A,{}),T&&(0,n.jsx)(N.Z,{error:S,subject:"Failed to retrieve database enumerated types"}),D&&(0,n.jsx)(y.Z,{head:[(0,n.jsx)(y.Z.th,{children:"Schema"},"schema"),(0,n.jsx)(y.Z.th,{children:"Name"},"name"),(0,n.jsx)(y.Z.th,{children:"Values"},"values"),(0,n.jsx)(y.Z.th,{},"actions")],body:(0,n.jsxs)(n.Fragment,{children:[0===R.length&&0===t.length&&(0,n.jsx)(y.Z.tr,{children:(0,n.jsxs)(y.Z.td,{colSpan:4,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No enumerated types created yet"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no enumerated types found in the schema "',r,'"']})]})}),0===R.length&&t.length>0&&(0,n.jsx)(y.Z.tr,{children:(0,n.jsxs)(y.Z.td,{colSpan:4,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',t,'" did not return any results']})]})}),R.length>0&&R.map(e=>(0,n.jsxs)(y.Z.tr,{children:[(0,n.jsx)(y.Z.td,{className:"w-20",children:(0,n.jsx)("p",{className:"w-20 truncate",children:e.schema})}),(0,n.jsx)(y.Z.td,{children:e.name}),(0,n.jsx)(y.Z.td,{children:e.enums.join(", ")}),(0,n.jsx)(y.Z.td,{children:!A&&(0,n.jsx)("div",{className:"flex justify-end items-center space-x-2",children:(0,n.jsxs)(f.h_,{children:[(0,n.jsx)(f.$F,{asChild:!0,children:(0,n.jsx)(u.z,{type:"default",className:"px-1",children:(0,n.jsx)(g.Z,{})})}),(0,n.jsxs)(f.AW,{side:"bottom",align:"end",className:"w-32",children:[(0,n.jsxs)(f.Xi,{className:"space-x-2",onClick:()=>d(e),children:[(0,n.jsx)(v.Z,{size:"tiny"}),(0,n.jsx)("p",{children:"Update type"})]}),(0,n.jsxs)(f.Xi,{className:"space-x-2",onClick:()=>x(e),children:[(0,n.jsx)(j.Z,{stroke:"red",size:"tiny"}),(0,n.jsx)("p",{children:"Delete type"})]})]})]})})})]},e.id))]})}),(0,n.jsx)(EnumeratedTypes_CreateEnumeratedTypeSidePanel,{visible:i,onClose:()=>l(!1),schema:r}),(0,n.jsx)(EnumeratedTypes_EditEnumeratedTypeSidePanel,{visible:void 0!==o,selectedEnumeratedType:o,onClose:()=>d(void 0)}),(0,n.jsx)(EnumeratedTypes_DeleteEnumeratedTypeModal,{visible:void 0!==m,selectedEnumeratedType:m,onClose:()=>x(void 0)})]})}},11539:function(e,t,a){var n=a(52322),r=a(34291),s=a.n(r),i=a(2784),l=a(94580);t.Z=e=>{let{loading:t=!1,disableApply:a=!1,hideApply:r=!1,children:o,applyButtonLabel:c="Apply",backButtonLabel:d="Back",applyFunction:u,closePanel:m=s(),formId:p}=e,[h,x]=(0,i.useState)(!1),applyCallback=()=>new Promise(e=>u(e)),onSelectApply=async()=>{x(!0),await applyCallback(),x(!1)};return(0,n.jsxs)("div",{className:"flex w-full justify-end space-x-3 border-t border-default px-3 py-4",children:[(0,n.jsx)(l.z,{size:"small",type:"default",htmlType:"button",onClick:m,disabled:h||t,children:d}),o,void 0!==u?(0,n.jsx)(l.z,{size:"small",onClick:onSelectApply,disabled:a||h||t,loading:h||t,children:c}):r?(0,n.jsx)("div",{}):(0,n.jsx)(l.z,{size:"small",disabled:t||a,loading:t,htmlType:"submit",form:p,children:c})]})}},40127:function(e,t,a){a.d(t,{Z:function(){return ColumnEditor_ColumnType}});var n=a(52322),r=a(34291),s=a.n(r),i=a(39097),l=a.n(i),o=a(31915),c=a(29245),d=a(27087);a(2784);var u=a(26445),m=a(97265),IconType_IconType=function(e){return(0,n.jsx)(m.Z,{icon:u.Z,...e})},p=a(99311),IconToggleRight_IconToggleRight=function(e){return(0,n.jsx)(m.Z,{icon:p.Z,...e})},h=a(60240),x=a(73205),f=a(94580),g=a(63157),v=a(75685),j=a(34876),ColumnEditor_ColumnType=e=>{let{value:t,enumTypes:a=[],className:r,size:i="medium",layout:u,error:m,disabled:p=!1,showLabel:b=!0,description:y,showRecommendation:N=!1,onOptionSelect:w=s()}=e,_=v.DL.concat(a.map(e=>e.name)),S=!t||_.includes(t),C=v.VP[t];if(!S)return(0,n.jsx)(o.Z,{readOnly:!0,disabled:!0,label:b?"Type":"",layout:b?"horizontal":void 0,className:"md:gap-x-0",size:"small",value:t,descriptionText:b?"Custom non-native psql data types cannot currently be changed to a different data type via Supabase Studio":""});let inferIcon=e=>{switch(e){case"number":return(0,n.jsx)(c.Z,{size:16,className:"text-foreground",strokeWidth:1.5});case"time":return(0,n.jsx)(d.Z,{size:16,className:"text-foreground",strokeWidth:1.5});case"text":return(0,n.jsx)(IconType_IconType,{size:16,className:"text-foreground",strokeWidth:1.5});case"json":return(0,n.jsx)("div",{className:"text-foreground",style:{padding:"0px 1px"},children:"{ }"});case"bool":return(0,n.jsx)(IconToggleRight_IconToggleRight,{size:16,className:"text-foreground",strokeWidth:1.5});default:return(0,n.jsx)("div",{})}};return(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)(h.Z,{label:b?"Type":"",layout:u||(b?"horizontal":"vertical"),value:t,size:i,error:m,disabled:p,descriptionText:y,className:"".concat(r," ").concat(p?"column-type-disabled":""," rounded-md"),onChange:e=>w(e),optionsWidth:480,children:[(0,n.jsx)(h.Z.Option,{value:"",label:"---",children:"---"},"empty"),a.length>0?(0,n.jsx)(h.Z.Option,{disabled:!0,value:"header-1",label:"header-1",children:"Other Data Types"},"header-1"):(0,n.jsx)(n.Fragment,{}),a.length>0?a.map(e=>(0,n.jsx)(h.Z.Option,{value:e.name,label:e.name,addOnBefore:()=>(0,n.jsx)(j.Z,{size:16,className:"text-foreground",strokeWidth:1.5}),children:(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)("p",{className:"text-foreground",children:e.name}),void 0!==e.comment&&(0,n.jsx)("p",{className:"text-foreground-lighter",children:e.comment})]})},e.name)):(0,n.jsx)(n.Fragment,{}),(0,n.jsx)(h.Z.Option,{disabled:!0,value:"header-2",label:"header-2",children:"PostgreSQL Data Types"}),v.N0.map(e=>(0,n.jsx)(h.Z.Option,{value:e.name,label:e.name,addOnBefore:()=>inferIcon(e.type),children:(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)("span",{className:"text-foreground",children:e.name}),(0,n.jsx)("span",{className:"text-foreground-lighter",children:e.description})]})},e.name))]}),N&&void 0!==C&&(0,n.jsxs)(x.b,{withIcon:!0,variant:"warning",title:(0,n.jsxs)(n.Fragment,{children:["It is recommended to use ",(0,n.jsx)("code",{className:"text-xs",children:C.alternative})," ","instead"]}),children:[(0,n.jsxs)("p",{children:["Postgres recommends against using the data type ",(0,n.jsx)("code",{className:"text-xs",children:t})," ","unless you have a very specific use case."]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2 mt-3",children:[(0,n.jsx)(f.z,{asChild:!0,type:"default",icon:(0,n.jsx)(g.Z,{}),children:(0,n.jsx)(l(),{href:C.reference,target:"_blank",rel:"noreferrer",children:"Read more"})}),(0,n.jsxs)(f.z,{type:"primary",onClick:()=>w(C.alternative),children:["Use ",C.alternative]})]})]})]})}},75685:function(e,t,a){a.d(t,{BB:function(){return o},DL:function(){return p},Ks:function(){return c},N0:function(){return x},VP:function(){return h},XO:function(){return u},YF:function(){return l},lb:function(){return d},nA:function(){return m}});var n=a(829),r=a.n(n),s=a(22487),i=a.n(s);let l=["json","jsonb"],o=["text","varchar"],c=["timestamp","timestamptz"],d=["date"],u=["time","timetz"],m=i()(c,d,u),p=r()(i()(["int2","int4","int8","float4","float8","numeric","double precision"],l,o,m,["uuid","bool","vector"])),h={varchar:{alternative:"text",reference:"https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_varchar.28n.29_by_default"},json:{alternative:"jsonb",reference:"https://www.postgresql.org/docs/current/datatype-json.html"},timetz:{alternative:"timestamptz",reference:"https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_timetz"},timestamp:{alternative:"timestamptz",reference:"https://wiki.postgresql.org/wiki/Don't_Do_This#Don.27t_use_timestamp_.28without_time_zone.29"}},x=[{name:"int2",description:"Signed two-byte integer",type:"number"},{name:"int4",description:"Signed four-byte integer",type:"number"},{name:"int8",description:"Signed eight-byte integer",type:"number"},{name:"float4",description:"Single precision floating-point number (4 bytes)",type:"number"},{name:"float8",description:"Double precision floating-point number (8 bytes)",type:"number"},{name:"numeric",description:"Exact numeric of selectable precision",type:"number"},{name:"json",description:"Textual JSON data",type:"json"},{name:"jsonb",description:"Binary JSON data, decomposed",type:"json"},{name:"text",description:"Variable-length character string",type:"text"},{name:"varchar",description:"Variable-length character string",type:"text"},{name:"uuid",description:"Universally unique identifier",type:"text"},{name:"date",description:"Calendar date (year, month, day)",type:"time"},{name:"time",description:"Time of day (no time zone)",type:"time"},{name:"timetz",description:"Time of day, including time zone",type:"time"},{name:"timestamp",description:"Date and time (no time zone)",type:"time"},{name:"timestamptz",description:"Date and time, including time zone",type:"time"},{name:"bool",description:"Logical boolean (true/false)",type:"bool"}]},93709:function(e,t,a){var n=a(52322),r=a(4220),s=a(94580);t.Z=e=>{let{searchString:t,onResetFilter:a,className:i}=e;return(0,n.jsxs)("div",{className:(0,r.cn)("bg-surface-100 border border-default px-6 py-4 rounded flex items-center justify-between",i),children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"No results found"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',t,'" did not return any results']})]}),void 0!==a&&(0,n.jsx)(s.z,{type:"default",onClick:()=>a(),children:"Reset filter"})]})}},63550:function(e,t,a){var n=a(52322),r=a(5632),s=a(82042);t.Z=e=>{let{message:t}=e,a=(0,r.useRouter)(),{ref:i}=a.query;return(0,n.jsx)(s.Z,{title:"No public tables found",ctaButtonLabel:"Create a new table",onClickCta:()=>{a.push("/project/".concat(i,"/editor"))},children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:t})})}},86178:function(e,t,a){a.d(t,{R:function(){return useDatabaseFunctionsQuery}});var n=a(58943),r=a(9402),s=a(37982);async function getDatabaseFunctions(e,t){let{projectRef:a,connectionString:n}=e;if(!a)throw Error("projectRef is required");let s=new Headers;n&&s.set("x-connection-encrypted",n);let{data:i,error:l}=await (0,r.U2)("/platform/pg-meta/{ref}/functions",{params:{path:{ref:a}},headers:s,signal:t});if(l)throw l;return i}let useDatabaseFunctionsQuery=function(e){let{projectRef:t,connectionString:a}=e,{enabled:r=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.a)(s.l.list(t),e=>{let{signal:n}=e;return getDatabaseFunctions({projectRef:t,connectionString:a},n)},{enabled:r&&void 0!==t,...i})}},37982:function(e,t,a){a.d(t,{l:function(){return n}});let n={list:e=>["projects",e,"database-functions"]}},86323:function(e,t,a){a.d(t,{z:function(){return useDatabasePublicationsQuery}});var n=a(58943),r=a(9402),s=a(37248);async function getDatabasePublications(e,t){let{projectRef:a,connectionString:n}=e;if(!a)throw Error("projectRef is required");let s=new Headers;n&&s.set("x-connection-encrypted",n);let{data:i,error:l}=await (0,r.U2)("/platform/pg-meta/{ref}/publications",{params:{header:{"x-connection-encrypted":n},path:{ref:a}},headers:s,signal:t});if(l)throw l;return i}let useDatabasePublicationsQuery=function(e){let{projectRef:t,connectionString:a}=e,{enabled:r=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.a)(s.z.list(t),e=>{let{signal:n}=e;return getDatabasePublications({projectRef:t,connectionString:a},n)},{enabled:r&&void 0!==t,...i})}},59600:function(e,t,a){a.d(t,{u:function(){return useDatabasePublicationUpdateMutation}});var n=a(55830),r=a(62350),s=a(62202),i=a(9402),l=a(37248);async function updateDatabasePublication(e){let{projectRef:t,connectionString:a,id:n,tables:r,publish_insert:s,publish_update:l,publish_delete:o,publish_truncate:c}=e,d=new Headers;a&&d.set("x-connection-encrypted",a);let u={id:n};void 0!==r&&(u.tables=r),void 0!==s&&(u.publish_insert=s),void 0!==l&&(u.publish_update=l),void 0!==o&&(u.publish_delete=o),void 0!==c&&(u.publish_truncate=c);let{data:m,error:p}=await (0,i.r$)("/platform/pg-meta/{ref}/publications",{params:{header:{"x-connection-encrypted":a},path:{ref:t},query:{id:n}},body:u,headers:d});if(p)throw p;return m}let useDatabasePublicationUpdateMutation=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,n.NL)();return(0,r.D)(e=>updateDatabasePublication(e),{async onSuccess(t,a,n){let{projectRef:r}=a;await i.invalidateQueries(l.z.list(r)),await (null==e?void 0:e(t,a,n))},async onError(e,a,n){void 0===t?s.Am.error("Failed to update database publication: ".concat(e.message)):t(e,a,n)},...a})}},37248:function(e,t,a){a.d(t,{z:function(){return n}});let n={list:e=>["projects",e,"database-publications"]}},49530:function(e,t,a){a.d(t,{x:function(){return useDatabaseTriggerCreateMutation}});var n=a(55830),r=a(62350),s=a(62202),i=a(3218),l=a(46732),o=a(21562);async function createDatabaseTrigger(e){let{projectRef:t,connectionString:a,payload:n}=e,r=new Headers;a&&r.set("x-connection-encrypted",a);let s=await (0,i.v_)("".concat(l.T5,"/pg-meta/").concat(t,"/triggers"),n,{headers:Object.fromEntries(r)});if(s.error)throw s.error;return s}let useDatabaseTriggerCreateMutation=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,n.NL)();return(0,r.D)(e=>createDatabaseTrigger(e),{async onSuccess(t,a,n){let{projectRef:r}=a;await i.invalidateQueries(o.D.list(r)),await (null==e?void 0:e(t,a,n))},async onError(e,a,n){void 0===t?s.Am.error("Failed to create database trigger: ".concat(e.message)):t(e,a,n)},...a})}},5776:function(e,t,a){a.d(t,{m:function(){return useDatabaseTriggerDeleteMutation}});var n=a(62202),r=a(55830),s=a(62350),i=a(3218),l=a(46732),o=a(21562);async function deleteDatabaseTrigger(e){let{id:t,projectRef:a,connectionString:n}=e,r=new Headers;n&&r.set("x-connection-encrypted",n);let s=await (0,i.$v)("".concat(l.T5,"/pg-meta/").concat(a,"/triggers?id=").concat(t),void 0,{headers:Object.fromEntries(r)});if(null==s?void 0:s.error)throw s.error;return s}let useDatabaseTriggerDeleteMutation=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,r.NL)();return(0,s.D)(e=>deleteDatabaseTrigger(e),{async onSuccess(t,a,n){let{projectRef:r}=a;await i.invalidateQueries(o.D.list(r)),await (null==e?void 0:e(t,a,n))},async onError(e,a,r){void 0===t?n.Am.error("Failed to delete database trigger: ".concat(e.message)):t(e,a,r)},...a})}},21562:function(e,t,a){a.d(t,{D:function(){return n}});let n={list:e=>["projects",e,"database-triggers"],resource:(e,t)=>["projects",e,"resources",t]}},71458:function(e,t,a){a.d(t,{T:function(){return useBackupsQuery}});var n=a(58943),r=a(9402),s=a(41867);async function getBackups(e,t){let{projectRef:a}=e;if(!a)throw Error("Project ref is required");let{data:n,error:s}=await (0,r.U2)("/platform/database/{ref}/backups",{params:{path:{ref:a}},signal:t});if(s)throw s;return n}let useBackupsQuery=function(e){let{projectRef:t}=e,{enabled:a=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.a)(s.A.backups(t),e=>{let{signal:a}=e;return getBackups({projectRef:t},a)},{enabled:a&&void 0!==t,...r})}},13627:function(e,t,a){a.d(t,{H:function(){return n}});let n={list:e=>["projects",e,"pg-sodium-keys"]}},8103:function(e,t,a){a.d(t,{W:function(){return n}});let n={list:e=>["projects",e,"secrets"],getDecryptedValue:(e,t)=>["projects",e,"secrets",t]}},73544:function(e,t,a){a.d(t,{mp:function(){return getDecryptedValue},zQ:function(){return useVaultSecretDecryptedValueQuery}});var n=a(58943),r=a(97035),s=a(70481),i=a(8103);let vaultSecretDecryptedValueQuery=e=>{let t=new r.A().from("decrypted_secrets","vault").select("decrypted_secret").match({id:e}).toSql();return t},getDecryptedValue=async(e,t)=>{let{projectRef:a,connectionString:n,id:r}=e,l=vaultSecretDecryptedValueQuery(r),{result:o}=await (0,s.Rj)({projectRef:a,connectionString:n,sql:l,queryKey:i.W.getDecryptedValue(a,r)},t);return o},useVaultSecretDecryptedValueQuery=function(e){let{projectRef:t,connectionString:a,id:r}=e,{enabled:s,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.a)(i.W.getDecryptedValue(t,r),e=>{let{signal:n}=e;return getDecryptedValue({projectRef:t,connectionString:a,id:r},n)},{select:e=>e[0].decrypted_secret,enabled:s&&void 0!==t,...l})}},14486:function(e,t,a){a.d(t,{f:function(){return useVaultSecretsQuery}});var n=a(97035),r=a(70481),s=a(8103);let getVaultSecretsQuery=()=>{let e=new n.A().from("secrets","vault").select("id,name,description,secret,key_id,created_at,updated_at").toSql();return e},useVaultSecretsQuery=function(e){let{projectRef:t,connectionString:a}=e,{enabled:n,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.cp)({projectRef:t,connectionString:a,sql:getVaultSecretsQuery(),queryKey:s.W.list(t)},{select:e=>e.result,enabled:n&&void 0!==t,...i})}},666:function(e,t,a){a.d(t,{N:function(){return n}});let n={list:e=>["projects",e,"views"],listBySchema:(e,t)=>[...n.list(e),t],view:(e,t)=>[...n.list(e),t]}},96286:function(e,t,a){a.d(t,{Z:function(){return misc_useTable}});var n=a(2755),r=a(5835),s=a(58943),i=a(3218),l=a(46732);async function getForeignTable(e,t){let{id:a,projectRef:n,connectionString:r}=e;if(!n)throw Error("projectRef is required");if(!a)throw Error("id is required");let s=new Headers;r&&s.set("x-connection-encrypted",r);let o=await (0,i.U2)("".concat(l.T5,"/pg-meta/").concat(n,"/foreign-tables?id=").concat(a),{headers:Object.fromEntries(s),signal:t});if("error"in o)throw o.error;return o}let useForeignTableQuery=function(e){let{projectRef:t,connectionString:a,id:n}=e,{enabled:r=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(["projects",t,"foreignTables",n],e=>{let{signal:r}=e;return getForeignTable({projectRef:t,connectionString:a,id:n},r)},{enabled:r&&void 0!==t&&void 0!==n,...i})};async function getMaterializedView(e,t){let{id:a,projectRef:n,connectionString:r}=e;if(!n)throw Error("projectRef is required");if(!a)throw Error("id is required");let s=new Headers;r&&s.set("x-connection-encrypted",r);let o=await (0,i.U2)("".concat(l.T5,"/pg-meta/").concat(n,"/materialized-views?id=").concat(a),{headers:Object.fromEntries(s),signal:t});if("error"in o)throw o.error;return o}let useMaterializedViewQuery=function(e){let{projectRef:t,connectionString:a,id:n}=e,{enabled:r=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(["projects",t,"materializedViews",n],e=>{let{signal:r}=e;return getMaterializedView({projectRef:t,connectionString:a,id:n},r)},{enabled:r&&void 0!==t&&void 0!==n,...i})};var o=a(90948),c=a(666);async function getView(e,t){let{id:a,projectRef:n,connectionString:r}=e;if(!n)throw Error("projectRef is required");if(!a)throw Error("id is required");let s=new Headers;r&&s.set("x-connection-encrypted",r);let o=await (0,i.U2)("".concat(l.T5,"/pg-meta/").concat(n,"/views?id=").concat(a),{headers:Object.fromEntries(s),signal:t});if("error"in o)throw o.error;return o}let useViewQuery=function(e){let{projectRef:t,connectionString:a,id:n}=e,{enabled:r=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(c.N.view(t,n),e=>{let{signal:r}=e;return getView({projectRef:t,connectionString:a,id:n},r)},{enabled:r&&void 0!==t&&void 0!==n,...i})};var d=a(16323),misc_useTable=function(e){let{project:t}=(0,n.d2)(),a=(0,d.Z)(e),s=(0,o.yp)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,id:null==a?void 0:a.id},{enabled:(null==a?void 0:a.type)===r.l.TABLE}),i=useViewQuery({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,id:null==a?void 0:a.id},{enabled:(null==a?void 0:a.type)===r.l.VIEW}),l=useMaterializedViewQuery({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,id:null==a?void 0:a.id},{enabled:(null==a?void 0:a.type)===r.l.MATERIALIZED_VIEW}),c=useForeignTableQuery({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,id:null==a?void 0:a.id},{enabled:(null==a?void 0:a.type)===r.l.FOREIGN_TABLE});switch(null==a?void 0:a.type){case r.l.TABLE:return s;case r.l.VIEW:return i;case r.l.MATERIALIZED_VIEW:return l;case r.l.FOREIGN_TABLE:return c;default:return s}}},27087:function(e,t,a){var n=a(52322);a(2784);var r=a(78046),s=a(97265);t.Z=function(e){return(0,n.jsx)(s.Z,{icon:r.Z,...e})}},68287:function(e,t,a){var n=a(52322);a(2784);var r=a(58951),s=a(97265);t.Z=function(e){return(0,n.jsx)(s.Z,{icon:r.Z,...e})}},29245:function(e,t,a){var n=a(52322);a(2784);var r=a(83178),s=a(97265);t.Z=function(e){return(0,n.jsx)(s.Z,{icon:r.Z,...e})}},364:function(e,t,a){a.d(t,{r:function(){return l}});var n=a(52322),r=a(2784),s=a(90182),i=a(4220);let l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(s.fC,{className:(0,i.cn)("peer inline-flex h-[24px] w-[44px] shrink-0 cursor-pointer items-center rounded-full border transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-brand data-[state=checked]:hover:bg-brand-600/90 data-[state=unchecked]:bg-control data-[state=unchecked]:hover:bg-border",a),...r,ref:t,children:(0,n.jsx)(s.bU,{className:(0,i.cn)("pointer-events-none block h-[18px] w-[18px] rounded-full bg-foreground-lighter data-[state=checked]:bg-white shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-[22px] data-[state=unchecked]:translate-x-[3px]")})})});l.displayName=s.fC.displayName}}]);