"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8271,2894],{80854:function(e,t,n){function getDisplayName(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",{displayName:l,display_name:a,fullName:s,full_name:r,familyName:i,family_name:o,givenName:c,given_name:d,surname:u,lastName:m,last_name:h,firstName:x,first_name:p}=null!==(t=e.raw_user_meta_data)&&void 0!==t?t:{},f=i||o||u||m||h,g=c||d||x||p;return l||a||s||r||g&&f&&"".concat(g," ").concat(f)||n}function getAvatarUrl(e){var t;let{avatarUrl:n,avatarURL:l,avatar_url:a,profileUrl:s,profileURL:r,profile_url:i,profileImage:o,profile_image:c,profileImageUrl:d,profileImageURL:u,profile_image_url:m}=null!==(t=e.raw_user_meta_data)&&void 0!==t?t:{};return n||l||a||o||c||s||r||i||d||u||m}n.d(t,{E:function(){return getAvatarUrl},G:function(){return getDisplayName}})},2894:function(e,t,n){n.d(t,{Q:function(){return RoleImpersonationSelector_RoleImpersonationPopover},G:function(){return RoleImpersonationSelector_RoleImpersonationSelector}});var l=n(52322),a=n(2784),s=n(56469),r=n(94580),i=n(4220),o=n(81395),c=n(30474),d=n(11033),u=n(80854),m=n(97036),h=n(38617);let ServiceRoleIcon=e=>{let{isSelected:t=!1}=e,{resolvedTheme:n}=(0,h.F)();return(0,l.jsx)("svg",{width:"53",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsxs)("g",{opacity:t?"1":".5",children:[(0,l.jsx)("rect",{x:"37.161",y:".53",width:"15",height:"15",rx:"5.5",stroke:"light"===n?"#11181C":"#EDEDED"}),(0,l.jsx)("path",{d:"M1 10.53h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2"}),(0,l.jsx)("rect",{x:"15.964",y:".53",width:"9",height:"15",rx:"4.5",stroke:"light"===n?"#7E868C":"#7E7E7E"}),(0,l.jsx)("path",{d:"M1 5.53h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2"})]})})},AnonIcon=e=>{let{isSelected:t=!1}=e,{resolvedTheme:n}=(0,h.F)();return(0,l.jsx)("svg",{width:"53",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsxs)("g",{opacity:t?"1":".5",children:[(0,l.jsx)("path",{d:"M1 4.994a.5.5 0 0 0 0 1v-1Zm16.218 1h.5v-1h-.5v1ZM1 5.994h1.014v-1H1v1Zm3.04 0h2.028v-1H4.041v1Zm4.056 0h2.027v-1H8.096v1Zm4.054 0h2.027v-1H12.15v1Zm4.055 0h1.013v-1h-1.013v1Z",fill:"light"===n?"#7E868C":"#7E7E7E"}),(0,l.jsx)("path",{d:"m15.92 12.56 9.04-9.04",stroke:"light"===n?"#11181C":"#EDEDED"}),(0,l.jsx)("rect",{x:"15.964",y:".494",width:"9",height:"15",rx:"4.5",stroke:"light"===n?"#11181C":"#EDEDED"}),(0,l.jsx)("rect",{x:"37.161",y:".744",width:"15",height:"15",rx:"5.5",stroke:"light"===n?"#11181C":"#EDEDED"}),(0,l.jsx)("path",{d:"M1 10.494h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2"}),(0,l.jsx)("path",{d:"M15.96 7.562 22.568.956M19.049 14.885l5.957-5.958",stroke:"light"===n?"#11181C":"#EDEDED"})]})})},AuthenticatedIcon=e=>{let{isSelected:t=!1}=e,{resolvedTheme:n}=(0,h.F)();return(0,l.jsx)("svg",{width:"68",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsxs)("g",{opacity:t?"1":".5",children:[(0,l.jsx)("path",{d:"M15.63 5.156a.5.5 0 1 0 0 1v-1Zm16.218 1h.5v-1h-.5v1Zm-16.218 0h1.013v-1H15.63v1Zm3.04 0h2.028v-1h-2.027v1Zm4.055 0h2.028v-1h-2.028v1Zm4.055 0h2.027v-1H26.78v1Zm4.055 0h1.013v-1h-1.013v1Z",fill:"light"===n?"#7E868C":"#7E7E7E"}),(0,l.jsx)("path",{d:"m30.55 12.722 9.04-9.04",stroke:"light"===n?"#11181C":"#EDEDED"}),(0,l.jsx)("rect",{x:"30.594",y:".656",width:"9",height:"15",rx:"4.5",stroke:"light"===n?"#11181C":"#EDEDED"}),(0,l.jsx)("rect",{x:"51.791",y:".906",width:"15",height:"15",rx:"5.5",stroke:"light"===n?"#11181C":"#EDEDED"}),(0,l.jsx)("path",{d:"M15.63 10.656h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2"}),(0,l.jsx)("path",{d:"m30.59 7.724 6.607-6.606M33.679 15.047l5.957-5.958",stroke:"light"===n?"#11181C":"#EDEDED"}),(0,l.jsx)("path",{d:"M12.666 14.281v-1.333A2.667 2.667 0 0 0 10 10.28H6a2.667 2.667 0 0 0-2.667 2.667v1.333M8 7.615A2.667 2.667 0 1 0 8 2.28a2.667 2.667 0 0 0 0 5.334Z",stroke:"light"===n?"#11181C":"#EDEDED",strokeLinecap:"round",strokeLinejoin:"round"})]})})};var x=n(55216),p=n(60537),f=n(97265),IconMinus_IconMinus=function(e){return(0,l.jsx)(f.Z,{icon:p.Z,...e})},RoleImpersonationSelector_RoleImpersonationRadio=function(e){let{label:t,value:n,isSelected:a,onSelectedChange:s,icon:r}=e;return(0,l.jsxs)("label",{className:(0,i.cn)("border border-default rounded-md bg-surface-200 hover:bg-overlay-hover hover:border-control px-4 py-3 w-44 cursor-pointer transition-colors",a&&"border-stronger bg-surface-300"),tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&s(n)},htmlFor:"role-".concat(n),children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[r&&(0,l.jsx)("div",{children:r}),a&&(0,l.jsxs)("div",{className:"flex items-center justify-center p-0.5 bg-foreground text-background rounded-full",children:["boolean"==typeof a&&(0,l.jsx)(x.Z,{size:12,strokeWidth:"4",className:"text-background"}),"partially"===a&&(0,l.jsx)(IconMinus_IconMinus,{size:12,strokeWidth:"4",className:"text-background"})]})]}),(0,l.jsx)("input",{id:"role-".concat(n),type:"radio",name:"role",value:n,checked:!!a,onChange:e=>{s(e.target.value)},className:"invisible h-0 w-0 border-0"}),(0,l.jsxs)("span",{className:(0,i.cn)("text-sm text-foreground-light whitespace-nowrap select-none transition-colors",a&&"text-foreground"),children:[null!=t?t:n," role"]})]})},g=n(53111),v=n(2755),j=n(7503),y=n(48193),b=n(47716),N=n(38880),w=n(88724),S=n(31915),RoleImpersonationSelector_UserImpersonationSelector=()=>{var e,t,n,s;let[i,o]=(0,a.useState)(""),c=(0,g.Nr)(i,300),{project:m}=(0,v.d2)(),{data:h,isSuccess:x,isLoading:p,isError:f,error:C,isFetching:_,isPreviousData:E}=(0,y.xY)({projectRef:null==m?void 0:m.ref,keywords:c||void 0},{keepPreviousData:!0}),R=(0,d.fN)(),k=(null===(e=R.role)||void 0===e?void 0:e.type)==="postgrest"&&"authenticated"===R.role.role&&R.role.user;function impersonateUser(e){R.setRole({type:"postgrest",role:"authenticated",user:e})}return(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsx)("h2",{className:"text-foreground text-base",children:k?"Impersonating ".concat((0,u.G)(k,null!==(s=null!==(n=null!==(t=k.email)&&void 0!==t?t:k.phone)&&void 0!==n?n:k.id)&&void 0!==s?s:"Unknown")):"Impersonate a User"}),(0,l.jsx)("p",{className:"text-sm text-foreground-light max-w-md",children:k?"Results will respect your database's Row-Level Security policies for this user.":"Select a user to respect your database's Row-Level Security policies for that particular user."}),k?(0,l.jsx)(UserImpersonatingRow,{user:k,onClick:function(){R.setRole(void 0)},isImpersonating:!0}):(0,l.jsxs)("div",{className:"flex flex-col gap-2 mt-4",children:[(0,l.jsx)(S.Z,{className:"table-editor-search border-none",icon:E&&_?(0,l.jsx)(b.Z,{className:"animate-spin text-foreground-lighter",size:16,strokeWidth:1.5}):(0,l.jsx)(N.Z,{className:"text-foreground-lighter",size:16,strokeWidth:1.5}),placeholder:"Search for a user..",onChange:e=>o(e.target.value.trim()),value:i,size:"small",actions:i&&(0,l.jsx)(r.z,{size:"tiny",type:"text",className:"px-1",onClick:()=>o(""),children:(0,l.jsx)(w.Z,{size:12,strokeWidth:2})})}),p&&(0,l.jsxs)("div",{className:"flex flex-col gap-2 items-center justify-center h-24",children:[(0,l.jsx)(b.Z,{className:"animate-spin",size:24}),(0,l.jsx)("span",{children:"Loading users..."})]}),f&&(0,l.jsx)(j.Z,{error:C,subject:"Failed to retrieve users"}),x&&(h.users.length>0?(0,l.jsx)("ul",{className:"divide-y max-h-[192px] overflow-y-scroll",role:"list",children:h.users.map(e=>(0,l.jsx)("li",{role:"listitem",children:(0,l.jsx)(UserRow,{user:e,onClick:impersonateUser})},e.id))}):(0,l.jsx)("div",{className:"flex flex-col gap-2 items-center justify-center h-24",children:(0,l.jsx)("p",{className:"text-foreground-light text-xs",role:"status",children:"No users found"})}))]})]})};let UserImpersonatingRow=e=>{var t,n,a;let{user:s,onClick:i,isImpersonating:o=!1}=e,d=(0,u.E)(s),m=(0,u.G)(s,null!==(a=null!==(n=null!==(t=s.email)&&void 0!==t?t:s.phone)&&void 0!==n?n:s.id)&&void 0!==a?a:"Unknown");return(0,l.jsxs)("div",{className:"flex items-center gap-3 py-2 text-foreground",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4 bg-surface-200 pr-5 pl-0.5 py-0.5 border rounded-full max-w-l",children:[d?(0,l.jsx)("img",{className:"rounded-full w-5 h-5",src:d,alt:m}):(0,l.jsx)("div",{className:"rounded-full w-[21px] h-[21px] bg-surface-300 border border-strong flex items-center justify-center",children:(0,l.jsx)(c.Z,{size:12,strokeWidth:2})}),(0,l.jsx)("span",{className:"text-sm truncate",children:m})]}),(0,l.jsx)(r.z,{type:"secondary",onClick:()=>{i(s)},children:o?"Stop Impersonating":"Impersonate"})]})},UserRow=e=>{var t,n,a;let{user:s,onClick:i,isImpersonating:o=!1}=e,d=(0,u.E)(s),m=(0,u.G)(s,null!==(a=null!==(n=null!==(t=s.email)&&void 0!==t?t:s.phone)&&void 0!==n?n:s.id)&&void 0!==a?a:"Unknown");return(0,l.jsxs)("div",{className:"flex items-center justify-between py-2 text-foreground",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[d?(0,l.jsx)("img",{className:"rounded-full w-5 h-5",src:d,alt:m}):(0,l.jsx)("div",{className:"rounded-full w-[21px] h-[21px] bg-surface-300 border text-muted flex items-center justify-center text-background",children:(0,l.jsx)(c.Z,{size:12,strokeWidth:2})}),(0,l.jsx)("span",{className:"text-sm",children:m})]}),(0,l.jsx)(r.z,{type:"secondary",onClick:()=>{i(s)},children:o?"Stop Impersonating":"Impersonate"})]})};var RoleImpersonationSelector_RoleImpersonationSelector=e=>{var t;let{serviceRoleLabel:n,padded:s=!0}=e,r=(0,d.fN)(),[o,c]=(0,a.useState)(()=>{var e;return(null===(e=r.role)||void 0===e?void 0:e.type)==="postgrest"&&("anon"===r.role.role||"authenticated"===r.role.role)?r.role.role:"service_role"}),u=!!("authenticated"===o&&(null===(t=r.role)||void 0===t?void 0:t.type)==="postgrest"&&"authenticated"===r.role.role&&r.role.user);function onSelectedChange(e){"service_role"===e&&r.setRole(void 0),"anon"===e&&r.setRole({type:"postgrest",role:e}),c(e)}return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:(0,i.cn)("flex flex-col gap-3",s?"p-5":"pb-5"),children:[(0,l.jsx)("h2",{className:"text-foreground text-base",children:"Database role settings"}),(0,l.jsx)("form",{onSubmit:e=>{e.preventDefault()},children:(0,l.jsxs)("fieldset",{className:"flex gap-3",children:[(0,l.jsx)(RoleImpersonationSelector_RoleImpersonationRadio,{value:"service_role",isSelected:"service_role"===o,onSelectedChange:onSelectedChange,label:n,icon:(0,l.jsx)(ServiceRoleIcon,{isSelected:"service_role"===o})}),(0,l.jsx)(RoleImpersonationSelector_RoleImpersonationRadio,{value:"anon",isSelected:"anon"===o,onSelectedChange:onSelectedChange,icon:(0,l.jsx)(AnonIcon,{isSelected:"anon"===o})}),(0,l.jsx)(RoleImpersonationSelector_RoleImpersonationRadio,{value:"authenticated",isSelected:"authenticated"===o&&(u||"partially"),onSelectedChange:onSelectedChange,icon:(0,l.jsx)(AuthenticatedIcon,{isSelected:"authenticated"===o})})]})}),"service_role"===o&&(0,l.jsxs)("p",{className:"text-foreground-light text-sm",children:["The default Postgres/superuser role. This has admin privileges.",(0,l.jsx)("br",{}),"It will bypass Row Level Security (RLS) policies."]}),"anon"===o&&(0,l.jsxs)("p",{className:"text-foreground-light text-sm",children:['For "anonymous access". This is the role which the API (PostgREST) will use when a user',(0,l.jsx)("br",{}),"is not logged in. It will respect Row Level Security (RLS) policies."]}),"authenticated"===o&&(0,l.jsxs)("p",{className:"text-foreground-light text-sm",children:['For "authenticated access". This is the role which the API (PostgREST) will use when',(0,l.jsx)("br",{})," a user is logged in. It will respect Row Level Security (RLS) policies."]})]}),"authenticated"===o&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(m.VD,{}),(0,l.jsx)("div",{className:(0,i.cn)("py-5",s&&"px-5"),children:(0,l.jsx)(RoleImpersonationSelector_UserImpersonationSelector,{})})]})]})},RoleImpersonationSelector_RoleImpersonationPopover=e=>{var t,n,c,u;let{serviceRoleLabel:m,variant:h="regular",align:x="end"}=e,p=(0,d.fN)(),[f,g]=(0,a.useState)(!1),v=null!==(u=null!==(c=null===(t=p.role)||void 0===t?void 0:t.role)&&void 0!==c?c:m)&&void 0!==u?u:"service role";return(0,l.jsxs)(s.J2,{open:f,onOpenChange:g,modal:!1,children:[(0,l.jsx)(s.xo,{asChild:!0,children:(0,l.jsx)(r.z,{size:"tiny",type:"default",className:(0,i.cn)("h-[26px] pr-3 gap-0","connected-on-right"===h&&"rounded-r-none border-r-0","connected-on-left"===h&&"rounded-l-none border-l-0","connected-on-both"===h&&"rounded-none border-x-0"),children:(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)("span",{className:"text-foreground-muted",children:"role"}),(0,l.jsx)("span",{children:v}),(null===(n=p.role)||void 0===n?void 0:n.type)==="postgrest"&&"authenticated"===p.role.role&&(0,l.jsx)(UserRoleButtonSection,{user:p.role.user}),(0,l.jsx)(o.Z,{className:"text-muted",strokeWidth:1,size:12})]})})}),(0,l.jsx)(s.yk,{className:"p-0 w-full overflow-hidden bg-overlay",side:"bottom",align:x,children:(0,l.jsx)(RoleImpersonationSelector_RoleImpersonationSelector,{serviceRoleLabel:m})})]})};let UserRoleButtonSection=e=>{var t,n,a;let{user:s}=e,r=(0,u.E)(s),i=(0,u.G)(s,null!==(a=null!==(n=null!==(t=s.email)&&void 0!==t?t:s.phone)&&void 0!==n?n:s.id)&&void 0!==a?a:"Unknown");return(0,l.jsxs)("div",{className:"flex gap-1 items-center pl-0.5 pr-1.5 h-[21px] bg-surface-200 rounded-full overflow-hidden",children:[r?(0,l.jsx)("img",{className:"rounded-full w-[18px] h-[18px]",src:r,alt:i}):(0,l.jsx)("div",{className:"rounded-full w-[18px] h-[18px] bg-surface-100 border flex items-center justify-center text-light",children:(0,l.jsx)(c.Z,{size:12,strokeWidth:2})}),(0,l.jsx)("span",{className:"truncate max-w-[84px]",children:i})]})}},48271:function(e,t,n){n.d(t,{ub:function(){return TableGridEditor_EmptyState},l5:function(){return TableGridEditor_SidePanelEditor},ZP:function(){return tM}});var l=n(52322),a=n(59491),s=n(55830),r=n(60674),i=n(55281),o=n.n(i),c=n(84336),d=n.n(c),u=n(46776),m=n(5632),h=n(90507),x=n(25076),p=n(2755),f=n(67950),g=n(17277),v=n(79312),j=n(11781),y=n(5835),b=n(74596),N=n(62350),w=n(62202),S=n(70481),C=n(74915),_=n(11033);async function updateTableRow(e){let{projectRef:t,connectionString:n,table:l,payload:a,configuration:s,enumArrayColumns:r,returning:i,impersonatedRole:o}=e,c=(0,C.Jh)(function(e){var t;let{table:n,configuration:l,payload:a,returning:s=!1,enumArrayColumns:r}=e;return new h.AE().from(n.name,null!==(t=n.schema)&&void 0!==t?t:void 0).update(a,{returning:s,enumArrayColumns:r}).match(l.identifiers).toSql()}({table:l,configuration:s,payload:a,enumArrayColumns:r,returning:i}),{projectRef:t,role:o}),{result:d}=await (0,S.Rj)({projectRef:t,connectionString:n,sql:c,isRoleImpersonationEnabled:(0,_.Gm)(o)});return d}let useTableRowUpdateMutation=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,s.NL)();return(0,N.D)(e=>updateTableRow(e),{async onSuccess(t,n,a){let{projectRef:s,table:r}=n;await l.invalidateQueries(b.M.query(s,[r.schema,r.name])),await (null==e?void 0:e(t,n,a))},async onError(e,n,l){void 0===t?w.Am.error("Failed to update table row: ".concat(e.message)):t(e,n,l)},...n})};var E=n(89465),R=n(16323),k=n(99033),Z=n(47095),T=n(44389),P=n(2894),D=n(24990),F=n(99354),I=n(39097),A=n.n(I),O=n(2784),L=n(94580),z=n(96143),U=n(39195),K=n(1681),V=n(22404),W=n(98050),M=n(97632),q=n(86323),H=n(59600),TableGridEditor_GridHeaderActions=e=>{var t;let{table:n}=e,{ref:s}=(0,r.UO)(),{project:i}=(0,p.d2)(),o=(0,E.N3)("realtime:all"),[c,d]=(0,O.useState)(!1),u=null==i?void 0:i.ref,{data:m}=(0,M.r)({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString}),h=(null!=m?m:[]).filter(e=>e.schema===n.schema&&e.table===n.name),{data:f}=(0,q.z)({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString}),g=(null!=f?f:[]).find(e=>"supabase_realtime"===e.name),v=null!==(t=null==g?void 0:g.tables)&&void 0!==t?t:[],j=v.some(e=>e.id===(null==n?void 0:n.id)),{mutate:y,isLoading:b}=(0,H.u)({onSuccess:()=>{d(!1)},onError:e=>{w.ZP.error("Failed to toggle realtime for ".concat(n.name,": ").concat(e.message))}}),N=(0,E.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"tables"),S=(0,E.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"columns"),C="public"===n.schema,_=(0,x.Z6)(n.id.toString()),R=(0,O.useRef)(new BroadcastChannel(_)),[k,Z]=(0,O.useState)(!n.rls_enabled&&"true"===localStorage.getItem(_));(0,O.useEffect)(()=>(R.current&&R.current.close(),R.current=new BroadcastChannel(_),R.current.onmessage=e=>{"dismiss"===e.data.type&&Z(!0)},()=>R.current.close()),[_]);let toggleRealtime=async()=>{if(!i)return console.error("Project is required");if(!g)return console.error("Unable to find realtime publication");let e=v.some(e=>e.id==n.id),t=e?v.filter(e=>e.id!=n.id).map(e=>"".concat(e.schema,".").concat(e.name)):["".concat(n.schema,".").concat(n.name)].concat(v.map(e=>"".concat(e.schema,".").concat(e.name)));y({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString,id:g.id,tables:t})};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[!N&&!S&&(0,l.jsxs)(D.fC,{delayDuration:0,children:[(0,l.jsx)(D.xz,{className:"w-full",children:(0,l.jsx)("div",{className:"border border-strong rounded bg-overlay-hover px-3 py-1 text-xs",children:"Viewing as read-only"})}),(0,l.jsx)(D.h_,{children:(0,l.jsxs)(D.VY,{side:"bottom",children:[(0,l.jsx)(D.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,l.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to manage your project's data"})})]})})]}),(n.rls_enabled||k)&&(0,l.jsx)(L.z,{asChild:!0,type:n.rls_enabled?"link":"warning",icon:n.rls_enabled?(0,l.jsx)(z.Z,{strokeWidth:2,size:14}):(0,l.jsx)(U.Z,{strokeWidth:2,size:14}),children:(0,l.jsx)(A(),{href:"/project/".concat(u,"/auth/policies?search=").concat(n.id),children:n.rls_enabled?"".concat(0==h.length?"No":h.length," active RLS polic").concat(h.length>1||0==h.length?"ies":"y"):"RLS is not enabled"})}),(0,l.jsx)(P.Q,{serviceRoleLabel:"postgres"}),o&&(0,l.jsxs)(L.z,{type:"default",icon:(0,l.jsx)(F.Z,{size:14,className:j?"text-brand":"text-lighter"}),onClick:()=>d(!0),children:["Realtime ",j?"on":"off"]}),C&&(0,l.jsx)("div",{className:"mt-[1px]",children:(0,l.jsx)(V.Z,{section:["entities",n.name]})})]}),(0,l.jsx)(W.Z,{visible:c,loading:b,header:"".concat(j?"Disable":"Enable"," realtime for ").concat(n.name),buttonLabel:"".concat(j?"Disable":"Enable"," realtime"),buttonLoadingLabel:"".concat(j?"Disabling":"Enabling"," realtime"),onSelectCancel:()=>d(!1),onSelectConfirm:()=>toggleRealtime(),children:(0,l.jsxs)(K.C.Content,{className:"py-4 space-y-2",children:[(0,l.jsxs)("p",{className:"text-sm",children:["Once realtime has been ",j?"disabled":"enabled",", the table will"," ",j?"no longer ":"","broadcast any changes to authorized subscribers."]}),!j&&(0,l.jsxs)("p",{className:"text-sm",children:["You may also select which events to broadcast to subscribers on the"," ",(0,l.jsx)(A(),{href:"/project/".concat(s,"/database/replication"),className:"text-brand",children:"database replication"})," ","settings."]})]})})]})},Y=n(61356),TableGridEditor_NotFoundState=e=>{let{id:t}=e;return(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsx)("div",{className:"w-[400px]",children:(0,l.jsx)(Y.Z,{icon:(0,l.jsx)(U.Z,{strokeWidth:2}),title:"Unable to find your table with ID ".concat(t)})})})},Q=n(45455),B=n.n(Q),J=n(34291),G=n.n(J),X=n(27924);async function createTableRow(e){let{projectRef:t,connectionString:n,table:l,payload:a,enumArrayColumns:s,returning:r,impersonatedRole:i}=e,o=(0,C.Jh)(function(e){var t;let{table:n,payload:l,returning:a=!1,enumArrayColumns:s}=e;return new h.AE().from(n.name,null!==(t=n.schema)&&void 0!==t?t:void 0).insert([l],{returning:a,enumArrayColumns:s}).toSql()}({table:l,payload:a,enumArrayColumns:s,returning:r}),{projectRef:t,role:i}),{result:c}=await (0,S.Rj)({projectRef:t,connectionString:n,sql:o,isRoleImpersonationEnabled:(0,_.Gm)(i)});return c}let useTableRowCreateMutation=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,s.NL)();return(0,N.D)(e=>createTableRow(e),{async onSuccess(t,n,a){let{projectRef:s,table:r}=n;await l.invalidateQueries(b.M.query(s,[r.schema,r.name])),await (null==e?void 0:e(t,n,a))},async onError(e,n,l){void 0===t?w.Am.error(e.message):t(e,n,l)},...n})};var $=n(33039),ee=n(28846),et=n(52797),en=n(66768),el=n(13781),ea=n(99902),es=n(60471),er=n(3889),ei=n(17833),eo=n(48256),ec=n(90948),ed=n(11539),eu=n(9402);async function getViews(e,t){let{projectRef:n,connectionString:l,schema:a}=e;if(!n)throw Error("projectRef is required");let s=new Headers;l&&s.set("x-connection-encrypted",l);let{data:r,error:i}=await (0,eu.U2)("/platform/pg-meta/{ref}/views",{params:{header:{"x-connection-encrypted":l},path:{ref:n},query:{included_schemas:a||""}},headers:s,signal:t});if(i)throw i;return r}n(666);let listEncryptedColumns=async(e,t,n)=>{if(!n)return[];let l=await getViews({projectRef:e.projectRef,connectionString:e.connectionString,schema:t}),a=l.find(e=>e.name==="decrypted_".concat(n));if(!a)return[];let s=await e.query("SELECT column_name as name FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'decrypted_".concat(n,"' and column_name like 'decrypted_%'"));return s.error?(console.error("Error fetching encrypted columns",s.error),[]):s.map(e=>e.name.split("decrypted_")[1])};function useEncryptedColumns(e){let{schemaName:t,tableName:n}=e,{meta:l}=(0,E.oR)(),[a,s]=(0,O.useState)([]);return(0,O.useEffect)(()=>{let e=!0,getEncryptedColumns=async()=>{if(void 0!==t&&void 0!==n){let a=await listEncryptedColumns(l,t,n);e&&s(a)}};return getEncryptedColumns(),()=>{e=!1}},[t,n]),a}var em=n(35500),eh=n(83150),ForeignRowSelector_Pagination=e=>{let{page:t,setPage:n,rowsPerPage:a,currentPageRowsCount:s=0,isLoading:r=!1}=e;return(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[r&&(0,l.jsx)(el.Z,{size:14,className:"animate-spin"}),(0,l.jsx)(L.z,{icon:(0,l.jsx)(em.Z,{}),type:"outline",disabled:t<=1||r,onClick:()=>{n(e=>e-1)},title:"Previous Page",style:{padding:"3px 10px"}}),(0,l.jsx)(L.z,{icon:(0,l.jsx)(eh.Z,{}),type:"outline",disabled:s<a||r,onClick:()=>{n(e=>e+1)},title:"Next Page",style:{padding:"3px 10px"}})]})},ex=n(33181),ep=n(47370),ef=n(41154);let columnRender=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,l.jsxs)("div",{className:"flex h-full items-center justify-center gap-2",children:[t&&(0,l.jsxs)(D.fC,{delayDuration:0,children:[(0,l.jsx)(D.xz,{children:(0,l.jsx)("div",{className:"text-brand",children:(0,l.jsx)(ef.Z,{size:"tiny",strokeWidth:2})})}),(0,l.jsx)(D.h_,{children:(0,l.jsxs)(D.VY,{side:"bottom",children:[(0,l.jsx)(D.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,l.jsx)("span",{className:"text-xs text-foreground",children:"Primary key"})})]})})]}),(0,l.jsx)("span",{className:"sb-grid-column-header__inner__name",children:e})]})},formatter=(e,t)=>{let n="object"==typeof t[e]?JSON.stringify(t[e]):t[e];return(0,l.jsx)("div",{className:"group sb-grid-select-cell__formatter overflow-hidden",children:(0,l.jsx)("span",{className:"text-sm truncate",children:n})})};var ForeignRowSelector_SelectorGrid=e=>{let{table:t,rows:n,onRowSelect:a}=e,s=t.columns.map(e=>{let t=(0,ex.ve)(e),n=(e.name.length+e.format.length)*ex.i1,l={key:e.name,name:e.name,renderCell:t=>formatter(e.name,t.row),renderHeaderCell:()=>columnRender(e.name,e.isPrimaryKey),resizable:!0,width:t<n?n:t,minWidth:x.mr};return l});return(0,l.jsx)(ep.ZP,{columns:s,rows:n,style:{height:"100%"},onCellClick:e=>a(e.row),rowClass:()=>"cursor-pointer"})},ForeignRowSelector_ForeignRowSelector=e=>{var t,n,a,s,r,i;let{visible:o,foreignKey:c,onSelect:d,closePanel:u}=e,{project:m}=(0,p.d2)(),{target_id:x,target_schema:f,target_table:g,target_columns:v}=null!=c?c:{},j=x?Number(x):void 0,{data:y}=(0,ec.yp)({projectRef:null==m?void 0:m.ref,connectionString:null==m?void 0:m.connectionString,id:j}),b=useEncryptedColumns({schemaName:f,tableName:g}),N=y&&(0,h.NK)({table:y,columns:null!==(t=y.columns)&&void 0!==t?t:[],primaryKeys:y.primary_keys,relationships:y.relationships},b),[w,S]=(0,O.useState)({filter:[],sort:[]}),C=(0,ea.rg)(null!==(n=w.sort)&&void 0!==n?n:[]),E=(0,ea.Yb)(null!==(a=w.filter)&&void 0!==a?a:[]),[R,k]=(0,O.useState)(1),Z=(0,_.fN)(),{data:T,isLoading:P,isSuccess:D,isError:F,isRefetching:I}=(0,eo.KK)({queryKey:[f,g],projectRef:null==m?void 0:m.ref,connectionString:null==m?void 0:m.connectionString,table:N,sorts:C,filters:E,page:R,limit:100,impersonatedRole:Z.role},{keepPreviousData:!0});return(0,l.jsx)(en.ZP,{visible:o,size:"large",header:(0,l.jsxs)("div",{children:["Select a record to reference from"," ",(0,l.jsxs)("code",{className:"font-mono text-sm",children:[f,".",g]})]}),onCancel:u,customFooter:(0,l.jsx)(ed.Z,{hideApply:!0,backButtonLabel:"Cancel",closePanel:u}),children:(0,l.jsx)(en.ZP.Content,{className:"h-full !px-0",children:(0,l.jsxs)("div",{className:"h-full",children:[P&&(0,l.jsxs)("div",{className:"flex h-full py-6 flex-col items-center justify-center space-y-2",children:[(0,l.jsx)(el.Z,{className:"animate-spin"}),(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"Loading rows"})]}),F&&(0,l.jsx)("div",{className:"flex h-full py-6 flex-col items-center justify-center",children:(0,l.jsxs)("p",{className:"text-sm text-foreground-light",children:["Unable to load rows from"," ",(0,l.jsxs)("code",{children:[f,".",g]}),". Please try again or contact support."]})}),D&&N&&(0,l.jsxs)("div",{className:"h-full flex flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between my-2 mx-3",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(es.Z,{table:N,isRefetching:I}),(0,l.jsx)(er.Z,{table:N,filters:null!==(s=w.filter)&&void 0!==s?s:[],setParams:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];R>1&&k(1),S(...t)}}),(0,l.jsx)(ee.W,{backend:et.PD,context:window,children:(0,l.jsx)(ei.Z,{table:N,sorts:null!==(r=w.sort)&&void 0!==r?r:[],setParams:S})})]}),(0,l.jsx)(ForeignRowSelector_Pagination,{page:R,setPage:k,rowsPerPage:100,currentPageRowsCount:null!==(i=null==T?void 0:T.rows.length)&&void 0!==i?i:0,isLoading:I})]}),T.rows.length>0?(0,l.jsx)(ForeignRowSelector_SelectorGrid,{table:N,rows:T.rows,onRowSelect:e=>d(e[null!=v?v:""])}):(0,l.jsx)("div",{className:"flex h-full items-center justify-center border-b border-t border-default",children:(0,l.jsx)("span",{className:"text-foreground-light text-sm",children:"No Rows Found"})})]})]})})})},eg=n(83359),ev=n(71813),ej=n(56974),ey=n.n(ej),eb=n(64475),eN=n(79569),DrilldownViewer_DrilldownBreadCrumbs=e=>{let{breadcrumbs:t=[],resetBreadcrumbs:n,onSelectBreadcrumb:a}=e;return(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(eb.Z,{size:16,strokeWidth:2,onClick:()=>n(),className:"cursor-pointer"}),t.length>0&&t.map(e=>(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(eN.Z,{size:16,strokeWidth:2}),e===ey()(t)?(0,l.jsx)("p",{className:"font-mono text-xs",children:e}):(0,l.jsx)("p",{className:"font-mono text-xs",children:(0,l.jsx)("div",{className:"cursor-pointer",onClick:()=>a(t.slice(0,t.indexOf(e)+1)),children:e})})]},e))]})},ew=n(25877),eS=n.n(ew),DrilldownViewer_DrilldownPane=e=>{let{pane:t,jsonData:n,activeKey:a,onSelectKey:s=G()}=e;if(!n)return(0,l.jsx)("div",{className:"flex-1 ".concat(2===t?"border-l border-default":""),children:(0,l.jsx)("div",{className:"flex space-x-2 py-2 px-5",children:(0,l.jsx)("p",{className:"text-sm",children:"Invalid JSON"})})});if(0===Object.keys(n).length)return(0,l.jsx)("div",{className:"max-w-[50%] flex-1 ".concat(2===t?"border-l border-default":""),children:(0,l.jsx)("div",{className:"flex space-x-2 py-2 px-5",children:(0,l.jsx)("p",{className:"text-sm opacity-50",children:"No data available"})})});let r=Object.keys(n).filter(e=>"object"==typeof n[e]&&!eS()(n[e])),i=Object.keys(n).filter(e=>eS()(n[e])||"object"!=typeof n[e]);return(0,l.jsxs)("div",{className:"max-w-[50%] flex-1 ".concat(2===t?"border-l border-default":""),children:[r.map(e=>(0,l.jsxs)("div",{className:"\n              ".concat(e===a?"bg-surface-300":"","\n              group flex cursor-pointer items-center transition\n              justify-between py-2 px-5 hover:bg-surface-200\n            "),onClick:()=>s(e,t),children:[(0,l.jsx)("p",{className:"font-mono text-xs !text-blue-900",children:e}),(0,l.jsx)("div",{className:"".concat(e===a?"opacity-100":"opacity-50"," group-hover:opacity-100 transition"),children:(0,l.jsx)(eN.Z,{strokeWidth:2,size:16})})]},e)),i.map(e=>(0,l.jsxs)("div",{className:"flex space-x-2 py-2 px-5",children:[(0,l.jsxs)("p",{className:"font-mono text-xs !text-blue-900",children:[e,":"]}),(0,l.jsx)("p",{className:"break-all font-mono text-xs ".concat("string"!=typeof n[e]?"!text-green-900":"!text-yellow-900"),children:eS()(n[e])?"null":"string"==typeof n[e]?'"'.concat(n[e],'"'):n[e].toString()})]},e))]})},JsonEditor_DrilldownViewer=e=>{let{jsonData:t={}}=e,[n,a]=(0,O.useState)(),[s,r]=(0,O.useState)([]),[i,o]=(0,O.useState)(t),[c,d]=(0,O.useState)({}),selectKey=(e,t)=>{a(e);let n=s.slice();1===t&&(d(i[e]),B()(c)||n.pop(),n.push(e),r(n)),2===t&&(o(c),d(c[e]),n.push(e),r(n))};return(0,l.jsxs)("div",{className:"border border-x-0 border-t-0 border-gray-500",children:[(0,l.jsx)("div",{className:"h-10 px-3 flex-initial flex items-center justify-between",children:(0,l.jsx)(DrilldownViewer_DrilldownBreadCrumbs,{breadcrumbs:s,onSelectBreadcrumb:e=>{let n=ey()(e)||"";a(n);let l={...t},i=s.slice(0,s.indexOf(n)+1);if(r(i),null===e)o(l),d({});else if(1===e.length)o(l),d(t[s[0]]);else{for(let t of e)l=l[t],e.indexOf(t)===e.length-2&&o(l);d(l)}},resetBreadcrumbs:()=>{a(void 0),r([]),o(t),d({})}})}),(0,l.jsxs)("div",{className:"flex items-stretch flex-auto justify-between border-t border-gray-500",children:[(0,l.jsx)(DrilldownViewer_DrilldownPane,{pane:1,jsonData:i,onSelectKey:selectKey,activeKey:n}),(0,l.jsx)(DrilldownViewer_DrilldownPane,{pane:2,jsonData:c,onSelectKey:selectKey})]})]})},eC=n(79534),JsonCodeEditor=e=>{let{value:t="",readOnly:n=!1,onInputChange:a=G()}=e;return(0,l.jsx)(eC.default,{className:"monaco-editor",theme:"supabase",defaultLanguage:"json",value:t,loading:(0,l.jsx)(()=>(0,l.jsx)("h4",{children:"Loading"}),{}),options:{readOnly:n,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0,lineNumbersMinChars:4},onMount:e=>{e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})})},onChange:a})},JsonEditor_JsonEditor=e=>{let{column:t,jsonString:n,visible:a,backButtonLabel:s,applyButtonLabel:r,readOnly:i=!1,closePanel:o,onSaveJSON:c}=e,{ui:d}=(0,E.oR)(),[u,m]=(0,O.useState)("edit"),[h,x]=(0,O.useState)("");(0,O.useEffect)(()=>{if(a){let e=(0,ev.ZO)(n);x(e)}},[a]);let validateJSON=async e=>{try{let e=(0,ev.jn)(h);c&&c(e)}catch(t){let e=t.message?"Error: ".concat(t.message):"JSON seems to have an invalid structure.";d.setNotification({category:"error",message:e,duration:4e3})}finally{e()}};return(0,l.jsx)(en.ZP,{size:"large",header:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:["edit"===u?(0,l.jsxs)("p",{children:[i?"Viewing":"Editing"," JSON Field: ",(0,l.jsx)("code",{children:t})]}):(0,l.jsxs)("p",{children:["Viewing JSON Field: ",(0,l.jsx)("code",{children:t})]}),(0,l.jsxs)("div",{className:"flex items-center gap-x-2",children:["edit"===u&&(0,l.jsxs)(D.fC,{delayDuration:0,children:[(0,l.jsx)(D.xz,{asChild:!0,children:(0,l.jsx)(L.z,{type:"default",icon:(0,l.jsx)(eg.Z,{}),className:"px-1",onClick:()=>(function(){let e=(0,ev.ZO)(h);x(e)})()})}),(0,l.jsx)(D.h_,{children:(0,l.jsxs)(D.VY,{side:"bottom",children:[(0,l.jsx)(D.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,l.jsx)("span",{className:"text-xs text-foreground",children:"Prettify JSON"})})]})})]}),(0,l.jsx)(g.Z,{options:["view","edit"],activeOption:u,borderOverride:"border-gray-500",onClickOption:function(e){m(e)}})]})]}),visible:a,onCancel:o,customFooter:(0,l.jsx)(ed.Z,{hideApply:i,closePanel:o,backButtonLabel:s,applyButtonLabel:r,applyFunction:i?void 0:validateJSON}),children:(0,l.jsx)("div",{className:"flex flex-auto h-full flex-col space-y-4",children:"edit"===u?(0,l.jsx)("div",{className:"w-full h-full flex-grow",children:(0,l.jsx)(JsonCodeEditor,{readOnly:i,onInputChange:function(e){x(null!=e?e:"")},value:h.toString()},n)}):(0,l.jsx)(JsonEditor_DrilldownViewer,{jsonData:(0,ev.dW)(h)})})})},e_=n(31915),eE=n(41867);async function createSchema(e){let{name:t,projectRef:n,connectionString:l}=e;if(!n)throw Error("projectRef is required");if(!l)throw Error("Connection string is required");let a=new Headers;a.set("x-connection-encrypted",l);let{data:s,error:r}=await (0,eu.v_)("/platform/pg-meta/{ref}/schemas",{params:{header:{"x-connection-encrypted":l},path:{ref:n}},body:{name:t,owner:"postgres"},headers:Object.fromEntries(a)});if(r)throw r;return s}let useSchemaCreateMutation=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,s.NL)();return(0,N.D)(e=>createSchema(e),{async onSuccess(t,n,a){let{projectRef:s}=n;await l.invalidateQueries(eE.A.schemaList(s)),await (null==e?void 0:e(t,n,a))},async onError(e,n,l){void 0===t?w.Am.error("Failed to create schema: ".concat(e.message)):t(e,n,l)},...n})};var SidePanelEditor_SchemaEditor=e=>{let{visible:t,closePanel:n,saveChanges:a}=e,{project:s}=(0,p.d2)(),[r,i]=(0,O.useState)({name:void 0}),[o,c]=(0,O.useState)(""),{mutate:d}=useSchemaCreateMutation();(0,O.useEffect)(()=>{t&&(c(""),i({name:void 0}))},[t]);let onSaveChanges=e=>{let t={};return(0===o.length&&(t.name="Please provide a name for your schema"),Object.keys(t).length>0)?(e(),i(t)):void 0===s?console.error("Project is required"):void d({projectRef:s.ref,connectionString:s.connectionString,name:o},{onSuccess:()=>{e(),n(),w.ZP.success('Successfully created schema "'.concat(o,'"'))}})};return(0,l.jsx)(en.ZP,{size:"large",visible:t,header:"Create a new schema",className:"transition-all duration-100 ease-in",onCancel:n,onConfirm:()=>e=>onSaveChanges(e),customFooter:(0,l.jsx)(ed.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:n,applyFunction:e=>onSaveChanges(e)}),children:(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(en.ZP.Content,{children:(0,l.jsx)("div",{className:"space-y-10 py-6",children:(0,l.jsx)(e_.Z,{label:"Name",layout:"horizontal",type:"text",error:null==r?void 0:r.name,value:o,onChange:e=>c(e.target.value)})})})})},"SchemaEditor")},eR=n(37248);async function createDatabasePublication(e){let{projectRef:t,connectionString:n,name:l,tables:a=[],publish_insert:s=!1,publish_update:r=!1,publish_delete:i=!1,publish_truncate:o=!1}=e,c=new Headers;n&&c.set("x-connection-encrypted",n);let{data:d,error:u}=await (0,eu.v_)("/platform/pg-meta/{ref}/publications",{params:{header:{"x-connection-encrypted":n},path:{ref:t}},body:{name:l,tables:a,publish_insert:s,publish_update:r,publish_delete:i,publish_truncate:o},headers:c});if(u)throw u;return d}let useDatabasePublicationCreateMutation=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,s.NL)();return(0,N.D)(e=>createDatabasePublication(e),{async onSuccess(t,n,a){let{projectRef:s}=n;await l.invalidateQueries(eR.z.list(s)),await (null==e?void 0:e(t,n,a))},async onError(e,n,l){void 0===t?w.Am.error("Failed to create database publication: ".concat(e.message)):t(e,n,l)},...n})};var ek=n(93969),eZ=n(96795),eT=n.n(eZ),RowEditor_HeaderTitle=e=>{let{isNewRecord:t,tableName:n}=e,a="".concat(t?"Add new":"Update"," row ").concat(t?"to":"from"," ");return(0,l.jsxs)(l.Fragment,{children:[a,n&&(0,l.jsx)("span",{className:"text-code font-mono",children:n})]})},eP=n(11886),eD=n.n(eP),eF=n(39381),eI=n(92508),eA=n(1191),eO=n(60240),eL=n(75685),ez=n(28879),eU=n.n(ez),RowEditor_DateTimeInput=e=>{let{value:t,onChange:n,name:a,format:s,description:r}=e,i=function(e){return eL.lb.indexOf(e.toLowerCase())>-1?"date":eL.XO.indexOf(e.toLowerCase())>-1?"time":eL.Ks.indexOf(e.toLowerCase())>-1?"datetime-local":"text"}(s);return(0,l.jsx)(e_.Z,{layout:"horizontal",className:"w-full",label:a,descriptionText:(0,l.jsxs)("div",{className:"space-y-1",children:[r,s.includes("tz")&&(0,l.jsxs)("p",{children:["Your local timezone will be automatically applied (",eU()().format("ZZ"),")"]})]}),labelOptional:s,size:"small",value:t,type:i,onChange:function(e){let t=e.target.value;(0!==t.length||""===t)&&n(t)},step:"datetime-local"==i||"time"==i?"1":void 0})},RowEditor_InputField=e=>{var t,n,a,s,r,i,o,c;let{field:d,errors:u,isEditable:m=!0,onUpdateField:h=G(),onEditJson:x=G(),onSelectForeignKey:p=G()}=e;if(d.enums.length>0){let e="_"===d.format[0];return e?(0,l.jsx)("div",{className:"text-area-text-sm",children:(0,l.jsx)(e_.Z.TextArea,{layout:"horizontal",label:d.name,className:"text-sm",descriptionText:d.comment,labelOptional:d.format,disabled:!m,error:u[d.name],rows:5,value:null!==(t=d.value)&&void 0!==t?t:"",placeholder:null===d.defaultValue?"":"string"==typeof d.defaultValue&&0===d.defaultValue.length?"EMPTY":"Default: ".concat(d.defaultValue),onChange:e=>h({[d.name]:e.target.value})})}):(0,l.jsxs)(eF.ZP,{size:"medium",layout:"horizontal",value:null!==(n=d.value)&&void 0!==n?n:"",label:d.name,labelOptional:d.format,descriptionText:d.comment,disabled:!m,error:u[d.name],onChange:e=>h({[d.name]:e.target.value}),children:[(0,l.jsx)(eF.ZP.Option,{value:"",children:"---"}),d.enums.map(e=>(0,l.jsx)(eF.ZP.Option,{value:e,children:e},e))]})}if(void 0!==d.foreignKey)return(0,l.jsx)(e_.Z,{layout:"horizontal",label:d.name,value:null!==(a=d.value)&&void 0!==a?a:"",descriptionText:(0,l.jsxs)(l.Fragment,{children:[d.comment&&(0,l.jsxs)("span",{className:"text-sm text-foreground-lighter",children:[d.comment," "]}),(0,l.jsxs)("span",{className:"text-sm text-foreground-lighter",children:[d.comment&&"(","Has a foreign key relation to"]}),(0,l.jsxs)("span",{className:"text-code font-mono text-xs text-foreground-lighter",children:[d.foreignKey.target_table_schema,".",d.foreignKey.target_table_name,".",d.foreignKey.target_column_name]}),d.comment&&(0,l.jsx)("span",{className:"text-sm text-foreground-lighter",children:")"})]}),labelOptional:d.format,disabled:!m,error:u[d.name],onChange:e=>h({[d.name]:e.target.value}),actions:(0,l.jsx)(L.z,{type:"default",className:"mr-1",htmlType:"button",onClick:p,icon:(0,l.jsx)(eI.Z,{}),children:"Select record"})});if(eD()(eL.BB,d.format))return(0,l.jsx)("div",{className:"text-area-text-sm",children:(0,l.jsx)(e_.Z.TextArea,{layout:"horizontal",label:d.name,className:"text-sm",descriptionText:d.comment,labelOptional:d.format,disabled:!m,error:u[d.name],rows:5,value:null!==(s=d.value)&&void 0!==s?s:"",placeholder:null===d.value&&null===d.defaultValue?"NULL":""===d.value?"EMPTY":"string"==typeof d.defaultValue&&0===d.defaultValue.length?"EMPTY":"NULL (Default: ".concat(d.defaultValue,")"),actions:(0,l.jsx)("div",{className:"mr-1 mt-0.5",children:(d.isNullable||!d.isNullable&&d.defaultValue)&&(0,l.jsx)(L.z,{type:"default",size:"tiny",onClick:()=>h({[d.name]:null}),children:"Set to NULL"})}),onChange:e=>h({[d.name]:e.target.value})})});if(eD()(eL.YF,d.format))return(0,l.jsx)(e_.Z,{layout:"horizontal",value:null!==(r=d.value)&&void 0!==r?r:"",label:d.name,descriptionText:d.comment,labelOptional:d.format,disabled:!m,placeholder:null!==(i=null==d?void 0:d.defaultValue)&&void 0!==i?i:"NULL",error:u[d.name],onChange:e=>h({[d.name]:e.target.value}),actions:(0,l.jsx)(L.z,{type:"default",htmlType:"button",onClick:()=>x({column:d.name,jsonString:d.value}),icon:(0,l.jsx)(eA.Z,{}),children:"Edit JSON"})});if(eD()(eL.nA,d.format))return(0,l.jsx)(RowEditor_DateTimeInput,{name:d.name,format:d.format,value:null!==(o=d.value)&&void 0!==o?o:"",description:(0,l.jsxs)(l.Fragment,{children:[d.defaultValue&&(0,l.jsxs)("p",{children:["Default: ",d.defaultValue]}),d.comment&&(0,l.jsx)("p",{children:d.comment})]}),onChange:e=>h({[d.name]:e})});if("bool"===d.format){let e=[{value:"true",label:"TRUE"},{value:"false",label:"FALSE"},...d.isNullable?[{value:"null",label:"NULL"}]:[]],t="null"===d.value?d.defaultValue:d.value;return(0,l.jsx)(eO.Z,{size:"small",layout:"horizontal",name:d.name,label:d.name,labelOptional:d.format,descriptionText:d.comment,value:null===t?"null":t,onChange:e=>{"null"===e?h({[d.name]:null}):h({[d.name]:e})},children:e.map(e=>(0,l.jsx)(eO.Z.Option,{id:e.value,label:e.label,value:e.value,children:e.label},e.value))})}return(0,l.jsx)(e_.Z,{layout:"horizontal",label:d.name,descriptionText:d.comment,labelOptional:d.format,error:u[d.name],value:null!==(c=d.value)&&void 0!==c?c:"",placeholder:d.isIdentity?"Automatically generated as identity":null!==d.defaultValue?"Default: ".concat(d.defaultValue):"NULL",disabled:!m,onChange:e=>h({[d.name]:e.target.value})})},eK=n(60417),eV=n.n(eK),eW=n(18149),eM=n.n(eW),eq=n(85505),eH=n.n(eq),eY=n(99686),eQ=n.n(eY);let generateRowFields=(e,t)=>{let{relationships:n,primary_keys:l}=t,a=l.map(e=>e.name);return t.columns.map(t=>{let l=d()(e)&&eL.BB.includes(t.format)?null:d()(e)&&"bool"===t.format&&!t.is_nullable?t.default_value:d()(e)&&"bool"===t.format&&t.is_nullable?"null":d()(e)?"":eL.nA.includes(t.format)?convertPostgresDatetimeToInputDatetime(t.format,e[t.name]):parseValue(e[t.name],t.format),s=o()(n,e=>e.source_schema===t.schema&&e.source_table_name===t.table&&e.source_column_name===t.name);return{value:l,foreignKey:s,id:t.id,name:t.name,comment:parseDescription(t.comment),format:t.format,enums:t.enums,defaultValue:null==t?void 0:t.default_value,isNullable:t.is_nullable,isIdentity:t.is_identity,isPrimaryKey:a.includes(t.name)}})},validateFields=e=>{let t={};return e.forEach(e=>{var n,l,a;let s=e.format.startsWith("_");if(s&&e.value)try{JSON.parse(e.value)}catch(n){t[e.name]="Value is an invalid array"}if(e.format.includes("json")&&(null!==(l=null===(n=e.value)||void 0===n?void 0:n.length)&&void 0!==l?l:0)>0)try{(0,ev.jn)(null!==(a=e.value)&&void 0!==a?a:"")}catch(n){t[e.name]="Value is an invalid JSON"}if(e.isIdentity||e.defaultValue)return}),t},parseValue=(e,t)=>{try{if(null===e||Array.isArray(e)&&0===e.length||"string"==typeof e&&0===e.length||"number"==typeof e||!t)return e;if("object"==typeof e)return JSON.stringify(e);if("boolean"==typeof e)return e.toString();else return e}catch(t){return e}},parseDescription=e=>{var t,n;if(!e)return"";let l=eV()(e.split("\n"));return 1==l.length?e:2==l.length?"".concat(l[0]," ").concat(null===(t=l[1])||void 0===t?void 0:t.split(".<")[0]):l.length>2?"".concat(l[0]," (").concat(l[1]," ").concat(null===(n=l[2])||void 0===n?void 0:n.split(".<")[0],")"):""},convertPostgresDatetimeToInputDatetime=(e,t)=>{if(!t||0==t.length)return"";if(eL.Ks.includes(e))return eU()(t).format("YYYY-MM-DDTHH:mm:ss");if(!eL.XO.includes(e))return t;{let e=t&&t.includes("+")?"HH:mm:ssZZ":"HH:mm:ss";return eU()(t,e).format("HH:mm:ss")}},convertInputDatetimeToPostgresDatetime=(e,t)=>{if(!t||0==t.length)return null;switch(e){case"timestamptz":return eU()(t,"YYYY-MM-DDTHH:mm:ss").format("YYYY-MM-DDTHH:mm:ssZ");case"timestamp":return eU()(t,"YYYY-MM-DDTHH:mm:ss").format("YYYY-MM-DDTHH:mm:ss");case"timetz":return eU()(t,"HH:mm:ss").format("HH:mm:ssZZ");case"time":return eU()(t,"HH:mm:ss").format("HH:mm:ss");default:return t}},generateRowObjectFromFields=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};return e.forEach(e=>{var t;let l=e.format.startsWith("_"),a=eL.BB.includes(e.format)?e.value:0===(null!==(t=null==e?void 0:e.value)&&void 0!==t?t:"").length?null:e.value;if(l&&null!==a)n[e.name]=(0,ev.dW)(a);else if(e.format.includes("json"))"object"==typeof e.value?n[e.name]=a:eH()(a)&&(n[e.name]=(0,ev.dW)(a));else if("bool"===e.format&&a)"null"===a?n[e.name]=null:n[e.name]="true"===a;else if(eL.nA.includes(e.format)){let t=(a||"").split(":"),l=2===t.length?"".concat(a,":00"):a;n[e.name]=convertInputDatetimeToPostgresDatetime(e.format,l)}else n[e.name]=a}),t?n:eQ()(n,eS())},generateUpdateRowPayload=(e,t)=>{let n=generateRowObjectFromFields(t,!0),l={},a=Object.keys(n);return a.forEach(a=>{var s;let r=null===(s=t.find(e=>e.name===a))||void 0===s?void 0:s.format;if(void 0!==r&&eL.nA.includes(r)){let t=convertPostgresDatetimeToInputDatetime(r,e[a]),s=convertInputDatetimeToPostgresDatetime(r,t);s!==n[a]&&(l[a]=n[a])}else eM()(e[a],n[a])||(l[a]=n[a])}),l};var RowEditor_RowEditor=e=>{var t,n,a,s;let{row:r,selectedTable:i,visible:o=!1,closePanel:c=G(),saveChanges:u=G(),updateEditorDirty:m=G()}=e,[h,x]=(0,O.useState)({}),[f,g]=(0,O.useState)([]),[v,y]=(0,O.useState)(),[b,N]=(0,O.useState)(!1),[w,S]=(0,O.useState)(),C=d()(r),_=!d()(v),[E,R]=(0,O.useState)(!1),[k,Z]=eT()(f,e=>!e.isNullable),{project:T}=(0,p.d2)(),{data:P}=(0,j.X)({projectRef:null==T?void 0:T.ref,connectionString:null==T?void 0:T.connectionString,schema:i.schema}),D=(0,O.useMemo)(()=>{var e;return P&&(null==w?void 0:null===(e=w.foreignKey)||void 0===e?void 0:e.id)?P.find(e=>{var t;return e.id===(null===(t=w.foreignKey)||void 0===t?void 0:t.id)}):void 0},[P,null==w?void 0:null===(t=w.foreignKey)||void 0===t?void 0:t.id]);(0,O.useEffect)(()=>{if(o){x({});let e=generateRowFields(r,i);g(e)}},[o]);let onUpdateField=e=>{let[t]=Object.keys(e),n=f.map(n=>n.name===t?{...n,value:e[t]}:n);g(n),m()},onOpenForeignRowSelector=async e=>{N(!0),S(e)},onSaveChanges=e=>{e.preventDefault();let t=validateFields(f);if(x(t),R(!0),B()(t)){m();let e=C?generateRowObjectFromFields(f):generateUpdateRowPayload(r,f),t={identifiers:{},rowIdx:-1};if(!C){let e=f.filter(e=>e.isPrimaryKey),n={};e.forEach(e=>n[e.name]=r[e.name]),t.identifiers=n,t.rowIdx=r.idx}u(e,C,t,()=>R(!1))}else R(!1)};return(0,l.jsxs)(en.ZP,{hideFooter:!0,size:"large",visible:o,header:(0,l.jsx)(RowEditor_HeaderTitle,{isNewRecord:C,tableName:i.name}),className:"transition-all duration-100 ease-in ".concat(_||b?" mr-32":""),onCancel:c,children:[(0,l.jsx)("form",{onSubmit:e=>onSaveChanges(e),className:"h-full",children:(0,l.jsxs)("div",{className:"flex h-full flex-col",children:[(0,l.jsxs)("div",{className:"flex flex-grow flex-col",children:[(0,l.jsx)(en.ZP.Content,{children:(0,l.jsx)("div",{className:"space-y-10 py-6",children:k.map(e=>(0,l.jsx)(RowEditor_InputField,{field:e,errors:h,onUpdateField:onUpdateField,onEditJson:y,onSelectForeignKey:()=>onOpenForeignRowSelector(e)},e.id))})}),Z.length>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(en.ZP.Separator,{}),(0,l.jsx)(en.ZP.Content,{children:(0,l.jsxs)("div",{className:"space-y-10 py-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-base text-foreground",children:"Optional Fields"}),(0,l.jsx)("p",{className:"text-sm text-foreground-lighter",children:"These are columns that do not need any value"})]}),Z.map(e=>(0,l.jsx)(RowEditor_InputField,{field:e,errors:h,onUpdateField:onUpdateField,onEditJson:y,onSelectForeignKey:()=>onOpenForeignRowSelector(e)},e.id))]})})]}),(0,l.jsx)(JsonEditor_JsonEditor,{visible:_,column:null!==(n=null==v?void 0:v.column)&&void 0!==n?n:"",jsonString:null!==(a=null==v?void 0:v.jsonString)&&void 0!==a?a:"",closePanel:()=>y(void 0),onSaveJSON:e=>{var t;onUpdateField({[null!==(t=null==v?void 0:v.column)&&void 0!==t?t:""]:e}),y(void 0)}})]}),(0,l.jsx)("div",{className:"flex-shrink",children:(0,l.jsx)(ed.Z,{loading:E,backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:c})})]})}),(0,l.jsx)(ForeignRowSelector_ForeignRowSelector,{visible:b,foreignKey:D,onSelect:e=>{w&&(onUpdateField({[w.name]:e}),N(!1),S(void 0))},closePanel:()=>{N(!1),S(void 0)}},"foreign-row-selector-".concat(null!==(s=null==D?void 0:D.id)&&void 0!==s?s:"null"))]},"RowEditor")},eB=n(88058),eJ=n(63157),eG=n(44593),eX=n(49730),e$=n(50074),e0=n(26861),e1=n(58943);async function getPostgresTypes(e,t){let{projectRef:n,connectionString:l}=e;if(!n)throw Error("projectRef is required");let a=new Headers;l&&a.set("x-connection-encrypted",l);let{data:s,error:r}=await (0,eu.U2)("/platform/pg-meta/{ref}/types",{params:{header:{"x-connection-encrypted":l},path:{ref:n}},headers:Object.fromEntries(a),signal:t});if(r)throw r;return s}let usePostgresTypesQuery=function(e){let{projectRef:t,connectionString:n}=e,{enabled:l=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,e1.a)(eE.A.postgresTypes(t),e=>{let{signal:l}=e;return getPostgresTypes({projectRef:t,connectionString:n},l)},{enabled:l&&void 0!==t,...a})},e2=[{name:"now()",value:"now()",description:"Returns the current date and time"},{name:"(now() at time zone 'utc')",value:"(now() at time zone 'utc')",description:"Returns the current date and time based on the specified timezone"}],e5=[{name:"Set as NULL",value:null,description:"Set the default value as NULL value"},{name:"Set as empty string",value:"",description:"Set the default value as an empty string"}],e4={uuid:[{name:"auth.uid()",value:"auth.uid()",description:"Returns the user's ID when rows are added or updated through the API"},{name:"gen_random_uuid()",value:"gen_random_uuid()",description:"Generates a version 4 UUID"}],time:[...e2],timetz:[...e2],timestamp:[...e2],timestamptz:[...e2],text:[...e5],varchar:[...e5]};var e3=n(97036),e6=n(8809),ColumnEditor_InputWithSuggestions=e=>{let{label:t,description:n,placeholder:a,size:s,layout:r,disabled:i=!1,className:o="",value:c="",suggestions:d=[],suggestionsTooltip:u,suggestionsHeader:m,onChange:h=G(),onSelectSuggestion:x=G()}=e,p=(0,O.useRef)(null),[f,g]=(0,O.useState)(d),v=f.length>0;return(0,O.useEffect)(()=>{g(d.slice(0,3))},[d]),(0,l.jsx)("div",{ref:p,className:"relative",children:(0,l.jsx)(e_.Z,{label:t,descriptionText:n,placeholder:a,size:s,layout:r,disabled:i,className:o,inputClassName:"pr-10",type:"text",value:c,onChange:e=>{h(e);let t=e.target.value;if(d.length>3){let e=t?d.filter(e=>-1!==e.name.indexOf(t)):d;g(e.slice(0,3))}},actions:v&&(0,l.jsxs)(e3.h_,{children:[(0,l.jsxs)(D.fC,{delayDuration:0,children:[(0,l.jsx)(e3.$F,{asChild:!0,children:(0,l.jsx)(D.xz,{asChild:!0,children:(0,l.jsx)(L.z,{type:"default",className:"!px-1 mr-1",children:(0,l.jsx)(e6.Z,{strokeWidth:1.5})})})}),(0,l.jsx)(D.h_,{children:(0,l.jsxs)(D.VY,{side:"bottom",children:[(0,l.jsx)(D.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"bg-alternative rounded py-1 px-2 leading-none shadow border-background border",children:(0,l.jsx)("span",{className:"text-foreground text-xs",children:u||"Suggestions"})})]})})]}),(0,l.jsxs)(e3.AW,{align:"end",side:"bottom",children:[(0,l.jsx)(e3.Ju,{children:m||"Suggestions"}),(0,l.jsx)(e3.VD,{}),f.map(e=>(0,l.jsxs)(e3.Xi,{className:"space-x-2",onClick:()=>x(e),children:[(0,l.jsx)("div",{children:e.name}),(0,l.jsx)("div",{className:"text-foreground-lighter",children:e.description})]},e.name))]})]})})})},ColumnEditor_ColumnDefaultValue=e=>{var t,n,a,s;let{columnFields:r,enumTypes:i=[],onUpdateField:o=G()}=e,c=null!==(t=null==e4?void 0:e4[r.format])&&void 0!==t?t:[],d=!eL.DL.includes(r.format)&&i.some(e=>e.name===r.format);if(d){let e=i.find(e=>e.name===r.format),t=null!==(n=null==e?void 0:e.enums)&&void 0!==n?n:[],s=null!==(a=null==r?void 0:r.defaultValue)&&void 0!==a?a:"",c=s.includes("::")?s.split("::")[0].slice(1,-1):s;if(void 0!==e)return(0,l.jsxs)(eF.ZP,{label:"Default Value",layout:"vertical",value:c,onChange:e=>o({defaultValue:e.target.value}),children:[(0,l.jsx)(eF.ZP.Option,{value:"",children:"NULL"},"empty-enum"),t.map(e=>(0,l.jsx)(eF.ZP.Option,{value:e,children:e},e))]})}return(0,l.jsx)(ColumnEditor_InputWithSuggestions,{label:"Default Value",layout:"vertical",description:"Can either be a literal or an expression. When using an expression wrap your expression in brackets, e.g. (gen_random_uuid())",placeholder:"string"==typeof r.defaultValue&&0===r.defaultValue.length?"EMPTY":"NULL",value:null!==(s=null==r?void 0:r.defaultValue)&&void 0!==s?s:"",suggestions:c,suggestionsHeader:"Suggested expressions",suggestionsTooltip:"Suggested expressions",onChange:e=>o({defaultValue:e.target.value}),onSelectSuggestion:e=>o({defaultValue:e.value})})},e8=n(1114),e9=n(84959),ColumnEditor_ColumnForeignKey=e=>{let{column:t,originalForeignKey:n,onSelectEditRelation:a,onSelectRemoveRelation:s,onSelectCancelRemoveRelation:r}=e,i=d()(n)&&d()(null==t?void 0:t.foreignKey);if(i)return(0,l.jsx)(L.z,{type:"default",onClick:a,children:"Add foreign key relation"});let o=(0,e8.wO)(n,null==t?void 0:t.foreignKey);switch(o){case"Add":return(0,l.jsx)(ColumnForeignKeyAdded,{columnName:t.name,foreignKey:t.foreignKey,onSelectEditRelation:a,onSelectRemoveRelation:s});case"Remove":return(0,l.jsx)(ColumnForeignKeyRemoved,{columnName:t.name,originalForeignKey:n,onSelectEditRelation:a,onSelectCancelRemoveRelation:r});case"Update":return(0,l.jsx)(ColumnForeignKeyUpdated,{columnName:t.name,originalForeignKey:n,updatedForeignKey:t.foreignKey,onSelectEditRelation:a,onSelectRemoveRelation:s});case"Info":return(0,l.jsx)(ColumnForeignKeyInformation,{columnName:t.name,foreignKey:t.foreignKey,onSelectEditRelation:a,onSelectRemoveRelation:s});default:return(0,l.jsx)("div",{})}};let ColumnForeignKeyInformation=e=>{let{columnName:t,foreignKey:n,onSelectEditRelation:a,onSelectRemoveRelation:s}=e,r=(0,e8.s8)(null==n?void 0:n.update_action),i=(0,e8.s8)(null==n?void 0:n.deletion_action);return(0,l.jsx)(Y.Z,{block:!0,title:(0,l.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("p",{className:"text-foreground-light",children:"This column has the following foreign key relation:"}),(0,l.jsxs)("div",{className:"flex items-center space-x-2 text-foreground",children:[(0,l.jsx)("p",{className:"text-xs text-code font-mono",children:t}),(0,l.jsx)(eh.Z,{size:14,strokeWidth:2}),(0,l.jsxs)("p",{className:"text-xs text-code font-mono",children:[null==n?void 0:n.target_table_schema,".",null==n?void 0:n.target_table_name,".",null==n?void 0:n.target_column_name]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[void 0!==r&&(0,l.jsxs)(e9.Z,{color:"gray",children:["On update: ",r]}),void 0!==i&&(0,l.jsxs)(e9.Z,{color:"gray",children:["On delete: ",i]})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(L.z,{type:"outline",onClick:a,children:"Edit relation"}),(0,l.jsx)(L.z,{type:"outline",onClick:s,children:"Remove"})]})]})})},ColumnForeignKeyAdded=e=>{let{columnName:t,foreignKey:n,onSelectEditRelation:a,onSelectRemoveRelation:s}=e,r=(0,e8.s8)(null==n?void 0:n.update_action),i=(0,e8.s8)(null==n?void 0:n.deletion_action);return(0,l.jsx)(Y.Z,{block:!0,title:(0,l.jsxs)("div",{className:"flex flex-col space-y-4 text-foreground-light",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("span",{children:["The following foreign key relation will be ",(0,l.jsx)("span",{className:"text-brand",children:"added"}),":"]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2 text-foreground",children:[(0,l.jsx)("p",{className:"".concat(t.length>0?"text-code font-mono text-xs":""," max-w-xs truncate"),children:t||"This column"}),(0,l.jsx)(eh.Z,{size:14,strokeWidth:2}),(0,l.jsxs)("p",{className:"max-w-xs text-xs truncate text-code font-mono",children:[null==n?void 0:n.target_table_schema,".",null==n?void 0:n.target_table_name,".",null==n?void 0:n.target_column_name]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[void 0!==r&&(0,l.jsxs)(e9.Z,{color:"gray",children:["On update: ",r]}),void 0!==i&&(0,l.jsxs)(e9.Z,{color:"gray",children:["On delete: ",i]})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(L.z,{type:"outline",onClick:a,children:"Edit relation"}),(0,l.jsx)(L.z,{type:"outline",onClick:s,children:"Remove"})]})]})})},ColumnForeignKeyRemoved=e=>{let{columnName:t,originalForeignKey:n,onSelectEditRelation:a,onSelectCancelRemoveRelation:s}=e;return(0,l.jsx)(Y.Z,{block:!0,title:(0,l.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("p",{className:"text-foreground-light",children:["The following foreign key relation will be"," ",(0,l.jsx)("span",{className:"text-amber-900",children:"removed"}),":"]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("code",{className:"text-xs font-mono",children:t}),(0,l.jsx)(eh.Z,{size:14,strokeWidth:2}),(0,l.jsxs)("code",{className:"text-xs font-mono",children:[null==n?void 0:n.target_table_schema,".",null==n?void 0:n.target_table_name,".",null==n?void 0:n.target_column_name]})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(L.z,{type:"outline",onClick:a,children:"Edit relation"}),(0,l.jsx)(L.z,{type:"outline",onClick:s,children:"Cancel remove"})]})]})})},ColumnForeignKeyUpdated=e=>{let{columnName:t,originalForeignKey:n,updatedForeignKey:a,onSelectEditRelation:s,onSelectRemoveRelation:r}=e,i="".concat(null==n?void 0:n.target_table_schema,".").concat(null==n?void 0:n.target_table_name,".").concat(null==n?void 0:n.target_column_name),o="".concat(null==a?void 0:a.target_table_schema,".").concat(null==a?void 0:a.target_table_name,".").concat(null==a?void 0:a.target_column_name),c=(0,e8.s8)(null==n?void 0:n.update_action),d=(0,e8.s8)(null==a?void 0:a.update_action),u=(0,e8.s8)(null==n?void 0:n.deletion_action),m=(0,e8.s8)(null==a?void 0:a.deletion_action);return(0,l.jsx)(Y.Z,{block:!0,title:(0,l.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("p",{children:["The foreign key relation will be ",(0,l.jsx)("span",{className:"text-brand",children:"updated"})," as such:"]}),(0,l.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,l.jsx)("code",{className:"text-xs font-mono",children:t}),(0,l.jsx)(eh.Z,{className:"mt-1",size:14,strokeWidth:2}),(0,l.jsxs)("div",{className:"flex flex-col space-y-2",children:[i!==o&&(0,l.jsx)("p",{className:"line-through",children:(0,l.jsx)("code",{className:"text-xs font-mono",children:i})}),(0,l.jsx)("code",{className:"text-xs font-mono",children:o})]})]}),(0,l.jsx)("div",{className:"flex items-center space-x-2",children:u!==m&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(e9.Z,{color:"gray",className:"line-through",children:["On delete: ",null!=u?u:"No action"]}),(0,l.jsxs)(e9.Z,{color:"green",children:["On delete: ",null!=m?m:"No action"]})]})}),(0,l.jsx)("div",{className:"flex items-center space-x-2",children:c!==d&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(e9.Z,{color:"gray",className:"line-through",children:["On update: ",null!=c?c:"No action"]}),(0,l.jsxs)(e9.Z,{color:"green",children:["On update: ",null!=d?d:"No action"]})]})})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(L.z,{type:"outline",onClick:s,children:"Edit relation"}),(0,l.jsx)(L.z,{type:"outline",onClick:r,children:"Remove"})]})]})})};var e7=n(40127),ColumnEditor_HeaderTitle=e=>{let{table:t,column:n}=e;return n?(0,l.jsxs)(l.Fragment,{children:["Update column ",(0,l.jsx)("code",{children:n.name})," from ",(0,l.jsx)("code",{children:n.table})]}):(0,l.jsxs)(l.Fragment,{children:["Add new column to ",(0,l.jsx)("code",{children:t.name})]})},ColumnEditor_ColumnEditor=e=>{var t,n,a,s,i;let{column:o,selectedTable:c,visible:d=!1,closePanel:u=G(),saveChanges:m=G(),updateEditorDirty:h=G()}=e,{ref:x}=(0,r.UO)(),{project:f}=(0,p.d2)(),[g,v]=(0,O.useState)({}),[y,b]=(0,O.useState)(),[N,w]=(0,O.useState)(!1),{data:S}=usePostgresTypesQuery({projectRef:null==f?void 0:f.ref,connectionString:null==f?void 0:f.connectionString}),C=(null!=S?S:[]).filter(e=>!k.U.includes(e.schema)),{data:_}=(0,j.X)({projectRef:null==f?void 0:f.ref,connectionString:null==f?void 0:f.connectionString,schema:null==c?void 0:c.schema}),E=_||[],R=void 0===o,Z=o?(0,e8.S)(o,c,E):void 0;if((0,O.useEffect)(()=>{if(d){v({});let e=R?(0,e8.QZ)():(0,e8.uE)(o,c,E);b(e)}},[d]),!y)return null;let onUpdateField=e=>{let t=eL.BB.includes(y.format);t||""!==e.defaultValue||(e.defaultValue=null);let n={...y,...e};b(n),h();let l={...g};for(let t of Object.keys(e))delete l[t];v(l)},onSaveChanges=e=>{if(y){let t=(0,e8.Of)(y);if(v(t),B()(t)){let t=R?(0,e8.oo)(c.id,y):(0,e8.xY)(o,c,y),n=y.foreignKey?{...y.foreignKey,source_column_name:y.name}:void 0,l={columnId:null==o?void 0:o.id};m(t,n,R,l,e)}else e()}};return(0,l.jsxs)(en.ZP,{size:"xlarge",visible:d,onConfirm:e=>onSaveChanges(e),header:(0,l.jsx)(ColumnEditor_HeaderTitle,{table:c,column:o}),onCancel:u,customFooter:(0,l.jsx)(ed.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:u,applyFunction:e=>onSaveChanges(e)}),children:[(0,l.jsx)(e0.hj,{header:(0,l.jsx)(e0.S0,{className:"lg:!col-span-4",children:"General"}),children:(0,l.jsxs)(e0.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,l.jsx)(e_.Z,{label:"Name",type:"text",descriptionText:"Recommended to use lowercase and use an underscore to separate words e.g. column_name",placeholder:"column_name",error:g.name,value:null!==(t=null==y?void 0:y.name)&&void 0!==t?t:"",onChange:e=>onUpdateField({name:e.target.value})}),(0,l.jsx)(e_.Z,{label:"Description",labelOptional:"Optional",type:"text",value:null!==(n=null==y?void 0:y.comment)&&void 0!==n?n:"",onChange:e=>onUpdateField({comment:e.target.value})})]})}),(0,l.jsx)(en.ZP.Separator,{}),(0,l.jsx)(e0.hj,{header:(0,l.jsx)(e0.S0,{className:"lg:!col-span-4",children:"Foreign Key Relation"}),children:(0,l.jsx)(e0.B4,{loading:!1,className:"lg:!col-span-8",children:(0,l.jsx)("div",{children:(0,l.jsx)(ColumnEditor_ColumnForeignKey,{column:y,originalForeignKey:Z,onSelectEditRelation:()=>w(!0),onSelectRemoveRelation:()=>onUpdateField({foreignKey:void 0}),onSelectCancelRemoveRelation:()=>onUpdateField({foreignKey:Z})})})})}),(0,l.jsx)(en.ZP.Separator,{}),(0,l.jsx)(e0.hj,{header:(0,l.jsx)(e0.S0,{className:"lg:!col-span-4",description:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(L.z,{asChild:!0,type:"default",size:"tiny",icon:(0,l.jsx)(eB.Z,{size:14,strokeWidth:2}),children:(0,l.jsx)(A(),{href:"/project/".concat(x,"/database/types"),target:"_blank",rel:"noreferrer",children:"Create enum types"})}),(0,l.jsx)(L.z,{asChild:!0,type:"default",size:"tiny",icon:(0,l.jsx)(eJ.Z,{size:14,strokeWidth:2}),children:(0,l.jsx)(A(),{href:"https://supabase.com/docs/guides/database/tables#data-types",target:"_blank",rel:"noreferrer",children:"About data types"})})]}),children:"Data Type"}),children:(0,l.jsxs)(e0.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,l.jsx)(e7.Z,{showRecommendation:!0,value:null!==(a=null==y?void 0:y.format)&&void 0!==a?a:"",layout:"vertical",enumTypes:C,error:g.format,disabled:(null==y?void 0:y.foreignKey)!==void 0,onOptionSelect:e=>onUpdateField({format:e,defaultValue:null})}),void 0===y.foreignKey&&(0,l.jsxs)("div",{className:"space-y-4",children:[y.format.includes("int")&&(0,l.jsx)("div",{className:"w-full",children:(0,l.jsx)(eG.Z,{label:"Is Identity",description:"Automatically assign a sequential unique number to the column",checked:y.isIdentity,onChange:()=>{let e=!y.isIdentity,t=!e&&y.isArray;onUpdateField({isIdentity:e,isArray:t})}})}),!y.isPrimaryKey&&(0,l.jsx)("div",{className:"w-full",children:(0,l.jsx)(eG.Z,{label:"Define as Array",description:"Allow column to be defined as variable-length multidimensional arrays",checked:y.isArray,onChange:()=>{let e=!y.isArray,t=!e&&y.isIdentity;onUpdateField({isArray:e,isIdentity:t})}})})]}),(0,l.jsx)(ColumnEditor_ColumnDefaultValue,{columnFields:y,enumTypes:C,onUpdateField:onUpdateField})]})}),(0,l.jsx)(en.ZP.Separator,{}),(0,l.jsx)(e0.hj,{header:(0,l.jsx)(e0.S0,{className:"lg:!col-span-4",children:"Constraints"}),children:(0,l.jsxs)(e0.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,l.jsx)(eX.Z,{label:"Is Primary Key",descriptionText:"A primary key indicates that a column or group of columns can be used as a unique identifier for rows in the table",checked:null!==(s=null==y?void 0:y.isPrimaryKey)&&void 0!==s&&s,onChange:()=>onUpdateField({isPrimaryKey:!(null==y?void 0:y.isPrimaryKey)})}),(0,l.jsx)(eX.Z,{label:"Allow Nullable",descriptionText:"Allow the column to assume a NULL value if no value is provided",checked:y.isNullable,onChange:()=>onUpdateField({isNullable:!y.isNullable})}),(0,l.jsx)(eX.Z,{label:"Is Unique",descriptionText:"Enforce values in the column to be unique across rows",checked:y.isUnique,onChange:()=>onUpdateField({isUnique:!y.isUnique})}),(0,l.jsx)(e_.Z,{label:"CHECK Constraint",labelOptional:"Optional",placeholder:"e.g length(".concat((null==y?void 0:y.name)||"column_name",") < 500"),type:"text",value:null!==(i=null==y?void 0:y.check)&&void 0!==i?i:"",onChange:e=>onUpdateField({check:e.target.value}),className:"[&_input]:font-mono"})]})}),R&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(en.ZP.Separator,{}),(0,l.jsx)(e0.hj,{header:(0,l.jsx)(e0.S0,{className:"lg:!col-span-4",children:"Security"}),children:(0,l.jsx)(e0.B4,{loading:!1,className:"lg:!col-span-8",children:(0,l.jsxs)(e$.bZ,{children:[(0,l.jsx)(U.Z,{}),(0,l.jsx)(e$.Cd,{children:"Column encryption has been removed from the GUI"}),(0,l.jsxs)(e$.X,{children:[(0,l.jsxs)("p",{className:"!leading-normal",children:["You may still encrypt new columns through the SQL editor using"," ",(0,l.jsx)(A(),{href:"/project/".concat(x,"/database/extensions?filter=pgsodium"),className:"text-brand hover:underline",children:"pgsodium's"})," ","Transparent Column Encryption (TCE)."]}),(0,l.jsx)(L.z,{asChild:!0,type:"default",icon:(0,l.jsx)(eJ.Z,{}),className:"mt-2",children:(0,l.jsx)(A(),{target:"_blank",rel:"noreferrer",href:"https://github.com/orgs/supabase/discussions/18849",children:"Learn more"})})]})]})})})]}),(0,l.jsx)(ForeignKeySelector_ForeignKeySelector,{column:y,visible:N,closePanel:()=>w(!1),saveChanges:e=>{onUpdateField({foreignKey:void 0!==e?{id:0,constraint_name:"",source_schema:c.schema,source_table_name:c.name,source_column_name:(null==y?void 0:y.name)||(null==o?void 0:o.name)||"",target_table_schema:e.table.schema,target_table_name:e.table.name,target_column_name:e.column.name,deletion_action:e.deletionAction,update_action:e.updateAction}:void 0,...void 0!==e&&{format:e.column.format,defaultValue:null}}),w(!1)}})]},"ColumnEditor")},te=n(73205),tt=n(78796),tn=n(40023),tl=n(22354),ta=n(5099),ts=n(99750),tr=n(72579),ti=n.n(tr),to=n(829),tc=n.n(to),td=n(12752),tu=n(59343),tm=n(16236);let th=[{key:"no-action",label:"No action",value:v.NO.NO_ACTION},{key:"cascade",label:"Cascade",value:v.NO.CASCADE},{key:"restrict",label:"Restrict",value:v.NO.RESTRICT},{key:"set-default",label:"Set default",value:v.NO.SET_DEFAULT},{key:"set-null",label:"Set NULL",value:v.NO.SET_NULL}],generateCascadeActionDescription=(e,t,n)=>{var a;let s="update"===e?"Updating":"Deleting",r=null!==(a=(0,e8.s8)(t))&&void 0!==a?a:"No action";switch(t){case v.NO.NO_ACTION:return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-foreground-light",children:r}),": ",s," a record from"," ",(0,l.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will"," ",(0,l.jsx)("span",{className:"text-amber-900 opacity-75",children:"raise an error"})," if there are records existing in this table that reference it"]});case v.NO.CASCADE:return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-foreground-light",children:r}),": ",s," a record from"," ",(0,l.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will"," ",(0,l.jsxs)("span",{className:"text-amber-900 opacity-75",children:["also ",e]})," any records that reference it in this table"]});case v.NO.RESTRICT:return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-foreground-light",children:r}),(0,l.jsxs)(D.fC,{delayDuration:0,children:[(0,l.jsx)(D.xz,{className:"translate-y-[3px] mx-1",children:(0,l.jsx)(ts.Z,{className:"text-foreground-light",size:16,strokeWidth:1.5})}),(0,l.jsx)(D.h_,{children:(0,l.jsxs)(D.VY,{side:"bottom",children:[(0,l.jsx)(D.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow w-[300px] space-y-2 border border-background",children:(0,l.jsx)("p",{className:"text-xs text-foreground",children:"This is similar to no action, but the restrict check cannot be deferred till later in the transaction"})})]})})]}),": ",s," a record from"," ",(0,l.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will"," ",(0,l.jsxs)("span",{className:"text-amber-900 opacity-75",children:["prevent ",s.toLowerCase()]})," ","existing referencing rows from this table."]});case v.NO.SET_DEFAULT:return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-foreground-light",children:r}),": ",s," a record from"," ",(0,l.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will set the value of any existing records in this table referencing it to their"," ",(0,l.jsx)("span",{className:"text-amber-900 opacity-75",children:"default value"})]});case v.NO.SET_NULL:return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-foreground-light",children:r}),": ",s," a record from"," ",(0,l.jsx)("code",{className:"text-xs text-foreground-light",children:n})," will set the value of any existing records in this table referencing it"," ",(0,l.jsx)("span",{className:"text-amber-900 opacity-75",children:"to NULL"})]})}};var ForeignKeySelector_ForeignKeySelector=e=>{var t,n,a,s;let{column:r,visible:i=!1,closePanel:c,saveChanges:d}=e,{project:u}=(0,p.d2)(),[m,h]=(0,O.useState)({}),[x,f]=(0,O.useState)({schema:"public",table:"",column:"",deletionAction:v.NO.NO_ACTION,updateAction:v.NO.NO_ACTION}),{data:g}=(0,td.Q1)({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString}),{data:j}=(0,ek.Bj)({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString,schema:x.schema}),y=null==r?void 0:r.foreignKey,b=o()(j,{name:null==x?void 0:x.table,schema:null==x?void 0:x.schema}),N=o()(null!==(t=null==b?void 0:b.columns)&&void 0!==t?t:[],{name:null==x?void 0:x.column});(0,O.useEffect)(()=>{i&&(h({}),y?f({schema:y.target_table_schema,table:y.target_table_name,column:y.target_column_name,deletionAction:y.deletion_action,updateAction:y.update_action}):f({schema:"public",table:"",column:"",deletionAction:v.NO.NO_ACTION,updateAction:v.NO.NO_ACTION}))},[i]);let updateSelectedSchema=e=>{let t={schema:e,table:"",column:"",deletionAction:v.NO.NO_ACTION,updateAction:v.NO.NO_ACTION};f(t)},updateSelectedTable=e=>{if(h({}),!e)return f({schema:"",table:"",column:"",deletionAction:v.NO.NO_ACTION,updateAction:v.NO.NO_ACTION});let t=o()(j,{id:e});if(t){var n,l;let e=null===(n=t.primary_keys[0])||void 0===n?void 0:n.name,a=(null===(l=t.columns)||void 0===l?void 0:l.length)?t.columns[0].name:void 0;f({schema:t.schema,table:t.name,column:null!=e?e:a,deletionAction:v.NO.NO_ACTION,updateAction:v.NO.NO_ACTION})}},updateSelectedColumn=e=>{h({});let t=o()(null==b?void 0:b.columns,{id:e});if(t){let e={...x,column:t.name};f(e)}},updateCascadeAction=(e,t)=>{h({}),f({...x,[e]:t})},w=(null==N?void 0:N.format)===(null==r?void 0:r.format);return(0,l.jsx)(en.ZP,{size:"medium",visible:i,onCancel:c,header:(0,l.jsxs)("span",{children:["Edit foreign key relation"," ",(null==r?void 0:r.name)&&(0,l.jsxs)(l.Fragment,{children:["for ",(0,l.jsx)("span",{className:"text-code",children:ti()(r,["name"],"")})]})]}),customFooter:(0,l.jsx)(ed.Z,{backButtonLabel:"Cancel",disableApply:!!(null==r?void 0:r.format)&&!w,applyButtonLabel:"Save",closePanel:c,applyFunction:e=>{let t={};(null==x?void 0:x.table)||(t.table="Please select a table"),(null==x?void 0:x.table)&&!x.column&&(t.column="The table ".concat(x.table," has no columns")),h(t),B()(t)&&(b&&N?d({table:b,column:N,deletionAction:x.deletionAction,updateAction:x.updateAction}):d(void 0)),e()}}),children:(0,l.jsx)(en.ZP.Content,{children:(0,l.jsxs)("div",{className:"py-6 space-y-6",children:[(0,l.jsx)(Y.Z,{icon:(0,l.jsx)(ts.Z,{size:"large",strokeWidth:1.5}),title:"What are foreign keys?",description:"Foreign keys help maintain referential integrity of your data by ensuring that no\n                one can insert rows into the table that do not have a matching entry to another\n                table.",url:"https://www.postgresql.org/docs/current/tutorial-fk.html",urlLabel:"Postgres Foreign Key Documentation"}),(0,l.jsx)(eO.Z,{id:"schema",label:"Select a schema",value:x.schema,error:m.schema,onChange:e=>updateSelectedSchema(e),children:null==g?void 0:g.map(e=>(0,l.jsx)(eO.Z.Option,{value:e.name,label:e.name,addOnBefore:()=>(0,l.jsx)(tu.Z,{size:16,strokeWidth:1.5}),children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"hidden",children:e.name}),(0,l.jsx)("span",{className:"text-foreground",children:e.name})]})},e.id))}),(0,l.jsxs)(eO.Z,{id:"table",label:"Select a table to reference to",value:null!==(n=null==b?void 0:b.id)&&void 0!==n?n:1,error:m.table,onChange:e=>updateSelectedTable(Number(e)),children:[(0,l.jsx)(eO.Z.Option,{value:1,label:"---",children:"---"},"empty"),tc()(j,["schema"]).map(e=>(0,l.jsx)(eO.Z.Option,{value:e.id,label:e.name,children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"hidden",children:e.name}),(0,l.jsx)("span",{className:"text-foreground-lighter",children:e.schema}),(0,l.jsx)("span",{className:"text-foreground",children:e.name})]})},e.id))]}),(null==x?void 0:x.table)&&(0,l.jsxs)(l.Fragment,{children:[0===(null!==(a=null==b?void 0:b.columns)&&void 0!==a?a:[]).length?(0,l.jsx)(e_.Z,{disabled:!0,label:(0,l.jsxs)("div",{children:["Select a column from"," ",(0,l.jsxs)("code",{className:"text-xs",children:[null==x?void 0:x.schema,".",null==x?void 0:x.table]})," ","to reference to"]}),error:m.column,placeholder:"This table has no columns available"}):(0,l.jsx)(eO.Z,{id:"column",value:null==N?void 0:N.id,label:(0,l.jsxs)("div",{children:["Select a column from"," ",(0,l.jsxs)("code",{className:"text-xs",children:[null==x?void 0:x.schema,".",null==x?void 0:x.table]})," ","to reference to"]}),error:m.column,onChange:e=>updateSelectedColumn(e),children:(null!==(s=null==b?void 0:b.columns)&&void 0!==s?s:[]).map(e=>(0,l.jsx)(eO.Z.Option,{value:e.id,label:e.name,children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-foreground",children:e.name}),(0,l.jsx)("span",{className:"text-foreground-lighter",children:e.format})]})},e.id))}),!w&&!(null==r?void 0:r.format)&&(0,l.jsxs)(e$.bZ,{variant:"default",children:[(0,l.jsx)(U.Z,{className:"h-4 w-4"}),(0,l.jsxs)(e$.Cd,{children:["The referenced column's type will be updated to ",null==N?void 0:N.data_type]}),(0,l.jsxs)(e$.X,{className:"leading-6",children:[(0,l.jsx)("span",{children:"The referenced column"}),(null==r?void 0:r.name)&&(0,l.jsx)("span",{className:"text-code",children:r.name}),(0,l.jsxs)("span",{children:[" ","must match the type of the selected foreign column when creating a foreign key relationship."]})]})]}),!w&&(null==r?void 0:r.format)&&(0,l.jsxs)(e$.bZ,{variant:"warning",children:[(0,l.jsx)(tm.Z,{strokeWidth:2}),(0,l.jsx)(e$.Cd,{children:"Column types do not match"}),(0,l.jsxs)(e$.X,{className:"leading-6",children:[(0,l.jsx)("span",{children:"The referenced column"}),(null==r?void 0:r.name)&&(0,l.jsx)("span",{className:"text-code",children:r.name}),(0,l.jsx)("span",{children:" is of type "}),(0,l.jsx)("span",{className:"text-code",children:r.format}),(0,l.jsx)("span",{children:" while the selected foreign column "}),(0,l.jsxs)("span",{className:"text-code",children:[null==b?void 0:b.name,".",null==N?void 0:N.name]}),(0,l.jsx)("span",{children:" has "}),(0,l.jsx)("span",{className:"text-code",children:null==N?void 0:N.data_type}),"type. These two columns can't be referenced until they are of the same type."]})]}),(0,l.jsx)(en.ZP.Separator,{}),(0,l.jsx)(Y.Z,{icon:(0,l.jsx)(ts.Z,{size:"large",strokeWidth:1.5}),title:"Which action is most appropriate?",description:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{children:"The choice of the action depends on what kinds of objects the related tables represent:"}),(0,l.jsxs)("ul",{className:"mt-2 list-disc pl-4 space-y-1",children:[(0,l.jsxs)("li",{children:[(0,l.jsx)("code",{className:"text-xs",children:"Cascade"}),": if the referencing table represents something that is a component of what is represented by the referenced table and cannot exist independently"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("code",{className:"text-xs",children:"Restrict"})," or"," ",(0,l.jsx)("code",{className:"text-xs",children:"No action"}),": if the two tables represent independent objects"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("code",{className:"text-xs",children:"Set NULL"})," or"," ",(0,l.jsx)("code",{className:"text-xs",children:"Set default"}),": if a foreign-key relationship represents optional information"]})]}),(0,l.jsx)("p",{className:"mt-2",children:"Typically, restricting and cascading deletes are the most common options, but the default behavior is no action"})]}),url:"https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-FK",urlLabel:"More information"}),(0,l.jsx)(eO.Z,{id:"updateAction",value:x.updateAction,label:"Action if referenced row is updated",descriptionText:(0,l.jsx)("p",{children:generateCascadeActionDescription("update",x.updateAction,"".concat(x.schema,".").concat(x.table))}),error:m.column,onChange:e=>updateCascadeAction("updateAction",e),children:th.filter(e=>["no-action","cascade","restrict"].includes(e.key)).map(e=>(0,l.jsx)(eO.Z.Option,{value:e.value,label:e.label,children:(0,l.jsx)("p",{className:"text-foreground",children:e.label})},e.key))}),(0,l.jsx)(eO.Z,{id:"deletionAction",value:x.deletionAction,label:"Action if referenced row is removed",descriptionText:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{children:generateCascadeActionDescription("delete",x.deletionAction,"".concat(x.schema,".").concat(x.table))}),(0,l.jsx)("p",{className:"mt-2",children:(0,l.jsx)("a",{href:"https://supabase.com/docs/guides/database/postgres/cascade-deletes",target:"_blank",rel:"noreferrer",className:"text-brand opacity-75",children:"Learn more about cascade deletes"})})]}),error:m.column,onChange:e=>updateCascadeAction("deletionAction",e),children:th.map(e=>(0,l.jsx)(eO.Z.Option,{value:e.value,label:e.label,children:(0,l.jsx)("p",{className:"text-foreground",children:e.label})},e.key))})]})]})})},"ForeignKeySelector")},tx=n(49764),tp=n(694),tf=n(71164),tg=n(88979),TableEditor_Column=e=>{var t,n;let{column:a=Z.kT,enumTypes:s=Z.Z6,isNewRecord:r=!1,hasImportContent:i=!1,dragHandleProps:o=Z.kT,onEditRelation:c=G(),onUpdateColumn:d=G(),onRemoveColumn:u=G()}=e,m=null!==(t=null==e4?void 0:e4[a.format])&&void 0!==t?t:[],h=[a.isNullable?1:0,a.isIdentity?1:0,a.isUnique?1:0,a.isArray?1:0].reduce((e,t)=>e+t,0);return(0,l.jsxs)("div",{className:"flex w-full items-center",children:[(0,l.jsx)("div",{className:"w-[5%] ".concat(r?"":"hidden"),children:(0,l.jsx)("div",{className:"cursor-drag",...o,children:(0,l.jsx)(tx.Z,{strokeWidth:1,size:15})})}),(0,l.jsx)("div",{className:"w-[20%]",children:(0,l.jsx)("div",{className:"flex w-[95%] items-center justify-between",children:(0,l.jsx)(e_.Z,{value:a.name,size:"small",title:a.name,disabled:i,placeholder:"column_name",className:"table-editor-columns-input bg-surface-100 lg:gap-0 ".concat(i?"opacity-50":""," rounded-md"),onChange:e=>d({name:e.target.value})})})}),(0,l.jsx)("div",{className:"w-[5%] mr-2.5",children:(0,l.jsxs)(D.fC,{delayDuration:0,children:[(0,l.jsx)(D.xz,{asChild:!0,children:(0,l.jsx)(L.z,{type:void 0!==a.foreignKey?"secondary":"default",onClick:()=>c(a),className:"px-1 py-2",children:(0,l.jsx)(eI.Z,{size:14,strokeWidth:void 0!==a.foreignKey?2:1})})}),(0,l.jsx)(D.h_,{children:(0,l.jsxs)(D.VY,{side:"bottom",children:[(0,l.jsx)(D.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:void 0===a.foreignKey?(0,l.jsx)("span",{className:"text-xs text-foreground",children:"Edit foreign key relation"}):(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-xs text-foreground-light",children:"Foreign key relation:"}),(0,l.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,l.jsxs)("p",{className:"text-xs text-foreground",children:[a.foreignKey.source_schema,".",a.foreignKey.source_table_name,".",a.foreignKey.source_column_name]}),(0,l.jsx)(eh.Z,{size:"tiny",strokeWidth:1.5}),(0,l.jsxs)("p",{className:"text-xs text-foreground",children:[a.foreignKey.target_table_schema,".",a.foreignKey.target_table_name,".",a.foreignKey.target_column_name]})]}),a.foreignKey.deletion_action!==v.NO.NO_ACTION&&(0,l.jsxs)("p",{className:"text-xs text-foreground mt-1",children:["On delete: ",(0,e8.s8)(a.foreignKey.deletion_action)]})]})})]})})]})}),(0,l.jsx)("div",{className:"w-[25%]",children:(0,l.jsx)("div",{className:"w-[95%]",children:(0,l.jsx)(e7.Z,{value:a.format,enumTypes:s,size:"small",showLabel:!1,className:"table-editor-column-type lg:gap-0 ",disabled:void 0!==a.foreignKey,onOptionSelect:e=>{let t="uuid"===e?"gen_random_uuid()":null;d({format:e,defaultValue:t})}})})}),(0,l.jsx)("div",{className:"".concat(r?"w-[25%]":"w-[30%]"),children:(0,l.jsx)("div",{className:"w-[95%]",children:(0,l.jsx)(ColumnEditor_InputWithSuggestions,{placeholder:"string"==typeof a.defaultValue&&0===a.defaultValue.length?"EMPTY":"NULL",size:"small",value:null!==(n=a.defaultValue)&&void 0!==n?n:"",disabled:a.format.includes("int")&&a.isIdentity,className:"rounded bg-surface-100 lg:gap-0 ".concat(a.format.includes("int")&&a.isIdentity?"opacity-50":""),suggestions:m,suggestionsHeader:"Suggested expressions",suggestionsTooltip:"Suggested expressions",onChange:e=>d({defaultValue:e.target.value}),onSelectSuggestion:e=>d({defaultValue:e.value})})})}),(0,l.jsx)("div",{className:"w-[10%]",children:(0,l.jsx)(eG.Z,{label:"",checked:a.isPrimaryKey,onChange:()=>d({isPrimaryKey:!a.isPrimaryKey})})}),(0,l.jsx)("div",{className:"".concat(i?"w-[10%]":"w-[0%]")}),(0,l.jsx)("div",{className:"flex w-[5%] justify-end",children:(!a.isPrimaryKey||a.format.includes("int"))&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(tp.Z,{size:"xlarge",className:"pointer-events-auto",align:"end",modal:!0,header:(0,l.jsx)("div",{className:"flex items-center justify-center",children:(0,l.jsx)("h5",{className:"text-sm text-foreground",children:"Extra options"})}),overlay:[(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[!a.isPrimaryKey&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(eG.Z,{label:"Is Nullable",description:"Specify if the column can assume a NULL value if no value is provided",checked:a.isNullable,className:"p-4",onChange:()=>d({isNullable:!a.isNullable})}),(0,l.jsx)(tp.Z.Separator,{})]}),a.isNewColumn&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(eG.Z,{label:"Is Unique",description:"Enforce if values in the column should be unique across rows",checked:a.isUnique,className:"p-4",onChange:()=>d({isUnique:!a.isUnique})}),(0,l.jsx)(tp.Z.Separator,{})]}),a.format.includes("int")&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(eG.Z,{label:"Is Identity",description:"Automatically assign a sequential unique number to the column",checked:a.isIdentity,className:"p-4",onChange:()=>{let e=!a.isIdentity,t=!e&&a.isArray;d({isIdentity:e,isArray:t})}}),(0,l.jsx)(tp.Z.Separator,{})]}),!a.isPrimaryKey&&(0,l.jsx)(eG.Z,{label:"Define as Array",description:"Define your column as a variable-length multidimensional array",checked:a.isArray,className:"p-4",onChange:()=>{let e=!a.isArray,t=!e&&a.isIdentity;d({isArray:e,isIdentity:t})}})]},"".concat(a.id,"_configuration"))],children:(0,l.jsxs)("div",{className:"group flex items-center -space-x-1",children:[h>0&&(0,l.jsx)("div",{className:"rounded-full bg-foreground py-0.5 px-2 text-xs text-background",children:h}),(0,l.jsx)("div",{className:"text-foreground-light transition-colors group-hover:text-foreground",children:(0,l.jsx)(tf.Z,{size:18,strokeWidth:1})})]})})})}),!i&&(0,l.jsx)("div",{className:"flex w-[5%] justify-end",children:(0,l.jsx)("button",{className:"cursor-pointer",onClick:()=>u(),children:(0,l.jsx)(tg.Z,{strokeWidth:1})})})]})},TableEditor_ColumnManagement=e=>{var t;let{table:n,columns:a=[],enumTypes:s=[],importContent:r,isNewRecord:i,onColumnsUpdated:o=G(),onSelectImportData:c=G(),onClearImportContent:d=G()}=e,[u,m]=(0,O.useState)(),h=!B()(r),[x,p]=eT()(a,e=>e.isPrimaryKey),onUpdateColumn=(e,t)=>{let n=a.map(n=>{if(n.id!==e.id)return n;{let a=eL.BB.includes(e.format);if(a||""!==t.defaultValue||(t.defaultValue=null),"name"in t&&void 0!==n.foreignKey){var l;let e={...n.foreignKey,source_column_name:null!==(l=null==t?void 0:t.name)&&void 0!==l?l:""};return{...n,...t,foreignKey:e}}return{...n,...t}}});o(n)},onAddColumn=()=>{let e=(0,e8.QZ)(),t=a.concat(e);o(t)},onRemoveColumn=e=>{let t=a.filter(t=>t.id!==e.id);o(t)},onSortColumns=(e,t)=>{if(e.destination){if("pks"===t){let t=x.slice(),[n]=t.splice(e.source.index,1);t.splice(e.destination.index,0,n);let l=t.concat(p);return o(l)}if("others"===t){let t=p.slice(),[n]=t.splice(e.source.index,1);t.splice(e.destination.index,0,n);let l=x.concat(t);return o(l)}}};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"w-full space-y-4 table-editor-columns",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,l.jsx)("h5",{children:"Columns"}),i&&(0,l.jsx)(l.Fragment,{children:h?(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)(L.z,{type:"default",icon:(0,l.jsx)(tl.Z,{}),onClick:c,children:"Edit content"}),(0,l.jsx)(L.z,{type:"danger",icon:(0,l.jsx)(ta.Z,{}),onClick:d,children:"Remove content"})]}):(0,l.jsx)(L.z,{type:"default",onClick:c,children:"Import data via spreadsheet"})})]}),h&&(0,l.jsxs)("p",{className:"text-sm text-foreground-light my-2",children:["Your table will be created with ",null==r?void 0:null===(t=r.rowCount)||void 0===t?void 0:t.toLocaleString()," rows and the following ",a.length," columns."]}),0===x.length&&(0,l.jsx)(te.b,{title:"Warning: No primary keys selected",variant:"warning",withIcon:!0,children:"Tables require at least one column as a primary key in order to uniquely identify each row. Without a primary key, you will not be able to update or delete rows from the table."}),x.length>1&&(0,l.jsx)(Y.Z,{block:!0,icon:(0,l.jsx)(ef.Z,{className:"text-white",size:"large"}),title:"Composite primary key selected",description:"The columns that you've selected will be grouped as a primary key, and will serve as the unique identifier for the rows in your table"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex w-full px-3",children:[i&&(0,l.jsx)("div",{className:"w-[5%]"}),(0,l.jsxs)("div",{className:"w-[25%] flex items-center space-x-2",children:[(0,l.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Name"}),(0,l.jsxs)(D.fC,{delayDuration:0,children:[(0,l.jsx)(D.xz,{children:(0,l.jsx)("h5",{className:"text-xs text-foreground-lighter",children:(0,l.jsx)(ts.Z,{size:15,strokeWidth:1.5})})}),(0,l.jsx)(D.h_,{children:(0,l.jsxs)(D.VY,{side:"bottom",children:[(0,l.jsx)(D.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,l.jsx)("span",{className:"text-xs text-foreground",children:"Recommended to use lowercase and use an underscore to separate words e.g. column_name"})})]})})]})]}),(0,l.jsx)("div",{className:"w-[25%]",children:(0,l.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Type"})}),(0,l.jsxs)("div",{className:"".concat(i?"w-[25%]":"w-[30%]"," flex items-center space-x-2"),children:[(0,l.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Default Value"}),(0,l.jsxs)(D.fC,{delayDuration:0,children:[(0,l.jsx)(D.xz,{children:(0,l.jsx)("h5",{className:"text-xs text-foreground-lighter",children:(0,l.jsx)(ts.Z,{size:15,strokeWidth:1.5})})}),(0,l.jsx)(D.h_,{children:(0,l.jsxs)(D.VY,{side:"bottom",children:[(0,l.jsx)(D.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,l.jsx)("span",{className:"text-xs text-foreground",children:"Can either be a literal or an expression. When using an expression wrap your expression in brackets, e.g. (gen_random_uuid())"})})]})})]})]}),(0,l.jsx)("div",{className:"w-[10%]",children:(0,l.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Primary"})}),(0,l.jsx)("div",{className:"".concat(h?"w-[10%]":"w-0")}),(0,l.jsx)("div",{className:"w-[5%]"}),!h&&(0,l.jsx)("div",{className:"w-[5%]"})]}),x.length>0&&(0,l.jsx)(tn.Z5,{onDragEnd:e=>onSortColumns(e,"pks"),children:(0,l.jsx)(tn.bK,{droppableId:"pk_columns_droppable",children:e=>(0,l.jsxs)("div",{ref:e.innerRef,className:"space-y-2 rounded-md bg-surface-200 px-3 py-2 ".concat(i?"":"-mx-3"),children:[x.map((e,t)=>(0,l.jsx)(tn._l,{draggableId:e.id,index:t,children:t=>(0,l.jsx)("div",{ref:t.innerRef,...t.draggableProps,children:(0,l.jsx)(TableEditor_Column,{column:e,enumTypes:s,isNewRecord:i,hasImportContent:h,dragHandleProps:t.dragHandleProps,onEditRelation:()=>{m(e)},onUpdateColumn:t=>onUpdateColumn(e,t),onRemoveColumn:()=>onRemoveColumn(e)})})},e.id)),e.placeholder]})})}),(0,l.jsx)(tn.Z5,{onDragEnd:e=>onSortColumns(e,"others"),children:(0,l.jsx)(tn.bK,{droppableId:"other_columns_droppable",children:e=>(0,l.jsxs)("div",{ref:e.innerRef,className:"space-y-2 py-2 ".concat(i?"px-3 ":""),children:[p.map((e,t)=>(0,l.jsx)(tn._l,{draggableId:e.id,index:t,children:t=>(0,l.jsx)("div",{ref:t.innerRef,...t.draggableProps,children:(0,l.jsx)(TableEditor_Column,{column:e,enumTypes:s,isNewRecord:i,hasImportContent:h,dragHandleProps:t.dragHandleProps,onEditRelation:()=>{m(e)},onUpdateColumn:t=>onUpdateColumn(e,t),onRemoveColumn:()=>onRemoveColumn(e)})})},e.id)),e.placeholder]})})})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[!h&&(0,l.jsx)(L.z,{type:"default",onClick:()=>onAddColumn(),children:"Add column"}),(0,l.jsx)(L.z,{asChild:!0,type:"text",className:"text-foreground-light hover:text-foreground",icon:(0,l.jsx)(eJ.Z,{size:12,strokeWidth:2}),children:(0,l.jsx)(A(),{href:"https://supabase.com/docs/guides/database/tables#data-types",target:"_blank",rel:"noreferrer",children:"Learn more about data types"})})]})]}),(0,l.jsx)(ForeignKeySelector_ForeignKeySelector,{column:u,visible:void 0!==u,closePanel:()=>m(void 0),saveChanges:e=>{if(void 0!==u){var t,l;onUpdateColumn(u,{foreignKey:void 0!==e?{id:0,constraint_name:"",source_schema:null!==(t=null==n?void 0:n.schema)&&void 0!==t?t:"",source_table_name:null!==(l=null==n?void 0:n.name)&&void 0!==l?l:"",source_column_name:null==u?void 0:u.name,target_table_schema:e.table.schema,target_table_name:e.table.name,target_column_name:e.column.name,deletion_action:e.deletionAction,update_action:e.updateAction}:void 0,...void 0!==e&&{format:e.column.format,defaultValue:null}})}m(void 0)}})]})},TableEditor_HeaderTitle=e=>{let{schema:t,table:n,isDuplicating:a}=e;return n?a?(0,l.jsxs)(l.Fragment,{children:["Duplicate table ",(0,l.jsx)("code",{className:"text-sm",children:null==n?void 0:n.name})]}):(0,l.jsxs)(l.Fragment,{children:["Update table ",(0,l.jsx)("code",{className:"text-sm",children:null==n?void 0:n.name})]}):(0,l.jsxs)(l.Fragment,{children:["Create a new table under ",(0,l.jsx)("code",{className:"text-sm",children:t})]})},tv=n(10024);let tj=[{id:(0,ev.k$)(),name:"id",format:"int8",defaultValue:null,check:null,foreignKey:void 0,isNullable:!1,isUnique:!1,isArray:!1,isPrimaryKey:!0,isIdentity:!0,isNewColumn:!0,isEncrypted:!1},{id:(0,ev.k$)(),name:"created_at",format:"timestamptz",defaultValue:"now()",check:null,foreignKey:void 0,isNullable:!1,isUnique:!1,isArray:!1,isPrimaryKey:!1,isIdentity:!1,isNewColumn:!0,isEncrypted:!1}];var ty=n(51525),tb=n.n(ty);let TableEditor_utils_validateFields=e=>{let t={};return 0===e.name.length&&(t.name="Please assign a name for your table"),tb()(e.columns,e=>0===e.format.length)&&(t.columns="Ensure that all your columns are assigned a type"),tb()(e.columns,e=>0===e.name.length)&&(t.columns="Ensure that all your columns are named"),t},generateTableField=()=>({id:0,name:"",comment:"",columns:tj,isRLSEnabled:!0,isRealtimeEnabled:!1}),generateTableFieldFromPostgresTable=function(e,t){var n;let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{id:e.id,name:l?"".concat(e.name,"_duplicate"):e.name,comment:l?"This is a duplicate of ".concat(e.name):null!==(n=null==e?void 0:e.comment)&&void 0!==n?n:"",columns:e.columns.map(n=>(0,e8.uE)(n,e,t)),isRLSEnabled:e.rls_enabled,isRealtimeEnabled:a}},formatImportedContentToColumnFields=e=>{let{headers:t,selectedHeaders:n,columnTypeMap:l}=e,a=t.filter(e=>n.includes(e)).map(e=>{let t=l[e];return(0,e8.QZ)({name:e,format:t})});return a};var TableEditor_TableEditor=e=>{var t,n;let{table:a,isDuplicating:s,visible:r=!1,closePanel:i=G(),saveChanges:o=G(),updateEditorDirty:c=G()}=e,u=(0,T._2)(),{ui:m}=(0,E.oR)(),{project:h}=(0,p.d2)(),x=d()(a),f=(0,E.N3)("realtime:all"),{data:g}=usePostgresTypesQuery({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString}),v=(null!=g?g:[]).filter(e=>!k.U.includes(e.schema)),{data:y}=(0,q.z)({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString}),b=(null!=y?y:[]).find(e=>"supabase_realtime"===e.name),N=null!==(t=null==b?void 0:b.tables)&&void 0!==t?t:[],w=!x&&N.some(e=>e.id===(null==a?void 0:a.id)),[S,C]=(0,O.useState)({}),[_,R]=(0,O.useState)(),[Z,P]=(0,O.useState)(!1),[D,F]=(0,O.useState)(),[I,z]=(0,O.useState)(!1),[U,V]=(0,O.useState)(!1),{data:M}=(0,j.X)({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString,schema:null==a?void 0:a.schema}),H=M||[];(0,O.useEffect)(()=>{if(r){if(C({}),F(void 0),P(!1),x){let e=generateTableField();R(e)}else{let e=generateTableFieldFromPostgresTable(a,H,s,w);R(e)}}},[r]),(0,O.useEffect)(()=>{if(D&&!B()(D)){let e=formatImportedContentToColumnFields(D);onUpdateField({columns:e})}},[D]);let onUpdateField=e=>{let t={..._,...e};R(t),c();let n={...S};for(let t of Object.keys(e))delete n[t];C(n)},onSaveChanges=e=>{if(_){let t=TableEditor_utils_validateFields(_);if(t.columns&&m.setNotification({category:"error",message:t.columns,duration:4e3}),C(t),B()(t)){let t={name:_.name,schema:u.selectedSchemaName,comment:_.comment,...!x&&{rls_enabled:_.isRLSEnabled}},n=_.columns.map(e=>e.foreignKey?{...e,foreignKey:{...e.foreignKey,source_table_name:_.name}}:e),l={tableId:null==a?void 0:a.id,importContent:D,isRLSEnabled:_.isRLSEnabled,isRealtimeEnabled:_.isRealtimeEnabled,isDuplicateRows:Z};o(t,n,x,l,e)}else e()}};return _?(0,l.jsx)(en.ZP,{size:"large",visible:r,header:(0,l.jsx)(TableEditor_HeaderTitle,{schema:u.selectedSchemaName,table:a,isDuplicating:s}),className:"transition-all duration-100 ease-in ".concat(I?" mr-32":""),onCancel:i,onConfirm:()=>e=>onSaveChanges(e),customFooter:(0,l.jsx)(ed.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:i,applyFunction:e=>onSaveChanges(e)}),children:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(en.ZP.Content,{children:(0,l.jsxs)("div",{className:"space-y-10 py-6",children:[(0,l.jsx)(e_.Z,{label:"Name",layout:"horizontal",type:"text",error:S.name,value:null==_?void 0:_.name,onChange:e=>onUpdateField({name:e.target.value})}),(0,l.jsx)(e_.Z,{label:"Description",placeholder:"Optional",layout:"horizontal",type:"text",value:null!==(n=null==_?void 0:_.comment)&&void 0!==n?n:"",onChange:e=>onUpdateField({comment:e.target.value})})]})}),(0,l.jsx)(en.ZP.Separator,{}),(0,l.jsx)(en.ZP.Content,{children:(0,l.jsxs)("div",{className:"space-y-10 py-6",children:[(0,l.jsx)(eG.Z,{id:"enable-rls",label:(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{children:"Enable Row Level Security (RLS)"}),(0,l.jsx)(e9.Z,{color:"gray",children:"Recommended"})]}),description:(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("p",{children:"Restrict access to your table by enabling RLS and writing Postgres policies."})}),checked:_.isRLSEnabled,onChange:()=>{_.isRLSEnabled?V(!0):onUpdateField({isRLSEnabled:!_.isRLSEnabled})},size:"medium"}),_.isRLSEnabled?(0,l.jsxs)(te.b,{withIcon:!0,variant:"info",className:"!px-4 !py-3 mt-3",title:"Policies are required to query data",children:[(0,l.jsxs)("p",{children:["You need to write an access policy before you can query data from this table. Without a policy, querying this table will result in an ",(0,l.jsx)("u",{children:"empty array"})," of results."]}),x&&(0,l.jsx)("p",{className:"mt-3",children:"You can create policies after you create this table."}),(0,l.jsx)("p",{className:"mt-4",children:(0,l.jsx)(L.z,{asChild:!0,type:"default",icon:(0,l.jsx)(tt.Z,{strokeWidth:1.5}),children:(0,l.jsx)(A(),{href:"https://supabase.com/docs/guides/auth/row-level-security",target:"_blank",rel:"noreferrer",children:"RLS Documentation"})})})]}):(0,l.jsxs)(te.b,{withIcon:!0,variant:"warning",className:"!px-4 !py-3 mt-3",title:"You are allowing anonymous access to your table",children:[(0,l.jsxs)("p",{children:[_.name?"The table ".concat(_.name):"Your table"," will be publicly writable and readable"]}),(0,l.jsx)("p",{className:"mt-4",children:(0,l.jsx)(L.z,{asChild:!0,type:"default",icon:(0,l.jsx)(tt.Z,{strokeWidth:1.5}),children:(0,l.jsx)(A(),{href:"https://supabase.com/docs/guides/auth/row-level-security",target:"_blank",rel:"noreferrer",children:"RLS Documentation"})})})]}),f&&(0,l.jsx)(eG.Z,{id:"enable-realtime",label:"Enable Realtime",description:"Broadcast changes on this table to authorized subscribers",checked:_.isRealtimeEnabled,onChange:()=>onUpdateField({isRealtimeEnabled:!_.isRealtimeEnabled}),size:"medium"})]})}),(0,l.jsx)(en.ZP.Separator,{}),(0,l.jsx)(en.ZP.Content,{children:(0,l.jsxs)("div",{className:"space-y-10 py-6",children:[!s&&(0,l.jsx)(TableEditor_ColumnManagement,{table:{name:_.name,schema:u.selectedSchemaName},columns:null==_?void 0:_.columns,enumTypes:v,isNewRecord:x,importContent:D,onColumnsUpdated:e=>onUpdateField({columns:e}),onSelectImportData:()=>z(!0),onClearImportContent:()=>{onUpdateField({columns:tj}),F(void 0)}}),s&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(eG.Z,{id:"duplicate-rows",label:"Duplicate table entries",description:"This will copy all the data in the table into the new table",checked:Z,onChange:()=>P(!Z),size:"medium"})}),(0,l.jsx)(SpreadsheetImport_SpreadsheetImport,{visible:I,headers:null==D?void 0:D.headers,rows:null==D?void 0:D.rows,saveContent:e=>{F(e),z(!1)},closePanel:()=>z(!1)}),(0,l.jsx)(W.Z,{visible:U,header:"Turn off Row Level Security",buttonLabel:"Confirm",size:"medium",onSelectCancel:()=>V(!1),onSelectConfirm:()=>{onUpdateField({isRLSEnabled:!_.isRLSEnabled}),V(!1)},children:(0,l.jsx)(K.C.Content,{children:(0,l.jsx)(tv.Z,{})})})]})})]})},"TableEditor"):null},tN=n(54073),tw=n.n(tN),tS=n(40599),tC=n(11205),t_=n(29557),SpreadsheetImport_SpreadSheetFileUpload=e=>{let{parseProgress:t,uploadedFile:n,onFileUpload:a,removeUploadedFile:s}=e,[r,i]=(0,O.useState)(!1),o=(0,O.useRef)(null),onDragOver=e=>{"dragover"!==e.type||r?("dragleave"===e.type||"drop"===e.type)&&i(!1):i(!0),e.stopPropagation(),e.preventDefault()};return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("p",{className:"mb-2 text-sm text-foreground-light",children:["Upload a CSV or TSV file. The first row should be the headers of the table, and your headers should not include any special characters other than hyphens (",(0,l.jsx)("span",{className:"text-code",children:"-"}),") or underscores (",(0,l.jsx)("span",{className:"text-code",children:"_"}),")."]}),(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"Tip: Datetime columns should be formatted as YYYY-MM-DD HH:mm:ss"})]}),n?(0,l.jsxs)("div",{className:"flex h-28 flex-col items-center justify-center space-y-2 rounded-md border border-dashed border-strong",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(tC.Z,{size:14,strokeWidth:1.5}),(0,l.jsx)("p",{className:"text-sm text-foreground",children:n.name})]}),100===t?(0,l.jsx)(L.z,{type:"outline",onClick:s,children:"Remove File"}):(0,l.jsxs)("div",{className:"flex w-3/5 items-center space-x-2",children:[(0,l.jsx)(el.Z,{className:"h-4 w-4 animate-spin"}),(0,l.jsx)(t_.Z,{value:t,max:100,type:"horizontal",barClass:"bg-green-900",labelBottom:"Checking file...",labelTop:"".concat(t,"%")})]})]}):(0,l.jsx)("div",{className:"flex h-48 cursor-pointer items-center justify-center rounded-md border border-dashed border-strong ".concat(r?"bg-gray-500":""),onDragOver:onDragOver,onDragLeave:onDragOver,onDrop:e=>{onDragOver(e),a(e)},onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.click()},children:(0,l.jsxs)("p",{className:"text-sm",children:["Drag and drop, or ",(0,l.jsx)("span",{className:"text-brand",children:"browse"})," your files"]})}),(0,l.jsx)("input",{ref:o,className:"hidden",type:"file",onChange:a})]})},tE=n(6277),tR=n(25618),tk=n(43502),SpreadSheetImportConfiguration=e=>{let{spreadsheetData:t,selectedHeaders:n,onToggleHeader:a}=e,[s,r]=(0,O.useState)(!1);return(0,l.jsxs)(tR.ZP,{open:s,onOpenChange:r,className:"",children:[(0,l.jsx)(tR.ZP.Trigger,{asChild:!0,children:(0,l.jsx)(en.ZP.Content,{children:(0,l.jsxs)("div",{className:"py-1 flex items-center justify-between",children:[(0,l.jsx)("p",{className:"text-sm",children:"Configure import data"}),(0,l.jsx)(L.z,{type:"text",icon:(0,l.jsx)(tk.Z,{size:18,strokeWidth:2,className:(0,tE.default)("text-foreground-light",s&&"rotate-180")}),className:"px-1",onClick:()=>r(!s)})]})})}),(0,l.jsx)(tR.ZP.Content,{children:(0,l.jsx)(en.ZP.Content,{children:(0,l.jsxs)("div",{className:"py-2 space-y-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"Select which columns to import"}),(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"By default, all columns are selected to be imported from your CSV"})]}),(0,l.jsx)("div",{className:"flex items-center flex-wrap gap-2 pl-0.5 pb-0.5",children:t.headers.map(e=>{let t=n.includes(e);return(0,l.jsx)(L.z,{type:t?"primary":"default",className:(0,tE.default)("transition",t?"opacity-100":"opacity-75"),onClick:()=>a(e),children:e},e)})})]})})})]})},SpreadsheetImport_SpreadSheetTextInput=e=>{let{input:t,onInputChange:n}=e;return(0,l.jsxs)("div",{className:"space-y-10",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("p",{className:"mb-2 text-sm text-foreground-light",children:["Copy a table from a spreadsheet program such as Google Sheets or Excel and paste it in the field below. The first row should be the headers of the table, and your headers should not include any special characters other than hyphens (",(0,l.jsx)("code",{children:"-"}),") or underscores (",(0,l.jsx)("code",{children:"_"}),")."]}),(0,l.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Tip: Datetime columns should be formatted as YYYY-MM-DD HH:mm:ss"})]}),(0,l.jsx)(e_.Z.TextArea,{size:"tiny",className:"font-mono",rows:15,style:{resize:"none"},value:t,onChange:n})]})};let tZ=["text/csv","text/tab-separated-values","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],tT=["csv","tsv"],tP={headers:[],rows:[],rowCount:0,columnTypeMap:{}};var tD=n(90286),tF=n.n(tD),tI=n(93352),tA=n.n(tI);let parseSpreadsheetText=e=>{let t={};return new Promise(n=>{tF().parse(e,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,complete:e=>{let l=e.meta.fields||[],a=e.data,s=e.errors;l.forEach(n=>{let l=inferColumnType(n,e.data);tA()(t,n)?t[n]!==l&&(t[n]="text"):t[n]=l}),n({headers:l,rows:a,previewRows:e.data.slice(0,20),columnTypeMap:t,errors:s})}})})},parseSpreadsheet=(e,t)=>{let n=[],l=0,a=0,s=[],r={},i=[];return new Promise(o=>{tF().parse(e,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,worker:!0,quoteChar:"text/tab-separated-values"===e.type?"":'"',chunkSize:262144,chunk:o=>{if((n=o.meta.fields).forEach(e=>{let t=inferColumnType(e,o.data);tA()(r,e)?r[e]!==t&&(r[e]="text"):r[e]=t}),a+=o.data.length,s=o.data.slice(0,20),o.errors.length>0){let e=o.errors.map(e=>({...e,data:o.data[e.row]}));i.push(...e)}l+=1;let c=262144*l/e.size;t(c>1?100:Number((100*c).toFixed(2)))},complete:()=>{let e={headers:n,rowCount:a,previewRows:s,columnTypeMap:r,errors:i};o(e)}})})},inferColumnType=(e,t)=>{if(0===t.length)return"text";let n=t[0][e],l=t.map(t=>t[e]);if(null==n)return"text";if(Number(n)){let n=t.map(t=>Number(t[e]));if(n.includes(NaN))return"text";{let e=n.map(e=>e%1);return e.every(e=>0===e)?"int8":"float8"}}if(eD()(["true","false"],n.toString().toLowerCase())){let e=l.every(e=>null==e||eD()(["true","false"],e.toString().toLowerCase()));if(e)return"bool"}if((0,ev.dW)(n)){let e=l.every(e=>(0,ev.dW)(n));if(e)return"jsonb"}if(Date.parse(n)){let e=l.every(e=>eU()(e,"YYYY-MM-DD hh:mm:ss").isValid());if(e)return"timestamptz"}return"text"},acceptedFileExtension=e=>{let t=null==e?void 0:e.name.split(".").pop().toLowerCase();return tT.includes(t)};var SpreadsheetImport_SpreadsheetPreviewGrid=e=>{let{headers:t=[],rows:n=[],height:a}=e,s=t.slice(0,20),r=n.slice(0,20);return(0,l.jsx)(ep.ZP,{columns:s.map(e=>{let t=r.map(t=>{var n,l;return null!==(l=null===(n=t[e])||void 0===n?void 0:n.toString())&&void 0!==l?l:""}),n=Math.max(...t.map(e=>e.length));return{key:e,name:e,width:n>20?200:10*n,resizable:!0,headerRenderer:()=>(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsx)("p",{className:"text-xs",children:e})}),formatter:t=>{let{row:n}=t,a=!n[e];return(0,l.jsx)("span",{className:(0,tE.default)("text-sm flex items-center",a&&"text-foreground-light"),children:a?"NULL":n[e]})}}}),rows:r,className:"!border-l !border-r",style:{height:a||"".concat(34+34*(r.length||1),"px")}})},SpreadsheetImport_SpreadsheetImportPreview=e=>{let{selectedTable:t,spreadsheetData:n,errors:a=[],selectedHeaders:s,incompatibleHeaders:r}=e,[i,o]=(0,O.useState)(!1),[c,d]=(0,O.useState)([]),{headers:u,rows:m}=n,h=u.filter(e=>s.includes(e)).slice(0,20),x=m.slice(0,20),p=void 0===t||0===r.length;(0,O.useEffect)(()=>{o(!0)},[n]);let onSelectExpandError=e=>{c.includes(e)?d(c.filter(t=>t!==e)):d(c.concat([e]))};return(0,l.jsxs)(tR.ZP,{open:i,onOpenChange:o,className:"",children:[(0,l.jsx)(tR.ZP.Trigger,{asChild:!0,children:(0,l.jsx)(en.ZP.Content,{children:(0,l.jsxs)("div",{className:"py-1 flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("p",{className:"text-sm",children:"Preview data to be imported"}),!p&&(0,l.jsx)(e9.Z,{color:"red",children:"Data incompatible"}),a.length>0&&(0,l.jsxs)(e9.Z,{color:"yellow",children:[a.length," issues found"]})]}),(0,l.jsx)(L.z,{type:"text",icon:(0,l.jsx)(tk.Z,{size:18,strokeWidth:2,className:(0,tE.default)("text-foreground-light",i&&"rotate-180")}),className:"px-1",onClick:()=>o(!i)})]})})}),(0,l.jsx)(tR.ZP.Content,{children:(0,l.jsxs)(en.ZP.Content,{children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:void 0===t?"Your table will have ".concat(n.rowCount.toLocaleString()," rows and the\n                        following ").concat(n.headers.length," columns."):"A total of ".concat(n.rowCount.toLocaleString(),' rows will be added to the table "').concat(t.name,'"')}),(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"Here is a preview of the data that will be added (up to the first 20 columns and first 20 rows)."})]}),(0,l.jsx)("div",{className:"mb-4",children:h.length>0&&x.length>0?(0,l.jsx)(SpreadsheetImport_SpreadsheetPreviewGrid,{height:350,headers:h,rows:x}):(0,l.jsxs)("div",{className:"flex items-center justify-center py-4 border border-control rounded-md space-x-2",children:[(0,l.jsx)(U.Z,{size:16,strokeWidth:1.5,className:"text-foreground-light"}),(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:0===h.length?"No headers have been selected":0===x.length?"Your CSV contains no data":""})]})}),(!p||a.length>0)&&(0,l.jsxs)("div",{className:"space-y-2 my-4",children:[(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)("p",{className:"text-sm",children:"Issues found in spreadsheet"}),p&&(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:void 0!==t?"This CSV can still be imported into your table despite issues in the following rows.":"Your table can still be created nonetheless despite issues in the following rows."})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[!p&&(0,l.jsx)("div",{className:"space-y-2",children:(0,l.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,l.jsx)("div",{className:"w-[14px] h-[14px] flex items-center justify-center translate-y-[3px]",children:(0,l.jsx)("div",{className:"w-[6px] h-[6px] rounded-full bg-foreground-lighter"})}),(0,l.jsxs)("p",{className:"text-sm",children:["This CSV ",(0,l.jsx)("span",{className:"text-red-900",children:"cannot"})," be imported into your table due to incompatible headers:",(0,l.jsx)("br",{}),"The column",r.length>1?"s":""," ",r.map(e=>'"'.concat(e,'"')).join(", ")," ",r.length>1?"are":"is"," not present in your table"]})]})}),a.map((e,t)=>{var a,s;let r="import-error-".concat(t),i=c.includes(r);return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 cursor-pointer",onClick:()=>onSelectExpandError(r),children:[void 0!==e.data?(0,l.jsx)(eN.Z,{size:14,className:"transform ".concat(i?"rotate-90":"")}):(0,l.jsx)("div",{className:"w-[14px] h-[14px] flex items-center justify-center",children:(0,l.jsx)("div",{className:"w-[6px] h-[6px] rounded-full bg-foreground-lighter"})}),void 0!==e.data&&(0,l.jsxs)("p",{className:"text-sm w-14",children:["Row: ",e.row]}),(0,l.jsx)("p",{className:"text-sm",children:e.message}),(null===(a=e.data)||void 0===a?void 0:a.__parsed_extra)&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(eh.Z,{size:14}),(0,l.jsx)("p",{className:"text-sm",children:"Extra field(s):"}),null===(s=e.data)||void 0===s?void 0:s.__parsed_extra.map((e,t)=>(0,l.jsx)("code",{className:"text-xs",children:e},t))]})]}),void 0!==e.data&&i&&(0,l.jsx)(SpreadsheetImport_SpreadsheetPreviewGrid,{headers:n.headers,rows:[e.data]})]},r)})]})]})]})})]})},SpreadsheetImport_SpreadsheetImport=e=>{var t;let{visible:n=!1,debounceDuration:a=250,headers:s=[],rows:r=[],selectedTable:i,saveContent:o,closePanel:c,updateEditorDirty:d=G()}=e,{ui:u}=(0,E.oR)();(0,O.useEffect)(()=>{n&&0===s.length&&resetSpreadsheetImport()},[n]);let[m,h]=(0,O.useState)("fileUpload"),[x,p]=(0,O.useState)(""),[f,g]=(0,O.useState)(),[v,j]=(0,O.useState)(0),[y,b]=(0,O.useState)({headers:s,rows:r,rowCount:0,columnTypeMap:{}}),[N,S]=(0,O.useState)([]),[C,_]=(0,O.useState)([]),R=(null!==(t=null==i?void 0:i.columns)&&void 0!==t?t:[]).map(e=>e.name),k=C.filter(e=>!R.includes(e)),Z=void 0===i||0===k.length,onProgressUpdate=e=>{j(e)},onFileUpload=async e=>{j(0),e.persist();let[t]=e.target.files||e.dataTransfer.files;if(t.size>104857600)return e.target.value="",(0,w.ZP)((0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("p",{children:"The dashboard currently only supports importing of CSVs below 100MB."}),(0,l.jsx)("p",{children:"For bulk data loading, we recommend doing so directly through the database."}),(0,l.jsx)(L.z,{asChild:!0,type:"default",icon:(0,l.jsx)(eJ.Z,{}),className:"!mt-2",children:(0,l.jsx)(A(),{href:"https://supabase.com/docs/guides/database/tables#bulk-data-loading",target:"_blank",rel:"noreferrer",children:"Learn more"})})]}),{duration:1/0});if(t&&eD()(tZ,null==t?void 0:t.type)&&acceptedFileExtension(t)){d(!0),g(t);let{headers:e,rowCount:n,columnTypeMap:l,errors:a,previewRows:s}=await parseSpreadsheet(t,onProgressUpdate);a.length>0&&u.setNotification({error:a,category:"error",message:"Some issues have been detected on ".concat(a.length," rows. More details below the content preview."),duration:4e3}),S(a),_(e),b({headers:e,rows:s,rowCount:n,columnTypeMap:l})}else u.setNotification({category:"info",message:"Sorry! We only accept CSV or TSV file types, please upload another file."});e.target.value=""},resetSpreadsheetImport=()=>{p(""),b(tP),g(void 0),S([]),d(!1)},readSpreadsheetText=async e=>{if(e.length>0){let{headers:t,rows:n,columnTypeMap:l,errors:a}=await parseSpreadsheetText(e);a.length>0&&u.setNotification({error:a,category:"error",message:"Some issues have been detected on ".concat(a.length," rows. More details below the content preview."),duration:4e3}),S(a),_(t),b({headers:t,rows:n,rowCount:n.length,columnTypeMap:l})}else b(tP)},T=(0,O.useCallback)(tw()(readSpreadsheetText,a),[]);return(0,l.jsxs)(en.ZP,{size:"large",visible:n,align:"right",header:void 0!==i?(0,l.jsxs)(l.Fragment,{children:["Add data to"," ",(0,l.jsxs)("code",{className:"text-sm",children:[i.schema,".",i.name]})]}):"Add content to new table",onCancel:()=>c(),customFooter:(0,l.jsx)(ed.Z,{backButtonLabel:"Cancel",applyButtonLabel:void 0===i?"Save":"Import data",closePanel:c,applyFunction:e=>{"fileUpload"===m&&void 0===f?(u.setNotification({category:"error",message:"Please upload a file to import your data with"}),e()):0===C.length?(u.setNotification({category:"error",message:"Please select at least one header from your CSV"}),e()):Z?o({file:f,...y,selectedHeaders:C,resolve:e}):(u.setNotification({category:"error",message:"The data that you are trying to import is incompatible with your table structure"}),e())}}),children:[(0,l.jsx)(en.ZP.Content,{children:(0,l.jsx)("div",{className:"pt-6",children:(0,l.jsxs)(tS.Z,{block:!0,type:"pills",onChange:h,children:[(0,l.jsx)(tS.Z.Panel,{id:"fileUpload",label:"Upload CSV",children:(0,l.jsx)(SpreadsheetImport_SpreadSheetFileUpload,{parseProgress:v,uploadedFile:f,onFileUpload:onFileUpload,removeUploadedFile:resetSpreadsheetImport})}),(0,l.jsx)(tS.Z.Panel,{id:"pasteText",label:"Paste text",children:(0,l.jsx)(SpreadsheetImport_SpreadSheetTextInput,{input:x,onInputChange:e=>{p(e.target.value),T(e.target.value)}})})]})})}),y.headers.length>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"pt-4",children:(0,l.jsx)(en.ZP.Separator,{})}),(0,l.jsx)(SpreadSheetImportConfiguration,{spreadsheetData:y,selectedHeaders:C,onToggleHeader:e=>{let t=C.includes(e)?C.filter(t=>t!==e):C.concat([e]);_(t)}}),(0,l.jsx)(en.ZP.Separator,{}),(0,l.jsx)(SpreadsheetImport_SpreadsheetImportPreview,{selectedTable:i,spreadsheetData:y,errors:N,selectedHeaders:C,incompatibleHeaders:k}),(0,l.jsx)(en.ZP.Separator,{})]})]})},TableGridEditor_SidePanelEditor=e=>{var t,n,a,r,i,o,c,u,m,h,x,f,g,v,j;let{editable:y=!0,selectedTable:N,onTableCreated:S=G()}=e,C=(0,T._2)(),[R,k]=(0,E.x3)({arrayKeys:["filter","sort"]}),{meta:Z,ui:P}=(0,E.oR)(),D=(0,s.NL)(),{project:F}=(0,p.d2)(),[I,A]=(0,O.useState)(!1),[L,z]=(0,O.useState)(!1),U=(null!==(j=null==N?void 0:N.columns)&&void 0!==j?j:[]).filter(e=>{var t;return(null!==(t=null==e?void 0:e.enums)&&void 0!==t?t:[]).length>0&&"array"===e.data_type.toLowerCase()}).map(e=>e.name),{mutateAsync:V}=useTableRowCreateMutation({onSuccess(){w.Am.success("Successfully created row")}}),{mutateAsync:M}=useTableRowUpdateMutation({onSuccess(){w.Am.success("Successfully updated row")}}),{data:Y}=(0,q.z)({projectRef:null==F?void 0:F.ref,connectionString:null==F?void 0:F.connectionString}),{mutateAsync:Q}=useDatabasePublicationCreateMutation(),{mutateAsync:J}=(0,H.u)({onError:()=>{}}),ee=(0,_.z6)(),saveRow=async(e,t,n,l)=>{let a;if(!F||void 0===N)return console.error("no project or table selected");if(t)try{await V({projectRef:F.ref,connectionString:F.connectionString,table:N,payload:e,enumArrayColumns:U,impersonatedRole:ee()})}catch(e){a=e}else{let t=!B()(e);if(t){if(N.primary_keys.length>0)try{await M({projectRef:F.ref,connectionString:F.connectionString,table:N,configuration:n,payload:e,enumArrayColumns:U,impersonatedRole:ee()})}catch(e){a=e}else a=Error("No primary key"),P.setNotification({category:"error",message:"We can't make changes to this table because there is no primary key. Please create a primary key and try again."})}}l(a),a||(A(!1),C.closeSidePanel())},onSaveJSON=async e=>{var t;if(void 0===N||(null===(t=C.sidePanel)||void 0===t?void 0:t.type)!=="json")return;let n=C.sidePanel.jsonValue;try{let{row:t,column:l}=n,a={[l]:null===e?null:JSON.parse(e)},s={};N.primary_keys.forEach(e=>s[e.name]=t[e.name]);let r={identifiers:s,rowIdx:t.idx};saveRow(a,!1,r,e=>{if(e){var t;w.Am.error(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"Something went wrong while trying to save the JSON value")}})}catch(e){}},onSaveForeignRow=async e=>{var t;if(void 0===N||(null===(t=C.sidePanel)||void 0===t?void 0:t.type)!=="foreign-row-selector")return;let n=C.sidePanel.foreignKey;try{let{row:t,column:l}=n,a={[l.name]:e},s={};N.primary_keys.forEach(e=>s[e.name]=t[e.name]);let r={identifiers:s,rowIdx:t.idx};saveRow(a,!1,r,()=>{})}catch(e){}},saveColumn=async(e,t,n,l,a)=>{var s;let r=(null===(s=C.sidePanel)||void 0===s?void 0:s.type)==="column"&&C.sidePanel.column,{columnId:i}=l,o=n?await Z.createColumn(e,N,t):await Z.updateColumn(i,e,N,t);(null==o?void 0:o.error)?P.setNotification({category:"error",message:o.error.message}):(!n&&e.name&&r&&r.name!==e.name&&reAddRenamedColumnSortAndFilter(r.name,e.name),await Promise.all([D.invalidateQueries(b.M.query(null==F?void 0:F.ref,["foreign-key-constraints"])),D.invalidateQueries($.W.table(null==F?void 0:F.ref,N.id)),D.invalidateQueries(b.M.query(null==F?void 0:F.ref,[N.schema,N.name])),D.invalidateQueries(b.M.query(null==F?void 0:F.ref,["table-definition",N.schema,N.name])),D.invalidateQueries(X.C.list(null==F?void 0:F.ref))]),A(!1),C.closeSidePanel()),a()},reAddRenamedColumnSortAndFilter=(e,t)=>{k(n=>{var l,a;let s=null!==(l=null==n?void 0:n.filter)&&void 0!==l?l:[],r=null!==(a=null==n?void 0:n.sort)&&void 0!==a?a:[];return{...n,filter:s.map(n=>{let[l]=n.split(":");return l===e?n.replace(l,t):n}),sort:r.map(n=>{let[l]=n.split(":");return l===e?n.replace(l,t):n})}})},updateTableRealtime=async(e,t)=>{if(!F)return console.error("Project is required");let n=(null!=Y?Y:[]).find(e=>"supabase_realtime"===e.name),l=await D.fetchQuery({queryKey:$.W.list(F.ref,"public"),queryFn:e=>{let{signal:t}=e;return(0,ek.Lk)({projectRef:F.ref,connectionString:F.connectionString,schema:"public"},t)}});try{void 0===n&&(n=await Q({projectRef:F.ref,connectionString:null==F?void 0:F.connectionString,name:"supabase_realtime",publish_insert:!0,publish_update:!0,publish_delete:!0}));let{id:a,tables:s}=n;if(null===s){let n=t?l.map(e=>"".concat(e.schema,".").concat(e.name)):l.filter(t=>t.id!==e.id).map(e=>"".concat(e.schema,".").concat(e.name));await J({id:a,projectRef:F.ref,connectionString:null==F?void 0:F.connectionString,tables:n})}else{let n=s.some(t=>t.id==e.id),l=n&&!t?s.filter(t=>t.id!==e.id).map(e=>"".concat(e.schema,".").concat(e.name)):!n&&t?["".concat(e.schema,".").concat(e.name)].concat(s.map(e=>"".concat(e.schema,".").concat(e.name))):null;if(null===l)return;await J({id:a,projectRef:F.ref,connectionString:null==F?void 0:F.connectionString,tables:l})}}catch(t){console.log({error:t}),w.Am.error("Failed to update realtime for ".concat(e.name,": ").concat(t.message))}},saveTable=async(e,t,n,l,a)=>{let s;let r=!1,{importContent:i,isRLSEnabled:o,isRealtimeEnabled:c,isDuplicateRows:d}=l;try{var u;if((null===(u=C.sidePanel)||void 0===u?void 0:u.type)==="table"&&"duplicate"===C.sidePanel.mode&&N){s=P.setNotification({category:"loading",message:"Duplicating table: ".concat(N.name,"...")});let t=await Z.duplicateTable(e,{isRLSEnabled:o,isDuplicateRows:d,duplicateTable:N});c&&await updateTableRealtime(t,c),await Promise.all([D.invalidateQueries($.W.list(null==F?void 0:F.ref,t.schema)),D.invalidateQueries(X.C.list(null==F?void 0:F.ref))]),P.setNotification({id:s,category:"success",message:"Table ".concat(N.name," has been successfully duplicated into ").concat(t.name,"!")}),S(t)}else if(n){s=P.setNotification({category:"loading",message:"Creating new table: ".concat(e.name,"...")});let n=await Z.createTable(s,e,t,o,i);c&&await updateTableRealtime(n,!0),await Promise.all([D.invalidateQueries($.W.list(null==F?void 0:F.ref,n.schema)),D.invalidateQueries(X.C.list(null==F?void 0:F.ref))]),P.setNotification({id:s,category:"success",message:"Table ".concat(n.name," is good to go!")}),S(n)}else if(N){s=P.setNotification({category:"loading",message:"Updating table: ".concat(null==N?void 0:N.name,"...")});let{table:n,hasError:l}=await Z.updateTable(s,N,e,t);await updateTableRealtime(n,c),l?P.setNotification({id:s,category:"info",message:"Table ".concat(n.name," has been updated, but there were some errors")}):(D.invalidateQueries(b.M.query(null==F?void 0:F.ref,["foreign-key-constraints"])),await Promise.all([D.invalidateQueries(b.M.query(null==F?void 0:F.ref,[N.schema,N.name])),D.invalidateQueries(b.M.query(null==F?void 0:F.ref,["table-definition",N.schema,N.name])),D.invalidateQueries(X.C.list(null==F?void 0:F.ref)),D.invalidateQueries($.W.table(null==F?void 0:F.ref,n.schema))]),P.setNotification({id:s,category:"success",message:"Successfully updated ".concat(n.name,"!")}))}}catch(e){r=!0,P.setNotification({error:e,id:s,category:"error",message:e.message})}r||(A(!1),C.closeSidePanel()),a()},onImportData=async e=>{if(!F||void 0===N)return console.error("no project or table selected");let{file:t,rowCount:n,selectedHeaders:l,resolve:a}=e,s=P.setNotification({category:"loading",message:"Adding ".concat(n.toLocaleString()," rows to ").concat(N.name)});if(t&&n>0){let{error:e}=await Z.insertRowsViaSpreadsheet(t,N,l,e=>{P.setNotification({id:s,progress:e,category:"loading",message:"Adding ".concat(n.toLocaleString()," rows to ").concat(N.name)})});if(e)return P.setNotification({error:e,id:s,category:"error",message:"Failed to import data: ".concat(e.message)}),a()}else{let{error:t}=await Z.insertTableRows(N,e.rows,l,t=>{P.setNotification({id:s,progress:t,category:"loading",message:"Adding ".concat(e.rows.length.toLocaleString()," rows to ").concat(N.name)})});if(t)return P.setNotification({error:t,id:s,category:"error",message:"Failed to import data: ".concat(t.message)}),a()}await Promise.all([D.invalidateQueries(b.M.query(null==F?void 0:F.ref,[N.schema,N.name]))]),P.setNotification({id:s,category:"success",message:"Successfully imported ".concat(n," rows of data into ").concat(N.name)}),a(),C.closeSidePanel()},onClosePanel=()=>{I?z(!0):C.closeSidePanel()};return(0,l.jsxs)(l.Fragment,{children:[!d()(N)&&(0,l.jsx)(RowEditor_RowEditor,{row:(null===(t=C.sidePanel)||void 0===t?void 0:t.type)==="row"?C.sidePanel.row:void 0,selectedTable:N,visible:(null===(n=C.sidePanel)||void 0===n?void 0:n.type)==="row",closePanel:onClosePanel,saveChanges:saveRow,updateEditorDirty:()=>A(!0)}),!d()(N)&&(0,l.jsx)(ColumnEditor_ColumnEditor,{column:(null===(a=C.sidePanel)||void 0===a?void 0:a.type)==="column"?C.sidePanel.column:void 0,selectedTable:N,visible:(null===(r=C.sidePanel)||void 0===r?void 0:r.type)==="column",closePanel:onClosePanel,saveChanges:saveColumn,updateEditorDirty:()=>A(!0)}),(0,l.jsx)(TableEditor_TableEditor,{table:(null===(i=C.sidePanel)||void 0===i?void 0:i.type)==="table"&&("edit"===C.sidePanel.mode||"duplicate"===C.sidePanel.mode)?N:void 0,isDuplicating:(null===(o=C.sidePanel)||void 0===o?void 0:o.type)==="table"&&"duplicate"===C.sidePanel.mode,visible:(null===(c=C.sidePanel)||void 0===c?void 0:c.type)==="table",closePanel:onClosePanel,saveChanges:saveTable,updateEditorDirty:()=>A(!0)}),(0,l.jsx)(SidePanelEditor_SchemaEditor,{visible:(null===(u=C.sidePanel)||void 0===u?void 0:u.type)==="schema",closePanel:onClosePanel,saveChanges:()=>{}}),(0,l.jsx)(JsonEditor_JsonEditor,{visible:(null===(m=C.sidePanel)||void 0===m?void 0:m.type)==="json",column:(null===(h=C.sidePanel)||void 0===h?void 0:h.type)==="json"&&C.sidePanel.jsonValue.column||"",jsonString:(null===(x=C.sidePanel)||void 0===x?void 0:x.type)==="json"&&C.sidePanel.jsonValue.jsonString||"",backButtonLabel:"Cancel",applyButtonLabel:"Save changes",readOnly:!y,closePanel:onClosePanel,onSaveJSON:onSaveJSON}),(0,l.jsx)(ForeignRowSelector_ForeignRowSelector,{visible:(null===(f=C.sidePanel)||void 0===f?void 0:f.type)==="foreign-row-selector",foreignKey:(null===(g=C.sidePanel)||void 0===g?void 0:g.type)==="foreign-row-selector"?C.sidePanel.foreignKey.foreignKey:void 0,closePanel:onClosePanel,onSelect:onSaveForeignRow}),(0,l.jsx)(SpreadsheetImport_SpreadsheetImport,{visible:(null===(v=C.sidePanel)||void 0===v?void 0:v.type)==="csv-import",selectedTable:N,saveContent:onImportData,closePanel:onClosePanel,updateEditorDirty:A}),(0,l.jsx)(W.Z,{visible:L,header:"Discard changes",buttonLabel:"Discard",onSelectCancel:()=>z(!1),onSelectConfirm:()=>{z(!1),A(!1),C.closeSidePanel()},children:(0,l.jsx)(K.C.Content,{children:(0,l.jsx)("p",{className:"py-4 text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})})]})},tO=n(38617),tL=n(36782),tz=n(20775);let getTableDefinitionQuery=e=>{let{schema:t="public",name:n}=e,l="\n    ".concat(v.kj,"\n\n    select pg_temp.pg_get_tabledef (\n      '").concat(t,"',\n      '").concat(n,"',\n      false,\n      'FKEYS_INTERNAL',\n      'INCLUDE_TRIGGERS'\n    ) as definition\n  ").trim();return l},useTableDefinitionQuery=function(e){let{projectRef:t,connectionString:n,schema:l,name:a}=e,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,S.cp)({projectRef:t,connectionString:n,sql:getTableDefinitionQuery({schema:l,name:a}),queryKey:["table-definition",l,a]},{select:e=>e.result[0].definition.trim(),...s})},getViewDefinitionQuery=e=>{let{schema:t,name:n}=e,l=[t,n].filter(Boolean).join("."),a="\n    select pg_get_viewdef('".concat(l,"', true) as definition\n  ").trim();return a},useViewDefinitionQuery=function(e){let{projectRef:t,connectionString:n,schema:l,name:a}=e,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,S.cp)({projectRef:t,connectionString:n,sql:getViewDefinitionQuery({schema:l,name:a}),queryKey:["view-definition",l,a]},{select:e=>e.result[0].definition.trim(),...s})};var tU=(0,u.Pi)(e=>{let{id:t}=e,{ref:n}=(0,r.UO)(),a=(0,O.useRef)(null),s=(0,O.useRef)(null),{resolvedTheme:i}=(0,tO.F)(),o=(0,R.Z)(t),{project:c}=(0,p.d2)(),d=useViewDefinitionQuery({schema:null==o?void 0:o.schema,name:null==o?void 0:o.name,projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString},{enabled:(null==o?void 0:o.type)===y.l.VIEW||(null==o?void 0:o.type)===y.l.MATERIALIZED_VIEW}),u=useTableDefinitionQuery({schema:null==o?void 0:o.schema,name:null==o?void 0:o.name,projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString},{enabled:(null==o?void 0:o.type)===y.l.TABLE}),{data:m,isLoading:h}=(null==o?void 0:o.type)===y.l.VIEW||(null==o?void 0:o.type)===y.l.MATERIALIZED_VIEW?d:u,x=(null==o?void 0:o.type)===y.l.VIEW?"create view ".concat(o.schema,".").concat(o.name," as\n"):(null==o?void 0:o.type)===y.l.MATERIALIZED_VIEW?"create materialized view ".concat(o.schema,".").concat(o.name," as\n"):"",f=(0,O.useMemo)(()=>m?(0,tL.WU)(x+m,{language:"postgresql",keywordCase:"lower"}):void 0,[m]),handleEditorOnMount=async(e,t)=>{a.current=e,s.current=t,e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),await (0,ev.Vs)(500),null==e||e.focus()};return h?(0,l.jsx)("div",{className:"p-4",children:(0,l.jsx)(tz.A,{})}):(0,l.jsxs)("div",{className:"flex-grow overflow-y-auto border-t border-muted relative",children:[(0,l.jsx)(L.z,{asChild:!0,type:"default",className:"absolute top-2 right-5 z-10",children:(0,l.jsx)(A(),{href:"/project/".concat(n,"/sql/new?content=").concat(encodeURIComponent(null!=f?f:"")),children:"Open in SQL Editor"})}),(0,l.jsx)(eC.default,{className:"monaco-editor",theme:(null==i?void 0:i.includes("dark"))?"vs-dark":"vs",onMount:handleEditorOnMount,defaultLanguage:"pgsql",value:f,path:"",options:{domReadOnly:!0,readOnly:!0,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0}})]})}),tK=(0,u.Pi)(e=>{var t,n,i,c,u;let{theme:N="dark",isLoadingSelectedTable:w=!1,selectedTable:S}=e,C=(0,m.useRouter)(),{meta:D,ui:F}=(0,E.oR)(),{ref:I,id:A}=(0,r.UO)(),{project:O}=(0,p.d2)(),L=(0,T._2)(),z=(0,_.z6)(),[{view:U="data"},K]=(0,E.x3)(),V=(0,E.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"tables"),W=(0,E.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"columns"),M=!V&&!W,q=useEncryptedColumns({schemaName:null==S?void 0:S.schema,tableName:null==S?void 0:S.name}),H=(0,s.NL)(),{mutate:Y}=useTableRowUpdateMutation({async onMutate(e){let{projectRef:t,table:n,configuration:l,payload:a}=e,s=new Set(Object.keys(l.identifiers)),r=b.M.query(t,[n.schema,n.name,{table:{name:n.name,schema:n.schema}}]);await H.cancelQueries(r);let i=H.getQueriesData(r);return H.setQueriesData(r,e=>{var t;return{result:null!==(t=null==e?void 0:e.result.map(e=>Object.entries(e).filter(e=>{let[t]=e;return s.has(t)}).every(e=>{let[t,n]=e;return n===l.identifiers[t]})?{...e,...a}:e))&&void 0!==t?t:[]}}),{previousRowsQueries:i}},onError(e,t,n){let{previousRowsQueries:l}=n;l.forEach(e=>{let[t,n]=e;n&&H.setQueriesData(t,n),H.invalidateQueries(t)}),onError(e)}}),{data:Q}=(0,j.X)({projectRef:null==O?void 0:O.ref,connectionString:null==O?void 0:O.connectionString,schema:null==S?void 0:S.schema}),B=Q||[],J=(0,R.Z)(null==S?void 0:S.id),G=(0,E.dU)(null!==(t=null==S?void 0:S.columns)&&void 0!==t?t:Z.Z6);if(w)return(0,l.jsx)(f.Z,{});if(d()(S))return(0,l.jsx)(TableGridEditor_NotFoundState,{id:Number(A)});let X=(null==J?void 0:J.type)===y.l.VIEW||(null==J?void 0:J.type)===y.l.MATERIALIZED_VIEW,$=(null==J?void 0:J.type)===y.l.TABLE,ee=(null==J?void 0:J.type)===y.l.FOREIGN_TABLE,et=k.F.includes(null!==(n=null==J?void 0:J.schema)&&void 0!==n?n:""),en=$&&!et,el=("relationships"in S&&S.relationships||[]).map(e=>{var t;let n=B.find(t=>t.id===e.id);return{...e,deletion_action:null!==(t=null==n?void 0:n.deletion_action)&&void 0!==t?t:v.NO.NO_ACTION}}),ea=X||ee?(0,h.NK)({table:S,columns:null!==(u=S.columns)&&void 0!==u?u:[],primaryKeys:[],relationships:[]}):(0,h.NK)({table:S,columns:null!==(i=S.columns)&&void 0!==i?i:[],primaryKeys:null!==(c=S.primary_keys)&&void 0!==c?c:[],relationships:el},q),es="".concat(S.schema,"_").concat(S.name),onSqlQuery=async e=>{let t=await D.query(e);return t.error?{error:t.error}:{data:t}},onError=e=>{var t,n;F.setNotification({category:"error",message:null!==(n=null!==(t=null==e?void 0:e.details)&&void 0!==t?t:null==e?void 0:e.message)&&void 0!==n?n:e})};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(h.zB,{theme:N,gridProps:{height:"100%"},storageRef:I,editable:!M&&en,schema:S.schema,table:ea,headerActions:$||X||en?(0,l.jsxs)(l.Fragment,{children:[en&&(0,l.jsx)(TableGridEditor_GridHeaderActions,{table:S}),($||X)&&(0,l.jsxs)(l.Fragment,{children:[X&&(0,l.jsx)(P.Q,{serviceRoleLabel:"postgres"}),en&&(0,l.jsx)("div",{className:"h-[20px] w-px border-r border-control"}),(0,l.jsx)("div",{children:(0,l.jsx)(g.Z,{width:75,options:["definition","data"],activeOption:U,borderOverride:"border-gray-500",onClickOption:e=>{"data"===e?K({view:void 0}):K({view:e})}})})]})]}):null,onAddColumn:L.onAddColumn,onEditColumn:e=>{let t=o()(G.current,{name:e});t?L.onEditColumn(t):F.setNotification({category:"error",message:"Unable to find column ".concat(e," in ").concat(null==S?void 0:S.name)})},onDeleteColumn:e=>{var t;let n=o()(null!==(t=G.current)&&void 0!==t?t:[],{name:e});n?L.onDeleteColumn(n):F.setNotification({category:"error",message:"Unable to find column ".concat(e," in ").concat(null==S?void 0:S.name)})},onAddRow:L.onAddRow,updateTableRow:(e,t)=>{var n;if(!O)return;let l="columns"in S&&(null===(n=S.columns)||void 0===n?void 0:n.filter(e=>{var t;return(null!==(t=null==e?void 0:e.enums)&&void 0!==t?t:[]).length>0&&"array"===e.data_type.toLowerCase()}).map(e=>e.name))||[],a={};if(S.primary_keys.forEach(t=>a[t.name]=e[t.name]),0===Object.keys(a).length)return F.setNotification({category:"error",message:x.jg});Y({projectRef:O.ref,connectionString:O.connectionString,table:ea,configuration:{identifiers:a},payload:t,enumArrayColumns:l,impersonatedRole:z()})},onEditRow:L.onEditRow,onImportData:L.onImportData,onError:onError,onSqlQuery:onSqlQuery,onExpandJSONEditor:(e,t)=>L.onExpandJSONEditor({column:e,row:t,jsonString:JSON.stringify(t[e])||""}),onEditForeignKeyColumnValue:L.onEditForeignKeyColumnValue,showCustomChildren:(X||$)&&"definition"===U,customHeader:(X||$)&&"definition"===U?(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsxs)("p",{children:["SQL Definition of ",(0,l.jsx)("code",{className:"text-sm",children:S.name})," "]}),(0,l.jsx)("p",{className:"text-foreground-light text-sm",children:"(Read only)"})]}):null,children:(X||$)&&(0,l.jsx)(tU,{id:null==S?void 0:S.id})},es),void 0!==L.selectedSchemaName&&(0,l.jsx)(TableGridEditor_SidePanelEditor,{editable:!M&&en,selectedTable:S,onTableCreated:e=>{C.push("/project/".concat(I,"/editor/").concat(e.id))}})]})}),tV=n(82042),tW=n(24435),TableGridEditor_EmptyState=e=>{var t,n;let{}=e,s=(0,T._2)(),r=k.F.includes(s.selectedSchemaName),i=(0,E.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"tables")&&!r,[o]=(0,E._)("table-editor-sort","alphabetical"),{project:c}=(0,p.d2)(),{data:d}=(0,tW.H)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString,schema:s.selectedSchemaName,sort:o},{keepPreviousData:!0}),u=null!==(n=null==d?void 0:null===(t=d.pages)||void 0===t?void 0:t[0].data.count)&&void 0!==n?n:0;return(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:0===u?(0,l.jsx)(tV.Z,{title:"Table Editor",ctaButtonLabel:i?"Create a new table":void 0,onClickCta:i?s.onAddTable:void 0,children:(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"There are no tables available in this schema."})}):(0,l.jsx)("div",{className:"flex flex-col items-center space-y-4",children:(0,l.jsx)(tV.Z,{title:"Table Editor",ctaButtonLabel:i?"Create a new table":void 0,onClickCta:i?s.onAddTable:void 0,children:(0,l.jsxs)("p",{className:"text-sm text-foreground-light",children:["Select a table from the navigation panel on the left to view its data",i&&", or create a new one."]})})})})},tM=tK},48193:function(e,t,n){n.d(t,{RT:function(){return r},xY:function(){return useUsersQuery}});var l=n(58943),a=n(9402),s=n(549);let r=10;async function getUsers(e,t){let{projectRef:n,page:l=1,keywords:s="",verified:i}=e;if(!n)throw Error("Project ref is required");let o={limit:r.toString(),offset:((l-1)*10).toString(),keywords:s};i&&(o.verified=i);let{data:c,error:d}=await (0,a.U2)("/platform/auth/{ref}/users",{params:{path:{ref:n},query:o},signal:t});if(d)throw d;return c}let useUsersQuery=function(e){let{projectRef:t,page:n,keywords:a,verified:r}=e,{enabled:i=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,l.a)(s.o.users(t,{page:n,keywords:a,verified:r}),e=>{let{signal:l}=e;return getUsers({projectRef:t,page:n,keywords:a,verified:r},l)},{enabled:i&&void 0!==t,...o})}},83359:function(e,t,n){var l=n(52322);n(2784);var a=n(50468),s=n(97265);t.Z=function(e){return(0,l.jsx)(s.Z,{icon:a.Z,...e})}}}]);