(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6526],{50893:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/logs/explorer",function(){return t(61572)}])},7141:function(e,s,t){"use strict";var n=t(52322),a=t(1681),i=t(94580),l=t(39097),r=t.n(l),o=t(1872),c=t(89465);s.Z=e=>{let{show:s,setShowUpgradePrompt:t}=e,l=(0,c.lL)();return(0,n.jsx)(a.C,{hideFooter:!0,visible:s,closable:!0,size:"medium",header:"Log retention",onCancel:()=>t(!1),children:(0,n.jsxs)("div",{className:"space-y-4 py-4",children:[(0,n.jsx)(a.C.Content,{children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("p",{className:"text-sm",children:"Logs can be retained up to a duration of 3 months depending on the plan that your project is on."}),(0,n.jsxs)("div",{className:"border-control bg-surface-300 rounded border",children:[(0,n.jsxs)("div",{className:"flex items-center px-4 pt-2 pb-1",children:[(0,n.jsx)("p",{className:"text-foreground-light w-[40%] text-sm",children:"Plan"}),(0,n.jsx)("p",{className:"text-foreground-light w-[60%] text-sm",children:"Retention duration"})]}),(0,n.jsxs)("div",{className:"py-1",children:[(0,n.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,n.jsx)("p",{className:"w-[40%] text-sm",children:"Free"}),(0,n.jsx)("p",{className:"w-[60%] text-sm",children:o.fg.FREE.text})]}),(0,n.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,n.jsx)("p",{className:"w-[40%] text-sm",children:"Pro"}),(0,n.jsx)("p",{className:"w-[60%] text-sm",children:o.fg.PRO.text})]}),(0,n.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,n.jsx)("p",{className:"w-[40%] text-sm",children:"Team"}),(0,n.jsx)("p",{className:"w-[60%] text-sm",children:o.fg.TEAM.text})]}),(0,n.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,n.jsx)("p",{className:"w-[40%] text-sm",children:"Enterprise"}),(0,n.jsx)("p",{className:"w-[60%] text-sm",children:o.fg.ENTERPRISE.text})]})]})]})]})}),(0,n.jsx)(a.C.Separator,{}),(0,n.jsx)(a.C.Content,{children:(0,n.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,n.jsx)(i.z,{type:"default",onClick:()=>t(!1),children:"Close"}),(0,n.jsx)(i.z,{asChild:!0,size:"tiny",children:(0,n.jsx)(r(),{href:"/org/".concat(null==l?void 0:l.slug,"/billing?panel=subscriptionPlan"),children:"Upgrade"})})]})})]})})}},63825:function(e,s,t){"use strict";var n=t(52322);s.Z=e=>{let{children:s,active:t,className:a}=e;return(0,n.jsx)("div",{className:[a,"flex h-full flex-grow transition-opacity ",t?"opacity-30":"opacity-100"].join(" "),children:s})}},81409:function(e,s,t){"use strict";var n=t(52322),a=t(24990),i=t(1872),l=t(44171),r=t(71813),o=t(39097),c=t.n(o),d=t(2784),x=t(82089),m=t(8809),p=t(94580),u=t(63157),h=t(66768),f=t(88979),j=t(78796),g=t(40599),v=t(55216),y=t(49097);s.Z=e=>{let{subtitle:s}=e,[t,a]=(0,d.useState)(!1);return(0,n.jsxs)("div",{className:"flex items-center gap-8 transition-all pb-6 justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded border border-brand-600 bg-brand-300 text-brand ",children:(0,n.jsx)(m.Z,{size:14,strokeWidth:3})}),(0,n.jsx)("h1",{className:"text-2xl text-foreground",children:"Logs Explorer"}),s&&(0,n.jsx)("span",{className:"text-2xl text-foreground-light",children:s})]}),(0,n.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,n.jsx)(p.z,{asChild:!0,type:"default",icon:(0,n.jsx)(u.Z,{strokeWidth:1.5}),children:(0,n.jsx)(c(),{href:i.n7,children:"Documentation"})}),(0,n.jsxs)(h.ZP,{size:"large",header:(0,n.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,n.jsx)("h3",{children:"Field Reference"}),(0,n.jsx)(p.z,{type:"text",className:"px-1",onClick:()=>a(!1),icon:(0,n.jsx)(f.Z,{size:18,strokeWidth:1.5})})]}),visible:t,cancelText:"Close",onCancel:()=>a(!1),hideFooter:!0,triggerElement:(0,n.jsx)(p.z,{type:"default",onClick:()=>a(!0),icon:(0,n.jsx)(j.Z,{strokeWidth:1.5}),children:"Field Reference"}),children:[(0,n.jsx)(h.ZP.Content,{children:(0,n.jsx)("div",{className:"pt-4 pb-2 space-y-1",children:(0,n.jsxs)("p",{className:"text-sm",children:["The following table shows all the available paths that can be queried from each respective source. Do note that to access nested keys, you would need to perform the necessary"," ",(0,n.jsxs)(c(),{href:"https://supabase.com/docs/guides/platform/logs#unnesting-arrays",target:"_blank",rel:"noreferrer",className:"text-brand",children:["unnesting joins",(0,n.jsx)(u.Z,{size:"tiny",className:"ml-1 inline -translate-y-[2px]",strokeWidth:1.5})]})]})})}),(0,n.jsx)(h.ZP.Separator,{}),(0,n.jsx)(g.Z,{scrollable:!0,size:"small",type:"underlined",defaultActiveId:"edge_logs",listClassNames:"px-2",children:x.vc.schemas.map(e=>(0,n.jsx)(g.Z.Panel,{id:e.reference,label:e.name,className:"px-4 pb-4",children:(0,n.jsx)(l.Z,{head:[(0,n.jsx)(l.Z.th,{className:"text-xs !p-2",children:"Path"},"path"),(0,n.jsx)(l.Z.th,{className:"text-xs !p-2",children:"Type"},"type")],body:e.fields.sort((e,s)=>e.path-s.path).map(e=>(0,n.jsx)(Field,{field:e},e.path))})},e.reference))})]})]})]})};let Field=e=>{let{field:s}=e,[t,i]=(0,d.useState)(!1);return(0,n.jsxs)(l.Z.tr,{children:[(0,n.jsxs)(l.Z.td,{className:"font-mono text-xs !p-2 cursor-pointer hover:text-foreground transition flex items-center space-x-2",onClick:()=>(0,r.vQ)(s.path,()=>{i(!0),setTimeout(()=>i(!1),3e3)}),children:[(0,n.jsx)("span",{children:s.path}),t?(0,n.jsxs)(a.fC,{delayDuration:0,children:[(0,n.jsx)(a.xz,{children:(0,n.jsx)(v.Z,{size:14,strokeWidth:3,className:"text-brand"})}),(0,n.jsx)(a.h_,{children:(0,n.jsxs)(a.VY,{side:"bottom",children:[(0,n.jsx)(a.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"Copied"})})]})})]}):(0,n.jsxs)(a.fC,{delayDuration:0,children:[(0,n.jsx)(a.xz,{children:(0,n.jsx)(y.Z,{size:"tiny",strokeWidth:1.5})}),(0,n.jsx)(a.h_,{children:(0,n.jsxs)(a.VY,{side:"bottom",children:[(0,n.jsx)(a.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"Copy value"})})]})})]})]}),(0,n.jsx)(l.Z.td,{className:"font-mono text-xs !p-2",children:s.type})]})}},66893:function(e,s,t){"use strict";var n=t(58943),a=t(1872),i=t(2784),l=t(46732),r=t(3218);s.Z=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=(0,a.PJ)(a.up),[o,c]=(0,i.useState)({sql:(null==s?void 0:s.sql)||"",project:e,iso_timestamp_start:s.iso_timestamp_start?s.iso_timestamp_start:t.calcFrom(),iso_timestamp_end:s.iso_timestamp_end?s.iso_timestamp_end:t.calcTo()}),d=void 0!==e&&!!o.sql,x=(0,a.GT)(o),{data:m,error:p,isLoading:u,isRefetching:h,refetch:f}=(0,n.a)(["projects",e,"logs",x],s=>{let{signal:t}=s;return(0,r.U2)("".concat(l.T5,"/projects/").concat(e,"/analytics/endpoints/logs.all?").concat(x),{signal:t})},{enabled:d,refetchOnWindowFocus:!1}),j=p?p.message:null;return!j&&(null==m?void 0:m.error)&&(j=null==m?void 0:m.error),{params:o,isLoading:d&&u||h,logData:(0,r.d8)(m)&&m.result?m.result:[],error:j,changeQuery:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";c(s=>({...s,sql:e}))},runQuery:()=>f(),setParams:c}}},45360:function(e,s,t){"use strict";t.d(s,{_:function(){return useUpgradePrompt}});var n=t(2784),a=t(1872),i=t(21511),l=t(18569);let useUpgradePrompt=e=>{var s;let t=(0,l.l)(),{data:r}=(0,i.G)({orgSlug:null==t?void 0:t.slug}),[o,c]=(0,n.useState)(!1),d=(0,a.dP)(e,null==r?void 0:null===(s=r.plan)||void 0===s?void 0:s.id);return(0,n.useEffect)(()=>{d&&c(!0)},[e]),{showUpgradePrompt:o,setShowUpgradePrompt:c,shouldShowUpgradePrompt:d}}},61572:function(e,s,t){"use strict";t.r(s),t.d(s,{LogsExplorerPage:function(){return LogsExplorerPage},default:function(){return P}});var n=t(52322),a=t(28879),i=t.n(a),l=t(46776),r=t(5632),o=t(2784),c=t(1681),d=t(57463),x=t(31915),m=t(94580),p=t(73872),u=t(1872),h=t(7141),f=t(51373),j=t(35229),g=t(63825),v=t(81409),y=t(50575),N=t(55830),_=t(62350),b=t(9402),w=t(13080);async function insertContent(e,s){let{projectRef:t,payload:n}=e,{data:a,error:i}=await (0,b.v_)("/platform/projects/{ref}/content",{params:{path:{ref:t}},body:{id:n.id,name:n.name,description:n.description,owner_id:n.owner_id,type:n.type,visibility:n.visibility,content:n.content},signal:s});if(i)throw i;return a}let useContentInsertMutation=function(){let{onSuccess:e,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,N.NL)();return(0,_.D)(e=>insertContent(e),{async onSuccess(s,n,a){let{projectRef:i}=n;await Promise.all([t.invalidateQueries(w.$.list(i))]),await (null==e?void 0:e(s,n,a))},...s})};var C=t(89465),S=t(66893),Z=t(45360),q=t(71813),E=t(21511);let LogsExplorerPage=()=>{(0,u.Q9)();let{ui:e}=(0,C.oR)(),s=(0,r.useRouter)(),{ref:t,q:a,ite:l,its:f}=(0,p.UO)(),N=(0,C.lL)(),[_,b]=(0,o.useState)((0,q.k$)()),[w,P]=(0,o.useState)("select\n  cast(timestamp as datetime) as timestamp,\n  event_message, metadata \nfrom edge_logs \nlimit 5"),[k,z]=(0,o.useState)(!1),[L,T]=(0,o.useState)([]),{data:R}=(0,E.G)({orgSlug:null==N?void 0:N.slug}),{params:F,logData:W,error:D,isLoading:I,changeQuery:O,runQuery:U,setParams:$}=(0,S.Z)(t,{iso_timestamp_start:f||void 0,iso_timestamp_end:l||void 0}),[M,Q]=(0,C._)("project-content-".concat(t,"-recent-log-sql"),[]),addRecentLogSqlSnippet=e=>{Q([...M,{schema_version:"1",favorite:!1,sql:"",content_id:"",...e}])},{showUpgradePrompt:V,setShowUpgradePrompt:A}=(0,Z._)(F.iso_timestamp_start);(0,o.useEffect)(()=>{a&&onSelectTemplate({mode:"custom",searchString:a})},[]),(0,o.useEffect)(()=>{let e=[],s=F.iso_timestamp_start?i()(F.iso_timestamp_start):i()(),t=F.iso_timestamp_end?i()(F.iso_timestamp_end):i()(),n=Math.abs(s.diff(t,"days"));w&&!w.includes("limit")&&n>u.$K&&e.push({text:"When querying large date ranges, include a LIMIT clause."}),T(e)},[w,F.iso_timestamp_start,F.iso_timestamp_end]),(0,o.useEffect)(()=>{if(f){var e;let s=(0,u.dP)(f,null==R?void 0:null===(e=R.plan)||void 0===e?void 0:e.id);s&&A(!V)}},[f,R]);let onSelectTemplate=e=>{P(e.searchString),O(e.searchString),b((0,q.k$)()),s.push({pathname:s.pathname,query:{...s.query,q:e.searchString}}),addRecentLogSqlSnippet({sql:e.searchString})},handleRun=e=>{let t="string"==typeof e&&e||w;e&&"string"==typeof e&&P(e),O(t),U(),s.push({pathname:s.pathname,query:{...s.query,q:t}}),addRecentLogSqlSnippet({sql:t})},{isLoading:G,mutate:X}=useContentInsertMutation({onError:s=>{console.error(s),z(!1),e.setNotification({error:s,category:"error",message:"Failed to save query: ".concat(s.message)})},onSuccess:s=>{z(!1),e.setNotification({category:"success",message:'Saved "'.concat(s[0].name,'" log query')})}});return(0,n.jsxs)("div",{className:"w-full h-full px-5 py-6 mx-auto",children:[(0,n.jsx)(v.Z,{}),(0,n.jsxs)("div",{className:"flex flex-col flex-grow h-full gap-4",children:[(0,n.jsxs)("div",{className:"border rounded",children:[(0,n.jsx)(u.dL,{defaultFrom:F.iso_timestamp_start||"",defaultTo:F.iso_timestamp_end||"",onDateChange:e=>{var t;let{to:n,from:a}=e,i=(0,u.dP)(a,null==R?void 0:null===(t=R.plan)||void 0===t?void 0:t.id);i?A(!V):($(e=>({...e,iso_timestamp_start:a||"",iso_timestamp_end:n||""})),s.push({pathname:s.pathname,query:{...s.query,its:a||"",ite:n||""}}))},onSelectSource:e=>{P(s=>s+e),b((0,q.k$)())},onClear:()=>{P(""),b((0,q.k$)()),O("")},onRun:handleRun,hasEditorValue:!!w,templates:u.xN.filter(e=>"custom"===e.mode),onSelectTemplate:onSelectTemplate,onSave:function(){z(!k)},isLoading:I,warnings:L}),(0,n.jsxs)("div",{className:"h-48 min-h-[7rem]",children:[(0,n.jsx)(y.Z,{active:I}),(0,n.jsx)(j.ZP,{id:_,language:"pgsql",defaultValue:w,onInputChange:e=>P(e||""),onInputRun:handleRun})]})]}),(0,n.jsxs)("div",{className:"relative flex flex-col flex-grow",children:[(0,n.jsx)(g.Z,{active:I,children:(0,n.jsx)("div",{className:"flex flex-grow h-full",children:(0,n.jsx)(u.ol,{params:F,data:W,error:D,projectRef:t})})}),(0,n.jsx)("div",{className:"flex flex-row justify-end mt-2",children:(0,n.jsx)(h.Z,{show:V,setShowUpgradePrompt:A})})]})]}),(0,n.jsx)(c.C,{size:"medium",onCancel:()=>z(!k),header:"Save log query",visible:k,hideFooter:!0,children:(0,n.jsx)(d.Z,{initialValues:{name:"",desdcription:""},onSubmit:async(e,s)=>{let{setSubmitting:n}=s;n(!0);let a={id:(0,q.k$)(),name:e.name,description:e.description||"",type:"log_sql",content:{content_id:_,sql:w,schema_version:"1",favorite:!1},visibility:"user"};X({projectRef:t,payload:a})},children:()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"py-4",children:(0,n.jsx)(c.C.Content,{children:(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)(x.Z,{layout:"horizontal",label:"Name",id:"name"}),(0,n.jsx)("div",{className:"text-area-text-sm",children:(0,n.jsx)(x.Z.TextArea,{layout:"horizontal",labelOptional:"Optional",label:"Description",id:"description",rows:2})})]})})}),(0,n.jsx)("div",{className:"py-3 border-t bg-surface-100",children:(0,n.jsx)(c.C.Content,{children:(0,n.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,n.jsx)(m.z,{size:"tiny",type:"default",onClick:()=>z(!k),children:"Cancel"}),(0,n.jsx)(m.z,{size:"tiny",loading:G,htmlType:"submit",children:"Save"})]})})})]})})})]})};LogsExplorerPage.getLayout=e=>(0,n.jsx)(f.Uj,{children:e});var P=(0,l.Pi)(LogsExplorerPage)}},function(e){e.O(0,[1715,1187,6653,3844,8421,9362,4796,806,2591,3958,8119,9574,1915,4079,4964,8211,452,8108,3313,1872,9774,2888,179],function(){return e(e.s=50893)}),_N_E=e.O()}]);