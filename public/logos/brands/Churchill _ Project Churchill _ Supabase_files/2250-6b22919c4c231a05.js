"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2250],{56995:function(e,s,r){r.d(s,{Y:function(){return i},w:function(){return t}});let t=.8,i=["Pricing","My project isn't getting traction","Poor customer service","Missing feature","I didn't see the value","Supabase didn't meet my needs","Dashboard is too complicated","Postgres is too complicated","Problem not solved","Too many bugs/issues","I decided to use something else","My work has finished/discontinued","Iâ€™m migrating to/starting a new project","None of the above"]},75641:function(e,s,r){r.d(s,{Z:function(){return Infrastructure_ProjectUpgradeAlert}});var t=r(52322),i=r(55830),n=r(39097),o=r.n(n),a=r(5632),l=r(2784),d=r(50074),c=r(94580),u=r(1681),p=r(57463),g=r(39195),h=r(16236),v=r(60240),m=r(73872),j=r(50226),f=r(62350),x=r(62202),b=r(9402);async function upgradeProject(e){let{ref:s,target_version:r}=e,{data:t,error:i}=await (0,b.v_)("/v1/projects/{ref}/upgrade",{params:{path:{ref:s}},body:{target_version:r}});if(i)throw i;return t}let useProjectUpgradeMutation=function(){let{onSuccess:e,onError:s,...r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,f.D)(e=>upgradeProject(e),{async onSuccess(s,r,t){await (null==e?void 0:e(s,r,t))},async onError(e,r,t){void 0===s?x.Am.error("Failed to upgrade project: ".concat(e.message)):s(e,r,t)},...r})};var _=r(29659),y=r(89465),w=r(46732),Infrastructure_ProjectUpgradeAlert=()=>{var e,s,r,n,f;let x=(0,a.useRouter)(),{ui:b}=(0,y.oR)(),{ref:N}=(0,m.UO)(),P=(0,i.NL)(),[C,k]=(0,l.useState)(!1),{data:Z}=(0,j.D)({projectRef:N}),U=(null!==(r=null==Z?void 0:Z.current_app_version)&&void 0!==r?r:"").split("supabase-postgres-")[1],I=(null!==(n=null==Z?void 0:Z.latest_app_version)&&void 0!==n?n:"").split("supabase-postgres-")[1],S=(null==Z?void 0:Z.duration_estimate_hours)||1,z=(null==Z?void 0:Z.legacy_auth_custom_roles)||[],R={version:null!==(f=null==Z?void 0:null===(s=Z.target_upgrade_versions)||void 0===s?void 0:null===(e=s[0])||void 0===e?void 0:e.postgres_version)&&void 0!==f?f:0},{mutate:T,isLoading:Y}=useProjectUpgradeMutation({onSuccess:(e,s)=>{(0,_.k7)(P,s.ref,w.S.UPGRADING),b.setNotification({category:"success",message:"Upgrading project"}),x.push("/project/".concat(s.ref,"?upgradeInitiated=true"))}}),onConfirmUpgrade=async e=>{if(!N)return b.setNotification({category:"error",message:"Project ref not found"});T({ref:N,target_version:e.version})};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(d.bZ,{title:"Your project can be upgraded to the latest version of Postgres",children:[(0,t.jsx)(d.Cd,{children:"Your project can be upgraded to the latest version of Postgres"}),(0,t.jsxs)(d.X,{children:[(0,t.jsxs)("p",{className:"mb-3",children:["The latest version of Postgres (",I,") is available for your project."]}),(0,t.jsx)(c.z,{size:"tiny",type:"primary",onClick:()=>k(!0),children:"Upgrade project"})]})]}),(0,t.jsx)(u.C,{hideFooter:!0,visible:C,onCancel:()=>k(!1),header:(0,t.jsx)("h3",{children:"Upgrade Postgres"}),children:(0,t.jsx)(p.Z,{id:"project-upgrade-form",initialValues:R,onSubmit:onConfirmUpgrade,children:e=>{var s,r,i,n;let{values:a}=e,l=(null!==(r=null==Z?void 0:Z.target_upgrade_versions)&&void 0!==r?r:[]).find(e=>e.postgres_version===a.version);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"py-6",children:(0,t.jsx)(u.C.Content,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("p",{className:"text-sm",children:"All services are going offline."}),(0,t.jsxs)("p",{className:"text-sm",children:["You will not be able to downgrade back to Postgres ",U,"."]}),(0,t.jsxs)(d.bZ,{title:"Your project will be offline while the upgrade is in progress",children:[(0,t.jsx)(g.Z,{className:"h-4 w-4",strokeWidth:2}),(0,t.jsxs)(d.Cd,{children:["Your project will be offline for up to ",S," hour",1===S?"":"s"]}),(0,t.jsx)(d.X,{children:(0,t.jsx)("p",{children:"It is advised to upgrade at a time when there will be minimal impact for your application."})})]}),(null!==(i=null==Z?void 0:Z.potential_breaking_changes)&&void 0!==i?i:[]).length>0&&(0,t.jsxs)(d.bZ,{variant:"destructive",title:"Breaking changes",children:[(0,t.jsx)(g.Z,{className:"h-4 w-4",strokeWidth:2}),(0,t.jsx)(d.Cd,{children:"Breaking changes"}),(0,t.jsxs)(d.X,{className:"flex flex-col gap-3",children:[(0,t.jsx)("p",{children:"Your project will be upgraded across major versions of Postgres. This may involve breaking changes."}),(0,t.jsx)("div",{children:(0,t.jsx)(c.z,{size:"tiny",type:"default",asChild:!0,children:(0,t.jsx)(o(),{href:"https://supabase.com/docs/guides/platform/migrating-and-upgrading-projects#caveats",target:"_blank",rel:"noreferrer",children:"View docs"})})})]})]}),z.length>0&&(0,t.jsxs)(d.bZ,{variant:"warning",title:"Custom Postgres roles using md5 authentication have been detected",children:[(0,t.jsx)(h.Z,{className:"h-4 w-4",strokeWidth:2}),(0,t.jsx)(d.Cd,{children:"Custom Postgres roles will not work automatically after upgrade"}),(0,t.jsxs)(d.X,{className:"flex flex-col gap-3",children:[(0,t.jsx)("p",{children:"You must run a series of commands after upgrading."}),(0,t.jsx)("p",{children:"This is because new Postgres versions use scram-sha-256 authentication by default and do not support md5, as it has been deprecated."}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"mb-1",children:"Run the following commands after the upgrade:"}),(0,t.jsx)("div",{className:"flex items-baseline gap-2",children:(0,t.jsx)("code",{className:"text-xs",children:z.map(e=>(0,t.jsxs)("div",{className:"pb-1",children:["ALTER ROLE ",(0,t.jsx)("span",{className:"text-brand",children:e})," WITH PASSWORD '",(0,t.jsx)("span",{className:"text-brand",children:"newpassword"}),"';"]},e))})})]}),(0,t.jsx)("div",{children:(0,t.jsx)(c.z,{size:"tiny",type:"default",asChild:!0,children:(0,t.jsx)(o(),{href:"https://supabase.com/docs/guides/platform/migrating-and-upgrading-projects#caveats",target:"_blank",rel:"noreferrer",children:"View docs"})})})]})]}),(0,t.jsx)(v.Z,{id:"version",name:"version",label:"Select the version of Postgres to upgrade to",descriptionText:"Postgres will be upgraded from ".concat(U," to ").concat(null!==(n=null==l?void 0:null===(s=l.app_version)||void 0===s?void 0:s.split("supabase-postgres-")[1])&&void 0!==n?n:a.version),children:null==Z?void 0:Z.target_upgrade_versions.map(e=>(0,t.jsxs)(v.Z.Option,{value:e.postgres_version,label:"".concat(e.postgres_version," (").concat(e.app_version.split("supabase-postgres-")[1],")"),children:[e.postgres_version," (",e.app_version.split("supabase-postgres-")[1],")"]},e.postgres_version))})]})})}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 justify-end px-4 py-4 border-t",children:[(0,t.jsx)(c.z,{type:"default",onClick:()=>k(!1),disabled:Y,children:"Cancel"}),(0,t.jsx)(c.z,{htmlType:"submit",disabled:Y,loading:Y,children:"Confirm upgrade"})]})]})}})})]})}},83194:function(e,s,r){var t=r(52322);r(2784);var i=r(7342),n=r(97265);s.Z=function(e){return(0,t.jsx)(n.Z,{icon:i.Z,...e})}}}]);