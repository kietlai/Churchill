"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2223],{72223:function(e,n,o){o.d(n,{Z:function(){return Database_ConnectionPooling}});var s=o(52322),l=o(88883),a=o(59491),t=o(60674),r=o(2784),i=o(63955),c=o(69218),d=o(60240),u=o(84283),m=o(31915),p=o(30195),x=o(2755),f=o(7503),g=o(80035),h=o(26861),j=o(12744),b=o(20775),_=o(88847),N=o(55830),v=o(62350),y=o(62202),P=o(9402),w=o(41867);async function updatePoolingConfiguration(e){let{ref:n,pgbouncer_enabled:o,ignore_startup_parameters:s,pool_mode:l,default_pool_size:a,max_client_conn:t}=e;if(!n)return console.error("Project ref is required");let{data:r,error:i}=await (0,P.r$)("/platform/projects/{ref}/config/pgbouncer",{params:{path:{ref:n}},body:{pgbouncer_enabled:o,default_pool_size:a,ignore_startup_parameters:s,pool_mode:l,max_client_conn:t}});if(i)throw i;return r}let usePoolingConfigurationUpdateMutation=function(){let{onSuccess:e,onError:n,...o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,N.NL)();return(0,v.D)(e=>updatePoolingConfiguration(e),{async onSuccess(n,o,l){let{ref:a}=o;await s.invalidateQueries(w.A.poolingConfiguration(a)),await (null==e?void 0:e(n,o,l))},async onError(e,o,s){void 0===n?y.Am.error("Failed to update pooling configuration: ".concat(e.message)):n(e,o,s)},...o})};var C=o(89465);let Z="connection-pooling-form";var Database_ConnectionPooling=()=>{let{ref:e}=(0,t.UO)(),{data:n,error:o,isLoading:l,isError:a,isSuccess:i}=(0,_.Y)({projectRef:e});return(0,s.jsxs)(s.Fragment,{children:[l&&(0,s.jsx)(j.Z,{title:(0,s.jsx)("h5",{className:"mb-0",children:"Connection Pooling"},"panel-title"),children:(0,s.jsxs)(j.Z.Content,{className:"space-y-8",children:[Array.from({length:5}).map((e,n)=>(0,s.jsxs)(r.Fragment,{children:[(0,s.jsxs)("div",{className:"grid gap-2 items-center md:grid md:grid-cols-12 md:gap-x-4 w-full",children:[(0,s.jsx)(b.Z,{className:"h-4 w-1/3 col-span-4",delayIndex:n}),(0,s.jsx)(b.Z,{className:"h-8 w-full col-span-8",delayIndex:n})]}),(0,s.jsx)(g.Z,{light:!0})]},n)),(0,s.jsx)(b.Z,{className:"h-8 w-full"})]})}),a&&(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)(f.Z,{error:o,subject:"Failed to retrieve pooling configuration"})}),i&&(0,s.jsx)(s.Fragment,{children:(null==n?void 0:n.pgbouncer_enabled)||(null==n?void 0:n.pool_mode)!==null?(0,s.jsx)(MainConfig,{projectRef:e,poolingInfo:n}):(0,s.jsx)(j.Z,{title:(0,s.jsx)("h5",{className:"mb-0",children:"Connection Pooling is not available for this project"},"panel-title"),children:(0,s.jsx)(j.Z.Content,{children:(0,s.jsx)("p",{className:"text-foreground-light",children:"Please start a new project to enable this feature."})})})})]})};let S=p.ZP.union([p.ZP.number().positive().int(),p.ZP.string().min(1).pipe(p.ZP.coerce.number().positive().int()),p.ZP.string().max(0,"The field accepts only a number").transform(e=>null),p.ZP.null()]),F=p.ZP.object({default_pool_size:S,ignore_startup_parameters:p.ZP.string(),pool_mode:p.ZP.union([p.ZP.literal("transaction"),p.ZP.literal("session"),p.ZP.literal("statement")]),max_client_conn:S}),MainConfig=e=>{let{projectRef:n,poolingInfo:o}=e,{ui:t}=(0,C.oR)(),{project:r}=(0,x.d2)(),p=(0,C.Xo)(a.KA.UPDATE,"projects",{resource:{project_id:null==r?void 0:r.id}}),f=(0,i.cI)({resolver:(0,l.F)(F),defaultValues:{ignore_startup_parameters:o.ignore_startup_parameters,pool_mode:o.pool_mode,default_pool_size:o.default_pool_size,max_client_conn:o.max_client_conn}}),{mutateAsync:g,isLoading:b}=usePoolingConfigurationUpdateMutation({onSuccess:e=>{e&&f.reset({ignore_startup_parameters:e.ignore_startup_parameters,pool_mode:e.pool_mode,default_pool_size:e.default_pool_size,max_client_conn:e.max_client_conn}),t.setNotification({category:"success",message:"Successfully saved settings"})}}),onSubmit=async e=>{await g({ref:n,pgbouncer_enabled:o.pgbouncer_enabled,default_pool_size:e.default_pool_size,ignore_startup_parameters:e.ignore_startup_parameters,pool_mode:e.pool_mode,max_client_conn:e.max_client_conn})};return(0,s.jsxs)(j.Z,{className:"mb-8",title:(0,s.jsx)("h5",{children:"Connection Pooling"}),footer:o.pgbouncer_enabled&&(0,s.jsx)(h.iN,{form:Z,isSubmitting:b,hasChanges:f.formState.isDirty,handleReset:()=>f.reset(),helper:p?void 0:"You need additional permissions to update connection pooling settings"}),children:[o.pgbouncer_enabled&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.l0,{...f,children:(0,s.jsxs)("form",{id:Z,className:"space-y-6 w-full px-8 py-8",onSubmit:f.handleSubmit(onSubmit),children:[(0,s.jsx)(c.Wi,{control:f.control,name:"pool_mode",render:e=>{let{field:n}=e;return(0,s.jsxs)(c.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,s.jsx)(c.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Pool Mode"}),(0,s.jsx)(c.NI,{className:"col-span-8",children:(0,s.jsxs)(d.Z,{value:n.value,className:"w-full",onChange:e=>n.onChange(e),children:[(0,s.jsx)(d.Z.Option,{label:"Transaction",value:"transaction",children:"Transaction"},"transaction"),(0,s.jsx)(d.Z.Option,{label:"Session",value:"session",children:"Session"},"session")]})}),(0,s.jsxs)(c.pf,{className:"col-start-5 col-span-8",children:["Specify when a connection can be returned to the pool. Please refer to our"," ",(0,s.jsx)("a",{href:"https://supabase.com/docs/guides/database/connecting-to-postgres#connection-pool",target:"_blank",className:"underline",children:"documentation"})," ","to find out the most suitable mode for your use case."]}),(0,s.jsx)(c.zG,{className:"col-start-5 col-span-8"})]})}}),(0,s.jsx)(c.Wi,{control:f.control,name:"default_pool_size",render:e=>{let{field:n}=e;return(0,s.jsxs)(c.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,s.jsx)(c.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Default Pool Size"}),(0,s.jsx)(c.NI,{className:"col-span-8",children:(0,s.jsx)(u.I,{className:"w-full",...n,value:n.value||void 0})}),(0,s.jsxs)(c.pf,{className:"col-start-5 col-span-8",children:["The maximum number of connections made to the underlying Postgres cluster, per user+db combination. Overrides default optimizations; Please refer to our"," ",(0,s.jsx)("a",{href:"https://supabase.com/docs/guides/platform/custom-postgres-config#pooler-config",target:"_blank",className:"underline",children:"documentation"})," ","to find out more."]}),(0,s.jsx)(c.zG,{className:"col-start-5 col-span-8"})]})}}),!o.supavisor_enabled&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.Wi,{control:f.control,name:"ignore_startup_parameters",render:e=>{let{field:n}=e;return(0,s.jsxs)(c.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,s.jsx)(c.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Ignore Startup Parameters"}),(0,s.jsx)(c.NI,{className:"col-span-8",children:(0,s.jsx)(u.I,{...n,className:"w-full"})}),(0,s.jsx)(c.pf,{className:"col-start-5 col-span-8",children:'Defaults are either blank or "extra_float_digits"'}),(0,s.jsx)(c.zG,{className:"col-start-5 col-span-8"})]})}}),(0,s.jsx)(c.Wi,{control:f.control,name:"max_client_conn",render:e=>{let{field:n}=e;return(0,s.jsxs)(c.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,s.jsx)(c.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Max Client Connections"}),(0,s.jsx)(c.NI,{className:"col-span-8",children:(0,s.jsx)(u.I,{...n,value:n.value||void 0,className:"w-full"})}),(0,s.jsxs)(c.pf,{className:"col-start-5 col-span-8",children:["The maximum number of concurrent client connections allowed. Overrides default optimizations; Please refer to our"," ",(0,s.jsx)("a",{href:"https://supabase.com/docs/guides/platform/custom-postgres-config#pooler-config",target:"_blank",className:"underline",children:"documentation"})," ","to found out more."]}),(0,s.jsx)(c.zG,{className:"col-start-5 col-span-8"})]})}})]})]})}),(0,s.jsx)("div",{className:"border-muted border-t"})]}),(0,s.jsx)(m.Z,{className:"input-mono w-full px-8 py-8 flex items-center",layout:"horizontal",readOnly:!0,copy:!0,disabled:!0,value:o.db_port,label:"Port"}),(0,s.jsx)("div",{className:"border-muted border-t"}),(0,s.jsx)(m.Z,{className:"input-mono w-full px-8 py-8",layout:"vertical",readOnly:!0,copy:!0,disabled:!0,label:"Connection string",value:o.connectionString})]})}},26861:function(e,n,o){o.d(n,{iN:function(){return FormActions},ph:function(){return FormHeader},by:function(){return FormPanel},hj:function(){return FormSection},B4:function(){return FormSectionContent},S0:function(){return FormSectionLabel},ld:function(){return FormsContainer}});var s=o(52322);function FormsContainer(e){return(0,s.jsxs)("div",{className:"mx-auto max-w-4xl px-5 pt-12 pb-20",children:[e.header&&(0,s.jsx)("h1",{className:"text-foreground mb-8 text-3xl",children:e.header}),(0,s.jsx)("div",{className:"space-y-20",children:e.children})]})}var l=o(39097),a=o.n(l),t=o(29071),r=o(94580),i=o(63157);let FormHeader=e=>{let{title:n,description:o,docsUrl:l}=e;return(0,s.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("h3",{className:"text-foreground text-xl",children:(0,s.jsx)(t.D,{unwrapDisallowed:!0,disallowedElements:["p"],children:n})}),o&&(0,s.jsx)("div",{className:"text-foreground-lighter text-sm",children:(0,s.jsx)(t.D,{children:o})})]}),void 0!==l&&(0,s.jsx)(r.z,{asChild:!0,type:"default",icon:(0,s.jsx)(i.Z,{}),children:(0,s.jsx)(a(),{href:l,target:"_blank",rel:"noreferrer",children:"Documentation"})})]})};var c=o(2784);let FormSection=e=>{let{children:n,id:o,header:l,disabled:a,className:t}=e;return(0,s.jsxs)("div",{id:o,className:["grid grid-cols-12 gap-6 px-8 py-8","".concat(a?" opacity-30":" opacity-100"),"".concat(t)].join(" "),children:[l,n]})},FormSectionLabel=e=>{let{children:n,className:o="",description:l}=e;return void 0!==l?(0,s.jsxs)("div",{className:"flex flex-col space-y-2 col-span-12 lg:col-span-5 ".concat(o),children:[(0,s.jsx)("label",{className:"text-foreground text-sm",children:n}),l]}):(0,s.jsx)("label",{className:"text-foreground col-span-12 text-sm lg:col-span-5 ".concat(o),children:n})},Shimmer=()=>(0,s.jsxs)("div",{className:"flex w-full flex-col gap-2",children:[(0,s.jsx)("div",{className:"shimmering-loader h-2 w-1/3 rounded"}),(0,s.jsx)("div",{className:"flex flex-col justify-between space-y-2",children:(0,s.jsx)("div",{className:"shimmering-loader h-[34px] w-2/3 rounded"})})]}),FormSectionContent=e=>{let{children:n,loading:o=!0,fullWidth:l,className:a}=e;return(0,s.jsx)("div",{className:"\n        relative col-span-12 flex flex-col gap-6 lg:col-span-7\n        ".concat(l&&"!col-span-12","\n        ").concat(a,"\n      "),children:o?c.Children.map(n,()=>(0,s.jsx)(Shimmer,{})):n})},FormPanel=e=>{let{children:n,header:o,footer:l}=e;return(0,s.jsxs)("div",{className:" bg-surface-100 border-default overflow-hidden  rounded-md border shadow",children:[o&&(0,s.jsx)("div",{className:"border-default border-b px-8 py-4",children:o}),(0,s.jsx)("div",{className:"divide-border flex flex-col gap-0 divide-y",children:n}),l&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"border-default border-t"}),l]})]})},FormActions=e=>{let{form:n,hasChanges:o,handleReset:l,helper:a,disabled:t=!1,isSubmitting:i,submitText:c="Save"}=e,d=i||t||!o&&void 0!==o;return(0,s.jsxs)("div",{className:["flex w-full items-center gap-2",a?"justify-between":"justify-end"].join(" "),children:[a&&(0,s.jsx)("span",{className:"text-sm text-foreground-lighter",children:a}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(r.z,{disabled:d,type:"default",htmlType:"reset",onClick:()=>l(),children:"Cancel"}),(0,s.jsx)(r.z,{form:n,type:"primary",htmlType:"submit",disabled:d,loading:i,children:c})]})]})}},88847:function(e,n,o){o.d(n,{Y:function(){return usePoolingConfigurationQuery}});var s=o(58943),l=o(9402),a=o(41867);async function getPoolingConfiguration(e,n){let{projectRef:o}=e,{data:s,error:a}=await (0,l.U2)("/platform/projects/{ref}/config/pgbouncer",{params:{path:{ref:o}},signal:n});if(a)throw a;return s}let usePoolingConfigurationQuery=function(e){let{projectRef:n}=e,{enabled:o=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(a.A.poolingConfiguration(n),e=>{let{signal:o}=e;return getPoolingConfiguration({projectRef:n},o)},{enabled:o&&void 0!==n,...l})}}}]);