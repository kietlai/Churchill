"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4978],{24978:function(e,n,s){s.d(n,{Z:function(){return M}});var a=s(52322),t=s(59491),i=s(46776),o=s(39097),l=s.n(o),r=s(2784),c=s(62202),d=s(82089),m=s(63157),u=s(13781),x=s(49730),h=s(84959),f=s(1681),b=s(2755),j=s(98050),p=s(55830),v=s(62350),g=s(9402),y=s(22531);async function disableDatabaseExtension(e){let{projectRef:n,connectionString:s,id:a}=e,t=new Headers;s&&t.set("x-connection-encrypted",s);let{data:i,error:o}=await (0,g.IV)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":s},path:{ref:n},query:{id:a}},headers:t});if(o)throw o;return i}let useDatabaseExtensionDisableMutation=function(){let{onSuccess:e,onError:n,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,p.NL)();return(0,v.D)(e=>disableDatabaseExtension(e),{async onSuccess(n,s,t){let{projectRef:i}=s;await a.invalidateQueries(y.o.list(i)),await (null==e?void 0:e(n,s,t))},async onError(e,s,a){void 0===n?c.Am.error("Failed to disable database extension: ".concat(e.message)):n(e,s,a)},...s})};var w=s(89465),C=s(30877),E=s(20775),N=s(43753),S=s(12752),Z=s(57463),_=s(31915),k=s(60240),D=s(88058),z=s(59343),R=s(50074),L=s(16236),F=s(94580),Extensions_EnableExtensionModal=e=>{let{visible:n,extension:s,onCancel:t}=e,{project:i}=(0,b.d2)(),{meta:o}=(0,w.oR)(),[l,d]=(0,r.useState)(),[m,u]=(0,r.useState)(!1),{data:x,isLoading:h}=(0,S.Q1)({projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString}),{mutate:j,isLoading:p}=(0,N.k)({onSuccess:()=>{c.ZP.success("".concat(s.name," is on.")),t()},onError:e=>{c.ZP.error("Failed to enable ".concat(s.name,": ").concat(e.message))}});(0,r.useEffect)(()=>{let e=!1;if(n){let checkExtensionSchema=async()=>{e||(u(!0),d(void 0));let n=await o.query("select * from pg_available_extension_versions where name = '".concat(s.name,"'"));n.error||e||d(n[0].schema),u(!1)};checkExtensionSchema()}return()=>{e=!0}},[n,s.name]);let onSubmit=async e=>{if(void 0===i)return console.error("Project is required");let n=null!=l?l:"custom"===e.schema?e.name:e.schema;j({projectRef:i.ref,connectionString:null==i?void 0:i.connectionString,schema:n,name:s.name,version:s.default_version,cascade:!0,createSchema:!n.startsWith("pg_")})};return(0,a.jsx)(f.C,{hideFooter:!0,visible:n,onCancel:t,size:"small",header:(0,a.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,a.jsx)("h5",{className:"text-sm text-foreground",children:"Confirm to enable"}),(0,a.jsx)("code",{className:"text-xs",children:s.name})]}),children:(0,a.jsx)(Z.Z,{initialValues:{name:s.name,schema:"extensions"},validate:e=>{let n={};return"custom"!==e.schema||e.name||(n.name="Required field"),n},onSubmit:onSubmit,children:e=>{let{values:n}=e;return(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsx)(f.C.Content,{children:m||h?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(E.Z,{}),(0,a.jsx)("div",{className:"w-3/4",children:(0,a.jsx)(E.Z,{})})]}):l?(0,a.jsx)(_.Z,{disabled:!0,id:"schema",name:"schema",value:l,label:"Select a schema to enable the extension for",descriptionText:"Extension must be installed in ".concat(l,".")}):(0,a.jsxs)(k.Z,{size:"small",name:"schema",label:"Select a schema to enable the extension for",children:[(0,a.jsxs)(k.Z.Option,{id:"custom",label:'Create a new schema "'.concat(s.name,'"'),value:"custom",addOnBefore:()=>(0,a.jsx)(D.Z,{size:16,strokeWidth:1.5}),children:['Create a new schema "',s.name,'"']},"custom"),(0,a.jsx)(f.C.Separator,{}),null==x?void 0:x.map(e=>(0,a.jsx)(k.Z.Option,{id:e.name,label:e.name,value:e.name,addOnBefore:()=>(0,a.jsx)(z.Z,{size:16,strokeWidth:1.5}),children:e.name},e.id))]})}),"custom"===n.schema&&(0,a.jsx)(f.C.Content,{children:(0,a.jsx)(_.Z,{id:"name",name:"name",label:"Schema name"})}),"pg_cron"===s.name&&(null==i?void 0:i.cloud_provider)==="FLY"&&(0,a.jsx)(f.C.Content,{children:(0,a.jsxs)(R.bZ,{variant:"warning",children:[(0,a.jsx)(L.Z,{strokeWidth:2}),(0,a.jsx)(R.Cd,{children:"The pg_cron extension is not fully supported for Fly projects"}),(0,a.jsx)(R.X,{children:"You can still enable the extension, but pg_cron jobs may not run due to the behaviour of Fly projects."}),(0,a.jsx)(R.X,{className:"mt-3",children:(0,a.jsx)(F.z,{asChild:!0,type:"default",iconRight:(0,a.jsx)(C.Z,{width:12,height:12}),children:(0,a.jsx)("a",{href:"/docs/guides/platform/fly-postgres#limitations",target:"_blank",rel:"noopener noreferrer",children:(0,a.jsx)("span",{children:"Learn more"})})})})]})}),(0,a.jsx)(f.C.Separator,{}),(0,a.jsx)(f.C.Content,{children:(0,a.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,a.jsx)(F.z,{type:"default",disabled:p,onClick:()=>t(),children:"Cancel"}),(0,a.jsx)(F.z,{htmlType:"submit",disabled:p,loading:p,children:"Enable extension"})]})})]})}})})},M=(0,i.Pi)(e=>{var n,s,i,o,p;let{extension:v}=e,{project:g}=(0,b.d2)(),y=null!==v.installed_version,[C,E]=(0,r.useState)(!1),{mutate:N,isLoading:S}=useDatabaseExtensionDisableMutation({onSuccess:()=>{c.ZP.success("".concat(v.name," is off.")),k(!1)}}),Z=(0,w.Xo)(t.KA.TENANT_SQL_ADMIN_WRITE,"extensions");async function enableExtension(){return E(!0)}let[_,k]=(0,r.useState)(!1),onConfirmDisable=()=>{if(void 0===g)return console.error("Project is required");N({projectRef:g.ref,connectionString:g.connectionString,id:v.name})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex border-overlay flex-col overflow-hidden rounded border shadow-sm",children:[(0,a.jsxs)("div",{className:"border-overlay bg-surface-100 flex justify-between w-full border-b py-3 px-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 max-w-[85%]",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 truncate",children:[(0,a.jsx)("h3",{title:v.name,className:"h-5 m-0 text-sm truncate cursor-pointer text-foreground",children:v.name}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:null!==(o=null==v?void 0:v.installed_version)&&void 0!==o?o:v.default_version})]}),d.Rw.find(e=>e.name===v.name)?(0,a.jsx)(l(),{href:(null===(n=d.Rw.find(e=>e.name===v.name))||void 0===n?void 0:n.link.startsWith("/guides"))?"https://supabase.com/docs".concat(null===(s=d.Rw.find(e=>e.name===v.name))||void 0===s?void 0:s.link):null!==(p=null===(i=d.Rw.find(e=>e.name===v.name))||void 0===i?void 0:i.link)&&void 0!==p?p:"",className:"max-w-[85%] cursor-default zans",target:"_blank",rel:"noreferrer",children:(0,a.jsx)(m.Z,{className:"ml-2.5 cursor-pointer",size:14})}):null]}),S?(0,a.jsx)(u.Z,{className:"animate-spin",size:16}):(0,a.jsx)(x.Z,{size:"tiny",checked:y,disabled:!Z,onChange:()=>y?void k(!0):enableExtension()})]}),(0,a.jsxs)("div",{className:"bg-panel-header-light bg-panel-secondary-light flex h-full flex-col justify-between",children:[(0,a.jsx)("div",{className:"py-3 px-4",children:(0,a.jsx)("p",{className:"text-sm text-foreground-light capitalize-sentence",children:v.comment})}),y&&v.schema&&(0,a.jsx)("div",{className:"py-3 px-4",children:(0,a.jsxs)("div",{className:"flex items-center flex-grow space-x-2 text-sm text-foreground-light",children:[(0,a.jsx)("span",{children:"Schema:"}),(0,a.jsx)(h.Z,{color:"scale",children:"".concat(v.schema)})]})})]})]}),(0,a.jsx)(Extensions_EnableExtensionModal,{visible:C,extension:v,onCancel:()=>E(!1)}),(0,a.jsx)(j.Z,{visible:_,header:"Confirm to disable extension",buttonLabel:"Disable",buttonLoadingLabel:"Disabling",onSelectCancel:()=>k(!1),onSelectConfirm:()=>onConfirmDisable(),children:(0,a.jsx)(f.C.Content,{children:(0,a.jsxs)("p",{className:"py-4 text-sm text-foreground-light",children:['Are you sure you want to turn OFF the "',v.name,'" extension?']})})})]})})},43753:function(e,n,s){s.d(n,{k:function(){return useDatabaseExtensionEnableMutation}});var a=s(55830),t=s(62350),i=s(62202),o=s(9402),l=s(22531),r=s(70481);async function enableDatabaseExtension(e){let{projectRef:n,connectionString:s,schema:a,name:t,version:i,cascade:l=!1,createSchema:c=!1}=e,d=new Headers;if(s&&d.set("x-connection-encrypted",s),c)try{await (0,r.Rj)({projectRef:n,connectionString:s,sql:"create schema if not exists ".concat(a)})}catch(e){throw e}let{data:m,error:u}=await (0,o.v_)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":s},path:{ref:n}},body:{schema:a,name:t,version:i,cascade:l},headers:d});if(u)throw u;return m}let useDatabaseExtensionEnableMutation=function(){let{onSuccess:e,onError:n,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=(0,a.NL)();return(0,t.D)(e=>enableDatabaseExtension(e),{async onSuccess(n,s,a){let{projectRef:t}=s;await o.invalidateQueries(l.o.list(t)),await (null==e?void 0:e(n,s,a))},async onError(e,s,a){void 0===n?i.Am.error("Failed to enable database extension: ".concat(e.message)):n(e,s,a)},...s})}},59343:function(e,n,s){var a=s(52322);s(2784);var t=s(48869),i=s(97265);n.Z=function(e){return(0,a.jsx)(i.Z,{icon:t.Z,...e})}}}]);